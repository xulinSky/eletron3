"use strict";(self.webpackChunkvue2_project=self.webpackChunkvue2_project||[]).push([[819],{60:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(6368),n=i(4699);class l{static get(t){if(t){if(null===t[s.QG]||void 0===t[s.QG])if("object"==typeof t){const e=(0,n.qQ)(t.constructor);t[s.QG]=`${e}#${l.counter++}`}else"function"==typeof t&&(t[s.QG]="Function#"+l.counter++);return t[s.QG]}return null}static clear(t){delete t[s.QG]}}l.FIELD_NAME=s.QG,l.counter=0;const r=l},124:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t="",...e){if(this.consumed=!1,this.name=t,this.properties={},e[0]&&e[0].constructor===Object)for(const[t,i]of Object.entries(e[0]))this.properties[t]=i;else for(let t=0;t<e.length;t+=2)null!==e[t+1]&&(this.properties[e[t]]=e[t+1])}getName(){return this.name}getProperties(){return this.properties}getProperty(t){return this.properties[t]}isConsumed(){return this.consumed}consume(){this.consumed=!0}}},715:(t,e,i)=>{i.d(e,{A:()=>n});class s{constructor(t=0,e=0){this._x=0,this._y=0,this.x=t,this.y=e}get x(){return this._x}set x(t){if(Number.isNaN(t))throw new Error("Invalid x supplied.");this._x=t}get y(){return this._y}set y(t){if(Number.isNaN(t))throw new Error("Invalid y supplied.");this._y=t}equals(t){return!!t&&t.x===this.x&&t.y===this.y}clone(){return new s(this.x,this.y)}}const n=s},789:(t,e,i)=>{i.d(e,{HR:()=>l,NJ:()=>r,cK:()=>n});var s=i(6368);const n={addBendOnShiftClickEnabled:!1,connectFillColor:s.XW,cursorBend:"crosshair",cursorMovable:"move",cursorTerminal:"pointer",cursorVirtualBend:"crosshair",handleShape:"square",removeBendOnShiftClickEnabled:!1,selectionColor:s.nh,selectionDashed:s.Xy,selectionStrokeWidth:s.MO,virtualBendOpacity:20,virtualBendsEnabled:!1},l={fillColor:s.yS,labelCursor:"default",labelFillColor:s.dZ,labelSize:s.aQ,size:s.r5,strokeColor:s.XA},r={cursorMovable:"move",rotationEnabled:!1,selectionColor:s.SR,selectionStrokeWidth:s.Jk,selectionDashed:s.MQ}},849:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(715),n=i(9760),l=i(8302),r=i(9827),h=i(3439);class o extends n.A{constructor(t=0,e=0,i=0,s=0){super(t,e,i,s),this.TRANSLATE_CONTROL_POINTS=!0,this.alternateBounds=null,this.sourcePoint=null,this.targetPoint=null,this.points=null,this.offset=null,this.relative=!1}setRelative(t){this.relative=t}swap(){if(this.alternateBounds){const t=new n.A(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x,this.y=this.alternateBounds.y,this.width=this.alternateBounds.width,this.height=this.alternateBounds.height,this.alternateBounds=t}}getTerminalPoint(t){return t?this.sourcePoint:this.targetPoint}setTerminalPoint(t,e){return e?this.sourcePoint=t:this.targetPoint=t,t}rotate(t,e){const i=(0,l.eh)(t),n=Math.cos(i),r=Math.sin(i);if(!this.relative){const t=new s.A(this.getCenterX(),this.getCenterY()),i=(0,l.Iq)(t,n,r,e);this.x=Math.round(i.x-this.width/2),this.y=Math.round(i.y-this.height/2)}if(this.sourcePoint){const t=(0,l.Iq)(this.sourcePoint,n,r,e);this.sourcePoint.x=Math.round(t.x),this.sourcePoint.y=Math.round(t.y)}if(this.targetPoint){const t=(0,l.Iq)(this.targetPoint,n,r,e);this.targetPoint.x=Math.round(t.x),this.targetPoint.y=Math.round(t.y)}if(this.points)for(let t=0;t<this.points.length;t+=1)if(this.points[t]){const i=(0,l.Iq)(this.points[t],n,r,e);this.points[t].x=Math.round(i.x),this.points[t].y=Math.round(i.y)}}translate(t,e){if(this.relative||(this.x+=t,this.y+=e),this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x+t,this.sourcePoint.y=this.sourcePoint.y+e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x+t,this.targetPoint.y=this.targetPoint.y+e),this.TRANSLATE_CONTROL_POINTS&&this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x+t,this.points[i].y=this.points[i].y+e)}scale(t,e,i){if(this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x*t,this.sourcePoint.y=this.sourcePoint.y*e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x*t,this.targetPoint.y=this.targetPoint.y*e),this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x*t,this.points[i].y=this.points[i].y*e);this.relative||(this.x*=t,this.y*=e,i&&(e=t=Math.min(t,e)),this.width*=t,this.height*=e)}equals(t){return!!t&&super.equals(t)&&this.relative===t.relative&&(null===this.sourcePoint&&null===t.sourcePoint||!!this.sourcePoint?.equals(t.sourcePoint))&&(null===this.targetPoint&&null===t.targetPoint||!!this.targetPoint?.equals(t.targetPoint))&&(0,r.s7)(this.points,t.points)&&(null===this.alternateBounds&&null===t.alternateBounds||!!this.alternateBounds?.equals(t.alternateBounds))&&(null===this.offset&&null===t.offset||!!this.offset?.equals(t.offset))}clone(){return(0,h.o)(this)}}const a=o},868:(t,e,i)=>{i.d(e,{De:()=>s,kD:()=>l,TG:()=>n});const s={segment:i(6368).Q5},n={buffer:10,pointsFallback:!0},l={maxAllowedDirectionChange:90,maxLoops:2e3,endDirections:["north","south","east","west"],startDirections:["north","south","east","west"],step:12};((t,e)=>{for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];Array.isArray(s)?e[i]=[...s]:e[i]=s}})(l,{})},914:(t,e,i)=>{i.d(e,{eo:()=>n,m5:()=>l});var s=i(6368);const n={i18n:new class{isEnabled(){return!1}get(){return null}addResource(){}},logger:new class{debug(t){}enter(t){}error(t,...e){}info(t){}leave(t,e){}show(){}trace(t){}warn(t){}}},l={shadowColor:s.y2,shadowOffsetX:s.Mm,shadowOffsetY:s.FK,shadowOpacity:s.RH}},1264:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e,i){this.model=t,this.cell=e,this.value=i,this.previous=i}execute(){this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous)}}},1311:(t,e,i)=>{i.d(e,{S:()=>o});var s=i(8152),n=i(715),l=i(6368),r=i(8302),h=i(868);const o=(t,e,i,o,a)=>{const{view:d}=t,c=(t.style?.segment??h.De.segment)*d.scale,g=t.absolutePoints,u=g[0],p=g[g.length-1];let f=!1;if(null!=e){const t=e.cell.getGeometry();t.relative?f=t.x<=.5:null!=i&&(f=(null!=p?p.x:i.x+i.width)<(null!=u?u.x:e.x))}if(null!=u)(e=new s.A).x=u.x,e.y=u.y;else{if(null==e)return;{const i=(0,r.ct)(e,t,!0,l.TE.NONE);i!==l.TE.NONE&&i!==l.TE.WEST+l.TE.EAST&&(f=i===l.TE.WEST)}}let y=!0;if(null!=i){const t=i.cell.getGeometry();t.relative?y=t.x<=.5:null!=e&&(y=(null!=u?u.x:e.x+e.width)<(null!=p?p.x:i.x))}if(null!=p)(i=new s.A).x=p.x,i.y=p.y;else if(null!=i){const e=(0,r.ct)(i,t,!1,l.TE.NONE);e!==l.TE.NONE&&e!=l.TE.WEST+l.TE.EAST&&(y=e===l.TE.WEST)}if(null!=e&&null!=i){const t=f?e.x:e.x+e.width,s=d.getRoutingCenterY(e),l=y?i.x:i.x+i.width,r=d.getRoutingCenterY(i),h=c;let o=f?-h:h;const g=new n.A(t+o,s);o=y?-h:h;const u=new n.A(l+o,r);if(f===y){const e=f?Math.min(t,l)-c:Math.max(t,l)+c;a.push(new n.A(e,s)),a.push(new n.A(e,r))}else if(g.x<u.x===f){const t=s+(r-s)/2;a.push(g),a.push(new n.A(g.x,t)),a.push(new n.A(u.x,t)),a.push(u)}else a.push(g),a.push(u)}}},1526:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e,i){this.src=t,this.width=e,this.height=i}}},1613:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(6368),n=i(5491);class l extends n.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isHtmlAllowed(){let t=!0;return this.style&&null!=this.style.pointerEvents&&(t=this.style.pointerEvents),!this.isRounded&&!this.glass&&0===this.rotation&&(t||this.fill!==s.x3)}paintBackground(t,e,i,n,l){let r=!0;if(this.style&&null!=this.style.pointerEvents&&(r=this.style.pointerEvents),r||this.fill!==s.x3||this.stroke!==s.x3){if(r||this.fill!==s.x3||(t.pointerEvents=!1),this.isRounded){const s=this.getArcSize(n,l);t.roundrect(e,i,n,l,s,s)}else t.rect(e,i,n,l);t.fillAndStroke()}}isRoundable(t,e,i,s,n){return!0}paintForeground(t,e,i,n,l){this.glass&&!this.outline&&this.fill!==s.x3&&this.paintGlassEffect(t,e,i,n,l,this.getArcSize(n+this.strokeWidth,l+this.strokeWidth))}}const r=l},1635:(t,e,i)=>{i.d(e,{A:()=>v});var s=i(4329),n=i(8302),l=i(7895),r=i(3161),h=i(6368),o=i(9760);const a=class{constructor(){this.enabled=!0,this.baseUrl=null,this.baseDomain=null}updateBaseUrl(){this.baseDomain=`${location.protocol}//${location.host}`,this.baseUrl=this.baseDomain+location.pathname;const t=this.baseUrl.lastIndexOf("/");t>0&&(this.baseUrl=this.baseUrl.substring(0,t+1))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getBaseUrl(){return this.baseUrl}setBaseUrl(t){this.baseUrl=t}getBaseDomain(){return this.baseDomain}setBaseDomain(t){this.baseDomain=t}isRelativeUrl(t){return t&&"//"!==t.substring(0,2)&&"http://"!==t.substring(0,7)&&"https://"!==t.substring(0,8)&&"data:image"!==t.substring(0,10)&&"file://"!==t.substring(0,7)}convert(t){return this.isEnabled()&&this.isRelativeUrl(t)&&(this.getBaseUrl()||this.updateBaseUrl(),t="/"===t.charAt(0)?this.getBaseDomain()+t:this.getBaseUrl()+t),t}};var d=i(715),c=i(3439),g=i(914);const u=class{constructor(){this.state=this.createState(),this.states=[],this.path=[],this.rotateHtml=!0,this.lastX=0,this.lastY=0,this.moveOp="M",this.lineOp="L",this.quadOp="Q",this.curveOp="C",this.closeOp="Z",this.pointerEvents=!1,this.pointerEventsValue=null,this.addOp=(t,...e)=>{if(this.path.push(t),e.length>1){const t=this.state;for(let i=1;i<e.length;i+=2)this.lastX=e[i-1],this.lastY=e[i],this.path.push(this.format((this.lastX+t.dx)*t.scale)),this.path.push(this.format((this.lastY+t.dy)*t.scale))}},this.converter=this.createUrlConverter(),this.reset()}createUrlConverter(){return new a}reset(){this.state=this.createState(),this.states=[]}createState(){return{dx:0,dy:0,scale:1,alpha:1,fillAlpha:1,strokeAlpha:1,fillColor:h.x3,gradientFillAlpha:1,gradientColor:h.x3,gradientAlpha:1,gradientDirection:"east",strokeColor:h.x3,strokeWidth:1,dashed:!1,dashPattern:"3 3",fixDash:!1,lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:h.x3,fontBorderColor:h.x3,fontSize:h.FV,fontFamily:h.CT,fontStyle:0,shadow:!1,shadowColor:g.m5.shadowColor,shadowAlpha:g.m5.shadowOpacity,shadowDx:g.m5.shadowOffsetX,shadowDy:g.m5.shadowOffsetY,rotation:0,rotationCx:0,rotationCy:0}}format(t){return Math.round(t)}rotatePoint(t,e,i,s,l){const r=i*(Math.PI/180);return(0,n.Iq)(new d.A(t,e),Math.cos(r),Math.sin(r),new d.A(s,l))}save(){this.states.push(this.state),this.state=(0,c.o)(this.state)}restore(){const t=this.states.pop();t&&(this.state=t)}setLink(t){}scale(t){this.state.scale*=t,null!==this.state.strokeWidth&&(this.state.strokeWidth*=t)}translate(t,e){this.state.dx+=t,this.state.dy+=e}rotate(t,e,i,s,n){}setAlpha(t){this.state.alpha=t}setFillAlpha(t){this.state.fillAlpha=t}setStrokeAlpha(t){this.state.strokeAlpha=t}setFillColor(t){this.state.fillColor=t??h.x3,this.state.gradientColor=h.x3}setGradient(t,e,i,s,n,l,r,h=1,o=1){const a=this.state;a.fillColor=t,a.gradientFillAlpha=h,a.gradientColor=e,a.gradientAlpha=o,a.gradientDirection=r}setStrokeColor(t){this.state.strokeColor=t??h.x3}setStrokeWidth(t){this.state.strokeWidth=t}setDashed(t,e=!1){this.state.dashed=t,this.state.fixDash=e}setDashPattern(t){this.state.dashPattern=t}setLineCap(t){this.state.lineCap=t}setLineJoin(t){this.state.lineJoin=t}setMiterLimit(t){this.state.miterLimit=t}setFontColor(t){this.state.fontColor=t??h.x3}setFontBackgroundColor(t){this.state.fontBackgroundColor=t??h.x3}setFontBorderColor(t){this.state.fontBorderColor=t??h.x3}setFontSize(t){this.state.fontSize=t}setFontFamily(t){this.state.fontFamily=t}setFontStyle(t){this.state.fontStyle=t}setShadow(t){this.state.shadow=t}setShadowColor(t){this.state.shadowColor=t??h.x3}setShadowAlpha(t){this.state.shadowAlpha=t}setShadowOffset(t,e){this.state.shadowDx=t,this.state.shadowDy=e}begin(){this.lastX=0,this.lastY=0,this.path=[]}moveTo(t,e){this.addOp(this.moveOp,t,e)}lineTo(t,e){this.addOp(this.lineOp,t,e)}quadTo(t,e,i,s){this.addOp(this.quadOp,t,e,i,s)}curveTo(t,e,i,s,n,l){this.addOp(this.curveOp,t,e,i,s,n,l)}arcTo(t,e,i,s,l,r,h){const o=(0,n.UA)(this.lastX,this.lastY,t,e,i,s,l,r,h);if(null!=o)for(let t=0;t<o.length;t+=6)this.curveTo(o[t],o[t+1],o[t+2],o[t+3],o[t+4],o[t+5])}close(t,e,i,s,n,l){this.addOp(this.closeOp)}};var p=i(8872),f=i(4699);const y="function"==typeof DOMParser&&!r.A.IS_CHROMEAPP&&!r.A.IS_EDGE&&document.getElementsByTagName("base").length>0;class m extends u{constructor(t,e){super(),this.defs=null,this.styleEnabled=!0,this.node=null,this.matchHtmlAlignment=!0,this.textEnabled=!0,this.foEnabled=!0,this.foAltText="[Object]",this.foOffset=0,this.textOffset=0,this.imageOffset=0,this.strokeTolerance=0,this.minStrokeWidth=1,this.refCount=0,this.lineHeightCorrection=1,this.pointerEventsValue="all",this.fontMetricsPadding=10,this.cacheOffsetSize=!0,this.originalRoot=null,this.root=t,this.gradients={},this.defs=null,this.styleEnabled=null!=e&&e;let i=null;if(t.ownerDocument!==document){let e=t;for(;e&&"svg"!==e.nodeName;)e=e.parentElement;i=e}i&&(i.getElementsByTagName("defs").length>0&&(this.defs=i.getElementsByTagName("defs")[0]),this.defs||(this.defs=this.createElement("defs"),null!=i.firstChild?i.insertBefore(this.defs,i.firstChild):i.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}format(t){return parseFloat(t.toFixed(2))}getBaseUrl(){let{href:t}=window.location;const e=t.lastIndexOf("#");return e>0&&(t=t.substring(0,e)),t}reset(){super.reset(),this.gradients={}}end(){}createStyle(){const t=this.createElement("style");return t.setAttribute("type","text/css"),(0,p.M9)(t,`svg{font-family:${h.CT};font-size:${h.FV};fill:none;stroke-miterlimit:10}`),t}createElement(t,e){return this.root?.ownerDocument.createElementNS(e||h.pr,t)}getAlternateText(t,e,i,n,l,r,h,o,a,d,c,g,u){return(0,s.uy)(r)?null:this.foAltText}createAlternateContent(t,e,i,n,l,r,o,a,d,c,g,u,f){const y=this.getAlternateText(t,e,i,n,l,r,o,a,d,c,g,u,f),m=this.state;if(!(0,s.uy)(y)&&m.fontSize>0){const t="top"===a?1:"bottom"===a?0:.3,n="right"===o?"end":"left"===o?"start":"middle",l=this.createElement("text");l.setAttribute("x",String(Math.round(e+m.dx))),l.setAttribute("y",String(Math.round(i+m.dy+t*m.fontSize))),l.setAttribute("fill",m.fontColor||"black"),l.setAttribute("font-family",m.fontFamily),l.setAttribute("font-size",`${Math.round(m.fontSize)}px`),"start"!==n&&l.setAttribute("text-anchor",n);const r=m.fontStyle;(0,s.bW)(r,h.hv.BOLD)&&l.setAttribute("font-weight","bold"),(0,s.bW)(r,h.hv.ITALIC)&&l.setAttribute("font-style","italic");const d=[];return(0,s.bW)(r,h.hv.UNDERLINE)&&d.push("underline"),(0,s.bW)(r,h.hv.STRIKETHROUGH)&&d.push("line-through"),d.length>0&&l.setAttribute("text-decoration",d.join(" ")),(0,p.M9)(l,y),l}return null}createGradientId(t,e,i,s,n){"#"===t.charAt(0)&&(t=t.substring(1)),"#"===e.charAt(0)&&(e=e.substring(1)),t=`${t.toLowerCase()}-${i}`,e=`${e.toLowerCase()}-${s}`;let l=null;if(null==n||"south"===n)l="s";else if("east"===n)l="e";else{const i=t;t=e,e=i,"north"===n?l="s":"west"===n&&(l="e")}return`mx-gradient-${t}-${e}-${l}`}getSvgGradient(t,e,i,s,n){const l=this.createGradientId(t,e,i,s,n);let r=this.gradients[l];if(!r){const h=this.root.ownerSVGElement;let o=0,a=`${l}-${o}`;if(h)for(r=h.ownerDocument.getElementById(a);r&&r.ownerSVGElement!==h;)a=`${l}-${o++}`,r=h.ownerDocument.getElementById(a);else a="id"+ ++this.refCount;r||(r=this.createSvgGradient(t,e,i,s,n),r.setAttribute("id",a),this.defs?this.defs.appendChild(r):h&&h.appendChild(r)),this.gradients[l]=r}return r.getAttribute("id")}createSvgGradient(t,e,i,s,n){const l=this.createElement("linearGradient");l.setAttribute("x1","0%"),l.setAttribute("y1","0%"),l.setAttribute("x2","0%"),l.setAttribute("y2","0%"),null==n||"south"===n?l.setAttribute("y2","100%"):"east"===n?l.setAttribute("x2","100%"):"north"===n?l.setAttribute("y1","100%"):"west"===n&&l.setAttribute("x1","100%");let r=i<1?`;stop-opacity:${i}`:"",h=this.createElement("stop");return h.setAttribute("offset","0%"),h.setAttribute("style",`stop-color:${t}${r}`),l.appendChild(h),r=s<1?`;stop-opacity:${s}`:"",h=this.createElement("stop"),h.setAttribute("offset","100%"),h.setAttribute("style",`stop-color:${e}${r}`),l.appendChild(h),l}addNode(t,e){const{node:i}=this,s=this.state;if(i){if("path"===i.nodeName){if(!(this.path&&this.path.length>0))return;i.setAttribute("d",this.path.join(" "))}t&&s.fillColor!==h.x3?this.updateFill():this.styleEnabled||("ellipse"===i.nodeName&&r.A.IS_FF?i.setAttribute("fill","transparent"):i.setAttribute("fill",h.x3),t=!1),e&&s.strokeColor!==h.x3?this.updateStroke():this.styleEnabled||i.setAttribute("stroke",h.x3),s.transform&&s.transform.length>0&&i.setAttribute("transform",s.transform),s.shadow&&this.root.appendChild(this.createShadow(i)),this.strokeTolerance>0&&!t&&this.root.appendChild(this.createTolerance(i)),this.pointerEvents?i.setAttribute("pointer-events",this.pointerEventsValue):this.pointerEvents||this.originalRoot||i.setAttribute("pointer-events",h.x3),("rect"!==i.nodeName&&"path"!==i.nodeName&&"ellipse"!==i.nodeName||i.getAttribute("fill")!==h.x3&&"transparent"!==i.getAttribute("fill")||i.getAttribute("stroke")!==h.x3||i.getAttribute("pointer-events")!==h.x3)&&this.root.appendChild(i),this.node=null}}updateFill(){const t=this.state;if((t.alpha<1||t.fillAlpha<1)&&this.node.setAttribute("fill-opacity",String(t.alpha*t.fillAlpha)),t.fillColor!==h.x3)if(t.gradientColor!==h.x3){const e=this.getSvgGradient(t.fillColor,t.gradientColor,t.gradientFillAlpha,t.gradientAlpha,t.gradientDirection);if(this.root?.ownerDocument===document&&y){const t=this.getBaseUrl().replace(/([()])/g,"\\$1");this.node.setAttribute("fill",`url(${t}#${e})`)}else this.node.setAttribute("fill",`url(#${e})`)}else this.node.setAttribute("fill",t.fillColor.toLowerCase())}getCurrentStrokeWidth(){return Math.max(this.minStrokeWidth,Math.max(.01,this.format(this.state.strokeWidth*this.state.scale)))}updateStroke(){const t=this.state;t.strokeColor&&t.strokeColor!==h.x3&&this.node.setAttribute("stroke",t.strokeColor.toLowerCase()),(t.alpha<1||t.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",String(t.alpha*t.strokeAlpha));const e=this.getCurrentStrokeWidth();1!==e&&this.node.setAttribute("stroke-width",String(e)),"path"===this.node.nodeName&&this.updateStrokeAttributes(),t.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((t.fixDash?1:t.strokeWidth)*t.scale))}updateStrokeAttributes(){const t=this.state;if(t.lineJoin&&"miter"!==t.lineJoin&&this.node.setAttribute("stroke-linejoin",t.lineJoin),t.lineCap){let e=t.lineCap;"flat"===e&&(e="butt"),"butt"!==e&&this.node.setAttribute("stroke-linecap",e)}null==t.miterLimit||this.styleEnabled&&10===t.miterLimit||this.node.setAttribute("stroke-miterlimit",String(t.miterLimit))}createDashPattern(t){const e=[];if("string"==typeof this.state.dashPattern){const i=this.state.dashPattern.split(" ");if(i.length>0)for(let s=0;s<i.length;s+=1)e[s]=Number(i[s])*t}return e.join(" ")}createTolerance(t){const e=t.cloneNode(!0),i=parseFloat(e.getAttribute("stroke-width")||"1")+this.strokeTolerance;return e.setAttribute("pointer-events","stroke"),e.setAttribute("visibility","hidden"),e.removeAttribute("stroke-dasharray"),e.setAttribute("stroke-width",String(i)),e.setAttribute("fill","none"),e.setAttribute("stroke","white"),e}createShadow(t){const e=t.cloneNode(!0),i=this.state;return"none"===e.getAttribute("fill")||r.A.IS_FF&&"transparent"===e.getAttribute("fill")||e.setAttribute("fill",i.shadowColor),"none"!==e.getAttribute("stroke")&&i.shadowColor&&i.shadowColor!==h.x3&&e.setAttribute("stroke",i.shadowColor),e.setAttribute("transform",`translate(${this.format(i.shadowDx*i.scale)},${this.format(i.shadowDy*i.scale)})${i.transform||""}`),e.setAttribute("opacity",String(i.shadowAlpha)),e}setLink(t){if(t){this.originalRoot=this.root;const e=this.createElement("a");null==e.setAttributeNS||this.root.ownerDocument!==document?e.setAttribute("xlink:href",t):e.setAttributeNS(h.pK,"xlink:href",t),this.root.appendChild(e),this.root=e}else this.root=this.originalRoot}rotate(t,e,i,s,n){if(0!==t||e||i){const l=this.state;if(s+=l.dx,n+=l.dy,s*=l.scale,n*=l.scale,l.transform=l.transform||"",e&&i)t+=180;else if(e!==i){const t=e?s:0,r=e?-1:1,h=i?n:0,o=i?-1:1;l.transform+=`translate(${this.format(t)},${this.format(h)})scale(${this.format(r)},${this.format(o)})translate(${this.format(-t)},${this.format(-h)})`}(e?!i:i)&&(t*=-1),0!==t&&(l.transform+=`rotate(${this.format(t)},${this.format(s)},${this.format(n)})`),l.rotation+=t,l.rotationCx=s,l.rotationCy=n}}begin(){super.begin(),this.node=this.createElement("path")}rect(t,e,i,s){const n=this.state,l=this.createElement("rect");l.setAttribute("x",String(this.format((t+n.dx)*n.scale))),l.setAttribute("y",String(this.format((e+n.dy)*n.scale))),l.setAttribute("width",String(this.format(i*n.scale))),l.setAttribute("height",String(this.format(s*n.scale))),this.node=l}roundrect(t,e,i,s,n,l){this.rect(t,e,i,s),n>0&&this.node.setAttribute("rx",String(this.format(n*this.state.scale))),l>0&&this.node.setAttribute("ry",String(this.format(l*this.state.scale)))}ellipse(t,e,i,s){const n=this.state,l=this.createElement("ellipse");l.setAttribute("cx",String(this.format((t+i/2+n.dx)*n.scale))),l.setAttribute("cy",String(this.format((e+s/2+n.dy)*n.scale))),l.setAttribute("rx",String(i/2*n.scale)),l.setAttribute("ry",String(s/2*n.scale)),this.node=l}image(t,e,i,s,n,l=!0,r=!1,o=!1){n=this.converter.convert(n);const a=this.state;t+=a.dx,e+=a.dy;const d=this.createElement("image");d.setAttribute("x",String(this.format(t*a.scale)+this.imageOffset)),d.setAttribute("y",String(this.format(e*a.scale)+this.imageOffset)),d.setAttribute("width",String(this.format(i*a.scale))),d.setAttribute("height",String(this.format(s*a.scale))),d.setAttributeNS?d.setAttributeNS(h.pK,"xlink:href",n):d.setAttribute("xlink:href",n),l||d.setAttribute("preserveAspectRatio","none"),(a.alpha<1||a.fillAlpha<1)&&d.setAttribute("opacity",String(a.alpha*a.fillAlpha));let c=this.state.transform||"";if(r||o){let n=1,l=1,h=0,d=0;r&&(n=-1,h=-i-2*t),o&&(l=-1,d=-s-2*e),c+=`scale(${n},${l})translate(${h*a.scale},${d*a.scale})`}c.length>0&&d.setAttribute("transform",c),this.pointerEvents||d.setAttribute("pointer-events","none"),this.root.appendChild(d)}convertHtml(t){const e=(new DOMParser).parseFromString(t,"text/html");return null!=e&&("<body"===(t=(new XMLSerializer).serializeToString(e.body)).substring(0,5)&&(t=t.substring(t.indexOf(">",5)+1)),"</body>"===t.substring(t.length-7,t.length)&&(t=t.substring(0,t.length-7))),t}createDiv(t){let e=t;if((0,p.Ll)(e)||(e=`<div><div>${this.convertHtml(e)}</div></div>`),document.createElementNS){const t=document.createElementNS("http://www.w3.org/1999/xhtml","div");if((0,p.Ll)(e)){const i=e,s=document.createElement("div"),n=s.cloneNode(!1);this.root.ownerDocument!==document?s.appendChild(i.cloneNode(!0)):s.appendChild(i),n.appendChild(s),t.appendChild(n)}else t.innerHTML=e;return t}return(0,p.Ll)(e)&&(e=`<div><div>${((t,e="&#xa;")=>{let i=(new XMLSerializer).serializeToString(t);return i=i.replace(/\n/g,e),i})(e)}</div></div>`),e=`<div xmlns="http://www.w3.org/1999/xhtml">${e}</div>`,(new DOMParser).parseFromString(e,"text/xml").documentElement}updateText(t,e,i,s,n,l,r,h,o,a,d){d&&d.firstChild&&d.firstChild.firstChild&&this.updateTextNodes(t,e,i,s,n,l,r,h,o,a,d.firstChild)}addForeignObject(t,e,i,s,n,l,r,h,o,a,d,c,g,u,p){const f=this.createElement("g"),y=this.createElement("foreignObject");if(y.setAttribute("style","overflow: visible; text-align: left;"),y.setAttribute("pointer-events","none"),y.appendChild(u),f.appendChild(y),this.updateTextNodes(t,e,i,s,l,r,h,a,d,c,f),this.root?.ownerDocument!==document){const g=this.createAlternateContent(y,t,e,i,s,n,l,r,h,o,a,d,c);if(null!=g){y.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");const t=this.createElement("switch");t.appendChild(y),t.appendChild(g),f.appendChild(t)}}p.appendChild(f)}updateTextNodes(t,e,i,s,n,l,r,h,o,a,d){const c=this.state.scale;m.createCss(i+2,s,n,l,r,h,o,null!=this.state.fontBackgroundColor?this.state.fontBackgroundColor:null,null!=this.state.fontBorderColor?this.state.fontBorderColor:null,`display: flex; align-items: unsafe ${"top"===l?"flex-start":"bottom"===l?"flex-end":"center"}; justify-content: unsafe ${"left"===n?"flex-start":"right"===n?"flex-end":"center"}; `,this.getTextCss(),c,(i,s,n,l,r)=>{t+=this.state.dx,e+=this.state.dy;const h=d.firstChild,o=h.firstChild,g=o.firstChild,u=g.firstChild,p=(this.rotateHtml?this.state.rotation:0)+(null!=a?a:0);let f=(0!==this.foOffset?`translate(${this.foOffset} ${this.foOffset})`:"")+(1!==c?`scale(${c})`:"");u.setAttribute("style",r),g.setAttribute("style",l),h.setAttribute("width",`${Math.ceil(1/Math.min(1,c)*100)}%`),h.setAttribute("height",`${Math.ceil(1/Math.min(1,c)*100)}%`);const y=Math.round(e+s);y<0?h.setAttribute("y",String(y)):(h.removeAttribute("y"),n+=`padding-top: ${y}px; `),o.setAttribute("style",`${n}margin-left: ${Math.round(t+i)}px;`),f+=0!==p?`rotate(${p} ${t} ${e})`:"",""!==f?d.setAttribute("transform",f):d.removeAttribute("transform"),1!==this.state.alpha?d.setAttribute("opacity",String(this.state.alpha)):d.removeAttribute("opacity")})}getTextCss(){const t=this.state,e=h.Fb?t.fontSize*h.$g+"px":h.$g*this.lineHeightCorrection;let i=`display: inline-block; font-size: ${t.fontSize}px; font-family: ${t.fontFamily}; color: ${t.fontColor}; line-height: ${e}; pointer-events: ${this.pointerEvents?this.pointerEventsValue:"none"}; `;const n=t.fontStyle;(0,s.bW)(n,h.hv.BOLD)&&(i+="font-weight: bold; "),(0,s.bW)(n,h.hv.ITALIC)&&(i+="font-style: italic; ");const l=[];return(0,s.bW)(n,h.hv.UNDERLINE)&&l.push("underline"),(0,s.bW)(n,h.hv.STRIKETHROUGH)&&l.push("line-through"),l.length>0&&(i+=`text-decoration: ${l.join(" ")}; `),i}text(t,e,i,s,n,l,r,h,o,a,d,c=0,g){if(this.textEnabled&&null!=n)if(c=null!=c?c:0,this.foEnabled&&"html"===o){const u=this.createDiv(n);null!=u&&(null!=g&&u.setAttribute("dir",g),this.addForeignObject(t,e,i,s,n,l,r,h,o,a,d,c,g,u,this.root))}else this.plainText(t+this.state.dx,e+this.state.dy,i,s,n,l,r,h,a,d,c,g)}createClip(t,e,i,s){const n=`mx-clip-${t=Math.round(t)}-${e=Math.round(e)}-${i=Math.round(i)}-${s=Math.round(s)}`;let l=0,r=`${n}-${l}`;for(;null!=document.getElementById(r);)r=`${n}-${++l}`;const h=this.createElement("clipPath");h.setAttribute("id",r);const o=this.createElement("rect");return o.setAttribute("x",String(t)),o.setAttribute("y",String(e)),o.setAttribute("width",String(i)),o.setAttribute("height",String(s)),h.appendChild(o),h}plainText(t,e,i,s,n,l,o,a,d,c,g=0,u){const y=this.state,m=y.fontSize,v=this.createElement("g");let w=y.transform||"";if(this.updateFont(v),this.pointerEvents||null!=this.originalRoot||v.setAttribute("pointer-events","none"),0!==g&&(w+=`rotate(${g},${this.format(t*y.scale)},${this.format(e*y.scale)})`),null!=u&&v.setAttribute("direction",u),c&&i>0&&s>0){let n=t,h=e;"center"===l?n-=i/2:"right"===l&&(n-=i),"fill"!==d&&("middle"===o?h-=s/2:"bottom"===o&&(h-=s));const a=this.createClip(n*y.scale-2,h*y.scale-2,i*y.scale+4,s*y.scale+4);if(null!=this.defs?this.defs.appendChild(a):this.root.appendChild(a),r.A.IS_CHROMEAPP||r.A.IS_EDGE||this.root.ownerDocument!==document)v.setAttribute("clip-path",`url(#${a.getAttribute("id")})`);else{const t=this.getBaseUrl().replace(/([()])/g,"\\$1");v.setAttribute("clip-path",`url(${t}#${a.getAttribute("id")})`)}}const x="right"===l?"end":"center"===l?"middle":"start";"start"!==x&&v.setAttribute("text-anchor",x),this.styleEnabled&&m===h.FV||v.setAttribute("font-size",m*y.scale+"px"),w.length>0&&v.setAttribute("transform",w),y.alpha<1&&v.setAttribute("opacity",String(y.alpha));const b=n.split("\n"),C=Math.round(m*h.$g),S=m+(b.length-1)*C;let A=e+m-1;"middle"===o?A-="fill"===d?s/2:(this.matchHtmlAlignment&&c&&s>0?Math.min(S,s):S)/2:"bottom"===o&&(A-="fill"===d?s:(this.matchHtmlAlignment&&c&&s>0?Math.min(S,s):S)+1);for(let e=0;e<b.length;e+=1){const i=(0,f.Bq)(b[e]);if(i){const e=this.createElement("text");e.setAttribute("x",String(this.format(t*y.scale)+this.textOffset)),e.setAttribute("y",String(this.format(A*y.scale)+this.textOffset)),(0,p.M9)(e,i),v.appendChild(e)}A+=C}this.root.appendChild(v),this.addTextBackground(v,n,t,e,i,"fill"===d?s:S,l,o,d)}updateFont(t){const e=this.state;e.fontColor&&e.fontColor!==h.x3&&t.setAttribute("fill",e.fontColor),this.styleEnabled&&e.fontFamily===h.CT||t.setAttribute("font-family",e.fontFamily);const i=e.fontStyle;(0,s.bW)(i,h.hv.BOLD)&&t.setAttribute("font-weight","bold"),(0,s.bW)(i,h.hv.ITALIC)&&t.setAttribute("font-style","italic");const n=[];(0,s.bW)(i,h.hv.UNDERLINE)&&n.push("underline"),(0,s.bW)(i,h.hv.STRIKETHROUGH)&&n.push("line-through"),n.length>0&&t.setAttribute("text-decoration",n.join(" "))}addTextBackground(t,e,i,l,r,a,d,c,g){const u=this.state;if(null!=u.fontBackgroundColor||null!=u.fontBorderColor){let p=null;if("fill"===g||"width"===g)"center"===d?i-=r/2:"right"===d&&(i-=r),"middle"===c?l-=a/2:"bottom"===c&&(l-=a),p=new o.A((i+1)*u.scale,l*u.scale,(r-2)*u.scale,(a+2)*u.scale);else if(null!=t.getBBox&&this.root.ownerDocument===document)try{p=t.getBBox(),p=new o.A(p.x,p.y+1,p.width,p.height+0)}catch(t){}if(null==p||0===p.width||0===p.height){const t=document.createElement("div");t.style.lineHeight=h.Fb?u.fontSize*h.$g+"px":String(h.$g),t.style.fontSize=`${u.fontSize}px`,t.style.fontFamily=u.fontFamily,t.style.whiteSpace="nowrap",t.style.position="absolute",t.style.visibility="hidden",t.style.display="inline-block",(0,s.bW)(u.fontStyle,h.hv.BOLD)&&(t.style.fontWeight="bold"),(0,s.bW)(u.fontStyle,h.hv.ITALIC)&&(t.style.fontStyle="italic"),e=(0,f.bG)(e,!1),t.innerHTML=e.replace(/\n/g,"<br/>"),document.body.appendChild(t);const n=t.offsetWidth,r=t.offsetHeight;document.body.removeChild(t),"center"===d?i-=n/2:"right"===d&&(i-=n),"middle"===c?l-=r/2:"bottom"===c&&(l-=r),p=new o.A((i+1)*u.scale,(l+2)*u.scale,n*u.scale,(r+1)*u.scale)}if(null!=p){const e=this.createElement("rect");e.setAttribute("fill",u.fontBackgroundColor||"none"),e.setAttribute("stroke",u.fontBorderColor||"none"),e.setAttribute("x",String(Math.floor(p.x-1))),e.setAttribute("y",String(Math.floor(p.y-1))),e.setAttribute("width",String(Math.ceil(p.width+2))),e.setAttribute("height",String(Math.ceil(p.height)));const i=u.fontBorderColor?Math.max(1,this.format(u.scale)):0;e.setAttribute("stroke-width",String(i)),this.root?.ownerDocument===document&&1===(0,n.zi)(i,2)&&e.setAttribute("transform","translate(0.5, 0.5)"),t.insertBefore(e,t.firstChild)}}}stroke(){this.addNode(!1,!0)}fill(){this.addNode(!0,!1)}fillAndStroke(){this.addNode(!0,!0)}}m.createCss=(t,e,i,s,n,r,o,a,d,c,g,u,p)=>{let f=`box-sizing: border-box; font-size: 0; text-align: ${"left"===i?"left":"right"===i?"right":"center"}; `;const y=(0,l.oM)(i,s);let m="overflow: hidden; ",v="width: 1px; ",w="height: 1px; ",x=y.x*t,b=y.y*e;o?(v=`width: ${Math.round(t)}px; `,f+=`max-height: ${Math.round(e)}px; `,b=0):"fill"===r?(v=`width: ${Math.round(t)}px; `,w=`height: ${Math.round(e)}px; `,g+="width: 100%; height: 100%; ",f+=v+w):"width"===r?(v=`width: ${Math.round(t)}px; `,g+="width: 100%; ",f+=v,b=0,e>0&&(f+=`max-height: ${Math.round(e)}px; `)):(m="",b=0);let C="";a&&(C+=`background-color: ${a}; `),d&&(C+=`border: 1px solid ${d}; `),""==m||o?g+=C:f+=C,n&&t>0?(g+=`white-space: normal; word-wrap: ${h.Cx}; `,v=`width: ${Math.round(t)}px; `,""!==m&&"fill"!==r&&(b=0)):(g+="white-space: nowrap; ",""===m&&(x=0)),p(x,b,c+v+w,f+m,g,m)};const v=m},1997:(t,e,i)=>{i.d(e,{r:()=>l});var s=i(5964);class n extends s.H{createMarker(t,e,i,s,n,l,r,h,o,a){const d=this.get(i);return d?d(t,e,i,s,n,l,r,h,o,a):null}}const l=new n},2039:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(9504),n=i(124);const l=class{constructor(t,e=!0){this.changes=[],this.significant=!0,this.undone=!1,this.redone=!1,this.source=t,this.changes=[],this.significant=e}isEmpty(){return 0===this.changes.length}isSignificant(){return this.significant}add(t){this.changes.push(t)}notify(){}die(){}undo(){if(!this.undone){this.source.fireEvent(new n.A(s.A.START_EDIT));for(let t=this.changes.length-1;t>=0;t--){const e=this.changes[t];e.execute?e.execute():e.undo&&e.undo(),this.source.fireEvent(new n.A(s.A.EXECUTED,{change:e}))}this.undone=!0,this.redone=!1,this.source.fireEvent(new n.A(s.A.END_EDIT))}this.notify()}redo(){if(!this.redone){this.source.fireEvent(new n.A(s.A.START_EDIT));const t=this.changes.length;for(let e=0;e<t;e+=1){const t=this.changes[e];null!=t.execute?t.execute():null!=t.redo&&t.redo(),this.source.fireEvent(new n.A(s.A.EXECUTED,{change:t}))}this.undone=!1,this.redone=!0,this.source.fireEvent(new n.A(s.A.END_EDIT))}this.notify()}}},2223:(t,e,i)=>{i.d(e,{d:()=>vt});var s=i(1526),n=i(124),l=i(9214),r=i(9504),h=i(9760),o=i(3161),a=i(7895),d=i(3081),c=i(6368),g=i(9715),u=i(6905),p=i(7625),f=i(2748),y=i(7821),m=i(1264),v=i(8872),w=i(3618),x=i(8595),b=i(3675),C=i(715),S=i(8302),A=i(6172),E=i(8053),M=i(1613);const T=class{constructor(t,e=!0,i=null,s=0,n=0){this.perimeter=!0,this.name=null,this.dx=0,this.dy=0,this.point=t,this.perimeter=e,this.name=i,this.dx=s,this.dy=n}};var P=i(2630),H=i(1311),L=i(4344),D=i(9827),k=i(789);class O extends b.A{constructor(t,e,i=c.Vj,s=c.G7,n=c.ir){super(t,i,s,n),this.getCell=t=>{let e=super.getCell(t);if(e!==this.edgeHandler.state.cell&&e||!this.edgeHandler.currentPoint||(e=this.edgeHandler.graph.getCellAt(this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)),e&&!e.isConnectable()){const t=e.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.graph.isSwimlane(e)&&this.edgeHandler.currentPoint&&this.graph.hitsSwimlaneContent(e,this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)||!this.edgeHandler.isConnectableCell(e)||e===this.edgeHandler.state.cell||e&&!this.edgeHandler.graph.connectableEdges&&e.isEdge()||this.edgeHandler.state.cell.isAncestor(e))&&(e=null),e&&!e.isConnectable()&&(e=null),e},this.isValidState=t=>{const e=this.edgeHandler.state.cell.getTerminal(!this.edgeHandler.isSource),i=this.edgeHandler.graph.view.getState(e),s=this.edgeHandler.graph.view.getTerminalPort(t,i,!this.edgeHandler.isSource),n=s?s.cell:null,l=this.edgeHandler.isSource?t.cell:n,r=this.edgeHandler.isSource?n:t.cell;return this.edgeHandler.error=this.edgeHandler.validateConnection(l,r),!this.edgeHandler.error},this.edgeHandler=e}}const V=class{constructor(t){if(this.error=null,this.bends=[],this.cloneEnabled=!0,this.dblClickRemoveEnabled=!1,this.mergeRemoveEnabled=!1,this.straightRemoveEnabled=!1,this.parentHighlightEnabled=!1,this.preferHtml=!1,this.allowHandleBoundsCheck=!0,this.snapToTerminals=!1,this.handleImage=null,this.labelHandleImage=null,this.tolerance=0,this.outlineConnect=!1,this.manageLabelHandle=!1,this.currentPoint=null,this.parentHighlight=null,this.index=null,this.isSource=!1,this.isTarget=!1,this.isLabel=!1,this.points=[],this.snapPoint=null,this.abspoints=[],this.startX=0,this.startY=0,this.outline=!0,this.active=!0,this.state=t,this.graph=this.state.view.graph,this.marker=this.createMarker(),this.constraintHandler=this.createConstraintHandler(),this.points=[],this.abspoints=this.getSelectionPoints(this.state),this.shape=this.createSelectionShape(this.abspoints),this.shape.dialect="svg"!==this.graph.dialect?"mixedHtml":"svg",this.shape.init(this.graph.getView().getOverlayPane()),this.shape.pointerEvents=!1,this.shape.setCursor(k.cK.cursorMovable),r.A.redirectMouseEvents(this.shape.node,this.graph,this.state),this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode===this.graph.container,!this.preferHtml){const t=this.state.getVisibleTerminalState(!0);if(null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container),!this.preferHtml){const t=this.state.getVisibleTerminalState(!1);null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container)}}const e=this.graph.getPlugin("SelectionHandler");e&&(this.graph.getSelectionCount()<e.maxCells||e.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends())),this.label=new C.A(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape=this.createLabelHandleShape(),this.initBend(this.labelShape),this.labelShape.setCursor(k.HR.labelCursor),this.customHandles=this.createCustomHandles(),this.updateParentHighlight(),this.redraw(),this.escapeHandler=(e,i)=>{const s=null!=this.index;this.reset(),s&&this.graph.cellRenderer.redraw(this.state,!1,t.view.isRendering())},this.state.view.graph.addListener(r.A.ESCAPE,this.escapeHandler)}createConstraintHandler(){return new P.A(this.graph)}isParentHighlightVisible(){const t=this.state.cell.getParent();return t?!this.graph.isCellSelected(t):null}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=h.A.fromRectangle(i),this.parentHighlight.redraw())}else i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&i&&!i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect="svg",this.parentHighlight.pointerEvents=!1,i.style.rotation&&(this.parentHighlight.rotation=i.style.rotation),this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}createCustomHandles(){return[]}isVirtualBendsEnabled(t){return k.cK.virtualBendsEnabled&&(null==this.state.style.edgeStyle||this.state.style.edgeStyle===c.x3||this.state.style.noEdgeStyle)&&"arrow"!==this.state.style.shape}isCellEnabled(t){return!0}isAddPointEvent(t){return(0,L.RT)(t)}isRemovePointEvent(t){return(0,L.RT)(t)}getSelectionPoints(t){return t.absolutePoints}createParentHighlightShape(t){const e=new M.A(h.A.fromRectangle(t),c.x3,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}createSelectionShape(t){const e=new(0,this.state.shape.constructor);return e.outline=!0,e.apply(this.state),e.isDashed=this.isSelectionDashed(),e.stroke=this.getSelectionColor(),e.isShadow=!1,e}getSelectionColor(){return k.cK.selectionColor}getSelectionStrokeWidth(){return k.cK.selectionStrokeWidth}isSelectionDashed(){return k.cK.selectionDashed}isConnectableCell(t){return!0}getCellAt(t,e){return this.outlineConnect?null:this.graph.getCellAt(t,e)}createMarker(){return new O(this.graph,this)}validateConnection(t,e){return this.graph.getEdgeValidationError(this.state.cell,t,e)}createBends(){const{cell:t}=this.state,e=[];for(let i=0;i<this.abspoints.length;i+=1)if(this.isHandleVisible(i)){const s=0===i,n=i===this.abspoints.length-1,l=s||n;(l||this.graph.isCellBendable(t))&&(t=>{const s=this.createHandleShape(t);this.initBend(s,()=>{this.dblClickRemoveEnabled&&this.removePoint(this.state,t)}),this.isHandleEnabled(i)&&s.setCursor(l?k.cK.cursorTerminal:k.cK.cursorBend),e.push(s),l||(this.points.push(new C.A(0,0)),s.node.style.visibility="hidden")})(i)}return e}createVirtualBends(){const{cell:t}=this.state,e=(this.abspoints[0],[]);if(this.graph.isCellBendable(t))for(let t=1;t<this.abspoints.length;t+=1)(t=>{this.initBend(t),t.setCursor(k.cK.cursorVirtualBend),e.push(t)})(this.createHandleShape());return e}isHandleEnabled(t){return!0}isHandleVisible(t){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),s=this.state.cell.getGeometry();return(s?this.graph.view.getEdgeStyle(this.state,s.points||void 0,e,i):null)!==H.S||0===t||t===this.abspoints.length-1}createHandleShape(t){if(this.handleImage){const t=new E.A(new h.A(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);return t.preserveImageAspect=!1,t}let e=k.HR.size;return this.preferHtml&&(e-=1),new("circle"===k.cK.handleShape?A.A:M.A)(new h.A(0,0,e,e),k.HR.fillColor,k.HR.strokeColor)}createLabelHandleShape(){if(this.labelHandleImage){const t=new E.A(new h.A(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);return t.preserveImageAspect=!1,t}const t=k.HR.labelSize;return new M.A(new h.A(0,0,t,t),k.HR.labelFillColor,k.HR.strokeColor)}initBend(t,e){this.preferHtml?(t.dialect="strictHtml",t.init(this.graph.container)):(t.dialect="svg"!==this.graph.dialect?"mixedHtml":"svg",t.init(this.graph.getView().getOverlayPane())),r.A.redirectMouseEvents(t.node,this.graph,this.state,null,null,null,e),o.A.IS_TOUCH&&t.node.setAttribute("pointer-events","none")}getHandleForEvent(t){let e=null;const i=(0,L.Er)(t.getEvent())?1:this.tolerance,s=this.allowHandleBoundsCheck&&i>0?new h.A(t.getGraphX()-i,t.getGraphY()-i,2*i,2*i):null;let n=Number.POSITIVE_INFINITY;function l(e){if(e&&e.bounds&&e.node&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility&&(t.isSource(e)||s&&(0,S.HY)(e.bounds,s))){const i=t.getGraphX()-e.bounds.getCenterX(),s=t.getGraphY()-e.bounds.getCenterY(),l=i*i+s*s;if(l<=n)return n=l,!0}return!1}if(this.isCustomHandleEvent(t)&&this.customHandles)for(let t=this.customHandles.length-1;t>=0;t--)if(l(this.customHandles[t].shape))return r.A.CUSTOM_HANDLE-t;(t.isSource(this.state.text)||l(this.labelShape))&&(e=r.A.LABEL_HANDLE);for(let t=0;t<this.bends.length;t+=1)l(this.bends[t])&&(e=t);if(this.virtualBends&&this.isAddVirtualBendEvent(t))for(let t=0;t<this.virtualBends.length;t+=1)l(this.virtualBends[t])&&(e=r.A.VIRTUAL_HANDLE-t);return e}isAddVirtualBendEvent(t){return!0}isCustomHandleEvent(t){return!0}mouseDown(t,e){const i=this.getHandleForEvent(e);if(null!==i&&this.bends[i]){const t=this.bends[i].bounds;t&&(this.snapPoint=new C.A(t.getCenterX(),t.getCenterY()))}if(k.cK.addBendOnShiftClickEnabled&&null===i&&this.isAddPointEvent(e.getEvent()))this.addPoint(this.state,e.getEvent()),e.consume();else if(null!==i&&!e.isConsumed()&&this.graph.isEnabled()){const t=e.getCell();k.cK.removeBendOnShiftClickEnabled&&this.isRemovePointEvent(e.getEvent())?this.removePoint(this.state,i):(i!==r.A.LABEL_HANDLE||t&&this.graph.isLabelMovable(t))&&(this.virtualBends&&i<=r.A.VIRTUAL_HANDLE&&(0,a.Ko)(this.virtualBends[r.A.VIRTUAL_HANDLE-i].node,100),this.start(e.getX(),e.getY(),i)),e.consume()}}start(t,e,i){if(this.startX=t,this.startY=e,this.isSource=0!==this.bends.length&&0===i,this.isTarget=0!==this.bends.length&&i===this.bends.length-1,this.isLabel=i===r.A.LABEL_HANDLE,this.isSource||this.isTarget){const{cell:t}=this.state,e=t.getTerminal(this.isSource);(null==e&&this.graph.isTerminalPointMovable(t,this.isSource)||null!=e&&this.graph.isCellDisconnectable(t,e,this.isSource))&&(this.index=i)}else this.index=i;if(null!==this.index&&this.index<=r.A.CUSTOM_HANDLE&&this.index>r.A.VIRTUAL_HANDLE&&null!=this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)t!==r.A.CUSTOM_HANDLE-this.index&&this.customHandles[t].setVisible(!1)}clonePreviewState(t,e){return this.state.clone()}getSnapToTerminalTolerance(){return this.graph.getGridSize()*this.graph.getView().scale/2}updateHint(t,e){}removeHint(){}roundLength(t){return Math.round(t)}isSnapToTerminalsEvent(t){return this.snapToTerminals&&!(0,L.CA)(t.getEvent())}getPointForEvent(t){const e=this.graph.getView(),{scale:i}=e,s=new C.A(this.roundLength(t.getGraphX()/i)*i,this.roundLength(t.getGraphY()/i)*i),n=this.getSnapToTerminalTolerance();let l=!1,r=!1;if(n>0&&this.isSnapToTerminalsEvent(t)){const t=t=>{if(t){const{x:e}=t;Math.abs(s.x-e)<n&&(s.x=e,l=!0);const{y:i}=t;Math.abs(s.y-i)<n&&(s.y=i,r=!0)}},i=i=>{i&&t(new C.A(e.getRoutingCenterX(i),e.getRoutingCenterY(i)))};i(this.state.getVisibleTerminalState(!0)),i(this.state.getVisibleTerminalState(!1));for(let e=0;e<this.state.absolutePoints.length;e+=1)t(this.state.absolutePoints[e])}if(this.graph.isGridEnabledEvent(t.getEvent())){const t=e.translate;l||(s.x=(this.graph.snap(s.x/i-t.x)+t.x)*i),r||(s.y=(this.graph.snap(s.y/i-t.y)+t.y)*i)}return s}getPreviewTerminalState(t){if(this.constraintHandler.update(t,this.isSource,!0,t.isSource(this.marker.highlight.shape)?null:this.currentPoint),this.constraintHandler.currentFocus&&this.constraintHandler.currentConstraint){this.marker.highlight&&this.marker.highlight.shape&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent");const t=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(this.state.cell.getTerminal(!this.isSource)),!this.isSource),e=t?t.cell:null,i=this.isSource?this.constraintHandler.currentFocus.cell:e,s=this.isSource?e:this.constraintHandler.currentFocus.cell;this.error=this.validateConnection(i,s);let n=null;return null===this.error&&(n=this.constraintHandler.currentFocus),(null!==this.error||n&&!this.isCellEnabled(n.cell))&&this.constraintHandler.reset(),n}if(!this.graph.isIgnoreTerminalEvent(t.getEvent())){this.marker.process(t);const e=this.marker.getValidState();return e&&!this.isCellEnabled(e.cell)&&(this.constraintHandler.reset(),this.marker.reset()),this.marker.getValidState()}return this.marker.reset(),null}getPreviewPoints(t,e){const i=this.state.cell.getGeometry();if(!i)return null;let s=(i.points||[]).slice();const n=new C.A(t.x,t.y);let l=null;if(this.isSource||this.isTarget||null===this.index)this.graph.isResetEdgesOnConnect()&&(s=[]);else{if(this.convertPoint(n,!1),this.index<=r.A.VIRTUAL_HANDLE&&s.splice(r.A.VIRTUAL_HANDLE-this.index,0,n),!this.isSource&&!this.isTarget){for(let e=0;e<this.bends.length;e+=1)if(e!==this.index){const i=this.bends[e];i&&(0,S.gR)(i.bounds,t.x,t.y)&&(this.index<=r.A.VIRTUAL_HANDLE?s.splice(r.A.VIRTUAL_HANDLE-this.index,1):s.splice(this.index-1,1),l=s)}if(!l&&this.straightRemoveEnabled&&(!e||!(0,L.CA)(e.getEvent()))){const e=this.graph.getEventTolerance()*this.graph.getEventTolerance(),i=this.state.absolutePoints.slice();i[this.index]=t;const n=this.state.getVisibleTerminalState(!0);if(null!=n){const t=this.graph.getConnectionConstraint(this.state,n,!0);null!=t&&null!=this.graph.getConnectionPoint(n,t)||(i[0]=new C.A(n.view.getRoutingCenterX(n),n.view.getRoutingCenterY(n)))}const r=this.state.getVisibleTerminalState(!1);if(null!=r){const t=this.graph.getConnectionConstraint(this.state,r,!1);null!=t&&null!=this.graph.getConnectionPoint(r,t)||(i[i.length-1]=new C.A(r.view.getRoutingCenterX(r),r.view.getRoutingCenterY(r)))}h=this.index,o=t,h>0&&h<i.length-1&&(0,S.E8)(i[h-1].x,i[h-1].y,i[h+1].x,i[h+1].y,o.x,o.y)<e&&(s.splice(h-1,1),l=s)}}null==l&&this.index>r.A.VIRTUAL_HANDLE&&(s[this.index-1]=n)}var h,o;return null!=l?l:s}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,a.A3)(this.graph.container),i=t.getEvent(),s=(0,L.El)(i),n=(0,L.xJ)(i),l=document.documentElement,r=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),h=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+e.x-r,d=this.currentPoint.y-this.graph.container.scrollTop+e.y-h;return this.outlineConnect&&!(0,L.RT)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,L.CA)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||d!==n)&&null==t.getState()&&this.marker.highlight.isHighlightAt(o,d))}updatePreviewState(t,e,i,s,n=!1){const l=this.isSource?i:this.state.getVisibleTerminalState(!0),r=this.isTarget?i:this.state.getVisibleTerminalState(!1);let h=this.graph.getConnectionConstraint(t,l,!0),o=this.graph.getConnectionConstraint(t,r,!1),a=this.constraintHandler.currentConstraint;if(null==a&&n&&(null!=i?(s.isSource(this.marker.highlight.shape)&&(e=new C.A(s.getGraphX(),s.getGraphY())),a=this.graph.getOutlineConstraint(e,i,s),this.constraintHandler.setFocus(s,i,this.isSource),this.constraintHandler.currentConstraint=a,this.constraintHandler.currentPoint=e):a=new T(null)),this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const t=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=n?c.eX:"transparent",this.marker.highlight.shape.strokeWidth=c.XZ/t/t,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const e=s.getCell();this.marker.highlight.shape.stroke=e&&e.isConnectable()&&this.marker.getValidState()!==s.getState()?"transparent":c.Vj,this.marker.highlight.shape.strokeWidth=c.es/t/t,this.marker.highlight.repaint()}}this.isSource?h=a:this.isTarget&&(o=a),(this.isSource||this.isTarget)&&(null!=a&&null!=a.point?(t.style[this.isSource?"exitX":"entryX"]=a.point.x,t.style[this.isSource?"exitY":"entryY"]=a.point.y):(delete t.style[this.isSource?"exitX":"entryX"],delete t.style[this.isSource?"exitY":"entryY"])),t.setVisibleTerminalState(l,!0),t.setVisibleTerminalState(r,!1),this.isSource&&null==l||t.view.updateFixedTerminalPoint(t,l,!0,h),this.isTarget&&null==r||t.view.updateFixedTerminalPoint(t,r,!1,o),(this.isSource||this.isTarget)&&null==i&&(t.setAbsoluteTerminalPoint(e,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.isAllowDanglingEdges()?null:"")),t.view.updatePoints(t,this.points,l,r),t.view.updateFloatingTerminalPoints(t,l,r)}mouseMove(t,e){if(null!=this.index&&null!=this.marker){if(this.currentPoint=this.getPointForEvent(e),this.error=null,!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,L.RT)(e.getEvent())&&null!=this.snapPoint&&(Math.abs(this.snapPoint.x-this.currentPoint.x)<Math.abs(this.snapPoint.y-this.currentPoint.y)?this.currentPoint.x=this.snapPoint.x:this.currentPoint.y=this.snapPoint.y),this.index<=r.A.CUSTOM_HANDLE&&this.index>r.A.VIRTUAL_HANDLE)null!=this.customHandles&&(this.customHandles[r.A.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[r.A.CUSTOM_HANDLE-this.index].positionChanged(),null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="none"));else if(this.isLabel&&this.label)this.label.x=this.currentPoint.x,this.label.y=this.currentPoint.y;else{this.points=this.getPreviewPoints(this.currentPoint,e);let t=this.isSource||this.isTarget?this.getPreviewTerminalState(e):null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?this.currentPoint=this.constraintHandler.currentPoint.clone():this.outlineConnect&&((this.isSource||this.isTarget)&&this.isOutlineConnectEvent(e)?t=this.marker.highlight.state:null!=t&&t!==e.getState()&&e.getCell()?.isConnectable()&&null!=this.marker.highlight.shape&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint(),t=null)),null==t||this.isCellEnabled(t.cell)||(t=null,this.marker.reset()),this.currentPoint){const i=this.clonePreviewState(this.currentPoint,null!=t?t.cell:null);this.updatePreviewState(i,this.currentPoint,t,e,this.outline);const s=null==this.error?this.marker.validColor:this.marker.invalidColor;this.setPreviewColor(s),this.abspoints=i.absolutePoints,this.active=!0,this.updateHint(e,this.currentPoint)}}this.drawPreview(),r.A.consume(e.getEvent()),e.consume()}}mouseUp(t,e){if(null!=this.index&&null!=this.marker){null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="");let t=this.state.cell;const{index:i}=this;if(this.index=null,e.getX()!==this.startX||e.getY()!==this.startY){const s=!this.graph.isIgnoreTerminalEvent(e.getEvent())&&this.graph.isCloneEvent(e.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(null!=this.error)this.error.length>0&&this.graph.validationAlert(this.error);else if(i<=r.A.CUSTOM_HANDLE&&i>r.A.VIRTUAL_HANDLE){if(null!=this.customHandles){const t=this.graph.getDataModel();t.beginUpdate();try{this.customHandles[r.A.CUSTOM_HANDLE-i].execute(e),null!=this.shape&&null!=this.shape.node&&(this.shape.apply(this.state),this.shape.redraw())}finally{t.endUpdate()}}}else if(this.isLabel&&this.label)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){let i=null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(i=this.constraintHandler.currentFocus.cell),!i&&this.marker.hasValidState()&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&"transparent"!==this.marker.highlight.shape.stroke&&"white"!==this.marker.highlight.shape.stroke&&(i=this.marker.validState.cell),i){const n=this.graph.getDataModel(),l=t.getParent();n.beginUpdate();try{if(s){let e=t.getGeometry();const i=this.graph.cloneCell(t);n.add(l,i,l.getChildCount()),null!=e&&(e=e.clone(),n.setGeometry(i,e));const s=t.getTerminal(!this.isSource);this.graph.connectCell(i,s,!this.isSource),t=i}t=this.connect(t,i,this.isSource,s,e)}finally{n.endUpdate()}}else if(this.graph.isAllowDanglingEdges()){const e=this.abspoints[this.isSource?0:this.abspoints.length-1];e.x=this.roundLength(e.x/this.graph.view.scale-this.graph.view.translate.x),e.y=this.roundLength(e.y/this.graph.view.scale-this.graph.view.translate.y);const i=t.getParent(),n=i?this.graph.getView().getState(i):null;null!=n&&(e.x-=n.origin.x,e.y-=n.origin.y),e.x-=this.graph.getPanDx()/this.graph.view.scale,e.y-=this.graph.getPanDy()/this.graph.view.scale,t=this.changeTerminalPoint(t,e,this.isSource,s)}}else this.active?t=this.changePoints(t,this.points,s):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell))}else this.graph.isToggleEvent(e.getEvent())&&this.graph.selectCellForEvent(this.state.cell,e.getEvent());null!=this.marker&&(this.reset(),t!==this.state.cell&&this.graph.setSelectionCell(t)),e.consume()}}reset(){if(this.active&&this.refresh(),this.error=null,this.index=null,this.points=[],this.snapPoint=null,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.active=!1,this.marker&&this.marker.reset(),this.constraintHandler.reset(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].reset();this.setPreviewColor(k.cK.selectionColor),this.removeHint(),this.redraw()}setPreviewColor(t){this.shape.stroke=t}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate();e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x),t.y=Math.round(t.y/i-s.y);const n=this.state.cell.getParent(),l=n?this.graph.getView().getState(n):n;return l&&(t.x-=l.origin.x,t.y-=l.origin.y),t}moveLabel(t,e,i){const s=this.graph.getDataModel();let n=t.cell.getGeometry();if(null!=n){const{scale:l}=this.graph.getView();if(n=n.clone(),n.relative){let s=this.graph.getView().getRelativePoint(t,e,i);n.x=Math.round(1e4*s.x)/1e4,n.y=Math.round(s.y),n.offset=new C.A(0,0),s=this.graph.view.getPoint(t,n),n.offset=new C.A(Math.round((e-s.x)/l),Math.round((i-s.y)/l))}else{const s=t.absolutePoints,r=s[0],h=s[s.length-1];if(null!=r&&null!=h){const t=r.x+(h.x-r.x)/2,s=r.y+(h.y-r.y)/2;n.offset=new C.A(Math.round((e-t)/l),Math.round((i-s)/l)),n.x=0,n.y=0}}s.setGeometry(t.cell,n)}}connect(t,e,i,s,n){return t.getParent(),this.graph.batchUpdate(()=>{let s=this.constraintHandler.currentConstraint;null==s&&(s=new T(null)),this.graph.connectCell(t,e,i,s)}),t}changeTerminalPoint(t,e,i,s){const n=this.graph.getDataModel();return n.batchUpdate(()=>{if(s){const e=t.getParent(),s=t.getTerminal(!i);t=this.graph.cloneCell(t),n.add(e,t,e.getChildCount()),n.setTerminal(t,s,!i)}let l=t.getGeometry();null!=l&&(l=l.clone(),l.setTerminalPoint(e,i),n.setGeometry(t,l),this.graph.connectCell(t,null,i,new T(null)))}),t}changePoints(t,e,i){const s=this.graph.getDataModel();return s.batchUpdate(()=>{if(i){const e=t.getParent(),i=t.getTerminal(!0),n=t.getTerminal(!1);t=this.graph.cloneCell(t),s.add(e,t,e.getChildCount()),s.setTerminal(t,i,!0),s.setTerminal(t,n,!1)}let n=t.getGeometry();null!=n&&(n=n.clone(),n.points=e,s.setGeometry(t,n))}),t}addPoint(t,e){const i=(0,a.ce)(this.graph.container,(0,L.El)(e),(0,L.xJ)(e)),s=this.graph.isGridEnabledEvent(e);this.convertPoint(i,s),this.addPointAt(t,i.x,i.y),r.A.consume(e)}addPointAt(t,e,i){let s=t.cell.getGeometry();const n=new C.A(e,i);if(null!=s){s=s.clone();const e=this.graph.view.translate,i=this.graph.view.scale;let l=new C.A(e.x*i,e.y*i);const r=this.state.cell.getParent();if(r&&r.isVertex()){const t=this.graph.view.getState(r);t&&(l=new C.A(t.x,t.y))}const h=(0,S.JQ)(t,n.x*i+l.x,n.y*i+l.y);null==s.points?s.points=[n]:s.points.splice(h,0,n),this.graph.getDataModel().setGeometry(t.cell,s),this.refresh(),this.redraw()}}removePoint(t,e){if(e>0&&e<this.abspoints.length-1){let i=this.state.cell.getGeometry();null!=i&&null!=i.points&&(i=i.clone(),(i.points||[]).splice(e-1,1),this.graph.getDataModel().setGeometry(t.cell,i),this.refresh(),this.redraw())}}getHandleFillColor(t){const e=0===t,{cell:i}=this.state,s=i.getTerminal(e);let n=k.HR.fillColor;return null!=s&&!this.graph.isCellDisconnectable(i,s,e)||null==s&&!this.graph.isTerminalPointMovable(i,e)?n=c.J8:null!=s&&this.graph.isCellDisconnectable(i,s,e)&&(n=k.cK.connectFillColor),n}redraw(t){this.abspoints=this.state.absolutePoints.slice();const e=this.state.cell.getGeometry();if(e){const t=e.points;if(null!=this.bends&&this.bends.length>0&&null!=t){null==this.points&&(this.points=[]);for(let e=1;e<this.bends.length-1;e+=1)null!=this.bends[e]&&null!=this.abspoints[e]&&(this.points[e-1]=t[e-1])}}this.drawPreview(),t||this.redrawHandles()}redrawHandles(){const{cell:t}=this.state;let e=this.labelShape.bounds;this.label=new C.A(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new h.A(Math.round(this.label.x-e.width/2),Math.round(this.label.y-e.height/2),e.width,e.height);const i=this.graph.getLabel(t);if(this.labelShape.visible=null!=i&&i.length>0&&this.graph.isLabelMovable(t),null!=this.bends&&this.bends.length>0){const t=this.abspoints.length-1,i=this.abspoints[0],s=i.x,n=i.y;e=this.bends[0].bounds,this.bends[0].bounds=new h.A(Math.floor(s-e.width/2),Math.floor(n-e.height/2),e.width,e.height),this.bends[0].fill=this.getHandleFillColor(0),this.bends[0].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);const l=this.abspoints[t],r=l.x,o=l.y,a=this.bends.length-1;e=this.bends[a].bounds,this.bends[a].bounds=new h.A(Math.floor(r-e.width/2),Math.floor(o-e.height/2),e.width,e.height),this.bends[a].fill=this.getHandleFillColor(a),this.bends[a].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[a].bounds),this.redrawInnerBends(i,l)}if(this.virtualBends&&this.virtualBends.length>0){let t=this.abspoints[0];for(let e=0;e<this.virtualBends.length;e+=1)if(null!=this.virtualBends[e]&&null!=this.abspoints[e+1]){const i=this.abspoints[e+1],s=this.virtualBends[e],n=t.x+(i.x-t.x)/2,l=t.y+(i.y-t.y)/2;s.bounds&&(s.bounds=new h.A(Math.floor(n-s.bounds.width/2),Math.floor(l-s.bounds.height/2),s.bounds.width,s.bounds.height),s.redraw()),(0,a.Ko)(s.node,k.cK.virtualBendOpacity),t=i,this.manageLabelHandle&&this.checkLabelHandle(s.bounds)}}if(this.labelShape.redraw(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}setHandlesVisible(t){for(let e=0;e<this.bends.length;e+=1)this.bends[e].node.style.display=t?"":"none";if(this.virtualBends)for(let e=0;e<this.virtualBends.length;e+=1)this.virtualBends[e].node.style.display=t?"":"none";if(this.labelShape.node.style.display=t?"":"none",this.customHandles)for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}redrawInnerBends(t,e){for(let t=1;t<this.bends.length-1;t+=1)if(null!=this.bends[t])if(null!=this.abspoints[t]){const{x:e}=this.abspoints[t],{y:i}=this.abspoints[t],s=this.bends[t].bounds;if(this.bends[t].node.style.visibility="visible",this.bends[t].bounds=new h.A(Math.round(e-s.width/2),Math.round(i-s.height/2),s.width,s.height),this.manageLabelHandle)this.checkLabelHandle(this.bends[t].bounds);else if(null==this.handleImage&&this.labelShape.visible&&(0,S.HY)(this.bends[t].bounds,this.labelShape.bounds)){const s=k.HR.size+3,n=s;this.bends[t].bounds=new h.A(Math.round(e-s/2),Math.round(i-n/2),s,n)}this.bends[t].redraw()}else this.bends[t].destroy()}checkLabelHandle(t){const e=this.labelShape.bounds;(0,S.HY)(t,e)&&(t.getCenterY()<e.getCenterY()?e.y=t.y+t.height:e.y=t.y-e.height)}drawPreview(){try{if(this.isLabel){const t=this.labelShape.bounds,e=new h.A(Math.round(this.label.x-t.width/2),Math.round(this.label.y-t.height/2),t.width,t.height);t.equals(e)||(this.labelShape.bounds=e,this.labelShape.redraw())}null==this.shape||(0,D.s7)(this.shape.points,this.abspoints)||(this.shape.apply(this.state),this.shape.points=this.abspoints.slice(),this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokeWidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.isShadow=!1,this.shape.redraw()),this.updateParentHighlight()}catch(t){}}refresh(){null!=this.state&&(this.abspoints=this.getSelectionPoints(this.state),this.points=[],this.destroyBends(this.bends),this.bends=this.createBends(),this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends()),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles()),null!=this.labelShape&&null!=this.labelShape.node&&null!=this.labelShape.node.parentNode&&this.labelShape.node.parentNode.appendChild(this.labelShape.node))}isDestroyed(){return null==this.shape}destroyBends(t){if(null!=t)for(let e=0;e<t.length;e+=1)null!=t[e]&&t[e].destroy()}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.marker.destroy(),this.marker=null,this.shape.destroy(),this.shape=null,this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.labelShape.destroy(),this.labelShape=null,this.constraintHandler.onDestroy(),this.constraintHandler=null,this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=[]),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=[]),this.destroyBends(this.bends),this.bends=[],this.removeHint()}},B=class{isRotationEnabled(){return k.NJ.rotationEnabled}constructor(t){this.sizers=[],this.singleSizer=!1,this.index=null,this.allowHandleBoundsCheck=!0,this.handleImage=null,this.handlesVisible=!0,this.tolerance=0,this.parentHighlightEnabled=!1,this.rotationRaster=!0,this.rotationCursor="crosshair",this.livePreview=!1,this.movePreviewToFront=!1,this.manageSizers=!1,this.constrainGroupByChildren=!1,this.rotationHandleVSpacing=-16,this.horizontalOffset=0,this.verticalOffset=0,this.minBounds=null,this.x0=0,this.y0=0,this.customHandles=[],this.inTolerance=!1,this.startX=0,this.startY=0,this.rotationShape=null,this.currentAlpha=null,this.startAngle=0,this.startDist=0,this.ghostPreview=null,this.livePreviewActive=!1,this.childOffsetX=0,this.childOffsetY=0,this.parentState=null,this.parentHighlight=null,this.unscaledBounds=null,this.preview=null,this.labelShape=null,this.edgeHandlers=[],this.EMPTY_POINT=new C.A,this.state=t,this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new h.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect="svg",this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=this.state.style.rotation??0,this.selectionBorder.init(this.graph.getView().getOverlayPane()),r.A.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(k.NJ.cursorMovable);const e=this.getSelectionHandler();if(e&&(e.maxCells<=0||this.graph.getSelectionCount()<e.maxCells)){const t=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],t||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){let e=0;t&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",e++)),this.sizers.push(this.createSizer("n-resize",e++)),this.sizers.push(this.createSizer("ne-resize",e++)),this.sizers.push(this.createSizer("w-resize",e++)),this.sizers.push(this.createSizer("e-resize",e++)),this.sizers.push(this.createSizer("sw-resize",e++)),this.sizers.push(this.createSizer("s-resize",e++))),this.sizers.push(this.createSizer("se-resize",e++)));const i=this.state.cell.getGeometry();null==i||i.relative||this.graph.isSwimlane(this.state.cell)||!this.graph.isLabelMovable(this.state.cell)||(this.labelShape=this.createSizer(k.HR.labelCursor,r.A.LABEL_HANDLE,k.HR.labelSize,k.HR.labelFillColor),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(k.NJ.cursorMovable,r.A.LABEL_HANDLE,void 0,k.HR.labelFillColor),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,r.A.ROTATION_HANDLE,k.HR.size+3,k.HR.fillColor),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds(),this.escapeHandler=(t,e)=>{this.livePreview&&null!=this.index&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()},this.state.view.graph.addListener(r.A.ESCAPE,this.escapeHandler)}getSelectionHandler(){return this.graph.getPlugin("SelectionHandler")}isRotationHandleVisible(){const t=this.getSelectionHandler(),e=!t||t.maxCells<=0||this.graph.getSelectionCount()<t.maxCells;return this.graph.isEnabled()&&this.isRotationEnabled()&&this.graph.isCellRotatable(this.state.cell)&&e}isConstrainedEvent(t){return(0,L.RT)(t.getEvent())||"fixed"===this.state.style.aspect}isCenteredEvent(t,e){return!1}createCustomHandles(){return[]}updateMinBounds(){const t=this.graph.getChildCells(this.state.cell);if(t.length>0&&(this.minBounds=this.graph.view.getBounds(t),this.minBounds)){const t=this.state.view.scale,e=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=t,this.minBounds.y/=t,this.minBounds.width/=t,this.minBounds.height/=t,this.x0=this.state.x/t-e.x,this.y0=this.state.y/t-e.y}}getSelectionBounds(t){return new h.A(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height))}createParentHighlightShape(t){return this.createSelectionShape(t)}createSelectionShape(t){const e=new M.A(h.A.fromRectangle(t),c.x3,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}getSelectionColor(){return k.NJ.selectionColor}getSelectionStrokeWidth(){return k.NJ.selectionStrokeWidth}isSelectionDashed(){return k.NJ.selectionDashed}createSizer(t,e,i=k.HR.size,s=k.HR.fillColor){const n=new h.A(0,0,i,i),l=this.createSizerShape(n,e,s);return l.bounds&&l.isHtmlAllowed()&&this.state.text&&this.state.text.node.parentNode===this.graph.container?(l.bounds.height-=1,l.bounds.width-=1,l.dialect="strictHtml",l.init(this.graph.container)):(l.dialect="svg"!==this.graph.dialect?"mixedHtml":"svg",l.init(this.graph.getView().getOverlayPane())),r.A.redirectMouseEvents(l.node,this.graph,this.state),this.graph.isEnabled()&&l.setCursor(t),this.isSizerVisible(e)||(l.visible=!1),l}isSizerVisible(t){return!0}createSizerShape(t,e,i=k.HR.fillColor){if(this.handleImage){t=new h.A(t.x,t.y,this.handleImage.width,this.handleImage.height);const e=new E.A(t,this.handleImage.src);return e.preserveImageAspect=!1,e}const s=k.HR.strokeColor;return e===r.A.ROTATION_HANDLE?new A.A(t,i,s):new M.A(t,i,s)}moveSizerTo(t,e,i){t&&t.bounds&&(t.bounds.x=Math.floor(e-t.bounds.width/2),t.bounds.y=Math.floor(i-t.bounds.height/2),t.node&&"none"!==t.node.style.display&&t.redraw())}getHandleForEvent(t){const e=(0,L.Er)(t.getEvent())?1:this.tolerance,i=this.allowHandleBoundsCheck&&e>0?new h.A(t.getGraphX()-e,t.getGraphY()-e,2*e,2*e):null,s=e=>{const s=e&&e.constructor!==E.A&&this.allowHandleBoundsCheck?e.strokeWidth+e.svgStrokeTolerance:null,n=s?new h.A(t.getGraphX()-Math.floor(s/2),t.getGraphY()-Math.floor(s/2),s,s):i;return e&&e.bounds&&(t.isSource(e)||n&&(0,S.HY)(e.bounds,n)&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility)};if(s(this.rotationShape))return r.A.ROTATION_HANDLE;if(s(this.labelShape))return r.A.LABEL_HANDLE;for(let t=0;t<this.sizers.length;t+=1)if(s(this.sizers[t]))return t;if(null!=this.customHandles&&this.isCustomHandleEvent(t))for(let t=this.customHandles.length-1;t>=0;t--)if(s(this.customHandles[t].shape))return r.A.CUSTOM_HANDLE-t;return null}isCustomHandleEvent(t){return!0}mouseDown(t,e){if(!e.isConsumed()&&this.graph.isEnabled()){const t=this.getHandleForEvent(e);t&&(this.start(e.getGraphX(),e.getGraphY(),t),e.consume())}}isLivePreviewBorder(){return this.state.shape&&this.state.shape.fill===c.x3&&this.state.shape.stroke===c.x3}start(t,e,i){if(this.livePreviewActive=this.livePreview&&0===this.state.cell.getChildCount(),this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=i,this.startX=t,this.startY=e,this.index<=r.A.CUSTOM_HANDLE&&this.isGhostPreview())this.ghostPreview=this.createGhostPreview();else{const t=this.state.cell.getParent();if(this.state.view.currentRoot!==t&&t&&(t.isVertex()||t.isEdge())&&(this.parentState=this.state.view.graph.view.getState(t)),this.selectionBorder.node.style.display=i===r.A.ROTATION_HANDLE?"inline":"none",this.livePreviewActive&&!this.isLivePreviewBorder()||(this.preview=this.createSelectionShape(this.bounds),o.A.IS_SVG&&0!=(this.state.style.rotation??0)||null==this.state.text||this.state.text.node.parentNode!==this.graph.container?(this.preview.dialect="svg",this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect="strictHtml",this.preview.init(this.graph.container))),i===r.A.ROTATION_HANDLE){const t=this.getRotationHandlePosition(),e=t.x-this.state.getCenterX(),i=t.y-this.state.getCenterY();this.startAngle=0!==e?180*Math.atan(i/e)/Math.PI+90:0,this.startDist=Math.sqrt(e*e+i*i)}if(this.livePreviewActive){this.hideSizers(),i===r.A.ROTATION_HANDLE&&this.rotationShape?this.rotationShape.node.style.display="":i===r.A.LABEL_HANDLE&&this.labelShape?this.labelShape.node.style.display="":this.sizers[i]?this.sizers[i].node.style.display="":i<=r.A.CUSTOM_HANDLE&&this.customHandles[r.A.CUSTOM_HANDLE-i].setVisible(!0);const t=this.state.cell.getEdges();this.edgeHandlers=[];const e=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i]);s&&this.edgeHandlers.push(s)}}}}createGhostPreview(){const t=this.graph.cellRenderer.createShape(this.state);return t.init(this.graph.view.getOverlayPane()),t.scale=this.state.view.scale,t.bounds=this.bounds,t.outline=!0,t}setHandlesVisible(t){this.handlesVisible=t;for(let e=0;e<this.sizers.length;e+=1)this.sizers[e].node.style.display=t?"":"none";for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}hideSizers(){this.setHandlesVisible(!1)}checkTolerance(t){this.inTolerance&&null!==this.startX&&null!==this.startY&&((0,L.Er)(t.getEvent())||Math.abs(t.getGraphX()-this.startX)>this.graph.getEventTolerance()||Math.abs(t.getGraphY()-this.startY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}updateHint(t){}removeHint(){}roundAngle(t){return Math.round(10*t)/10}roundLength(t){return Math.round(100*t)/100}mouseMove(t,e){e.isConsumed()||null==this.index?!this.graph.isMouseDown&&this.getHandleForEvent(e)&&e.consume(!1):(this.checkTolerance(e),this.inTolerance||(this.index<=r.A.CUSTOM_HANDLE?null!=this.customHandles&&(this.customHandles[r.A.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[r.A.CUSTOM_HANDLE-this.index].active=!0,null!=this.ghostPreview?(this.ghostPreview.apply(this.state),this.ghostPreview.strokeWidth=this.getSelectionStrokeWidth()/this.ghostPreview.scale/this.ghostPreview.scale,this.ghostPreview.isDashed=this.isSelectionDashed(),this.ghostPreview.stroke=this.getSelectionColor(),this.ghostPreview.redraw(),null!=this.selectionBounds&&(this.selectionBorder.node.style.display="none")):(this.movePreviewToFront&&this.moveToFront(),this.customHandles[r.A.CUSTOM_HANDLE-this.index].positionChanged())):this.index===r.A.LABEL_HANDLE?this.moveLabel(e):(this.index===r.A.ROTATION_HANDLE?this.rotateVertex(e):this.resizeVertex(e),this.updateHint(e))),e.consume())}isGhostPreview(){return this.state.cell.getChildCount()>0}moveLabel(t){const e=new C.A(t.getGraphX(),t.getGraphY()),i=this.graph.view.translate,{scale:s}=this.graph.view;this.graph.isGridEnabledEvent(t.getEvent())&&(e.x=(this.graph.snap(e.x/s-i.x)+i.x)*s,e.y=(this.graph.snap(e.y/s-i.y)+i.y)*s);const n=this.rotationShape?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[n],e.x,e.y)}rotateVertex(t){const e=new C.A(t.getGraphX(),t.getGraphY());let i=this.state.x+this.state.width/2-e.x,s=this.state.y+this.state.height/2-e.y;if(this.currentAlpha=0!==i?180*Math.atan(s/i)/Math.PI+90:s<0?180:0,i>0&&(this.currentAlpha-=180),this.currentAlpha-=this.startAngle,this.rotationRaster&&this.graph.isGridEnabledEvent(t.getEvent())){let t;i=e.x-this.state.getCenterX(),s=e.y-this.state.getCenterY();const n=Math.sqrt(i*i+s*s);t=n-this.startDist<2?15:n-this.startDist<25?5:1,this.currentAlpha=Math.round(this.currentAlpha/t)*t}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreviewActive&&this.redrawHandles()}resizeVertex(t){const e=new C.A(this.state.getCenterX(),this.state.getCenterY()),i=(0,S.eh)(this.state.style.rotation??0),s=new C.A(t.getGraphX(),t.getGraphY()),n=this.graph.view.translate,{scale:l}=this.graph.view;let r=Math.cos(-i),o=Math.sin(-i),a=s.x-this.startX,d=s.y-this.startY;const c=o*a+r*d;a=r*a-o*d,d=c;const g=this.state.cell.getGeometry();if(g&&null!==this.index&&(this.unscaledBounds=this.union(g,a/l,d/l,this.index,this.graph.isGridEnabledEvent(t.getEvent()),1,new C.A(0,0),this.isConstrainedEvent(t),this.isCenteredEvent(this.state,t))),g&&!g.relative){let t=this.graph.getMaximumGraphBounds();if(null!=t&&null!=this.parentState&&(t=h.A.fromRectangle(t),t.x-=(this.parentState.x-n.x*l)/l,t.y-=(this.parentState.y-n.y*l)/l),this.graph.isConstrainChild(this.state.cell)){let e=this.graph.getCellContainmentArea(this.state.cell);if(null!=e){const i=this.graph.getOverlap(this.state.cell);i>0&&(e=h.A.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),t?(t=h.A.fromRectangle(t),t.intersect(e)):t=e}}t&&this.unscaledBounds&&(this.unscaledBounds.x<t.x&&(this.unscaledBounds.width-=t.x-this.unscaledBounds.x,this.unscaledBounds.x=t.x),this.unscaledBounds.y<t.y&&(this.unscaledBounds.height-=t.y-this.unscaledBounds.y,this.unscaledBounds.y=t.y),this.unscaledBounds.x+this.unscaledBounds.width>t.x+t.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-t.x-t.width),this.unscaledBounds.y+this.unscaledBounds.height>t.y+t.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-t.y-t.height))}if(this.unscaledBounds){const s=this.bounds;this.bounds=new h.A((this.parentState?this.parentState.x:n.x*l)+this.unscaledBounds.x*l,(this.parentState?this.parentState.y:n.y*l)+this.unscaledBounds.y*l,this.unscaledBounds.width*l,this.unscaledBounds.height*l),g&&g.relative&&this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),r=Math.cos(i),o=Math.sin(i);const c=new C.A(this.bounds.getCenterX(),this.bounds.getCenterY());a=c.x-e.x,d=c.y-e.y;const u=r*a-o*d-a,p=o*a+r*d-d,f=this.bounds.x-this.state.x,y=this.bounds.y-this.state.y,m=r*f-o*y,v=o*f+r*y;this.bounds.x+=u,this.bounds.y+=p,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+u/l),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+p/l),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),this.state.cell.isCollapsed()||0===u&&0===p?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+m,this.childOffsetY=this.state.y-this.bounds.y+v),s.equals(this.bounds)||(this.livePreviewActive&&this.updateLivePreview(t),null!=this.preview?this.drawPreview():this.updateParentHighlight())}}updateLivePreview(t){const{scale:e}=this.graph.view,i=this.graph.view.translate,s=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new C.A(this.state.x/e-i.x,this.state.y/e-i.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height;let n=this.state.absoluteOffset;n=new C.A(n.x,n.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;const l=this.state.cell.getGeometry();if(null!=l){const t=l.offset||this.EMPTY_POINT;null==t||l.relative||(this.state.absoluteOffset.x=this.state.view.scale*t.x,this.state.absoluteOffset.y=this.state.view.scale*t.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.movePreviewToFront&&this.moveToFront(),null!=this.state.control&&null!=this.state.control.node&&(this.state.control.node.style.visibility="hidden"),this.state.setState(s)}moveToFront(){(this.state.text&&this.state.text.node&&this.state.text.node.nextSibling||this.state.shape&&this.state.shape.node&&this.state.shape.node.nextSibling&&(!this.state.text||this.state.shape.node.nextSibling!==this.state.text.node))&&(this.state.shape&&this.state.shape.node&&this.state.shape.node.parentNode&&this.state.shape.node.parentNode.appendChild(this.state.shape.node),this.state.text&&this.state.text.node&&this.state.text.node.parentNode&&this.state.text.node.parentNode.appendChild(this.state.text.node))}mouseUp(t,e){if(null!=this.index&&null!=this.state){const t=new C.A(e.getGraphX(),e.getGraphY()),{index:i}=this;this.index=null,null==this.ghostPreview&&(this.state.view.invalidate(this.state.cell,!1,!1),this.state.view.validate()),this.graph.batchUpdate(()=>{if(i<=r.A.CUSTOM_HANDLE){if(null!=this.customHandles){const t=this.state.view.graph.getCellStyle(this.state.cell);this.customHandles[r.A.CUSTOM_HANDLE-i].active=!1,this.customHandles[r.A.CUSTOM_HANDLE-i].execute(e),null!=this.customHandles&&null!=this.customHandles[r.A.CUSTOM_HANDLE-i]&&(this.state.style=t,this.customHandles[r.A.CUSTOM_HANDLE-i].positionChanged())}}else if(i===r.A.ROTATION_HANDLE)if(null!=this.currentAlpha){const t=this.currentAlpha-(this.state.style.rotation??0);0!==t&&this.rotateCell(this.state.cell,t)}else this.rotateClick();else{const s=this.graph.isGridEnabledEvent(e.getEvent()),n=(0,S.eh)(this.state.style.rotation??0),l=Math.cos(-n),r=Math.sin(-n);let h=t.x-this.startX,o=t.y-this.startY;const a=r*h+l*o;h=l*h-r*o,o=a;const d=this.graph.view.scale,c=this.isRecursiveResize(this.state,e);this.resizeCell(this.state.cell,this.roundLength(h/d),this.roundLength(o/d),i,s,this.isConstrainedEvent(e),c)}}),e.consume(),this.reset(),this.redrawHandles()}}isRecursiveResize(t,e){return this.graph.isRecursiveResize(this.state)}rotateClick(){}rotateCell(t,e,i){if(0!==e){const s=this.graph.getDataModel();if(t.isVertex()||t.isEdge()){if(!t.isEdge()){const i=(this.graph.getCurrentCellStyle(t).rotation??0)+e;this.graph.setCellStyles("rotation",i,[t])}let n=t.getGeometry();if(n&&i){const l=i.getGeometry();if(null==l||i.isEdge()||(n=n.clone(),n.rotate(e,new C.A(l.width/2,l.height/2)),s.setGeometry(t,n)),t.isVertex()&&!n.relative||t.isEdge()){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.rotateCell(t.getChildAt(s),e,t)}}}}}reset(){if(null!==this.index&&"none"===this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display=""),this.index=null,this.currentAlpha=null,this.preview&&(this.preview.destroy(),this.preview=null),this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.livePreviewActive){for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].node.style.display="";this.state.control&&this.state.control.node&&(this.state.control.node.style.visibility="")}for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].active?(this.customHandles[t].active=!1,this.customHandles[t].reset()):this.customHandles[t].setVisible(!0);this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new h.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),this.removeHint(),this.redrawHandles(),this.edgeHandlers=[],this.handlesVisible=!0,this.unscaledBounds=null}resizeCell(t,e,i,s,n,l,h){let o=t.getGeometry();if(o)if(s===r.A.LABEL_HANDLE&&this.labelShape&&this.labelShape.bounds){const e=-(0,S.eh)(this.state.style.rotation??0),i=Math.cos(e),s=Math.sin(e),{scale:n}=this.graph.view,l=(0,S.Iq)(new C.A(Math.round((this.labelShape.bounds.getCenterX()-this.startX)/n),Math.round((this.labelShape.bounds.getCenterY()-this.startY)/n)),i,s);o=o.clone(),null==o.offset?o.offset=l:(o.offset.x+=l.x,o.offset.y+=l.y),this.graph.model.setGeometry(t,o)}else if(this.unscaledBounds){const{scale:e}=this.graph.view;0===this.childOffsetX&&0===this.childOffsetY||this.moveChildren(t,Math.round(this.childOffsetX/e),Math.round(this.childOffsetY/e)),this.graph.resizeCell(t,this.unscaledBounds,h)}}moveChildren(t,e,i){const s=this.graph.getDataModel(),n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l);let r=n.getGeometry();null!=r&&(r=r.clone(),r.translate(e,i),s.setGeometry(n,r))}}union(t,e,i,s,n,l,r,o,a){if(n=n&&this.graph.isGridEnabled(),this.singleSizer){let s=t.x+t.width+e,r=t.y+t.height+i;n&&(s=this.graph.snap(s/l)*l,r=this.graph.snap(r/l)*l);const o=new h.A(t.x,t.y,0,0);return o.add(new h.A(s,r,0,0)),o}const d=t.width,c=t.height;let g=t.x-r.x*l,u=g+d,p=t.y-r.y*l,f=p+c;const y=g+d/2,m=p+c/2;s>4?(f+=i,f=n?this.graph.snap(f/l)*l:Math.round(f/l)*l):s<3&&(p+=i,p=n?this.graph.snap(p/l)*l:Math.round(p/l)*l),0===s||3===s||5===s?(g+=e,g=n?this.graph.snap(g/l)*l:Math.round(g/l)*l):2!==s&&4!==s&&7!==s||(u+=e,u=n?this.graph.snap(u/l)*l:Math.round(u/l)*l);let v=u-g,w=f-p;if(o){const t=this.state.cell.getGeometry();if(null!=t){const e=t.width/t.height;1===s||2===s||7===s||6===s?v=w*e:w=v/e,0===s&&(g=u-v,p=f-w)}}if(a){v+=v-d,w+=w-c;const t=y-(g+v/2),e=m-(p+w/2);g+=t,p+=e,u+=t,f+=e}v<0&&(g+=v,v=Math.abs(v)),w<0&&(p+=w,w=Math.abs(w));const x=new h.A(g+r.x*l,p+r.y*l,v,w);return null!=this.minBounds&&(x.width=Math.max(x.width,this.minBounds.x*l+this.minBounds.width*l+Math.max(0,this.x0*l-x.x)),x.height=Math.max(x.height,this.minBounds.y*l+this.minBounds.height*l+Math.max(0,this.y0*l-x.y))),x}redraw(t){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new h.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),t||this.redrawHandles()}getHandlePadding(){const t=new C.A(0,0);let e=this.tolerance;return this.sizers.length>0&&this.sizers[0].bounds&&(this.bounds.width<2*this.sizers[0].bounds.width+2*e||this.bounds.height<2*this.sizers[0].bounds.height+2*e)&&(e/=2,t.x=this.sizers[0].bounds.width+e,t.y=this.sizers[0].bounds.height+e),t}getSizerBounds(){return this.bounds}redrawHandles(){let t=this.getSizerBounds();const e=this.tolerance;this.horizontalOffset=0,this.verticalOffset=0;for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.handlesVisible&&this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}if(this.sizers.length>0&&this.sizers[0]){if(null===this.index&&this.manageSizers&&this.sizers.length>=8){const i=this.getHandlePadding();this.horizontalOffset=i.x,this.verticalOffset=i.y,0===this.horizontalOffset&&0===this.verticalOffset||(t=new h.A(t.x,t.y,t.width,t.height),t.x-=this.horizontalOffset/2,t.width+=this.horizontalOffset,t.y-=this.verticalOffset/2,t.height+=this.verticalOffset),this.sizers.length>=8&&(this.sizers[0].bounds&&(t.width<2*this.sizers[0].bounds.width+2*e||t.height<2*this.sizers[0].bounds.height+2*e)?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):this.handlesVisible&&(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}const i=t.x+t.width,s=t.y+t.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],i,s);else{const e=t.x+t.width/2,n=t.y+t.height/2;if(this.sizers.length>=8){const l=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],r=(0,S.eh)(this.state.style.rotation??0),h=Math.cos(r),o=Math.sin(r),a=Math.round(4*r/Math.PI),d=new C.A(t.getCenterX(),t.getCenterY());let c=(0,S.Iq)(new C.A(t.x,t.y),h,o,d);this.moveSizerTo(this.sizers[0],c.x,c.y),this.sizers[0].setCursor(l[(0,S.zi)(0+a,l.length)]),c.x=e,c.y=t.y,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[1],c.x,c.y),this.sizers[1].setCursor(l[(0,S.zi)(1+a,l.length)]),c.x=i,c.y=t.y,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[2],c.x,c.y),this.sizers[2].setCursor(l[(0,S.zi)(2+a,l.length)]),c.x=t.x,c.y=n,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[3],c.x,c.y),this.sizers[3].setCursor(l[(0,S.zi)(7+a,l.length)]),c.x=i,c.y=n,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[4],c.x,c.y),this.sizers[4].setCursor(l[(0,S.zi)(3+a,l.length)]),c.x=t.x,c.y=s,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[5],c.x,c.y),this.sizers[5].setCursor(l[(0,S.zi)(6+a,l.length)]),c.x=e,c.y=s,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[6],c.x,c.y),this.sizers[6].setCursor(l[(0,S.zi)(5+a,l.length)]),c.x=i,c.y=s,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[7],c.x,c.y),this.sizers[7].setCursor(l[(0,S.zi)(4+a,l.length)]),c.x=e+this.state.absoluteOffset.x,c.y=n+this.state.absoluteOffset.y,c=(0,S.Iq)(c,h,o,d),this.moveSizerTo(this.sizers[8],c.x,c.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],e+this.state.absoluteOffset.x,n+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}if(this.rotationShape){const t=(0,S.eh)(this.currentAlpha??this.state.style.rotation??0),e=Math.cos(t),i=Math.sin(t),s=new C.A(this.state.getCenterX(),this.state.getCenterY()),n=(0,S.Iq)(this.getRotationHandlePosition(),e,i,s);null!=this.rotationShape.node&&(this.moveSizerTo(this.rotationShape,n.x,n.y),this.rotationShape.node.style.visibility=this.state.view.graph.isEditing()||!this.handlesVisible?"hidden":"")}if(null!=this.selectionBorder&&(this.selectionBorder.rotation=this.state.style.rotation??0),null!=this.edgeHandlers)for(let t=0;t<this.edgeHandlers.length;t+=1)this.edgeHandlers[t].redraw()}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}getRotationHandlePosition(){return new C.A(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)}isParentHighlightVisible(){const t=this.state.cell.getParent();return!!t&&!this.graph.isCellSelected(t)}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=h.A.fromRectangle(i),this.parentHighlight.redraw())}else null!=i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&null!=i&&null==i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect="svg",this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=i.style.rotation??0,this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}drawPreview(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode===this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=this.state.style.rotation??0,this.preview.redraw()),this.selectionBorder.bounds=this.getSelectionBorderBounds(),this.selectionBorder.redraw(),this.updateParentHighlight()}getSelectionBorderBounds(){return this.bounds}isDestroyed(){return null==this.selectionBorder}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=()=>{},this.preview&&(this.preview.destroy(),this.preview=null),this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.selectionBorder&&this.selectionBorder.destroy(),this.labelShape=null,this.removeHint();for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].destroy();this.sizers=[];for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].destroy();this.customHandles=[]}};var I=i(4402);const R=class extends V{constructor(t){super(t),this.flipEnabled=!0,this.doubleClickOrientationResource=(0,I.m)()?"doubleClickOrientation":""}createBends(){const t=[];let e=this.createHandleShape(0);return this.initBend(e),e.setCursor(k.cK.cursorTerminal),t.push(e),t.push(this.createVirtualBend(t=>{!(0,L.fm)(t)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell),r.A.consume(t))})),this.points.push(new C.A(0,0)),e=this.createHandleShape(2),this.initBend(e),e.setCursor(k.cK.cursorTerminal),t.push(e),t}createVirtualBend(t){const e=this.createHandleShape();return this.initBend(e,t),e.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(e.node.style.display="none"),e}getCursorForBend(){return"topToBottomEdgeStyle"===this.state.style.edgeStyle||"elbowEdgeStyle"===this.state.style.edgeStyle&&"vertical"===this.state.style.elbow?"row-resize":"col-resize"}getTooltipForNode(t){let e=null;return null==this.bends||null==this.bends[1]||t!==this.bends[1].node&&t.parentNode!==this.bends[1].node||(e=this.doubleClickOrientationResource,e=(0,I.T)(e)||e),e}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate(),{origin:n}=this.state;return e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x-n.x),t.y=Math.round(t.y/i-s.y-n.y),t}redrawInnerBends(t,e){const i=this.state.cell.getGeometry(),s=this.state.absolutePoints;let n=null;s.length>1?(t=s[1],e=s[s.length-2]):null!=i.points&&i.points.length>0&&(n=s[0]),n=null==n?new C.A(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2):new C.A(this.graph.getView().scale*(n.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(n.y+this.graph.getView().translate.y+this.state.origin.y));const l=this.bends[1].bounds;let r=l.width,o=l.height,a=new h.A(Math.round(n.x-r/2),Math.round(n.y-o/2),r,o);this.manageLabelHandle?this.checkLabelHandle(a):null==this.handleImage&&this.labelShape.visible&&this.labelShape.bounds&&(0,S.HY)(a,this.labelShape.bounds)&&(r=k.HR.size+3,o=r,a=new h.A(Math.floor(n.x-r/2),Math.floor(n.y-o/2),r,o)),this.bends[1].bounds=a,this.bends[1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)}},N=class extends R{constructor(t){super(t),this.points=[]}getCurrentPoints(){let t=this.state.absolutePoints;const e=Math.max(1,this.graph.view.scale);if(2===t.length&&t[0]&&t[1]||3===t.length&&t[0]&&t[1]&&t[2]&&(Math.abs(t[0].x-t[1].x)<e&&Math.abs(t[1].x-t[2].x)<e||Math.abs(t[0].y-t[1].y)<e&&Math.abs(t[1].y-t[2].y)<e)){const e=t[0].x+(t[t.length-1].x-t[0].x)/2,i=t[0].y+(t[t.length-1].y-t[0].y)/2;t=[t[0],new C.A(e,i),new C.A(e,i),t[t.length-1]]}return t}getPreviewPoints(t){if(this.isSource||this.isTarget)return super.getPreviewPoints(t);const e=this.getCurrentPoints();let i=this.convertPoint(e[0].clone(),!1);t=this.convertPoint(t.clone(),!1);let s=[];for(let n=1;n<e.length;n+=1){const l=this.convertPoint(e[n].clone(),!1);n===this.index&&(0===Math.round(i.x-l.x)&&(i.x=t.x,l.x=t.x),0===Math.round(i.y-l.y)&&(i.y=t.y,l.y=t.y)),n<e.length-1&&s.push(l),i=l}if(1===s.length){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),n=this.state.view.getScale(),l=this.state.view.getTranslate(),r=s[0].x*n+l.x,h=s[0].y*n+l.y;(null!=e&&(0,S.gR)(e,r,h)||null!=i&&(0,S.gR)(i,r,h))&&(s=[t,t])}return s}updatePreviewState(t,e,i,s){if(super.updatePreviewState(t,e,i,s),!this.isSource&&!this.isTarget){e=this.convertPoint(e.clone(),!1);const i=t.absolutePoints;let s=i[0],n=i[1],l=[];for(let t=2;t<i.length;t+=1){const e=i[t];0===Math.round(s.x-n.x)&&0===Math.round(n.x-e.x)||0===Math.round(s.y-n.y)&&0===Math.round(n.y-e.y)||l.push(this.convertPoint(n.clone(),!1)),s=n,n=e}const r=this.state.getVisibleTerminalState(!0),h=this.state.getVisibleTerminalState(!1),o=this.state.absolutePoints,a=i[i.length-1];if(0===l.length&&i[0]&&a&&(0===Math.round(i[0].x-a.x)||0===Math.round(i[0].y-a.y)))l=[e,e];else if(5===i.length&&2===l.length&&null!=r&&null!=h&&null!=o&&0===Math.round(o[0].x-o[o.length-1].x)){const i=this.graph.getView(),s=i.getScale(),n=i.getTranslate();let o=i.getRoutingCenterY(r)/s-n.y;const a=this.graph.getConnectionConstraint(t,r,!0);if(null!=a){const t=this.graph.getConnectionPoint(r,a);null!=t&&(this.convertPoint(t,!1),o=t.y)}let d=i.getRoutingCenterY(h)/s-n.y;const c=this.graph.getConnectionConstraint(t,h,!1);if(c){const t=this.graph.getConnectionPoint(h,c);null!=t&&(this.convertPoint(t,!1),d=t.y)}l=[new C.A(e.x,o),new C.A(e.x,d)]}this.points=l,t.view.updateFixedTerminalPoints(t,r,h),t.view.updatePoints(t,this.points,r,h),t.view.updateFloatingTerminalPoints(t,r,h)}}connect(t,e,i,s,n){const l=this.graph.getDataModel();let r=t.getGeometry(),h=null;if(null!=r&&null!=r.points&&r.points.length>0){const t=this.abspoints;let e=t[0],i=t[1];h=[];for(let s=2;s<t.length;s+=1){const n=t[s];!(e&&i&&n)||0===Math.round(e.x-i.x)&&0===Math.round(i.x-n.x)||0===Math.round(e.y-i.y)&&0===Math.round(i.y-n.y)||h.push(this.convertPoint(i.clone(),!1)),e=i,i=n}}return this.graph.batchUpdate(()=>{null!=h&&(r=t.getGeometry(),null!=r&&(r=r.clone(),r.points=h,l.setGeometry(t,r))),t=super.connect(t,e,i,s,n)}),t}getTooltipForNode(t){return null}start(t,e,i){super.start(t,e,i),null==this.bends||null==this.bends[i]||this.isSource||this.isTarget||(0,a.Ko)(this.bends[i].node,100)}createBends(){const t=[];let e=this.createHandleShape(0);this.initBend(e),e.setCursor(k.cK.cursorTerminal),t.push(e);const i=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(let s=0;s<i.length-1;s+=1){e=this.createVirtualBend(),t.push(e);let n=0===Math.round(i[s].x-i[s+1].x);0===Math.round(i[s].y-i[s+1].y)&&s<i.length-2&&(n=0===Math.round(i[s].x-i[s+2].x)),e.setCursor(n?"col-resize":"row-resize"),this.points.push(new C.A(0,0))}}return e=this.createHandleShape(i.length),this.initBend(e),e.setCursor(k.cK.cursorTerminal),t.push(e),t}redraw(){this.refresh(),super.redraw()}redrawInnerBends(t,e){if(this.graph.isCellBendable(this.state.cell)){const i=this.getCurrentPoints();if(null!=i&&i.length>1){let s=!1;if(4===i.length&&i[0]&&i[1]&&i[2]&&i[3]&&0===Math.round(i[1].x-i[2].x)&&0===Math.round(i[1].y-i[2].y))if(s=!0,0===Math.round(i[0].y-i[i.length-1].y)){const t=i[0].x+(i[i.length-1].x-i[0].x)/2;i[1]=new C.A(t,i[1].y),i[2]=new C.A(t,i[2].y)}else{const t=i[0].y+(i[i.length-1].y-i[0].y)/2;i[1]=new C.A(i[1].x,t),i[2]=new C.A(i[2].x,t)}for(let s=0;s<i.length-1;s+=1)if(null!=this.bends[s+1]){t=i[s],e=i[s+1];const n=new C.A(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2),l=this.bends[s+1].bounds;this.bends[s+1].bounds=new h.A(Math.floor(n.x-l.width/2),Math.floor(n.y-l.height/2),l.width,l.height),this.bends[s+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[s+1].bounds)}s&&((0,a.Ko)(this.bends[1].node,k.cK.virtualBendOpacity),(0,a.Ko)(this.bends[3].node,k.cK.virtualBendOpacity))}}}};var z=i(4329),F=i(4699),G=i(60);const _=(t,e={},i=!1)=>{const s=G.A.get(t);let n=e?e[s]:null;if(null==n&&(n=t.clone(),e[s]=n,i)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=_(t.getChildAt(s),e,!0);n.insert(i)}}return n},U=(t,e,i)=>{const s=e.getTerminal(!0);if(null!=s){const e=i[G.A.get(s)];null!=e&&e.insertEdge(t,!0)}const n=e.getTerminal(!1);if(null!=n){const e=i[G.A.get(n)];null!=e&&e.insertEdge(t,!1)}const l=t.getChildCount();for(let s=0;s<l;s+=1)U(t.getChildAt(s),e.getChildAt(s),i)},W={cellsResizable:!0,cellsBendable:!0,cellsSelectable:!0,cellsDisconnectable:!0,autoSizeCells:!1,autoSizeCellsOnAdd:!1,cellsLocked:!1,cellsCloneable:!0,cellsDeletable:!0,cellsMovable:!0,extendParents:!0,extendParentsOnAdd:!0,extendParentsOnMove:!1,getBoundingBox(t){let e=null;if(t.length>0)for(const i of t)if(i.isVertex()||i.isEdge()){const t=this.getView().getBoundingBox(this.getView().getState(i),!0);t&&(e?e.add(t):e=h.A.fromRectangle(t))}return e},removeStateForCell(t){for(const e of t.getChildren())this.removeStateForCell(e);this.getView().invalidate(t,!1,!0),this.getView().removeState(t)},getCurrentCellStyle(t,e=!1){const i=e?null:this.getView().getState(t);return i?i.style:this.getCellStyle(t)},getCellStyle(t){const e=t.getStyle(),i=this.getStylesheet(),s=t.isEdge()?i.getDefaultEdgeStyle():i.getDefaultVertexStyle();return this.postProcessCellStyle(i.getCellStyle(e,s??{}))},postProcessCellStyle(t){if(!t.image)return t;const e=t.image;let i=this.getImageFromBundles(e);if(i?t.image=i:i=e,i&&"data:image/"===i.substring(0,11)){if("data:image/svg+xml,<"===i.substring(0,20))i=i.substring(0,19)+encodeURIComponent(i.substring(19));else if("data:image/svg+xml,%3C"!==i.substring(0,22)){const t=i.indexOf(",");t>0&&";base64,"!==i.substring(t-7,t+1)&&(i=`${i.substring(0,t)};base64,${i.substring(t+1)}`)}t.image=i}return t},setCellStyle(t,e){e=e??this.getSelectionCells(),this.batchUpdate(()=>{for(const i of e)this.getDataModel().setStyle(i,t)})},toggleCellStyle(t,e=!1,i){return i=i??this.getSelectionCell(),this.toggleCellStyles(t,e,[i])},toggleCellStyles(t,e=!1,i){let s=!1;return(i=i??this.getSelectionCells()).length>0&&(s=!(this.getCurrentCellStyle(i[0])[t]??e),this.setCellStyles(t,s,i)),s},setCellStyles(t,e,i){i=i??this.getSelectionCells(),(0,a.nf)(this.getDataModel(),i,t,e)},toggleCellStyleFlags(t,e,i){i=i??this.getSelectionCells(),this.setCellStyleFlags(t,e,null,i)},setCellStyleFlags(t,e,i=null,s){(s=s??this.getSelectionCells()).length>0&&(null===i&&(i=!(((this.getCurrentCellStyle(s[0])[t]||0)&e)===e)),(0,a.fE)(this.getDataModel(),s,t,e,i))},alignCells(t,e,i=null){if((e=e??this.getSelectionCells()).length>1){if(null===i)for(const s of e){const e=this.getView().getState(s);if(e&&!s.isEdge())if(null===i){if("center"===t){i=e.x+e.width/2;break}if("right"===t)i=e.x+e.width;else if("top"===t)i=e.y;else{if("middle"===t){i=e.y+e.height/2;break}i="bottom"===t?e.y+e.height:e.x}}else i="right"===t?Math.max(i,e.x+e.width):"top"===t?Math.min(i,e.y):"bottom"===t?Math.max(i,e.y+e.height):Math.min(i,e.x)}if(null!==i){const s=this.getView().scale;this.batchUpdate(()=>{const l=i;for(const i of e){const e=this.getView().getState(i);if(null!=e){let n=i.getGeometry();null==n||i.isEdge()||(n=n.clone(),"center"===t?n.x+=(l-e.x-e.width/2)/s:"right"===t?n.x+=(l-e.x-e.width)/s:"top"===t?n.y+=(l-e.y)/s:"middle"===t?n.y+=(l-e.y-e.height/2)/s:"bottom"===t?n.y+=(l-e.y-e.height)/s:n.x+=(l-e.x)/s,this.resizeCell(i,n))}}this.fireEvent(new n.A(r.A.ALIGN_CELLS,{align:t,cells:e}))})}}return e},cloneCell(t,e=!1,i={},s=!1){return this.cloneCells([t],e,i,s)[0]},cloneCells(t,e=!0,i={},s=!1){let n;const l=new Map,r=[];for(const e of t)l.set(e,!0),r.push(e);if(r.length>0){const{scale:r}=this.getView(),h=this.getView().translate,o=[];n=((t,e=!0,i={})=>{const s=[];for(const n of t)s.push(_(n,i,e));for(let e=0;e<s.length;e+=1)null!=s[e]&&U(s[e],t[e],i);return s})(t,!0,i);for(let i=0;i<t.length;i+=1){const a=t[i],d=n[i];if(!e&&d.isEdge()&&null!==this.getEdgeValidationError(d,d.getTerminal(!0),d.getTerminal(!1)));else{o.push(d);const t=d.getGeometry();if(t){const e=this.getView().getState(a),i=a.getParent(),n=i?this.getView().getState(i):null;if(e&&n){const i=s?0:n.origin.x,o=s?0:n.origin.y;if(d.isEdge()){const s=e.absolutePoints;let n=a.getTerminal(!0);for(;n&&!l.get(n);)n=n.getParent();!n&&s[0]&&t.setTerminalPoint(new C.A(s[0].x/r-h.x,s[0].y/r-h.y),!0);let d=a.getTerminal(!1);for(;d&&!l.get(d);)d=d.getParent();const c=s[s.length-1];!d&&c&&t.setTerminalPoint(new C.A(c.x/r-h.x,c.y/r-h.y),!1);const{points:g}=t;if(g)for(const t of g)t.x+=i,t.y+=o}else t.translate(i,o)}}}}n=o}else n=[];return n},addCell(t,e=null,i=null,s=null,n=null){return this.addCells([t],e,i,s,n)[0]},addCells(t,e=null,i=null,s=null,l=null,h=!1){const o=e??this.getDefaultParent(),a=i??o.getChildCount();return this.batchUpdate(()=>{this.cellsAdded(t,o,a,s,l,h,!0),this.fireEvent(new n.A(r.A.ADD_CELLS,{cells:t,p:o,i:a,source:s,target:l}))}),t},cellsAdded(t,e,i,s=null,l=null,h=!1,o=!1,a=!0){this.batchUpdate(()=>{const d=h?this.getView().getState(e):null,c=d?d.origin:null,g=new C.A(0,0);t.forEach((t,n)=>{const r=t.getParent();if(c&&t!==e&&e!==r){const e=r?this.getView().getState(r):null,i=e?e.origin:g;let s=t.getGeometry();if(s){const e=i.x-c.x,n=i.y-c.y;s=s.clone(),s.translate(e,n),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),this.getDataModel().setGeometry(t,s)}}e===r&&i+n>e.getChildCount()&&i--,this.getDataModel().add(e,t,i+n),this.autoSizeCellsOnAdd&&this.autoSizeCell(t,!0),(!a||a)&&this.isExtendParentsOnAdd(t)&&this.isExtendParent(t)&&this.extendParent(t),o&&!o||this.constrainChild(t),s&&this.cellConnected(t,s,!0),l&&this.cellConnected(t,l,!1)}),this.fireEvent(new n.A(r.A.CELLS_ADDED,{cells:t,parent:e,index:i,source:s,target:l,absolute:h}))})},autoSizeCell(t,e=!0){if(e)for(const e of t.getChildren())this.autoSizeCell(e);t.isVertex()&&this.isAutoSizeCell(t)&&this.updateCellSize(t)},removeCells(t=null,e=!0){if(t||(t=this.getDeletableCells(this.getSelectionCells())),e)t=this.getDeletableCells(this.addAllEdges(t));else{t=t.slice();const e=this.getDeletableCells(this.getAllEdges(t)),i=new Map;for(const e of t)i.set(e,!0);for(const s of e)this.getView().getState(s)||i.get(s)||(i.set(s,!0),t.push(s))}return this.batchUpdate(()=>{this.cellsRemoved(t),this.fireEvent(new n.A(r.A.REMOVE_CELLS,{cells:t,includeEdges:e}))}),t??[]},cellsRemoved(t){if(t.length>0){const{scale:e}=this.getView(),i=this.getView().translate;this.batchUpdate(()=>{const s=new Map;for(const e of t)s.set(e,!0);for(const n of t){const t=this.getAllEdges([n]),l=(t,s)=>{let l=t.getGeometry();if(l){const r=t.getTerminal(s);let h=!1,o=r;for(;o;){if(n===o){h=!0;break}o=o.getParent()}if(h){l=l.clone();const n=this.getView().getState(t);if(n){const t=n.absolutePoints,r=t[s?0:t.length-1];l.setTerminalPoint(new C.A(r.x/e-i.x-n.origin.x,r.y/e-i.y-n.origin.y),s)}else if(r){const t=this.getView().getState(r);t&&l.setTerminalPoint(new C.A(t.getCenterX()/e-i.x,t.getCenterY()/e-i.y),s)}this.getDataModel().setGeometry(t,l),this.getDataModel().setTerminal(t,null,s)}}};for(const e of t)s.get(e)||(s.set(e,!0),l(e,!0),l(e,!1));this.getDataModel().remove(n)}this.fireEvent(new n.A(r.A.CELLS_REMOVED,{cells:t}))})}},toggleCells(t=!1,e,i=!0){return e=e??this.getSelectionCells(),i&&(e=this.addAllEdges(e)),this.batchUpdate(()=>{this.cellsToggled(e,t),this.fireEvent(new n.A(r.A.TOGGLE_CELLS,{show:t,cells:e,includeEdges:i}))}),e},cellsToggled(t,e=!1){t.length>0&&this.batchUpdate(()=>{for(const i of t)this.getDataModel().setVisible(i,e)})},updateCellSize(t,e=!1){return this.batchUpdate(()=>{this.cellSizeUpdated(t,e),this.fireEvent(new n.A(r.A.UPDATE_CELL_SIZE,{cell:t,ignoreChildren:e}))}),t},cellSizeUpdated(t,e=!1){this.batchUpdate(()=>{const i=this.getPreferredSizeForCell(t);let s=t.getGeometry();if(i&&s){const n=t.isCollapsed();if(s=s.clone(),this.isSwimlane(t)){const e=this.getCellStyle(t),l=t.getStyle();e.horizontal??1?(l.startSize=i.height+8,n&&(s.height=i.height+8),s.width=i.width):(l.startSize=i.width+8,n&&(s.width=i.width+8),s.height=i.height),this.getDataModel().setStyle(t,l)}else{const e=this.getView().createState(t),n=e.style.align??"center";"right"===n?s.x+=s.width-i.width:"center"===n&&(s.x+=Math.round((s.width-i.width)/2));const l=e.getVerticalAlign();"bottom"===l?s.y+=s.height-i.height:"middle"===l&&(s.y+=Math.round((s.height-i.height)/2)),s.width=i.width,s.height=i.height}if(!e&&!n){const e=this.getView().getBounds(t.getChildren());if(null!=e){const t=this.getView().translate,{scale:i}=this.getView(),n=(e.x+e.width)/i-s.x-t.x,l=(e.y+e.height)/i-s.y-t.y;s.width=Math.max(s.width,n),s.height=Math.max(s.height,l)}}this.cellsResized([t],[s],!1)}})},getPreferredSizeForCell(t,e=null){let i=null;const s=this.getView().createState(t),{style:n}=s;if(!t.isEdge()){const t=n.fontSize||c.FV;let l=0,r=0;(s.getImageSrc()||n.image)&&"label"===n.shape&&("middle"===n.verticalAlign&&(l+=n.imageWidth||c.tK),"center"!==n.align&&(r+=n.imageHeight||c.tK)),l+=2*(n.spacing||0),l+=n.spacingLeft||0,l+=n.spacingRight||0,r+=2*(n.spacing||0),r+=n.spacingTop||0,r+=n.spacingBottom||0;const o=this.getFoldingImage(s);o&&(l+=o.width+8);let d=this.getCellRenderer().getLabelValue(s);if(d&&d.length>0){this.isHtmlLabel(s.cell)||(d=(0,F.bG)(d,!1)),d=d.replace(/\n/g,"<br>");const o=(0,a.i4)(d,t,n.fontFamily,e,n.fontStyle);let c=o.width+l,g=o.height+r;if(!(n.horizontal??1)){const t=g;g=c,c=t}this.isGridEnabled()&&(c=this.snap(c+this.getGridSize()/2),g=this.snap(g+this.getGridSize()/2)),i=new h.A(0,0,c,g)}else{const t=4*this.getGridSize();i=new h.A(0,0,t,t)}}return i},resizeCell(t,e,i=!1){return this.resizeCells([t],[e],i)[0]},resizeCells(t,e,i){return i=i??this.isRecursiveResize(),this.batchUpdate(()=>{const s=this.cellsResized(t,e,i);this.fireEvent(new n.A(r.A.RESIZE_CELLS,{cells:t,bounds:e,prev:s}))}),t},cellsResized(t,e,i=!1){const s=[];return t.length===e.length&&this.batchUpdate(()=>{t.forEach((t,n)=>{s.push(this.cellResized(t,e[n],!1,i)),this.isExtendParent(t)&&this.extendParent(t),this.constrainChild(t)}),this.isResetEdgesOnResize()&&this.resetEdges(t),this.fireEvent(new n.A(r.A.CELLS_RESIZED,{cells:t,bounds:e,prev:s}))}),s},cellResized(t,e,i=!1,s=!1){const n=t.getGeometry();if(n&&(n.x!==e.x||n.y!==e.y||n.width!==e.width||n.height!==e.height)){const l=n.clone();if(!i&&l.relative){const{offset:t}=l;t&&(t.x+=e.x-l.x,t.y+=e.y-l.y)}else l.x=e.x,l.y=e.y;l.width=e.width,l.height=e.height,l.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(l.x=Math.max(0,l.x),l.y=Math.max(0,l.y)),this.batchUpdate(()=>{s&&this.resizeChildCells(t,l),this.getDataModel().setGeometry(t,l),this.constrainChildCells(t)})}return n},resizeChildCells(t,e){const i=t.getGeometry();if(i){const s=0!==i.width?e.width/i.width:1,n=0!==i.height?e.height/i.height:1;for(const e of t.getChildren())this.scaleCell(e,s,n,!0)}},constrainChildCells(t){for(const e of t.getChildren())this.constrainChild(e)},scaleCell(t,e,i,s=!1){let n=t.getGeometry();if(n){const l=this.getCurrentCellStyle(t);n=n.clone();const{x:r}=n,{y:h}=n,o=n.width,a=n.height;n.scale(e,i,"fixed"===l.aspect),l.resizeWidth?n.width=o*e:l.resizeWidth||(n.width=o),l.resizeHeight?n.height=a*i:l.resizeHeight||(n.height=a),this.isCellMovable(t)||(n.x=r,n.y=h),this.isCellResizable(t)||(n.width=o,n.height=a),t.isVertex()?this.cellResized(t,n,!0,s):this.getDataModel().setGeometry(t,n)}},extendParent(t){const e=t.getParent();let i=e?e.getGeometry():null;if(e&&i&&!e.isCollapsed()){const s=t.getGeometry();s&&!s.relative&&(i.width<s.x+s.width||i.height<s.y+s.height)&&(i=i.clone(),i.width=Math.max(i.width,s.x+s.width),i.height=Math.max(i.height,s.y+s.height),this.cellsResized([e],[i],!1))}},importCells(t,e,i,s=null,n=null,l={}){return this.moveCells(t,e,i,!0,s,n,l)},moveCells(t,e=0,i=0,s=!1,l=null,h=null,o={}){if(0!==e||0!==i||s||l){const a=t=(t=>{const e=new Map,i=[];for(let i=0;i<t.length;i+=1)e.set(t[i],!0);for(let s=0;s<t.length;s+=1){const n=t[s];let l=!0,r=n.getParent();for(;null!=r;){if(e.get(r)){l=!1;break}r=r.getParent()}l&&i.push(n)}return i})(t);this.batchUpdate(()=>{const d=new Map;for(const e of t)d.set(e,!0);const c=t=>{for(;t;){if(d.get(t))return!0;t=t.getParent()}return!1},g=[];for(const e of t){const t=e.getGeometry(),i=e.getParent();(!t||!t.relative||i&&!i.isEdge()||i&&!c(i.getTerminal(!0))&&!c(i.getTerminal(!1)))&&g.push(e)}t=g,s&&(t=this.cloneCells(t,this.isCloneInvalidEdges(),o),l||(l=this.getDefaultParent()));const u=this.isAllowNegativeCoordinates();if(l&&this.setAllowNegativeCoordinates(!0),this.cellsMoved(t,e,i,!s&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),!l,this.isExtendParentsOnMove()&&!l),this.setAllowNegativeCoordinates(u),l){const e=l.getChildCount();this.cellsAdded(t,l,e,null,null,!0),s&&t.forEach((t,e)=>{const i=t.getGeometry(),s=a[e].getParent();i&&i.relative&&s&&s.isEdge()&&this.getDataModel().contains(s)&&this.getDataModel().add(s,t)})}this.fireEvent(new n.A(r.A.MOVE_CELLS,{cells:t,dx:e,dy:i,clone:s,target:l,event:h}))})}return t},cellsMoved(t,e,i,s=!1,l=!1,h=!1){0===e&&0===i||this.batchUpdate(()=>{s&&this.disconnectGraph(t);for(const s of t)this.translateCell(s,e,i),h&&this.isExtendParent(s)?this.extendParent(s):l&&this.constrainChild(s);this.isResetEdgesOnMove()&&this.resetEdges(t),this.fireEvent(new n.A(r.A.CELLS_MOVED,{cells:t,dx:e,dy:i,disconnect:s}))})},translateCell(t,e,i){let s=t.getGeometry();if(s){if(s=s.clone(),s.translate(e,i),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),s.relative&&!t.isEdge()){const n=t.getParent();let l=0;if(n.isVertex()&&(l=this.getCurrentCellStyle(n).rotation??0),0!==l){const t=(0,S.eh)(-l),s=Math.cos(t),n=Math.sin(t),r=(0,S.Iq)(new C.A(e,i),s,n,new C.A(0,0));e=r.x,i=r.y}s.offset?(s.offset.x=s.offset.x+e,s.offset.y=s.offset.y+i):s.offset=new C.A(e,i)}this.getDataModel().setGeometry(t,s)}},getCellContainmentArea(t){if(!t.isEdge()){const e=t.getParent();if(e&&e!==this.getDefaultParent()){const t=e.getGeometry();if(t){let i=0,s=0,n=t.width,l=t.height;if(this.isSwimlane(e)){const t=this.getStartSize(e),r=this.getCurrentCellStyle(e),h=r.direction??"east",o=r.flipH??!1,a=r.flipV??!1;if("south"===h||"north"===h){const e=t.width;t.width=t.height,t.height=e}("east"===h&&!a||"north"===h&&!o||"west"===h&&a||"south"===h&&o)&&(i=t.width,s=t.height),n-=t.width,l-=t.height}return new h.A(i,s,n,l)}}}return null},constrainChild(t,e=!0){let i=t.getGeometry();if(i&&(this.isConstrainRelativeChildren()||!i.relative)){const e=t.getParent();let s=this.getMaximumGraphBounds();if(s&&e){const t=this.getBoundingBoxFromGeometry([e],!1);t&&(s=h.A.fromRectangle(s),s.x-=t.x,s.y-=t.y)}if(this.isConstrainChild(t)){let e=this.getCellContainmentArea(t);if(e){const i=this.getOverlap(t);i>0&&(e=h.A.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),s?(s=h.A.fromRectangle(s),s.intersect(e)):s=e}}if(s){const e=[t];if(!t.isCollapsed()){const i=t.getDescendants();for(const t of i)t.isVisible()&&e.push(t)}const n=this.getBoundingBoxFromGeometry(e,!1);if(n){i=i.clone();let e=0;i.width>s.width&&(e=i.width-s.width,i.width-=e),n.x+n.width>s.x+s.width&&(e-=n.x+n.width-s.x-s.width-e);let l=0;i.height>s.height&&(l=i.height-s.height,i.height-=l),n.y+n.height>s.y+s.height&&(l-=n.y+n.height-s.y-s.height-l),n.x<s.x&&(e-=n.x-s.x),n.y<s.y&&(l-=n.y-s.y),0===e&&0===l||(i.relative?(i.offset||(i.offset=new C.A),i.offset.x+=e,i.offset.y+=l):(i.x+=e,i.y+=l)),this.getDataModel().setGeometry(t,i)}}}},getChildCells(t,e=!1,i=!1){const s=(t=t??this.getDefaultParent()).getChildCells(e,i),n=[];for(const t of s)t.isVisible()&&n.push(t);return n},getCellAt(t,e,i=null,s=!0,n=!0,l=null){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i)for(let r=i.getChildCount()-1;r>=0;r--){const h=i.getChildAt(r),o=this.getCellAt(t,e,h,s,n,l);if(o)return o;if(h.isVisible()&&(n&&h.isEdge()||s&&h.isVertex())){const i=this.getView().getState(h);if(i&&(!l||!l(i,t,e))&&this.intersects(i,t,e))return h}}return null},getCells(t,e,i,s,n=null,l=[],r=null,h=null,o=!1){if(i>0||s>0||r){const a=this.getDataModel(),d=t+i,c=e+s;if(n||(n=this.getCurrentRoot())||(n=a.getRoot()),n)for(const a of n.getChildren()){const n=this.getView().getState(a);if(n&&a.isVisible()&&(!h||!h(n))){const g=n.style.rotation??0;let u=n;0!==g&&(u=(0,S.UX)(u,g));const p=r&&a.isVertex()&&(0,S.HY)(r,u)||!r&&(a.isEdge()||a.isVertex())&&u.x>=t&&u.y+u.height<=c&&u.y>=e&&u.x+u.width<=d;p&&l.push(a),p&&!o||this.getCells(t,e,i,s,a,l,r,h,o)}}}return l},getCellsBeyond(t,e,i=null,s=!1,n=!1){const l=[];if((s||n)&&(i||(i=this.getDefaultParent()),i))for(const r of i.getChildren()){const i=this.getView().getState(r);r.isVisible()&&i&&(!s||i.x>=t)&&(!n||i.y>=e)&&l.push(r)}return l},intersects(t,e,i){const s=t.absolutePoints;if(s.length>0){const t=this.getEventTolerance()*this.getEventTolerance();let n=s[0];for(let l=1;l<s.length;l+=1){const r=s[l];if(n&&r&&(0,S.E8)(n.x,n.y,r.x,r.y,e,i)<=t)return!0;n=r}}else{const s=(0,S.eh)(t.style.rotation??0);if(0!==s){const n=Math.cos(-s),l=Math.sin(-s),r=new C.A(t.getCenterX(),t.getCenterY()),h=(0,S.Iq)(new C.A(e,i),n,l,r);e=h.x,i=h.y}if((0,S.gR)(t,e,i))return!0}return!1},isValidAncestor:(t,e,i=!1)=>i?e.isAncestor(t):t?.getParent()===e,isCellLocked(t){const e=t.getGeometry();return this.isCellsLocked()||!!e&&t.isVertex()&&e.relative},isCellsLocked(){return this.cellsLocked},setCellsLocked(t){this.cellsLocked=t},getCloneableCells(t){return this.getDataModel().filterCells(t,t=>this.isCellCloneable(t))},isCellCloneable(t){return this.isCellsCloneable()&&(this.getCurrentCellStyle(t).cloneable??!0)},isCellsCloneable(){return this.cellsCloneable},setCellsCloneable(t){this.cellsCloneable=t},getExportableCells(t){return this.getDataModel().filterCells(t,t=>this.canExportCell(t))},canExportCell(t=null){return this.isExportEnabled()},getImportableCells(t){return this.getDataModel().filterCells(t,t=>this.canImportCell(t))},canImportCell(t=null){return this.isImportEnabled()},isCellSelectable(t){return this.isCellsSelectable()},isCellsSelectable(){return this.cellsSelectable},setCellsSelectable(t){this.cellsSelectable=t},getDeletableCells(t){return this.getDataModel().filterCells(t,t=>this.isCellDeletable(t))},isCellDeletable(t){return this.isCellsDeletable()&&(this.getCurrentCellStyle(t).deletable??!0)},isCellsDeletable(){return this.cellsDeletable},setCellsDeletable(t){this.cellsDeletable=t},isCellRotatable(t){return this.getCurrentCellStyle(t).rotatable??!0},getMovableCells(t){return this.getDataModel().filterCells(t,t=>this.isCellMovable(t))},isCellMovable(t){return this.isCellsMovable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).movable??!0)},isCellsMovable(){return this.cellsMovable},setCellsMovable(t){this.cellsMovable=t},isCellResizable(t){return this.isCellsResizable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).resizable??!0)},isCellsResizable(){return this.cellsResizable},setCellsResizable(t){this.cellsResizable=t},isCellBendable(t){return this.isCellsBendable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).bendable??!0)},isCellsBendable(){return this.cellsBendable},setCellsBendable(t){this.cellsBendable=t},isAutoSizeCell(t){return this.isAutoSizeCells()||(this.getCurrentCellStyle(t).autoSize??!1)},isAutoSizeCells(){return this.autoSizeCells},setAutoSizeCells(t){this.autoSizeCells=t},isExtendParent(t){return!t.isEdge()&&this.isExtendParents()},isExtendParents(){return this.extendParents},setExtendParents(t){this.extendParents=t},isExtendParentsOnAdd(t){return this.extendParentsOnAdd},setExtendParentsOnAdd(t){this.extendParentsOnAdd=t},isExtendParentsOnMove(){return this.extendParentsOnMove},setExtendParentsOnMove(t){this.extendParentsOnMove=t},getCursorForCell:t=>null,getCellBounds(t,e=!1,i=!1){let s=[t];e&&(s=s.concat(t.getEdges()));let n=this.getView().getBounds(s);if(i)for(const i of t.getChildren()){const t=this.getCellBounds(i,e,!0);n&&t?n.add(t):n=t}return n},getBoundingBoxFromGeometry(t,e=!1){let i=null,s=null;for(const n of t)if(e||n.isVertex()){const e=n.getGeometry();if(e){let l=null;if(n.isEdge()){const t=t=>{t&&(s?s.add(new h.A(t.x,t.y,0,0)):s=new h.A(t.x,t.y,0,0))};n.getTerminal(!0)||t(e.getTerminalPoint(!0)),n.getTerminal(!1)||t(e.getTerminalPoint(!1));const i=e.points;if(i&&i.length>0){s=new h.A(i[0].x,i[0].y,0,0);for(let e=1;e<i.length;e++)t(i[e])}l=s}else{const i=n.getParent();e.relative&&i?i.isVertex()&&i!==this.getView().currentRoot&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l=new h.A(e.x*s.width,e.y*s.height,e.width,e.height),t.indexOf(i)>=0&&(l.x+=s.x,l.y+=s.y))):(l=h.A.fromRectangle(e),i&&i.isVertex()&&t.indexOf(i)>=0&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l.x+=s.x,l.y+=s.y))),l&&e.offset&&(l.x+=e.offset.x,l.y+=e.offset.y);const r=this.getCurrentCellStyle(n);if(l){const t=r.rotation??0;0!==t&&(l=(0,S.UX)(l,t))}}l&&(i?i.add(l):i=h.A.fromRectangle(l))}}return i}},Y={constrainChildren:!0,constrainRelativeChildren:!1,disconnectOnMove:!0,cellsDisconnectable:!0,getOutlineConstraint(t,e,i){if(e.shape){const i=this.getView().getPerimeterBounds(e),s=e.style.direction;if("north"===s||"south"===s){i.x+=i.width/2-i.height/2,i.y+=i.height/2-i.width/2;const t=i.width;i.width=i.height,i.height=t}const n=(0,S.eh)(e.shape.getShapeRotation());if(0!==n){const e=Math.cos(-n),s=Math.sin(-n),l=new C.A(i.getCenterX(),i.getCenterY());t=(0,S.Iq)(t,e,s,l)}let l=1,r=1,h=0,o=0;if(e.cell.isVertex()){let t=e.style.flipH,n=e.style.flipV;if("north"===s||"south"===s){const e=t;t=n,n=e}t&&(l=-1,h=-i.width),n&&(r=-1,o=-i.height)}t=new C.A((t.x-i.x)*l-h+i.x,(t.y-i.y)*r-o+i.y);const a=0===i.width?0:Math.round(1e3*(t.x-i.x)/i.width)/1e3,d=0===i.height?0:Math.round(1e3*(t.y-i.y)/i.height)/1e3;return new T(new C.A(a,d),!1)}return null},getAllConnectionConstraints:(t,e)=>t?.shape?.stencil?.constraints??null,getConnectionConstraint(t,e,i=!1){let s=null;const n=t.style[i?"exitX":"entryX"];if(void 0!==n){const e=t.style[i?"exitY":"entryY"];void 0!==e&&(s=new C.A(n,e))}let l=!1,r=0,h=0;return s&&(l=t.style[i?"exitPerimeter":"entryPerimeter"]||!1,r=t.style[i?"exitDx":"entryDx"],h=t.style[i?"exitDy":"entryDy"],r=Number.isFinite(r)?r:0,h=Number.isFinite(h)?h:0),new T(s,l,null,r,h)},setConnectionConstraint(t,e,i=!1,s=null){s&&this.batchUpdate(()=>{s&&s.point?s.point&&(this.setCellStyles(i?"exitX":"entryX",s.point.x,[t]),this.setCellStyles(i?"exitY":"entryY",s.point.y,[t]),this.setCellStyles(i?"exitDx":"entryDx",s.dx,[t]),this.setCellStyles(i?"exitDy":"entryDy",s.dy,[t]),s.perimeter?this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]):this.setCellStyles(i?"exitPerimeter":"entryPerimeter","0",[t])):(this.setCellStyles(i?"exitX":"entryX",null,[t]),this.setCellStyles(i?"exitY":"entryY",null,[t]),this.setCellStyles(i?"exitDx":"entryDx",null,[t]),this.setCellStyles(i?"exitDy":"entryDy",null,[t]),this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]))})},getConnectionPoint(t,e,i=!0){let s=null;if(e.point){const i=this.getView().getPerimeterBounds(t),n=new C.A(i.getCenterX(),i.getCenterY()),l=t.style.direction;let r=0;t.style.anchorPointDirection&&("north"===l?r+=270:"west"===l?r+=180:"south"===l&&(r+=90),"north"!==l&&"south"!==l||i.rotate90());const{scale:h}=this.getView();s=new C.A(i.x+e.point.x*i.width+e.dx*h,i.y+e.point.y*i.height+e.dy*h);let o=t.style.rotation||0;if(e.perimeter){if(0!==r){let t=0,e=0;90===r?e=1:180===r?t=-1:270===r&&(e=-1),s=(0,S.Iq)(s,t,e,n)}s=this.getView().getPerimeterPoint(t,s,!1)}else if(o+=r,t.cell.isVertex()){let e=t.style.flipH,n=t.style.flipV;if("north"===l||"south"===l){const t=e;e=n,n=t}e&&(s.x=2*i.getCenterX()-s.x),n&&(s.y=2*i.getCenterY()-s.y)}if(0!==o&&s){const t=(0,S.eh)(o),e=Math.cos(t),i=Math.sin(t);s=(0,S.Iq)(s,e,i,n)}}return i&&s&&(s.x=Math.round(s.x),s.y=Math.round(s.y)),s},connectCell(t,e=null,i=!1,s=null){return this.batchUpdate(()=>{const l=t.getTerminal(i);this.cellConnected(t,e,i,s),this.fireEvent(new n.A(r.A.CONNECT_CELL,"edge",t,"terminal",e,"source",i,"previous",l))}),t},cellConnected(t,e,i=!1,s=null){this.batchUpdate(()=>{const l=t.getTerminal(i);if(this.setConnectionConstraint(t,e,i,s),this.isPortsEnabled()){let s=null;e&&this.isPort(e)&&(s=e.getId(),e=this.getTerminalForPort(e,i));const n=i?"sourcePort":"targetPort";this.setCellStyles(n,s,[t])}this.getDataModel().setTerminal(t,e,i),this.isResetEdgesOnConnect()&&this.resetEdge(t),this.fireEvent(new n.A(r.A.CELL_CONNECTED,"edge",t,"terminal",e,"source",i,"previous",l))})},disconnectGraph(t){this.batchUpdate(()=>{const{scale:e,translate:i}=this.getView(),s=new Map;for(let e=0;e<t.length;e+=1)s.set(t[e],!0);for(const n of t)if(n.isEdge()){let t=n.getGeometry();if(t){const l=this.getView().getState(n),r=n.getParent(),h=r?this.getView().getState(r):null;if(l&&h){t=t.clone();const r=-h.origin.x,o=-h.origin.y,a=l.absolutePoints;let d=n.getTerminal(!0);if(d&&this.isCellDisconnectable(n,d,!0)){for(;d&&!s.get(d);)d=d.getParent();!d&&a[0]&&(t.setTerminalPoint(new C.A(a[0].x/e-i.x+r,a[0].y/e-i.y+o),!0),this.getDataModel().setTerminal(n,null,!0))}let c=n.getTerminal(!1);if(c&&this.isCellDisconnectable(n,c,!1)){for(;c&&!s.get(c);)c=c.getParent();if(!c){const s=a[a.length-1];s&&(t.setTerminalPoint(new C.A(s.x/e-i.x+r,s.y/e-i.y+o),!1),this.getDataModel().setTerminal(n,null,!1))}}this.getDataModel().setGeometry(n,t)}}}})},getConnections(t,e=null){return this.getEdges(t,e,!0,!0,!1)},isConstrainChild(t){return this.isConstrainChildren()&&!!t.getParent()&&!t.getParent().isEdge()},isConstrainChildren(){return this.constrainChildren},setConstrainChildren(t){this.constrainChildren=t},isConstrainRelativeChildren(){return this.constrainRelativeChildren},setConstrainRelativeChildren(t){this.constrainRelativeChildren=t},isDisconnectOnMove(){return this.disconnectOnMove},setDisconnectOnMove(t){this.disconnectOnMove=t},isCellDisconnectable(t,e=null,i=!1){return this.isCellsDisconnectable()&&!this.isCellLocked(t)},isCellsDisconnectable(){return this.cellsDisconnectable},setCellsDisconnectable(t){this.cellsDisconnectable=t},isValidSource(t){return null==t&&this.isAllowDanglingEdges()||null!=t&&(!t.isEdge()||this.isConnectableEdges())&&t.isConnectable()},isValidTarget(t){return this.isValidSource(t)},isValidConnection(t,e){return this.isValidSource(t)&&this.isValidTarget(e)},setConnectable(t){const e=this.getPlugin("ConnectionHandler");e?.setEnabled(t)},isConnectable(){const t=this.getPlugin("ConnectionHandler");return t?.isEnabled()??!1}},X={dropEnabled:!1,splitEnabled:!0,autoScroll:!0,isAutoScroll(){return this.autoScroll},autoExtend:!0,isAutoExtend(){return this.autoExtend},isDropEnabled(){return this.dropEnabled},setDropEnabled(t){this.dropEnabled=t},isSplitEnabled(){return this.splitEnabled},setSplitEnabled(t){this.splitEnabled=t},isSplitTarget(t,e=[],i){if(t.isEdge()&&1===e.length&&e[0].isConnectable()&&!this.getEdgeValidationError(t,t.getTerminal(!0),e[0])){const i=t.getTerminal(!0),s=t.getTerminal(!1);return!e[0].isAncestor(i)&&!e[0].isAncestor(s)}return!1}};var $=i(849);const q={resetEdgesOnResize:!1,isResetEdgesOnResize(){return this.resetEdgesOnResize},resetEdgesOnMove:!1,isResetEdgesOnMove(){return this.resetEdgesOnMove},resetEdgesOnConnect:!0,isResetEdgesOnConnect(){return this.resetEdgesOnConnect},connectableEdges:!1,allowDanglingEdges:!0,cloneInvalidEdges:!1,alternateEdgeStyle:{},edgeLabelsMovable:!0,isEdgeLabelsMovable(){return this.edgeLabelsMovable},setEdgeLabelsMovable(t){this.edgeLabelsMovable=t},setAllowDanglingEdges(t){this.allowDanglingEdges=t},isAllowDanglingEdges(){return this.allowDanglingEdges},setConnectableEdges(t){this.connectableEdges=t},isConnectableEdges(){return this.connectableEdges},setCloneInvalidEdges(t){this.cloneInvalidEdges=t},isCloneInvalidEdges(){return this.cloneInvalidEdges},flipEdge(t){return this.alternateEdgeStyle&&this.batchUpdate(()=>{const e=t.getStyle();Object.keys(e).length?this.getDataModel().setStyle(t,this.alternateEdgeStyle):this.getDataModel().setStyle(t,{}),this.resetEdge(t),this.fireEvent(new n.A(r.A.FLIP_EDGE,{edge:t}))}),t},splitEdge(t,e,i,s=0,l=0,h,o,a=null){a=a??t.getParent();const d=t.getTerminal(!0);return this.batchUpdate(()=>{if(!i){i=this.cloneCell(t);const e=this.getView().getState(t);let n=i.getGeometry();if(n&&e){const i=this.getView().translate,r=this.getView().scale,h=(0,S.JQ)(e,(s+i.x)*r,(l+i.y)*r);n.points=n.points.slice(0,h),n=t.getGeometry(),n&&(n=n.clone(),n.points=n.points.slice(h),this.getDataModel().setGeometry(t,n))}}this.cellsMoved(e,s,l,!1,!1),this.cellsAdded(e,a,a?a.getChildCount():0,null,null,!0),this.cellsAdded([i],a,a?a.getChildCount():0,d,e[0],!1),this.cellConnected(t,e[0],!0),this.fireEvent(new n.A(r.A.SPLIT_EDGE,{edge:t,cells:e,newEdge:i,dx:s,dy:l}))}),i},insertEdge(...t){let e,i,s,n,l,r;if(1===t.length&&"object"==typeof t[0]){const h=t[0];e=h.parent,i=h.id,s=h.value,n=h.source,l=h.target,r=h.style}else[e,i,s,n,l,r]=t;const h=this.createEdge(e,i,s,n,l,r);return this.addEdge(h,e,n,l)},createEdge(t=null,e,i,s=null,n=null,l={}){const r=new d.A(i,new $.A,l);return r.setId(e),r.setEdge(!0),r.geometry.relative=!0,r},addEdge(t,e=null,i=null,s=null,n=null){return this.addCell(t,e,n,i,s)},addAllEdges(t){const e=t.slice();return(0,D.R3)(e.concat(this.getAllEdges(t)))},getAllEdges(t){let e=[];if(t)for(let i=0;i<t.length;i+=1){const s=t[i].getEdgeCount();for(let n=0;n<s;n++)e.push(t[i].getEdgeAt(n));const n=t[i].getChildren();e=e.concat(this.getAllEdges(n))}return e},getIncomingEdges(t,e=null){return this.getEdges(t,e,!0,!1,!1)},getOutgoingEdges(t,e=null){return this.getEdges(t,e,!1,!0,!1)},getEdges(t,e=null,i=!0,s=!0,n=!0,l=!1){let r=[];const h=t.isCollapsed(),o=t.getChildCount();for(let e=0;e<o;e+=1){const n=t.getChildAt(e);!h&&n.isVisible()||(r=r.concat(n.getEdges(i,s)))}r=r.concat(t.getEdges(i,s));const a=[];for(let h=0;h<r.length;h+=1){const o=this.getView().getState(r[h]),d=o?o.getVisibleTerminal(!0):this.getView().getVisibleTerminal(r[h],!0),c=o?o.getVisibleTerminal(!1):this.getView().getVisibleTerminal(r[h],!1);(n&&d===c||d!==c&&(i&&c===t&&(!e||this.isValidAncestor(d,e,l))||s&&d===t&&(!e||this.isValidAncestor(c,e,l))))&&a.push(r[h])}return a},getChildEdges(t){return this.getChildCells(t,!1,!0)},getEdgesBetween(t,e,i=!1){const s=this.getEdges(t),n=[];for(let l=0;l<s.length;l+=1){const r=this.getView().getState(s[l]),h=r?r.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[l],!0),o=r?r.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[l],!1);(h===t&&o===e||!i&&h===e&&o===t)&&n.push(s[l])}return n},resetEdges(t){const e=new Map;for(let i=0;i<t.length;i+=1)e.set(t[i],!0);this.batchUpdate(()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getEdges();for(let t=0;t<s.length;t++){const i=this.getView().getState(s[t]),n=i?i.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[t],!0),l=i?i.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[t],!1);e.get(n)&&e.get(l)||this.resetEdge(s[t])}this.resetEdges(t[i].getChildren())}})},resetEdge(t){let e=t.getGeometry();return e&&e.points&&e.points.length>0&&(e=e.clone(),e.points=[],this.getDataModel().setGeometry(t,e)),t}},K={cellsEditable:!0,startEditing(t){this.startEditingAtCell(null,t)},startEditingAtCell(t=null,e){if(!e||!(0,L.DO)(e))if(t){this.fireEvent(new n.A(r.A.START_EDITING,{cell:t,event:e}));const i=this.getPlugin("CellEditorHandler");i?.startEditing(t,e),this.fireEvent(new n.A(r.A.EDITING_STARTED,{cell:t,event:e}))}else(t=this.getSelectionCell())&&!this.isCellEditable(t)&&(t=null)},getEditingValue(t,e){return this.convertValueToString(t)},stopEditing(t=!1){const e=this.getPlugin("CellEditorHandler");e?.stopEditing(t),this.fireEvent(new n.A(r.A.EDITING_STOPPED,{cancel:t}))},labelChanged(t,e,i){return this.batchUpdate(()=>{const s=t.value;this.cellLabelChanged(t,e,this.isAutoSizeCell(t)),this.fireEvent(new n.A(r.A.LABEL_CHANGED,{cell:t,value:e,old:s,event:i}))}),t},cellLabelChanged(t,e,i=!1){this.batchUpdate(()=>{this.getDataModel().setValue(t,e),i&&this.cellSizeUpdated(t,!1)})},isEditing(t=null){const e=this.getPlugin("CellEditorHandler"),i=e?.getEditingCell();return t?t===i:!!i},isCellEditable(t){return this.isCellsEditable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).editable??!0)},isCellsEditable(){return this.cellsEditable},setCellsEditable(t){this.cellsEditable=t}};var j=i(2548);const J={lastTouchEvent:null,doubleClickCounter:0,lastTouchCell:null,fireDoubleClick:null,tapAndHoldThread:null,lastMouseX:null,lastMouseY:null,isMouseTrigger:null,ignoreMouseEvents:null,mouseMoveRedirect:null,mouseUpRedirect:null,lastEvent:null,escapeEnabled:!0,invokesStopCellEditing:!0,enterStopsCellEditing:!1,isMouseDown:!1,nativeDblClickEnabled:!0,doubleTapEnabled:!0,doubleTapTimeout:500,doubleTapTolerance:25,lastTouchX:0,lastTouchY:0,lastTouchTime:0,tapAndHoldEnabled:!0,tapAndHoldDelay:500,tapAndHoldInProgress:!1,tapAndHoldValid:!1,initialTouchX:0,initialTouchY:0,tolerance:4,isNativeDblClickEnabled(){return this.nativeDblClickEnabled},getEventTolerance(){return this.tolerance},setEventTolerance(t){this.tolerance=t},escape(t){this.fireEvent(new n.A(r.A.ESCAPE,{event:t}))},click(t){const e=t.getEvent();let i=t.getCell();const s=new n.A(r.A.CLICK,{event:e,cell:i});if(t.isConsumed()&&s.consume(),this.fireEvent(s),this.isEnabled()&&!(0,L.fm)(e)&&!s.isConsumed()){if(i){if(this.isTransparentClickEvent(e)){let e=!1;const s=this.getCellAt(t.graphX,t.graphY,null,!1,!1,t=>{const s=this.isCellSelected(t.cell);return e=e||s,!e||s||t.cell!==i&&t.cell.isAncestor(i)});s&&(i=s)}}else if(this.isSwimlaneSelectionEnabled()&&(i=this.getSwimlaneAt(t.getGraphX(),t.getGraphY()),!(null==i||this.isToggleEvent(e)&&(0,L.CA)(e)))){let t=i,s=[];for(;null!=t;){t=t.getParent();const e=this.getView().getState(t);this.isSwimlane(t)&&null!=e&&s.push(t)}if(s.length>0){s=s.reverse(),s.splice(0,0,i),s.push(i);for(let t=0;t<s.length-1;t+=1)this.isCellSelected(s[t])&&(i=s[this.isToggleEvent(e)?t:t+1])}}i?this.selectCellForEvent(i,e):this.isToggleEvent(e)||this.clearSelection()}return!1},dblClick(t,e=null){const i=new n.A(r.A.DOUBLE_CLICK,{event:t,cell:e});this.fireEvent(i),this.isEnabled()&&!(0,L.fm)(t)&&!i.isConsumed()&&e&&this.isCellEditable(e)&&!this.isEditing(e)&&(this.startEditingAtCell(e,t),r.A.consume(t))},tapAndHold(t){const e=t.getEvent(),i=new n.A(r.A.TAP_AND_HOLD,{event:e,cell:t.getCell()}),s=this.getPlugin("PanningHandler"),l=this.getPlugin("ConnectionHandler");if(this.fireEvent(i),i.isConsumed()&&s&&(s.panningTrigger=!1),this.isEnabled()&&!(0,L.fm)(e)&&!i.isConsumed()&&l&&l.isEnabled()){const e=l.marker.getCell(t);if(e){const i=this.getView().getState(e);i&&(l.marker.currentColor=l.marker.validColor,l.marker.markedState=i,l.marker.mark(),l.first=new C.A(t.getGraphX(),t.getGraphY()),l.edgeState=l.createEdgeState(t),l.previous=i,l.fireEvent(new n.A(r.A.START,{state:l.previous})))}}},addMouseListener(t){this.mouseListeners.push(t)},removeMouseListener(t){for(let e=0;e<this.mouseListeners.length;e+=1)if(this.mouseListeners[e]===t){this.mouseListeners.splice(e,1);break}},updateMouseEvent(t,e){const i=(0,a.ce)(this.getContainer(),t.getX(),t.getY());if(t.graphX=i.x-this.getPanDx(),t.graphY=i.y-this.getPanDy(),!t.getCell()&&this.isMouseDown&&e===r.A.MOUSE_MOVE){const e=this.getCellAt(i.x,i.y,null,!0,!0,t=>!t.shape||t.shape.paintBackground!==this.paintBackground||t.style.pointerEvents||t.shape.fill!==c.x3);t.state=e?this.getView().getState(e):null}return t},getStateForTouchEvent(t){const e=(0,L.El)(t),i=(0,L.xJ)(t),s=(0,a.ce)(this.getContainer(),e,i),n=this.getCellAt(s.x,s.y);return n?this.getView().getState(n):null},isEventIgnored(t,e,i){const s=(0,L.Er)(e.getEvent());let n=!1;e.getEvent()===this.lastEvent?n=!0:this.lastEvent=e.getEvent();const l=this.getEventSource();return l&&t!==r.A.MOUSE_MOVE?(r.A.removeGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.setEventSource(null)):!o.A.IS_GC&&l&&e.getSource()!==l?n=!0:l&&o.A.IS_TOUCH&&t===r.A.MOUSE_DOWN&&!s&&!(0,L.ew)(e.getEvent())&&(this.setEventSource(e.getSource()),this.mouseMoveRedirect=t=>{this.fireMouseEvent(r.A.MOUSE_MOVE,new j.A(t,this.getStateForTouchEvent(t)))},this.mouseUpRedirect=t=>{this.fireMouseEvent(r.A.MOUSE_UP,new j.A(t,this.getStateForTouchEvent(t)))},r.A.addGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect)),this.isSyntheticEventIgnored(t,e,i)&&(n=!0),!(0,L.$Y)(this.lastEvent)&&t!==r.A.MOUSE_MOVE&&2===this.lastEvent.detail||(t===r.A.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:t!==r.A.MOUSE_DOWN||this.isMouseDown?!n&&((!o.A.IS_FF||t!==r.A.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!==s||t===r.A.MOUSE_DOWN&&this.isMouseDown||t===r.A.MOUSE_UP&&!this.isMouseDown)&&(n=!0):(this.isMouseDown=!0,this.isMouseTrigger=s),n||t!==r.A.MOUSE_DOWN||(this.lastMouseX=e.getX(),this.lastMouseY=e.getY()),n)},isSyntheticEventIgnored(t,e,i){let s=!1;const n=(0,L.Er)(e.getEvent());return this.ignoreMouseEvents&&n&&t!==r.A.MOUSE_MOVE?(this.ignoreMouseEvents=t!==r.A.MOUSE_UP,s=!0):o.A.IS_FF&&!n&&t===r.A.MOUSE_UP&&(this.ignoreMouseEvents=!0),s},isEventSourceIgnored(t,e){const i=e.getSource();if(!i)return!0;const s=i.nodeName?i.nodeName.toLowerCase():"",n=!(0,L.Er)(e.getEvent())||(0,L.Lg)(e.getEvent());return t===r.A.MOUSE_DOWN&&n&&("select"===s||"option"===s||"input"===s&&"checkbox"!==i.type&&"radio"!==i.type&&"button"!==i.type&&"submit"!==i.type&&"file"!==i.type)},getEventState:t=>t,fireMouseEvent(t,e,i){if(i=i??this,this.isEventSourceIgnored(t,e)){const t=this.getPlugin("TooltipHandler");return void(t&&t.hide())}if(e=this.updateMouseEvent(e,t),!this.nativeDblClickEnabled&&!(0,L.$Y)(e.getEvent())||this.doubleTapEnabled&&o.A.IS_TOUCH&&((0,L.kH)(e.getEvent())||(0,L.ew)(e.getEvent()))){const i=(new Date).getTime();if(t===r.A.MOUSE_DOWN)if(this.lastTouchEvent&&this.lastTouchEvent!==e.getEvent()&&i-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){this.doubleClickCounter+=1;let i=!1;if(t===r.A.MOUSE_UP){if(e.getCell()===this.lastTouchCell&&this.lastTouchCell){this.lastTouchTime=0;const t=this.lastTouchCell;this.lastTouchCell=null,this.dblClick(e.getEvent(),t),i=!0}}else this.fireDoubleClick=!0,this.lastTouchTime=0;if(i)return void r.A.consume(e.getEvent())}else this.lastTouchEvent&&this.lastTouchEvent===e.getEvent()||(this.lastTouchCell=e.getCell(),this.lastTouchX=e.getX(),this.lastTouchY=e.getY(),this.lastTouchTime=i,this.lastTouchEvent=e.getEvent(),this.doubleClickCounter=0);else if((this.isMouseDown||t===r.A.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;const t=this.lastTouchCell;return this.lastTouchCell=null,this.isMouseDown=!1,void((t||((0,L.kH)(e.getEvent())||(0,L.ew)(e.getEvent()))&&(o.A.IS_GC||o.A.IS_SF))&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance?this.dblClick(e.getEvent(),t):r.A.consume(e.getEvent()))}}if(!this.isEventIgnored(t,e,i)){const s=e.getState();if(e.state=s?this.getEventState(s):null,this.fireEvent(new n.A(r.A.FIRE_MOUSE_EVENT,{eventName:t,event:e})),o.A.IS_SF||o.A.IS_GC||e.getEvent().target!==this.getContainer()){const s=this.getContainer();if(t===r.A.MOUSE_MOVE&&this.isMouseDown&&this.isAutoScroll()&&!(0,L.DO)(e.getEvent()))this.scrollPointToVisible(e.getGraphX(),e.getGraphY(),this.isAutoExtend());else if(t===r.A.MOUSE_UP&&this.isIgnoreScrollbars()&&this.isTranslateToScrollPosition()&&(0!==s.scrollLeft||0!==s.scrollTop)){const t=this.getView().scale,e=this.getView().translate;this.getView().setTranslate(e.x-s.scrollLeft/t,e.y-s.scrollTop/t),s.scrollLeft=0,s.scrollTop=0}const n=this.mouseListeners;e.getEvent().preventDefault||(e.getEvent().returnValue=!0);for(const s of n)t===r.A.MOUSE_DOWN?s.mouseDown(i,e):t===r.A.MOUSE_MOVE?s.mouseMove(i,e):t===r.A.MOUSE_UP&&s.mouseUp(i,e);t===r.A.MOUSE_UP&&this.click(e)}if(((0,L.kH)(e.getEvent())||(0,L.ew)(e.getEvent()))&&t===r.A.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress){this.tapAndHoldInProgress=!0,this.initialTouchX=e.getGraphX(),this.initialTouchY=e.getGraphY();const t=()=>{this.tapAndHoldValid&&this.tapAndHold(e),this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1};this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(t,this.tapAndHoldDelay),this.tapAndHoldValid=!0}else t===r.A.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-e.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-e.getGraphY())<this.tolerance);const l=this.getPlugin("CellEditorHandler");t===r.A.MOUSE_DOWN&&this.isEditing()&&!l?.isEventSource(e.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing()),this.consumeMouseEvent(t,e,i)}},consumeMouseEvent(t,e,i){i=i??this,t===r.A.MOUSE_DOWN&&(0,L.kH)(e.getEvent())&&e.consume(!1)},fireGestureEvent(t,e=null){this.lastTouchTime=0,this.fireEvent(new n.A(r.A.GESTURE,{event:t,cell:e}))},sizeDidChange(){const t=this.getGraphBounds(),e=this.getBorder();let i=Math.max(0,t.x)+t.width+2*e,s=Math.max(0,t.y)+t.height+2*e;const l=this.getMinimumContainerSize();if(l&&(i=Math.max(i,l.width),s=Math.max(s,l.height)),this.isResizeContainer()&&this.doResizeContainer(i,s),this.isPreferPageSize()||this.isPageVisible()){const e=this.getPreferredPageSize(t,Math.max(1,i),Math.max(1,s));i=e.width*this.getView().scale,s=e.height*this.getView().scale}const h=this.getMinimumGraphSize();h&&(i=Math.max(i,h.width*this.getView().scale),s=Math.max(s,h.height*this.getView().scale)),i=Math.ceil(i),s=Math.ceil(s);const o=this.getView().getDrawPane().ownerSVGElement;o&&(o.style.minWidth=`${Math.max(1,i)}px`,o.style.minHeight=`${Math.max(1,s)}px`,o.style.width="100%",o.style.height="100%"),this.updatePageBreaks(this.isPageBreaksVisible(),i,s),this.fireEvent(new n.A(r.A.SIZE,{bounds:t}))},isCloneEvent:t=>(0,L.qt)(t),isTransparentClickEvent:t=>!1,isToggleEvent:t=>o.A.IS_MAC?(0,L.UT)(t):(0,L.qt)(t),isGridEnabledEvent:t=>!(0,L.CA)(t),isConstrainedEvent:t=>(0,L.RT)(t),isIgnoreTerminalEvent:t=>!1,getPointForEvent(t,e=!0){const i=(0,a.ce)(this.getContainer(),(0,L.El)(t),(0,L.xJ)(t)),s=this.getView().scale,n=this.getView().translate,l=e?this.getGridSize()/2:0;return i.x=this.snap(i.x/s-n.x-l),i.y=this.snap(i.y/s-n.y-l),i},isEscapeEnabled(){return this.escapeEnabled},setEscapeEnabled(t){this.escapeEnabled=t},isInvokesStopCellEditing(){return this.invokesStopCellEditing},setInvokesStopCellEditing(t){this.invokesStopCellEditing=t},isEnterStopsCellEditing(){return this.enterStopsCellEditing},setEnterStopsCellEditing(t){this.enterStopsCellEditing=t},getCursorForMouseEvent(t){const e=t.getCell();return e?this.getCursorForCell(e):null}},Q={collapseExpandResource:(0,I.m)()?"collapse-expand":"",getCollapseExpandResource(){return this.collapseExpandResource},isFoldingEnabled(){return this.options.foldingEnabled},getFoldableCells(t,e=!1){return this.getDataModel().filterCells(t,t=>this.isCellFoldable(t,e))},isCellFoldable(t,e){return t.getChildCount()>0&&(this.getCurrentCellStyle(t).foldable??!0)},getFoldingImage(t){if(null!=t&&this.isFoldingEnabled()&&!t.cell.isEdge()){const e=t.cell.isCollapsed();if(this.isCellFoldable(t.cell,!e))return e?this.options.collapsedImage:this.options.expandedImage}return null},foldCells(t=!1,e=!1,i=null,s=!1,l=null){return null==i&&(i=this.getFoldableCells(this.getSelectionCells(),t)),this.stopEditing(!1),this.batchUpdate(()=>{this.cellsFolded(i,t,e,s),this.fireEvent(new n.A(r.A.FOLD_CELLS,"collapse",t,"recurse",e,"cells",i))}),i},cellsFolded(t=null,e=!1,i=!1,s=!1){null!=t&&t.length>0&&this.batchUpdate(()=>{for(let n=0;n<t.length;n+=1)if((!s||this.isCellFoldable(t[n],e))&&e!==t[n].isCollapsed()){if(this.getDataModel().setCollapsed(t[n],e),this.swapBounds(t[n],e),this.isExtendParent(t[n])&&this.extendParent(t[n]),i){const s=t[n].getChildren();this.cellsFolded(s,e,i)}this.constrainChild(t[n])}this.fireEvent(new n.A(r.A.CELLS_FOLDED,{cells:t,collapse:e,recurse:i}))})},swapBounds(t,e=!1){let i=t.getGeometry();null!=i&&(i=i.clone(),this.updateAlternateBounds(t,i,e),i.swap(),this.getDataModel().setGeometry(t,i))},updateAlternateBounds(t=null,e=null,i=!1){if(null!=t&&null!=e){const i=this.getCurrentCellStyle(t);if(null==e.alternateBounds){let s=e;if(this.options.collapseToPreferredSize){const e=this.getPreferredSizeForCell(t);if(null!=e){s=e;const t=i.startSize??0;t>0&&(s.height=Math.max(s.height,t))}}e.alternateBounds=new h.A(0,0,s.width,s.height)}if(null!=e.alternateBounds){e.alternateBounds.x=e.x,e.alternateBounds.y=e.y;const t=(0,S.eh)(i.rotation||0);if(0!==t){const i=e.alternateBounds.getCenterX()-e.getCenterX(),s=e.alternateBounds.getCenterY()-e.getCenterY(),n=Math.cos(t),l=Math.sin(t),r=n*i-l*s,h=l*i+n*s;e.alternateBounds.x+=r-i,e.alternateBounds.y+=h-s}}}}},Z={groupCells(t,e=0,i){i||(i=(0,a.gU)(this.getSelectionCells(),!0)),i||(i=this.getCellsForGroup(i)),null==t&&(t=this.createGroupCell(i));const s=this.getBoundsForGroup(t,i,e);if(i.length>1&&null!=s){let l=t.getParent();null==l&&(l=i[0].getParent()),this.batchUpdate(()=>{null==t.getGeometry()&&this.getDataModel().setGeometry(t,new $.A);let h=l.getChildCount();this.cellsAdded([t],l,h,null,null,!1,!1,!1),h=t.getChildCount(),this.cellsAdded(i,t,h,null,null,!1,!1,!1),this.cellsMoved(i,-s.x,-s.y,!1,!1,!1),this.cellsResized([t],[s],!1),this.fireEvent(new n.A(r.A.GROUP_CELLS,{group:t,border:e,cells:i}))})}return t},getCellsForGroup(t){const e=[];if(null!=t&&t.length>0){const i=t[0].getParent();e.push(t[0]);for(let s=1;s<t.length;s+=1)t[s].getParent()===i&&e.push(t[s])}return e},getBoundsForGroup(t,e,i){const s=this.getBoundingBoxFromGeometry(e,!0);if(null!=s){if(this.isSwimlane(t)){const e=this.getStartSize(t);s.x-=e.width,s.y-=e.height,s.width+=e.width,s.height+=e.height}null!=i&&(s.x-=i,s.y-=i,s.width+=2*i,s.height+=2*i)}return s},createGroupCell(t){const e=new d.A("");return e.setVertex(!0),e.setConnectable(!1),e},ungroupCells(t){let e=[];return null==t&&(t=this.getCellsForUngroup()),null!=t&&t.length>0&&this.batchUpdate(()=>{const i=t;for(let t=0;t<i.length;t+=1){let s=i[t].getChildren();if(null!=s&&s.length>0){s=s.slice();const n=i[t].getParent(),l=n.getChildCount();this.cellsAdded(s,n,l,null,null,!0),e=e.concat(s);for(const t of s){const e=this.getView().getState(t);let i=t.getGeometry();null!=e&&null!=i&&i.relative&&(i=i.clone(),i.x=e.origin.x,i.y=e.origin.y,i.relative=!1,this.getDataModel().setGeometry(t,i))}}}this.removeCellsAfterUngroup(i),this.fireEvent(new n.A(r.A.UNGROUP_CELLS,{cells:t}))}),e},getCellsForUngroup(){const t=this.getSelectionCells(),e=[];for(let i=0;i<t.length;i+=1)t[i].isVertex()&&t[i].getChildCount()>0&&e.push(t[i]);return e},removeCellsAfterUngroup(t){this.cellsRemoved(this.addAllEdges(t))},removeCellsFromParent(t){return null==t&&(t=this.getSelectionCells()),this.batchUpdate(()=>{const e=this.getDefaultParent(),i=e.getChildCount();this.cellsAdded(t,e,i,null,null,!0),this.fireEvent(new n.A(r.A.REMOVE_CELLS_FROM_PARENT,{cells:t}))}),t},updateGroupBounds(t,e=0,i=!1,s=0,n=0,l=0,r=0){return null==t&&(t=this.getSelectionCells()),e=null!=e?e:0,i=null!=i&&i,s=null!=s?s:0,n=null!=n?n:0,l=null!=l?l:0,r=null!=r?r:0,this.batchUpdate(()=>{for(let o=t.length-1;o>=0;o--){let a=t[o].getGeometry();if(null==a)continue;const d=this.getChildCells(t[o]);if(null!=d&&d.length>0){const c=this.getBoundingBoxFromGeometry(d,!0);if(null!=c&&c.width>0&&c.height>0){const g=this.isSwimlane(t[o])?this.getActualStartSize(t[o],!0):new h.A;a=a.clone(),i&&(a.x=Math.round(a.x+c.x-e-g.x-r),a.y=Math.round(a.y+c.y-e-g.y-s)),a.width=Math.round(c.width+2*e+g.x+r+n+g.width),a.height=Math.round(c.height+2*e+g.y+s+l+g.height),this.getDataModel().setGeometry(t[o],a),this.moveCells(d,e+g.x-c.x+r,e+g.y-c.y+s)}}}}),t},enterGroup(t){null!=(t=t||this.getSelectionCell())&&this.isValidRoot(t)&&(this.getView().setCurrentRoot(t),this.clearSelection())},exitGroup(){const t=this.getDataModel().getRoot(),e=this.getCurrentRoot();if(null!=e){let i=e.getParent();for(;i!==t&&!this.isValidRoot(i)&&i.getParent()!==t;)i=i.getParent();i===t||i.getParent()===t?this.getView().setCurrentRoot(null):this.getView().setCurrentRoot(i),null!=this.getView().getState(e)&&this.setSelectionCell(e)}}},tt={addImageBundle(t){this.imageBundles.push(t)},removeImageBundle(t){const e=[];for(let i=0;i<this.imageBundles.length;i+=1)this.imageBundles[i]!==t&&e.push(this.imageBundles[i]);this.imageBundles=e},getImageFromBundles(t){if(t)for(let e=0;e<this.imageBundles.length;e+=1){const i=this.imageBundles[e].getImage(t);if(i)return i}return null}},et={getLabel(t){let e="";return this.isLabelsVisible()&&t&&(this.getCurrentCellStyle(t).noLabel||(e=this.convertValueToString(t))),e},isHtmlLabel(t){return this.isHtmlLabels()},labelsVisible:!0,isLabelsVisible(){return this.labelsVisible},htmlLabels:!1,isHtmlLabels(){return this.htmlLabels},setHtmlLabels(t){this.htmlLabels=t},isWrapping(t){return"wrap"===this.getCurrentCellStyle(t).whiteSpace},isLabelClipped(t){return"hidden"===this.getCurrentCellStyle(t).overflow},isLabelMovable(t){return!this.isCellLocked(t)&&(t.isEdge()&&this.isEdgeLabelsMovable()||t.isVertex()&&this.isVertexLabelsMovable())}},it={orderCells(t=!1,e){return e||(e=this.getSelectionCells()),e||(e=(0,a.gU)(this.getSelectionCells(),!0)),this.batchUpdate(()=>{this.cellsOrdered(e,t);const i=new n.A(r.A.ORDER_CELLS,"back",t,"cells",e);this.fireEvent(i)}),e},cellsOrdered(t,e=!1){this.batchUpdate(()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getParent();e?this.getDataModel().add(s,t[i],i):this.getDataModel().add(s,t[i],s?s.getChildCount()-1:0)}this.fireEvent(new n.A(r.A.CELLS_ORDERED,{back:e,cells:t}))})}};class st extends l.A{constructor(t,e=null,i="right",s="bottom",n=new C.A,l="help"){super(),this.align="right",this.verticalAlign="bottom",this.offset=new C.A,this.cursor="help",this.defaultOverlap=.5,this.image=t,this.tooltip=e,this.align=i,this.verticalAlign=s,this.offset=n,this.cursor=l}getBounds(t){const e=t.cell.isEdge(),i=t.view.scale;let s=null;const n=this.image,l=n.width,r=n.height;if(e){const e=t.absolutePoints;if(e.length%2==1)s=e[Math.floor(e.length/2)];else{const t=e.length/2,i=e[t-1],n=e[t];s=new C.A(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}}else{if(s=new C.A,"left"===this.align)s.x=t.x;else if("center"===this.align)s.x=t.x+t.width/2;else{if("right"!==this.align)throw new Error;s.x=t.x+t.width}if("top"===this.verticalAlign)s.y=t.y;else if("middle"===this.verticalAlign)s.y=t.y+t.height/2;else{if("bottom"!==this.verticalAlign)throw new Error;s.y=t.y+t.height}}return new h.A(Math.round(s.x-(l*this.defaultOverlap-this.offset.x)*i),Math.round(s.y-(r*this.defaultOverlap-this.offset.y)*i),l*i,r*i)}toString(){return this.tooltip}}const nt=st,lt={addCellOverlay(t,e){t.overlays.push(e);const i=this.getView().getState(t);return i&&this.getCellRenderer().redraw(i),this.fireEvent(new n.A(r.A.ADD_OVERLAY,{cell:t,overlay:e})),e},getCellOverlays:t=>t.overlays,removeCellOverlay(t,e=null){if(e){const i=t.overlays.indexOf(e);if(i>=0){t.overlays.splice(i,1);const s=this.getView().getState(t);s&&this.getCellRenderer().redraw(s),this.fireEvent(new n.A(r.A.REMOVE_OVERLAY,{cell:t,overlay:e}))}else e=null}else this.removeCellOverlays(t);return e},removeCellOverlays(t){const{overlays:e}=t;t.overlays=[];const i=this.getView().getState(t);i&&this.getCellRenderer().redraw(i);for(let i=0;i<e.length;i+=1)this.fireEvent(new n.A(r.A.REMOVE_OVERLAY,"cell",t,"overlay",e[i]));return e},clearCellOverlays(t=null){if(!(t=t??this.getDataModel().getRoot()))return;this.removeCellOverlays(t);const e=t.getChildCount();for(let i=0;i<e;i+=1){const e=t.getChildAt(i);this.clearCellOverlays(e)}},setCellWarning(t,e=null,i,s=!1){if(i=i??this.getWarningImage(),e&&e.length>0){const n=new nt(i,`<font color=red>${e}</font>`);return s&&n.addListener(r.A.CLICK,(e,i)=>{this.isEnabled()&&this.setSelectionCell(t)}),this.addCellOverlay(t,n)}return this.removeCellOverlays(t),null}};var rt=i(2395);const ht={horizontalPageBreaks:null,verticalPageBreaks:null,updatePageBreaks(t,e,i){const{scale:s,translate:n}=this.getView(),l=this.getPageFormat(),r=s*this.getPageScale(),o=new h.A(0,0,l.width*r,l.height*r),a=h.A.fromRectangle(this.getGraphBounds());a.width=Math.max(1,a.width),a.height=Math.max(1,a.height),o.x=Math.floor((a.x-n.x*s)/o.width)*o.width+n.x*s,o.y=Math.floor((a.y-n.y*s)/o.height)*o.height+n.y*s,a.width=Math.ceil((a.width+(a.x-o.x))/o.width)*o.width,a.height=Math.ceil((a.height+(a.y-o.y))/o.height)*o.height;const d=(t=t&&Math.min(o.width,o.height)>this.getMinPageBreakDist())?Math.ceil(a.height/o.height)+1:0,c=t?Math.ceil(a.width/o.width)+1:0,g=(c-1)*o.width,u=(d-1)*o.height;null==this.horizontalPageBreaks&&d>0&&(this.horizontalPageBreaks=[]),null==this.verticalPageBreaks&&c>0&&(this.verticalPageBreaks=[]);const p=t=>{if(null!=t){const e=t===this.horizontalPageBreaks?d:c;for(let i=0;i<=e;i+=1){const e=t===this.horizontalPageBreaks?[new C.A(Math.round(o.x),Math.round(o.y+i*o.height)),new C.A(Math.round(o.x+g),Math.round(o.y+i*o.height))]:[new C.A(Math.round(o.x+i*o.width),Math.round(o.y)),new C.A(Math.round(o.x+i*o.width),Math.round(o.y+u))];if(null!=t[i])t[i].points=e,t[i].redraw();else{const s=new rt.A(e,this.getPageBreakColor());s.dialect=this.getDialect(),s.pointerEvents=!1,s.isDashed=this.isPageBreakDashed(),s.init(this.getView().backgroundPane),s.redraw(),t[i]=s}}for(let i=e;i<t.length;i+=1)t[i].destroy();t.splice(e,t.length-e)}};p(this.horizontalPageBreaks),p(this.verticalPageBreaks)}},ot={shiftPreview1:null,shiftPreview2:null,useScrollbarsForPanning:!0,isUseScrollbarsForPanning(){return this.useScrollbarsForPanning},timerAutoScroll:!1,isTimerAutoScroll(){return this.timerAutoScroll},allowAutoPanning:!1,isAllowAutoPanning(){return this.allowAutoPanning},panDx:0,getPanDx(){return this.panDx},setPanDx(t){this.panDx=t},panDy:0,getPanDy(){return this.panDy},setPanDy(t){this.panDy=t},panGraph(t,e){const i=this.getContainer();if(this.useScrollbarsForPanning&&(0,a.uM)(i))i.scrollLeft=-t,i.scrollTop=-e;else{const s=this.getView().getCanvas();if(0===t&&0===e){if(s.removeAttribute("transform"),this.shiftPreview1){let t=this.shiftPreview1.firstChild;for(;t;){const e=t.nextSibling;i.appendChild(t),t=e}this.shiftPreview1.parentNode&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,i.appendChild(s.parentNode);const e=this.shiftPreview2;for(t=e.firstChild;t;){const e=t.nextSibling;i.appendChild(t),t=e}e.parentNode&&e.parentNode.removeChild(e),this.shiftPreview2=null}}else{if(s.setAttribute("transform",`translate(${t},${e})`),!this.shiftPreview1){this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible";let t=this.shiftPreview1,e=i.firstChild;for(;e;){const i=e.nextSibling;e!==s.parentNode?t.appendChild(e):t=this.shiftPreview2,e=i}this.shiftPreview1.firstChild&&i.insertBefore(this.shiftPreview1,s.parentNode),this.shiftPreview2.firstChild&&i.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=`${t}px`,this.shiftPreview1.style.top=`${e}px`,this.shiftPreview2&&(this.shiftPreview2.style.left=`${t}px`,this.shiftPreview2.style.top=`${e}px`)}this.panDx=t,this.panDy=e,this.fireEvent(new n.A(r.A.PAN))}},scrollCellToVisible(t,e=!1){const i=-this.getView().translate.x,s=-this.getView().translate.y,n=this.getView().getState(t);if(n){const t=new h.A(i+n.x,s+n.y,n.width,n.height);if(e&&this.getContainer()){const e=this.getContainer().clientWidth,i=this.getContainer().clientHeight;t.x=t.getCenterX()-e/2,t.width=e,t.y=t.getCenterY()-i/2,t.height=i}const l=new C.A(this.getView().translate.x,this.getView().translate.y);if(this.scrollRectToVisible(t)){const t=new C.A(this.getView().translate.x,this.getView().translate.y);this.getView().translate.x=l.x,this.getView().translate.y=l.y,this.getView().setTranslate(t.x,t.y)}}},scrollRectToVisible(t){let e=!1;const i=this.getContainer(),s=i.offsetWidth,n=i.offsetHeight,l=Math.min(s,t.width),r=Math.min(n,t.height);if((0,a.uM)(i)){t.x+=this.getView().translate.x,t.y+=this.getView().translate.y;let e=i.scrollLeft-t.x;const s=Math.max(e-i.scrollLeft,0);e>0?i.scrollLeft-=e+2:(e=t.x+l-i.scrollLeft-i.clientWidth,e>0&&(i.scrollLeft+=e+2));let n=i.scrollTop-t.y;const h=Math.max(0,n-i.scrollTop);n>0?i.scrollTop-=n+2:(n=t.y+r-i.scrollTop-i.clientHeight,n>0&&(i.scrollTop+=n+2)),this.useScrollbarsForPanning||0==s&&0==h||this.getView().setTranslate(s,h)}else{const i=-this.getView().translate.x,h=-this.getView().translate.y,o=this.getView().scale;if(t.x+l>i+s&&(this.getView().translate.x-=(t.x+l-s-i)/o,e=!0),t.y+r>h+n&&(this.getView().translate.y-=(t.y+r-n-h)/o,e=!0),t.x<i&&(this.getView().translate.x+=(i-t.x)/o,e=!0),t.y<h&&(this.getView().translate.y+=(h-t.y)/o,e=!0),e){this.getView().refresh();const t=this.getPlugin("SelectionCellsHandler");t&&t.refresh()}}return e},setPanning(t){const e=this.getPlugin("PanningHandler");e&&(e.panningEnabled=t)}},at={portsEnabled:!0,isPort:t=>!1,getTerminalForPort:(t,e=!1)=>t.getParent(),isPortsEnabled(){return this.portsEnabled},setPortsEnabled(t){this.portsEnabled=t}},dt={selectionModel:null,getSelectionModel(){return this.selectionModel},setSelectionModel(t){this.selectionModel=t},isCellSelected(t){return this.selectionModel.isSelected(t)},isSelectionEmpty(){return this.selectionModel.isEmpty()},clearSelection(){this.selectionModel.clear()},getSelectionCount(){return this.selectionModel.cells.length},getSelectionCell(){return this.selectionModel.cells[0]},getSelectionCells(){return this.selectionModel.cells.slice()},setSelectionCell(t){this.selectionModel.setCell(t)},setSelectionCells(t){this.selectionModel.setCells(t)},addSelectionCell(t){this.selectionModel.addCell(t)},addSelectionCells(t){this.selectionModel.addCells(t)},removeSelectionCell(t){this.selectionModel.removeCell(t)},removeSelectionCells(t){this.selectionModel.removeCells(t)},selectRegion(t,e){const i=this.getCells(t.x,t.y,t.width,t.height);return this.selectCellsForEvent(i,e),i},selectNextCell(){this.selectCell(!0)},selectPreviousCell(){this.selectCell()},selectParentCell(){this.selectCell(!1,!0)},selectChildCell(){this.selectCell(!1,!1,!0)},selectCell(t=!1,e=!1,i=!1){const s=this.selectionModel.cells.length>0?this.selectionModel.cells[0]:null;this.selectionModel.cells.length>1&&this.selectionModel.clear();const n=s?s.getParent():this.getDefaultParent(),l=n.getChildCount();if(!s&&l>0){const t=n.getChildAt(0);this.setSelectionCell(t)}else if(n&&(!s||e)&&this.getView().getState(n)&&n.getGeometry())this.getCurrentRoot()!==n&&this.setSelectionCell(n);else if(s&&i){if(s.getChildCount()>0){const t=s.getChildAt(0);this.setSelectionCell(t)}}else if(l>0){let e=n.getIndex(s);if(t){e++;const t=n.getChildAt(e%l);this.setSelectionCell(t)}else{e--;const t=e<0?l-1:e,i=n.getChildAt(t);this.setSelectionCell(i)}}},selectAll(t,e=!1){t=t??this.getDefaultParent();const i=e?t.filterDescendants(e=>e!==t&&!!this.getView().getState(e)):t.getChildren();this.setSelectionCells(i)},selectVertices(t,e=!1){this.selectCells(!0,!1,t,e)},selectEdges(t){this.selectCells(!1,!0,t)},selectCells(t=!1,e=!1,i,s=!1){const n=(i=i??this.getDefaultParent()).filterDescendants(i=>{const n=i.getParent();return!!this.getView().getState(i)&&((s||0===i.getChildCount())&&i.isVertex()&&t&&n&&!n.isEdge()||i.isEdge()&&e)});this.setSelectionCells(n)},selectCellForEvent(t,e){const i=this.isCellSelected(t);this.isToggleEvent(e)?i?this.removeSelectionCell(t):this.addSelectionCell(t):i&&1===this.getSelectionCount()||this.setSelectionCell(t)},selectCellsForEvent(t,e){this.isToggleEvent(e)?this.addSelectionCells(t):this.setSelectionCells(t)},isSiblingSelected(t){const e=t.getParent(),i=e.getChildCount();for(let s=0;s<i;s+=1){const i=e.getChildAt(s);if(t!==i&&this.isCellSelected(i))return!0}return!1},getSelectionCellsForChanges(t,e=null){const i=new Map,s=[],n=t=>{if(!i.has(t)&&this.getDataModel().contains(t))if(t.isEdge()||t.isVertex())i.set(t,!0),s.push(t);else{const e=t.getChildCount();for(let i=0;i<e;i+=1)n(t.getChildAt(i))}};for(let i=0;i<t.length;i+=1){const s=t[i];if(!(s.constructor===p.A||e&&e(s))){let t=null;s instanceof g.A?t=s.child:s.cell&&s.cell instanceof d.A&&(t=s.cell),t&&n(t)}}return s},updateSelection(){const t=this.getSelectionCells(),e=[];for(const i of t)if(this.getDataModel().contains(i)&&i.isVisible()){let t=i.getParent();for(;t&&t!==this.getView().currentRoot;){if(t.isCollapsed()||!t.isVisible()){e.push(i);break}t=t.getParent()}}else e.push(i);this.removeSelectionCells(e)}},ct={snapTolerance:0,getSnapTolerance(){return this.snapTolerance},gridSize:10,gridEnabled:!0,snap(t){return this.gridEnabled&&(t=Math.round(t/this.gridSize)*this.gridSize),t},snapDelta(t,e,i=!1,s=!1,n=!1){const l=this.getView().translate,r=this.getView().scale;if(!i&&this.gridEnabled){const i=this.gridSize*r*.5;if(!s){const s=e.x-(this.snap(e.x/r-l.x)+l.x)*r;Math.abs(t.x-s)<i?t.x=0:t.x=this.snap(t.x/r)*r-s}if(!n){const s=e.y-(this.snap(e.y/r-l.y)+l.y)*r;Math.abs(t.y-s)<i?t.y=0:t.y=this.snap(t.y/r)*r-s}}else{const i=.5*r;if(!s){const s=e.x-(Math.round(e.x/r-l.x)+l.x)*r;Math.abs(t.x-s)<i?t.x=0:t.x=Math.round(t.x/r)*r-s}if(!n){const s=e.y-(Math.round(e.y/r-l.y)+l.y)*r;Math.abs(t.y-s)<i?t.y=0:t.y=Math.round(t.y/r)*r-s}}return t},isGridEnabled(){return this.gridEnabled},setGridEnabled(t){this.gridEnabled=t},getGridSize(){return this.gridSize},setGridSize(t){this.gridSize=t}},gt={swimlaneSelectionEnabled:!0,swimlaneNesting:!0,swimlaneIndicatorColorAttribute:"fillColor",getSwimlane(t=null){for(;t&&!this.isSwimlane(t);)t=t.getParent();return t},getSwimlaneAt(t,e,i){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i){const s=i.getChildCount();for(let n=0;n<s;n+=1){const s=i.getChildAt(n);if(s){const i=this.getSwimlaneAt(t,e,s);if(null!=i)return i;if(s.isVisible()&&this.isSwimlane(s)){const i=this.getView().getState(s);if(i&&this.intersects(i,t,e))return s}}}}return null},hitsSwimlaneContent(t,e,i){const s=this.getView().getState(t),n=this.getStartSize(t);if(s){const t=this.getView().getScale();if(e-=s.x,i-=s.y,n.width>0&&e>0&&e>n.width*t)return!0;if(n.height>0&&i>0&&i>n.height*t)return!0}return!1},getStartSize(t,e=!1){const i=new h.A,s=this.getCurrentCellStyle(t,e),n=s.startSize??c.QX;return s.horizontal??1?i.height=n:i.width=n,i},getSwimlaneDirection(t){const e=t.direction??"east",i=t.flipH,s=t.flipV;let n=t.horizontal??1?0:3;"north"===e?n--:"west"===e?n+=2:"south"===e&&(n+=1);const l=(0,S.zi)(n,2);return i&&1===l&&(n+=2),s&&0===l&&(n+=2),["north","east","south","west"][(0,S.zi)(n,4)]},getActualStartSize(t,e=!1){const i=new h.A;if(this.isSwimlane(t,e)){const s=this.getCurrentCellStyle(t,e),n=s.startSize??c.QX,l=this.getSwimlaneDirection(s);"north"===l?i.y=n:"west"===l?i.x=n:"south"===l?i.height=n:i.width=n}return i},isSwimlane(t,e=!1){return!(!t||t.getParent()===this.getDataModel().getRoot()||t.isEdge())&&"swimlane"===this.getCurrentCellStyle(t,e).shape},isValidDropTarget(t,e,i){return t&&(this.isSplitEnabled()&&this.isSplitTarget(t,e,i)||!t.isEdge()&&(this.isSwimlane(t)||t.getChildCount()>0&&!t.isCollapsed()))},getDropTarget(t,e,i=null,s=!1){if(!this.isSwimlaneNesting())for(let e=0;e<t.length;e+=1)if(this.isSwimlane(t[e]))return null;const n=(0,a.ce)(this.getContainer(),(0,L.El)(e),(0,L.xJ)(e));n.x-=this.getPanDx(),n.y-=this.getPanDy();const l=this.getSwimlaneAt(n.x,n.y);if(i){if(l){let t=l.getParent();for(;t&&this.isSwimlane(t)&&t!==i;)t=t.getParent();t===i&&(i=l)}}else i=l;for(;i&&!this.isValidDropTarget(i,t,e)&&!this.getDataModel().isLayer(i);)i=i.getParent();let r=i;if(!s)for(;r&&t.indexOf(r)<0;)r=r.getParent();return this.getDataModel().isLayer(i)||r?null:i},isSwimlaneNesting(){return this.swimlaneNesting},setSwimlaneNesting(t){this.swimlaneNesting=t},isSwimlaneSelectionEnabled(){return this.swimlaneSelectionEnabled},setSwimlaneSelectionEnabled(t){this.swimlaneSelectionEnabled=t}},ut={isTerminalPointMovable:(t,e)=>!0,getOpposites(t,e=null,i=!0,s=!0){const n=[],l=new Map;for(let r=0;r<t.length;r+=1){const h=this.getView().getState(t[r]),o=h?h.getVisibleTerminal(!0):this.getView().getVisibleTerminal(t[r],!0),a=h?h.getVisibleTerminal(!1):this.getView().getVisibleTerminal(t[r],!1);o===e&&a&&a!==e&&s?l.has(a)||(l.set(a,!0),n.push(a)):a===e&&o&&o!==e&&i&&(l.has(o)||(l.set(o,!0),n.push(o)))}return n}},pt={getTooltip(t,e,i,s){let n=null;if(!t.control||e!==t.control.node&&e.parentNode!==t.control.node||(n=this.getCollapseExpandResource(),n=(0,F.bG)((0,I.T)(n)||n,!0).replace(/\\n/g,"<br>")),!n&&t.overlays&&t.overlays.forEach(t=>{n||e!==t.node&&e.parentNode!==t.node||(n=t.overlay?t.overlay.toString()??null:null)}),!n){const i=this.getPlugin("SelectionCellsHandler"),s=i?.getHandler(t.cell);s&&"getTooltipForNode"in s&&"function"==typeof s.getTooltipForNode&&(n=s.getTooltipForNode(e))}return n||(n=this.getTooltipForCell(t.cell)),n},getTooltipForCell(t){let e=null;return e=t&&"getTooltip"in t?t.getTooltip():this.convertValueToString(t),e},setTooltips(t){const e=this.getPlugin("TooltipHandler");e?.setEnabled(t)}},ft={validationAlert(t){alert(t)},isEdgeValid(t,e,i){return!this.getEdgeValidationError(t,e,i)},getEdgeValidationError(t=null,e=null,i=null){if(t&&!this.isAllowDanglingEdges()&&(!e||!i))return"";if(t&&!t.getTerminal(!0)&&!t.getTerminal(!1))return null;if(!this.isAllowLoops()&&e===i&&e)return"";if(!this.isValidConnection(e,i))return"";if(e&&i){let s="";if(!this.isMultigraph()){const n=this.getDataModel().getEdgesBetween(e,i,!0);(n.length>1||1===n.length&&n[0]!==t)&&(s+=`${(0,I.T)(this.getAlreadyConnectedResource())||this.getAlreadyConnectedResource()}\n`)}const n=e.getDirectedEdgeCount(!0,t),l=i.getDirectedEdgeCount(!1,t);for(const r of this.multiplicities){const h=r.check(this,t,e,i,n,l);null!=h&&(s+=h)}const r=this.validateEdge(t,e,i);return null!=r&&(s+=r),s.length>0?s:null}return this.isAllowDanglingEdges()?null:""},validateEdge:(t=null,e=null,i=null)=>null,validateGraph(t=null,e){if(!(t=t??this.getDataModel().getRoot()))return"The root does not exist!";e=e??{};let i=!0;const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);let l=e;this.isValidRoot(s)&&(l={});const r=this.validateGraph(s,l);r?this.setCellWarning(s,r.replace(/\n/g,"<br>")):this.setCellWarning(s,null),i=i&&null==r}let n="";t&&t.isCollapsed()&&!i&&(n+=`${(0,I.T)(this.getContainsValidationErrorsResource())||this.getContainsValidationErrorsResource()}\n`),t&&t.isEdge()?n+=this.getEdgeValidationError(t,t.getTerminal(!0),t.getTerminal(!1))||"":n+=this.getCellValidationError(t)||"";const l=this.validateCell(t,e);return null!=l&&(n+=l),null==t.getParent()&&this.getView().validate(),n.length>0||!i?n:null},getCellValidationError(t){const e=t.getDirectedEdgeCount(!0),i=t.getDirectedEdgeCount(!1),s=t.getValue();let n="";for(let t=0;t<this.multiplicities.length;t+=1){const l=this.multiplicities[t];(l.source&&(0,v.Ll)(s,l.type,l.attr,l.value)&&(e>l.max||e<l.min)||!l.source&&(0,v.Ll)(s,l.type,l.attr,l.value)&&(i>l.max||i<l.min))&&(n+=`${l.countError}\n`)}return n.length>0?n:null},validateCell:(t,e)=>null},yt={vertexLabelsMovable:!1,allowNegativeCoordinates:!0,isAllowNegativeCoordinates(){return this.allowNegativeCoordinates},setAllowNegativeCoordinates(t){this.allowNegativeCoordinates=t},insertVertex(...t){let e,i,s,n,l,r,h,o,a,d;if(1===t.length&&"object"==typeof t[0]){const c=t[0];e=c.parent,i=c.id,s=c.value,n="x"in c?c.x:c.position?.[0],l="y"in c?c.y:c.position?.[1],r="width"in c?c.width:c.size?.[0],h="height"in c?c.height:c.size?.[1],o=c.style,a=c.relative,d=c.geometryClass}else[e,i,s,n,l,r,h,o,a,d]=t;const c=this.createVertex(e,i,s,n,l,r,h,o,a,d);return this.addCell(c,e)},createVertex(t,e,i,s,n,l,r,h,o=!1,a=$.A){const c=new a(s,n,l,r);c.relative=o;const g=new d.A(i,c,h);return g.setId(e),g.setVertex(!0),g.setConnectable(!0),g},getChildVertices(t){return this.getChildCells(t,!0,!1)},isVertexLabelsMovable(){return this.vertexLabelsMovable},setVertexLabelsMovable(t){this.vertexLabelsMovable=t}},mt={zoomFactor:1.2,keepSelectionVisibleOnZoom:!1,centerZoom:!0,zoomIn(){this.zoom(this.zoomFactor)},zoomOut(){this.zoom(1/this.zoomFactor)},zoomActual(){1===this.getView().scale?this.getView().setTranslate(0,0):(this.getView().translate.x=0,this.getView().translate.y=0,this.getView().setScale(1))},zoomTo(t,e=!1){this.zoom(t/this.getView().scale,e)},zoom(t,e){e=e??this.centerZoom;const i=Math.round(this.getView().scale*t*100)/100,s=this.getView().getState(this.getSelectionCell()),n=this.getContainer();if(t=i/this.getView().scale,this.keepSelectionVisibleOnZoom&&null!=s){const e=new h.A(s.x*t,s.y*t,s.width*t,s.height*t);this.getView().scale=i,this.scrollRectToVisible(e)||(this.getView().revalidate(),this.getView().setScale(i))}else{const s=(0,a.uM)(this.getContainer());if(e&&!s){let e=n.offsetWidth,s=n.offsetHeight;if(t>1){const n=(t-1)/(2*i);e*=-n,s*=-n}else{const i=(1/t-1)/(2*this.getView().scale);e*=i,s*=i}this.getView().scaleAndTranslate(i,this.getView().translate.x+e,this.getView().translate.y+s)}else{const l=this.getView().translate.x,r=this.getView().translate.y,h=n.scrollLeft,o=n.scrollTop;if(this.getView().setScale(i),s){let i=0,s=0;e&&(i=n.offsetWidth*(t-1)/2,s=n.offsetHeight*(t-1)/2),n.scrollLeft=(this.getView().translate.x-l)*this.getView().scale+Math.round(h*t+i),n.scrollTop=(this.getView().translate.y-r)*this.getView().scale+Math.round(o*t+s)}}}},zoomToRect(t){const e=this.getContainer(),i=e.clientWidth/t.width/(e.clientHeight/t.height);t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);let s=Math.min(e.scrollWidth,t.x+t.width),n=Math.min(e.scrollHeight,t.y+t.height);if(t.width=s-t.x,t.height=n-t.y,i<1){const s=t.height/i,l=(s-t.height)/2;t.height=s;const r=Math.min(t.y,l);t.y-=r,n=Math.min(e.scrollHeight,t.y+t.height),t.height=n-t.y}else{const n=t.width*i,l=(n-t.width)/2;t.width=n;const r=Math.min(t.x,l);t.x-=r,s=Math.min(e.scrollWidth,t.x+t.width),t.width=s-t.x}const l=e.clientWidth/t.width,r=this.getView().scale*l;(0,a.uM)(this.getContainer())?(this.getView().setScale(r),e.scrollLeft=Math.round(t.x*l),e.scrollTop=Math.round(t.y*l)):this.getView().scaleAndTranslate(r,this.getView().translate.x-t.x/this.getView().scale,this.getView().translate.y-t.y/this.getView().scale)}};class vt extends l.A{createEdgeHandlerInstance(t){return new V(t)}createEdgeSegmentHandler(t){return new N(t)}createElbowEdgeHandler(t){return new R(t)}createVertexHandler(t){return new B(t)}registerDefaults(){}constructor(t){super(),this.destroyed=!1,this.graphModelChangeListener=null,this.paintBackground=null,this.isConstrainedMoving=!1,this.cells=[],this.imageBundles=[],this.mouseListeners=[],this.multiplicities=[],this.plugins=new Map,this.renderHint=null,this.dialect="svg",this.defaultOverlap=.5,this.defaultParent=null,this.backgroundImage=null,this.pageVisible=!1,this.pageBreaksVisible=!1,this.pageBreakColor="gray",this.pageBreakDashed=!0,this.minPageBreakDist=20,this.preferPageSize=!1,this.pageFormat=new h.A(...c.s4),this.pageScale=1.5,this.enabled=!0,this.exportEnabled=!0,this.importEnabled=!0,this.ignoreScrollbars=!1,this.translateToScrollPosition=!1,this.maximumGraphBounds=null,this.minimumGraphSize=null,this.minimumContainerSize=null,this.maximumContainerSize=null,this.resizeContainer=!1,this.border=0,this.keepEdgesInForeground=!1,this.keepEdgesInBackground=!1,this.recursiveResize=!1,this.resetViewOnRootChange=!0,this.allowLoops=!1,this.defaultLoopStyle=w.F,this.multigraph=!0,this.warningImage=new s.A(`${o.A.imageBasePath}/warning${o.A.IS_MAC?".png":".gif"}`,16,16),this.alreadyConnectedResource=(0,I.m)()?"alreadyConnected":"",this.containsValidationErrorsResource=(0,I.m)()?"containsValidationErrors":"",this.options={foldingEnabled:!0,collapsedImage:new s.A(`${o.A.imageBasePath}/collapsed.gif`,9,9),expandedImage:new s.A(`${o.A.imageBasePath}/expanded.gif`,9,9),collapseToPreferredSize:!0},this.getContainer=()=>this.container,this.getPlugin=t=>this.plugins.get(t),this.getCellRenderer=()=>this.cellRenderer,this.getDialect=()=>this.dialect,this.isPageVisible=()=>this.pageVisible,this.isPageBreaksVisible=()=>this.pageBreaksVisible,this.getPageBreakColor=()=>this.pageBreakColor,this.isPageBreakDashed=()=>this.pageBreakDashed,this.getMinPageBreakDist=()=>this.minPageBreakDist,this.isPreferPageSize=()=>this.preferPageSize,this.getPageFormat=()=>this.pageFormat,this.getPageScale=()=>this.pageScale,this.isExportEnabled=()=>this.exportEnabled,this.isImportEnabled=()=>this.importEnabled,this.isIgnoreScrollbars=()=>this.ignoreScrollbars,this.isTranslateToScrollPosition=()=>this.translateToScrollPosition,this.getMinimumGraphSize=()=>this.minimumGraphSize,this.setMinimumGraphSize=t=>this.minimumGraphSize=t,this.getMinimumContainerSize=()=>this.minimumContainerSize,this.setMinimumContainerSize=t=>this.minimumContainerSize=t,this.getAlreadyConnectedResource=()=>this.alreadyConnectedResource,this.getContainsValidationErrorsResource=()=>this.containsValidationErrorsResource,this.registerDefaults(),this.container=t?.container??document.createElement("div"),this.initializeCollaborators(t),this.graphModelChangeListener=(t,e)=>{this.graphModelChanged(e.getProperty("edit").changes)},this.getDataModel().addListener(r.A.CHANGE,this.graphModelChangeListener),this.view.init(),this.sizeDidChange(),t?.plugins?.forEach(t=>this.plugins.set(t.pluginId,new t(this))),this.view.revalidate()}getWarningImage(){return this.warningImage}batchUpdate(t){this.getDataModel().batchUpdate(t)}getDataModel(){return this.model}getView(){return this.view}getStylesheet(){return this.stylesheet}setStylesheet(t){this.stylesheet=t}graphModelChanged(t){for(const e of t)this.processChange(e);this.updateSelection(),this.view.validate(),this.sizeDidChange()}processChange(t){if(t instanceof p.A)this.clearSelection(),this.setDefaultParent(null),t.previous&&this.removeStateForCell(t.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new n.A(r.A.ROOT));else if(t instanceof g.A){const e=t.child.getParent();this.view.invalidate(t.child,!0,!0),e&&this.getDataModel().contains(e)&&!e.isCollapsed()||(this.view.invalidate(t.child,!0,!0),this.removeStateForCell(t.child),this.view.currentRoot==t.child&&this.home()),e!=t.previous&&(null!=e&&this.view.invalidate(e,!1,!1),null!=t.previous&&this.view.invalidate(t.previous,!1,!1))}else if(t instanceof y.A||t instanceof u.A)(t instanceof y.A||null==t.previous&&null!=t.geometry||null!=t.previous&&!t.previous.equals(t.geometry))&&this.view.invalidate(t.cell);else if(t instanceof m.A)this.view.invalidate(t.cell,!1,!1);else if(t instanceof f.A){this.view.invalidate(t.cell,!0,!0);const e=this.view.getState(t.cell);null!=e&&(e.invalidStyle=!0)}else null!=t.cell&&t.cell instanceof d.A&&this.removeStateForCell(t.cell)}scrollPointToVisible(t,e,i=!1,s=20){const n=this.getPlugin("PanningHandler");if(this.isTimerAutoScroll()||!this.ignoreScrollbars&&!(0,a.uM)(this.container))this.isAllowAutoPanning()&&n&&!n.isActive()&&n.getPanningManager().panTo(t+this.getPanDx(),e+this.getPanDy());else{const n=this.container;if(t>=n.scrollLeft&&e>=n.scrollTop&&t<=n.scrollLeft+n.clientWidth&&e<=n.scrollTop+n.clientHeight){let l=n.scrollLeft+n.clientWidth-t;if(l<s){const t=n.scrollLeft;if(n.scrollLeft+=s-l,i&&t===n.scrollLeft){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollWidth+s-l;t.style.width=`${e}px`,n.scrollLeft+=s-l}}else l=t-n.scrollLeft,l<s&&(n.scrollLeft-=s-l);let r=n.scrollTop+n.clientHeight-e;if(r<s){const t=n.scrollTop;if(n.scrollTop+=s-r,t==n.scrollTop&&i){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollHeight+s-r;t.style.height=`${e}px`,n.scrollTop+=s-r}}else r=e-n.scrollTop,r<s&&(n.scrollTop-=s-r)}}}getBorderSizes(){const t=(0,a.lY)(this.container);return new h.A((0,a.sc)(t.paddingLeft)+("none"!=t.borderLeftStyle?(0,a.sc)(t.borderLeftWidth):0),(0,a.sc)(t.paddingTop)+("none"!=t.borderTopStyle?(0,a.sc)(t.borderTopWidth):0),(0,a.sc)(t.paddingRight)+("none"!=t.borderRightStyle?(0,a.sc)(t.borderRightWidth):0),(0,a.sc)(t.paddingBottom)+("none"!=t.borderBottomStyle?(0,a.sc)(t.borderBottomWidth):0))}getPreferredPageSize(t,e,i){const s=this.view.translate,n=this.pageFormat,l=this.pageScale,r=new h.A(0,0,Math.ceil(n.width*l),Math.ceil(n.height*l)),o=this.pageBreaksVisible?Math.ceil(e/r.width):1,a=this.pageBreaksVisible?Math.ceil(i/r.height):1;return new h.A(0,0,o*r.width+2+s.x,a*r.height+2+s.y)}doResizeContainer(t,e){null!=this.maximumContainerSize&&(t=Math.min(this.maximumContainerSize.width,t),e=Math.min(this.maximumContainerSize.height,e));const i=this.container;i.style.width=`${Math.ceil(t)}px`,i.style.height=`${Math.ceil(e)}px`}createHandler(t){let e=null;if(t.cell.isEdge()){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1),n=t.cell.getGeometry(),l=this.getView().getEdgeStyle(t,n&&n.points||void 0,i,s);e=this.createEdgeHandler(t,l)}else e=this.createVertexHandler(t);return e}createEdgeHandler(t,e){switch(x.O.getHandlerKind(e)){case"elbow":return this.createElbowEdgeHandler(t);case"segment":return this.createEdgeSegmentHandler(t)}return this.createEdgeHandlerInstance(t)}getCurrentRoot(){return this.view.currentRoot}getTranslateForRoot(t){return null}getChildOffsetForCell(t){return null}home(){const t=this.getCurrentRoot();null!=t&&(this.view.setCurrentRoot(null),null!=this.view.getState(t)&&this.setSelectionCell(t))}isValidRoot(t){return!!t}getGraphBounds(){return this.view.getGraphBounds()}getMaximumGraphBounds(){return this.maximumGraphBounds}refresh(t=null){t?this.view.clear(t,!1):this.view.clear(void 0,!0),this.view.validate(),this.sizeDidChange(),this.fireEvent(new n.A(r.A.REFRESH))}center(t=!0,e=!0,i=.5,s=.5){const n=this.container,l=(0,a.uM)(this.container),r=2*this.getBorder(),h=n.clientWidth-r,o=n.clientHeight-r,d=this.getGraphBounds(),c=this.view.translate,g=this.view.scale;let u=t?h-d.width:0,p=e?o-d.height:0;if(l){d.x-=c.x,d.y-=c.y;const t=n.scrollWidth,e=n.scrollHeight;t>h&&(u=0),e>o&&(p=0),this.view.setTranslate(Math.floor(u/2-d.x),Math.floor(p/2-d.y)),n.scrollLeft=(t-h)/2,n.scrollTop=(e-o)/2}else this.view.setTranslate(t?Math.floor(c.x-d.x/g+u*i/g):c.x,e?Math.floor(c.y-d.y/g+p*s/g):c.y)}isOrthogonal(t){const e=t.style.orthogonal;if(!(0,z.uy)(e))return e;const i=this.view.getEdgeStyle(t);return x.O.isOrthogonal(i)}getBackgroundImage(){return this.backgroundImage}setBackgroundImage(t){this.backgroundImage=t}convertValueToString(t){const e=t.getValue();if(null!=e){if((0,v.Ll)(e))return e.nodeName;if("function"==typeof e.toString)return e.toString()}return""}getLinkForCell(t){return null}getBorder(){return this.border}setBorder(t){this.border=t}isResizeContainer(){return this.resizeContainer}setResizeContainer(t){this.resizeContainer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isMultigraph(){return this.multigraph}setMultigraph(t){this.multigraph=t}isAllowLoops(){return this.allowLoops}setAllowLoops(t){this.allowLoops=t}isRecursiveResize(t=null){return this.recursiveResize}setRecursiveResize(t){this.recursiveResize=t}getOverlap(t){return this.isAllowOverlapParent(t)?this.defaultOverlap:0}isAllowOverlapParent(t){return!1}getDefaultParent(){let t=this.getCurrentRoot();return t||(t=this.defaultParent,t)||(t=this.getDataModel().getRoot().getChildAt(0)),t}setDefaultParent(t){this.defaultParent=t}destroy(){this.destroyed||(this.destroyed=!0,Object.values(this.plugins).forEach(t=>t.onDestroy()),this.view.destroy(),this.model&&this.graphModelChangeListener&&(this.getDataModel().removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null))}}(t=>{const e=(0,z.rU)(t);for(const t of[W,Y,X,q,K,J,Q,Z,tt,et,it,ht,lt,ot,at,dt,ct,gt,ut,pt,ft,yt,mt])e(t)})(vt)},2380:(t,e,i)=>{i.d(e,{A:()=>w});var s=i(9214),n=i(2039),l=i(8206),r=i(3081),h=i(8302),o=i(124),a=i(9504),d=i(9715);const c=class{constructor(t,e,i){this.model=t,this.cell=e,this.collapsed=i,this.previous=i}execute(){this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)}};var g=i(6905),u=i(7625),p=i(2748),f=i(7821),y=i(1264);const m=class{constructor(t,e,i){this.model=t,this.cell=e,this.visible=i,this.previous=i}execute(){this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)}};class v extends s.A{constructor(t=null){super(),this.root=null,this.cells={},this.maintainEdgeParent=!0,this.ignoreRelativeEdgeParent=!0,this.createIds=!0,this.prefix="",this.postfix="",this.nextId=0,this.currentEdit=null,this.updateLevel=0,this.endingUpdate=!1,this.currentEdit=this.createUndoableEdit(),null!=t?this.setRoot(t):this.clear()}clear(){this.setRoot(this.createRoot())}isCreateIds(){return this.createIds}setCreateIds(t){this.createIds=t}createRoot(){const t=new r.A;return t.insert(new r.A),t}getCell(t){return this.cells?this.cells[t]:null}filterCells(t,e){return t.filter(e)}getRoot(t=null){return t?t.getRoot():this.root}setRoot(t){return this.execute(new u.A(this,t)),t}rootChanged(t){const e=this.root;return this.root=t,this.nextId=0,this.cells=null,this.cellAdded(t),e}isRoot(t=null){return null!=t&&this.root===t}isLayer(t){return!!t&&this.isRoot(t.getParent())}contains(t){return this.root.isAncestor(t)}add(t,e,i=null){if(e!==t&&null!=t&&null!=e){null==i&&(i=t.getChildCount());const s=t!==e.getParent();this.execute(new d.A(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParents(e)}return e}cellAdded(t){if(null!=t){if(null==t.getId()&&this.createIds&&t.setId(this.createId(t)),null!=t.getId()){let e=this.getCell(t.getId());if(e!==t){for(;null!=e;)t.setId(this.createId(t)),e=this.getCell(t.getId());null==this.cells&&(this.cells={}),this.cells[t.getId()]=t}}(0,h.kf)(String(t.getId()))&&(this.nextId=Math.max(this.nextId,parseInt(t.getId())));for(const e of t.getChildren())this.cellAdded(e)}}createId(t){const e=this.nextId;return this.nextId++,this.prefix+e+this.postfix}updateEdgeParents(t,e=this.getRoot(t)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=t.getChildAt(s);this.updateEdgeParents(i,e)}const s=t.getEdgeCount(),n=[];for(let e=0;e<s;e+=1)n.push(t.getEdgeAt(e));for(let t=0;t<n.length;t+=1){const i=n[t];e.isAncestor(i)&&this.updateEdgeParent(i,e)}}updateEdgeParent(t,e){let i=t.getTerminal(!0),s=t.getTerminal(!1),n=null;for(;null!=i&&!i.isEdge()&&null!=i.geometry&&i.geometry.relative;)i=i.getParent();for(;null!=s&&this.ignoreRelativeEdgeParent&&!s.isEdge()&&null!=s.geometry&&s.geometry.relative;)s=s.getParent();if(e.isAncestor(i)&&e.isAncestor(s)&&(i===s?n=i?i.getParent():null:i&&(n=i.getNearestCommonAncestor(s)),null!=n&&(n.getParent()!==this.root||n.isAncestor(t))&&t&&t.getParent()!==n)){let e=t.getGeometry();if(null!=e){const i=t.getParent().getOrigin(),s=n.getOrigin(),l=s.x-i.x,r=s.y-i.y;e=e.clone(),e.translate(-l,-r),this.setGeometry(t,e)}this.add(n,t,n.getChildCount())}}remove(t){return t===this.root?this.setRoot(null):null!=t.getParent()&&this.execute(new d.A(this,null,t)),t}cellRemoved(t){if(null!=t&&null!=this.cells){for(let e=t.getChildCount()-1;e>=0;e--)this.cellRemoved(t.getChildAt(e));null!=this.cells&&null!=t.getId()&&delete this.cells[t.getId()]}}parentForCellChanged(t,e,i){const s=t.getParent();if(null!=e)e===s&&s.getIndex(t)===i||e.insert(t,i);else if(null!=s){const e=s.getIndex(t);s.remove(e)}const n=e?this.contains(e):null,l=this.contains(s);return n&&!l?this.cellAdded(t):l&&!n&&this.cellRemoved(t),s}setTerminal(t,e,i){const s=e!==t.getTerminal(i);return this.execute(new f.A(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParent(t,this.getRoot()),e}setTerminals(t,e,i){this.beginUpdate();try{this.setTerminal(t,e,!0),this.setTerminal(t,i,!1)}finally{this.endUpdate()}}terminalForCellChanged(t,e,i=!1){const s=t.getTerminal(i);return null!=e?e.insertEdge(t,i):null!=s&&s.removeEdge(t,i),s}getEdgesBetween(t,e,i=!1){const s=t.getEdgeCount(),n=e.getEdgeCount();let l=t,r=s;n<s&&(r=n,l=e);const h=[];for(let s=0;s<r;s+=1){const n=l.getEdgeAt(s),r=n.getTerminal(!0),o=n.getTerminal(!1);(r===t&&o===e||!i&&o===t&&r===e)&&h.push(n)}return h}setValue(t,e){return this.execute(new y.A(this,t,e)),e}valueForCellChanged(t,e){return t.valueChanged(e)}setGeometry(t,e){return e!==t.getGeometry()&&this.execute(new g.A(this,t,e)),e}geometryForCellChanged(t,e){const i=t.getGeometry();return t.setGeometry(e),i}setStyle(t,e){e!==t.getStyle()&&this.execute(new p.A(this,t,e))}styleForCellChanged(t,e){const i=t.getStyle();return t.setStyle(e),i}setCollapsed(t,e){return e!==t.isCollapsed()&&this.execute(new c(this,t,e)),e}collapsedStateForCellChanged(t,e){const i=t.isCollapsed();return t.setCollapsed(e),i}setVisible(t,e){return e!==t.isVisible()&&this.execute(new m(this,t,e)),e}visibleStateForCellChanged(t,e){const i=t.isVisible();return t.setVisible(e),i}execute(t){t.execute(),this.beginUpdate(),this.currentEdit.add(t),this.fireEvent(new o.A(a.A.EXECUTE,{change:t})),this.fireEvent(new o.A(a.A.EXECUTED,{change:t})),this.endUpdate()}batchUpdate(t){this.beginUpdate();try{t()}finally{this.endUpdate()}}beginUpdate(){this.updateLevel+=1,this.fireEvent(new o.A(a.A.BEGIN_UPDATE)),1===this.updateLevel&&this.fireEvent(new o.A(a.A.START_EDIT))}endUpdate(){if(this.updateLevel-=1,0===this.updateLevel&&this.fireEvent(new o.A(a.A.END_EDIT)),!this.endingUpdate){this.endingUpdate=0===this.updateLevel,this.fireEvent(new o.A(a.A.END_UPDATE,{edit:this.currentEdit}));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new o.A(a.A.BEFORE_UNDO,{edit:this.currentEdit}));const t=this.currentEdit;this.currentEdit=this.createUndoableEdit(),t.notify(),this.fireEvent(new o.A(a.A.UNDO,{edit:t}))}}finally{this.endingUpdate=!1}}}createUndoableEdit(t=!0){const e=new n.A(this,t);return e.notify=()=>{e.source.fireEvent(new o.A(a.A.CHANGE,{edit:e,changes:e.changes})),e.source.fireEvent(new o.A(a.A.NOTIFY,{edit:e,changes:e.changes}))},e}mergeChildren(t,e,i=!0){this.beginUpdate();try{const s={};this.mergeChildrenImpl(t,e,i,s);for(const t in s){const e=s[t];let i=e.getTerminal(!0);null!=i&&(i=s[l.A.create(i)],this.setTerminal(e,i,!0)),i=e.getTerminal(!1),null!=i&&(i=s[l.A.create(i)],this.setTerminal(e,i,!1))}}finally{this.endUpdate()}}mergeChildrenImpl(t,e,i,s={}){this.beginUpdate();try{const n=t.getChildCount();for(let r=0;r<n;r+=1){const n=t.getChildAt(r);if("function"==typeof n.getId){const t=n.getId();let r=null==t||n.isEdge()&&i?null:this.getCell(t);if(null==r){const i=n.clone();i.setId(t),i.setTerminal(n.getTerminal(!0),!0),i.setTerminal(n.getTerminal(!1),!1),r=e.insert(i),this.cellAdded(r)}s[l.A.create(n)]=r,this.mergeChildrenImpl(n,r,i,s)}}}finally{this.endUpdate()}}}const w=v},2395:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(5491);class n extends s.A{constructor(t,e,i=1){super(),this.points=t,this.stroke=e,this.strokeWidth=i}getRotation(){return 0}getShapeRotation(){return 0}isPaintBoundsInverted(){return!1}paintEdgeShape(t,e){const i=t.pointerEventsValue;t.pointerEventsValue="stroke",this.style?.curved?this.paintCurvedLine(t,e):this.paintLine(t,e,this.isRounded),t.pointerEventsValue=i}paintLine(t,e,i){t.begin(),this.addPoints(t,e,i,this.getBaseArcSize(),!1),t.stroke()}paintCurvedLine(t,e){t.begin();const i=e[0],s=e.length;t.moveTo(i.x,i.y);for(let i=1;i<s-2;i+=1){const s=e[i],n=e[i+1],l=(s.x+n.x)/2,r=(s.y+n.y)/2;t.quadTo(s.x,s.y,l,r)}const n=e[s-2],l=e[s-1];t.quadTo(n.x,n.y,l.x,l.y),t.stroke()}}const l=n},2548:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(4344),n=i(8872);const l=class{constructor(t,e=null){this.consumed=!1,this.evt=t,this.state=e,this.sourceState=e,this.graphX=0,this.graphY=0}getEvent(){return this.evt}getSource(){return(0,s.el)(this.evt)}isSource(t){return!!t&&(0,n.oH)(t.node,this.getSource())}getX(){return(0,s.El)(this.getEvent())}getY(){return(0,s.xJ)(this.getEvent())}getGraphX(){return this.graphX}getGraphY(){return this.graphY}getState(){return this.state}getCell(){const t=this.getState();return t?t.cell:null}isPopupTrigger(){return(0,s.$Y)(this.getEvent())}isConsumed(){return this.consumed}consume(t){(t=t||window.TouchEvent&&this.evt instanceof TouchEvent||(0,s.Er)(this.evt))&&this.evt.preventDefault&&this.evt.preventDefault(),this.consumed=!0}}},2630:(t,e,i)=>{i.d(e,{A:()=>g});var s=i(1526),n=i(3161),l=i(6368),r=i(9504),h=i(8302),o=i(9760),a=i(8053),d=i(1613),c=i(4344);const g=class{constructor(t){this.pointImage=new s.A(`${n.A.imageBasePath}/point.gif`,5,5),this.currentFocus=null,this.currentFocusArea=null,this.focusIcons=[],this.constraints=null,this.currentConstraint=null,this.focusHighlight=null,this.focusPoints=[],this.currentPoint=null,this.enabled=!0,this.highlightColor=l.Vj,this.mouseleaveHandler=null,this.graph=t,this.resetHandler=()=>{this.currentFocus&&!this.graph.view.getState(this.currentFocus.cell)?this.reset():this.redraw()},this.graph.model.addListener(r.A.CHANGE,this.resetHandler),this.graph.view.addListener(r.A.SCALE_AND_TRANSLATE,this.resetHandler),this.graph.view.addListener(r.A.TRANSLATE,this.resetHandler),this.graph.view.addListener(r.A.SCALE,this.resetHandler),this.graph.addListener(r.A.ROOT,this.resetHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}reset(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null),this.currentConstraint=null,this.currentFocusArea=null,this.currentPoint=null,this.currentFocus=null,this.focusPoints=[]}getTolerance(t){return this.graph.getEventTolerance()}getImageForConstraint(t,e,i){return this.pointImage}isEventIgnored(t,e=!1){return!1}isStateIgnored(t,e=!1){return!1}destroyIcons(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[]}destroyFocusHighlight(){this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)}isKeepFocusEvent(t){return(0,c.RT)(t.getEvent())}getCellForEvent(t,e){let i=t.getCell();if(i||!e||t.getGraphX()===e.x&&t.getGraphY()===e.y||(i=this.graph.getCellAt(e.x,e.y)),i&&!i.isConnectable()){const t=i.getParent();t&&t.isVertex()&&t.isConnectable()&&(i=t)}return i?this.graph.isCellLocked(i)?null:i:null}update(t,e,i,s){if(this.isEnabled()&&!this.isEventIgnored(t)){!this.mouseleaveHandler&&this.graph.container&&(this.mouseleaveHandler=()=>{this.reset()},r.A.addListener(this.graph.container,"mouseleave",this.resetHandler));const n=this.getTolerance(t),a=s?s.x:t.getGraphX(),d=s?s.y:t.getGraphY(),c=new o.A(a-n,d-n,2*n,2*n),g=new o.A(t.getGraphX()-n,t.getGraphY()-n,2*n,2*n),u=this.graph.view.getState(this.getCellForEvent(t,s));this.isKeepFocusEvent(t)||this.currentFocusArea&&this.currentFocus&&!u&&this.currentFocus.cell.isVertex()&&(0,h.HY)(this.currentFocusArea,g)||u===this.currentFocus||(this.currentFocusArea=null,this.currentFocus=null,this.setFocus(t,u,e)),this.currentConstraint=null,this.currentPoint=null;let p,f=null;if(this.focusIcons.length>0&&this.constraints&&(!u||this.currentFocus===u)){const t=g.getCenterX(),n=g.getCenterY();for(let h=0;h<this.focusIcons.length;h+=1){const o=t-this.focusIcons[h].bounds.getCenterX(),a=n-this.focusIcons[h].bounds.getCenterY();if(p=o*o+a*a,(this.intersects(this.focusIcons[h],g,e,i)||s&&this.intersects(this.focusIcons[h],c,e,i))&&(null===f||p<f)){if(this.currentConstraint=this.constraints[h],this.currentPoint=this.focusPoints[h],f=p,p=this.focusIcons[h].bounds.clone(),p.grow(l.bF+1),p.width-=1,p.height-=1,!this.focusHighlight){const t=this.createHighlightShape();t.dialect="svg",t.pointerEvents=!1,t.init(this.graph.getView().getOverlayPane()),this.focusHighlight=t;const e=()=>this.currentFocus?this.currentFocus:u;r.A.redirectMouseEvents(t.node,this.graph,e)}this.focusHighlight.bounds=p,this.focusHighlight.redraw()}}}this.currentConstraint||this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null}redraw(){if(this.currentFocus&&this.constraints&&this.focusIcons.length>0){const t=this.graph.view.getState(this.currentFocus.cell);this.currentFocus=t,this.currentFocusArea=new o.A(t.x,t.y,t.width,t.height);for(let e=0;e<this.constraints.length;e+=1){const i=this.graph.getConnectionPoint(t,this.constraints[e]),s=this.getImageForConstraint(t,this.constraints[e],i),n=new o.A(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height);this.focusIcons[e].bounds=n,this.focusIcons[e].redraw(),this.currentFocusArea.add(this.focusIcons[e].bounds),this.focusPoints[e]=i}}}setFocus(t,e,i){if(this.constraints=e&&!this.isStateIgnored(e,i)&&e.cell.isConnectable()?this.isEnabled()?this.graph.getAllConnectionConstraints(e,i)??[]:[]:null,this.constraints&&e){this.currentFocus=e,this.currentFocusArea=new o.A(e.x,e.y,e.width,e.height);for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[];for(let t=0;t<this.constraints.length;t+=1){const i=this.graph.getConnectionPoint(e,this.constraints[t]),s=this.getImageForConstraint(e,this.constraints[t],i),{src:n}=s,l=new o.A(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height),h=new a.A(l,n);h.dialect="svg"!==this.graph.dialect?"mixedHtml":"svg",h.preserveImageAspect=!1,h.init(this.graph.getView().getDecoratorPane()),h.node.previousSibling&&h.node.parentNode?.insertBefore(h.node,h.node.parentNode.firstChild);const d=()=>this.currentFocus?this.currentFocus:e;h.redraw(),r.A.redirectMouseEvents(h.node,this.graph,d),this.currentFocusArea.add(h.bounds),this.focusIcons.push(h),this.focusPoints.push(i)}this.currentFocusArea.grow(this.getTolerance(t))}else this.destroyIcons(),this.destroyFocusHighlight()}createHighlightShape(){const t=new d.A(new o.A,this.highlightColor,this.highlightColor,l.es);return t.opacity=l.V8,t}intersects(t,e,i,s){return(0,h.HY)(t.bounds,e)}onDestroy(){this.reset(),this.graph.model.removeListener(this.resetHandler),this.graph.view.removeListener(this.resetHandler),this.graph.removeListener(this.resetHandler),this.mouseleaveHandler&&this.graph.container&&(r.A.removeListener(this.graph.container,"mouseleave",this.mouseleaveHandler),this.mouseleaveHandler=null)}}},2748:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e,i){this.model=t,this.cell=e,this.style=i,this.previous=i}execute(){this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous)}}},3081:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(3439),n=i(715),l=i(8206),r=i(4329);const h=class{constructor(t=null,e=null,i={}){this.invalidating=!1,this.onInit=null,this.overlays=[],this.id=null,this.value=null,this.geometry=null,this.style={},this.vertex=!1,this.edge=!1,this.connectable=!0,this.visible=!0,this.collapsed=!1,this.parent=null,this.source=null,this.target=null,this.children=[],this.edges=[],this.mxTransient=["id","value","parent","source","target","children","edges"],this.value=t,this.setGeometry(e),this.setStyle(i),this.onInit&&this.onInit()}getChildren(){return this.children||[]}getId(){return this.id}setId(t){this.id=t}getValue(){return this.value}setValue(t){this.value=t}valueChanged(t){const e=this.getValue();return this.setValue(t),e}getGeometry(){return this.geometry}setGeometry(t){this.geometry=t}getStyle(){return this.style}getClonedStyle(){return(0,s.o)(this.getStyle())}setStyle(t){this.style=t}isVertex(){return this.vertex}setVertex(t){this.vertex=t}isEdge(){return this.edge}setEdge(t){this.edge=t}isConnectable(){return this.connectable}setConnectable(t){this.connectable=t}isVisible(){return this.visible}setVisible(t){this.visible=t}isCollapsed(){return this.collapsed}setCollapsed(t){this.collapsed=t}getParent(){return this.parent}setParent(t){this.parent=t}getTerminal(t=!1){return t?this.source:this.target}setTerminal(t,e){return e?this.source=t:this.target=t,t}getChildCount(){return this.children.length}getIndex(t){return null===t?-1:this.children.indexOf(t)}getChildAt(t){return this.children[t]}insert(t,e){return void 0===e&&(e=this.getChildCount(),t.getParent()===this&&e--),t.removeFromParent(),t.setParent(this),this.children.splice(e,0,t),t}remove(t){let e=null;return t>=0&&(e=this.getChildAt(t),e&&(this.children.splice(t,1),e.setParent(null))),e}removeFromParent(){if(this.parent){const t=this.parent.getIndex(this);this.parent.remove(t)}}getEdgeCount(){return this.edges.length}getEdgeIndex(t){return this.edges.indexOf(t)}getEdgeAt(t){return this.edges[t]}insertEdge(t,e=!1){return t.removeFromTerminal(e),t.setTerminal(this,e),(0===this.edges.length||t.getTerminal(!e)!==this||this.edges.indexOf(t)<0)&&this.edges.push(t),t}removeEdge(t,e=!1){if(null!=t){if(t.getTerminal(!e)!==this&&null!=this.edges){const e=this.getEdgeIndex(t);e>=0&&this.edges.splice(e,1)}t.setTerminal(null,e)}return t}removeFromTerminal(t){const e=this.getTerminal(t);e&&e.removeEdge(this,t)}hasAttribute(t){const e=this.getValue();return(0,r.vq)(e)&&e.hasAttribute?e.hasAttribute(t):!(0,r.uy)(e.getAttribute?.(t))}getAttribute(t,e){const i=this.getValue();return((0,r.vq)(i)?i.getAttribute?.(t):null)??e}setAttribute(t,e){const i=this.getValue();(0,r.vq)(i)&&i.setAttribute?.(t,e)}clone(){const t=(0,s.o)(this,this.mxTransient);return t.setValue(this.cloneValue()),t}cloneValue(){let t=this.getValue();return(0,r.uy)(t)||("function"==typeof t.clone?t=t.clone():!(0,r.uy)(t.nodeType)&&t.cloneNode&&(t=t.cloneNode(!0))),t}getNearestCommonAncestor(t){let e=l.A.create(t);if(e.length>0){let i=this,s=l.A.create(i);if(e.length<s.length){i=t;const n=s;s=e,e=n}for(;i&&s;){const t=i.getParent();if(0===e.indexOf(s+l.A.PATH_SEPARATOR)&&t)return i;s=l.A.getParentPath(s),i=t}}return null}isAncestor(t){for(;t&&t!==this;)t=t.getParent();return t===this}getChildVertices(){return this.getChildCells(!0,!1)}getChildEdges(){return this.getChildCells(!1,!0)}getChildCells(t=!1,e=!1){const i=this.getChildCount(),s=[];for(let n=0;n<i;n+=1){const i=this.getChildAt(n);(!e&&!t||e&&i.isEdge()||t&&i.isVertex())&&s.push(i)}return s}getDirectedEdgeCount(t,e=null){let i=0;const s=this.getEdgeCount();for(let n=0;n<s;n+=1){const s=this.getEdgeAt(n);s!==e&&s&&s.getTerminal(t)===this&&(i+=1)}return i}getConnections(){return this.getEdges(!0,!0,!1)}getIncomingEdges(){return this.getEdges(!0,!1,!1)}getOutgoingEdges(){return this.getEdges(!1,!0,!1)}getEdges(t=!0,e=!0,i=!0){const s=this.getEdgeCount(),n=[];for(let l=0;l<s;l+=1){const s=this.getEdgeAt(l),r=s.getTerminal(!0),h=s.getTerminal(!1);(i&&r===h||r!==h&&(t&&h===this||e&&r===this))&&n.push(s)}return n}getOrigin(){let t=new n.A;const e=this.getParent();if(e&&(t=e.getOrigin(),!this.isEdge())){const e=this.getGeometry();e&&(t.x+=e.x,t.y+=e.y)}return t}getDescendants(){return this.filterDescendants(null)}filterDescendants(t){let e=[];(null===t||t(this))&&e.push(this);const i=this.getChildCount();for(let s=0;s<i;s+=1){const i=this.getChildAt(s);e=e.concat(i.filterDescendants(t))}return e}getRoot(){let t=this,e=t;for(;t;)e=t,t=t.getParent();return e}}},3161:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(6368);class n{}n.basePath=".",n.setBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.basePath=t):n.basePath="."},n.imageBasePath=".",n.setImageBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.imageBasePath=t):n.imageBasePath=`${n.basePath}/images`},n.IS_EDGE="undefined"!=typeof window&&null!=navigator.userAgent&&!!navigator.userAgent.match(/Edge\//),n.IS_NS="undefined"!=typeof window&&null!=navigator.userAgent&&navigator.userAgent.indexOf("Mozilla/")>=0&&navigator.userAgent.indexOf("MSIE")<0&&navigator.userAgent.indexOf("Edge/")<0,n.IS_SF="undefined"!=typeof window&&/Apple Computer, Inc/.test(navigator.vendor),n.IS_ANDROID="undefined"!=typeof window&&navigator.appVersion.indexOf("Android")>=0,n.IS_IOS="undefined"!=typeof window&&/iP(hone|od|ad)/.test(navigator.platform),n.IS_GC="undefined"!=typeof window&&/Google Inc/.test(navigator.vendor),n.IS_CHROMEAPP="undefined"!=typeof window&&null!=window.chrome&&null!=chrome.app&&null!=chrome.app.runtime,n.IS_FF=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,n.IS_MT="undefined"!=typeof window&&(navigator.userAgent.indexOf("Firefox/")>=0&&navigator.userAgent.indexOf("Firefox/1.")<0&&navigator.userAgent.indexOf("Firefox/2.")<0||navigator.userAgent.indexOf("Iceweasel/")>=0&&navigator.userAgent.indexOf("Iceweasel/1.")<0&&navigator.userAgent.indexOf("Iceweasel/2.")<0||navigator.userAgent.indexOf("SeaMonkey/")>=0&&navigator.userAgent.indexOf("SeaMonkey/1.")<0||navigator.userAgent.indexOf("Iceape/")>=0&&navigator.userAgent.indexOf("Iceape/1.")<0),n.IS_SVG="undefined"!=typeof window&&"MICROSOFT INTERNET EXPLORER"!==navigator.appName.toUpperCase(),n.NO_FO="undefined"!=typeof window&&(!document.createElementNS||"[object SVGForeignObjectElement]"!==document.createElementNS(s.pr,"foreignObject").toString()||navigator.userAgent.indexOf("Opera/")>=0),n.IS_WIN="undefined"!=typeof window&&navigator.appVersion.indexOf("Win")>0,n.IS_MAC="undefined"!=typeof window&&navigator.appVersion.indexOf("Mac")>0,n.IS_CHROMEOS="undefined"!=typeof window&&/\bCrOS\b/.test(navigator.appVersion),n.IS_TOUCH="undefined"!=typeof window&&"ontouchstart"in document.documentElement,n.IS_POINTER="undefined"!=typeof window&&null!=window.PointerEvent&&!(navigator.appVersion.indexOf("Mac")>0),n.IS_LOCAL="undefined"!=typeof window&&document.location.href.indexOf("http://")<0&&document.location.href.indexOf("https://")<0;const l=n},3355:(t,e,i)=>{i.d(e,{A:()=>f});var s=i(3161),n=i(6368),l=i(8302),r=i(7895),h=i(715),o=i(5491),a=i(9760),d=i(4699),c=i(8872),g=i(1635),u=i(4329);class p extends o.A{constructor(t,e,i="center",s="middle",l="black",r=n.CT,h=n.FV,o=n.fm,a=2,d=0,c=0,g=0,u=0,p=!0,f=n.x3,y=n.x3,m=!1,v=!1,w="visible",x=0,b=n.Sr){super(),this.margin=null,this.unrotatedBoundingBox=null,this.flipH=!1,this.flipV=!1,this.baseSpacingTop=0,this.baseSpacingBottom=0,this.baseSpacingLeft=0,this.baseSpacingRight=0,this.replaceLinefeeds=!0,this.verticalTextRotation=-90,this.ignoreClippedStringSize=!0,this.ignoreStringSize=!1,this.lastValue=null,this.cacheEnabled=!0,this.value=t,this.bounds=e,this.color=l??"black",this.align=i??"center",this.valign=s??"middle",this.family=r??n.CT,this.size=h??n.FV,this.fontStyle=o??n.fm,this.spacing=a??2,this.spacingTop=this.spacing+(d??0),this.spacingRight=this.spacing+(c??0),this.spacingBottom=this.spacing+(g??0),this.spacingLeft=this.spacing+(u??0),this.horizontal=p??!0,this.background=f,this.border=y,this.wrap=m??!1,this.clipped=v??!1,this.overflow=w??"visible",this.labelPadding=x??0,this.textDirection=b,this.rotation=0,this.updateMargin()}getSvgScreenOffset(){return 0}checkBounds(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)}paint(t,e=!1){const i=this.scale,s=this.bounds.x/i,n=this.bounds.y/i,l=this.bounds.width/i,r=this.bounds.height/i;if(this.updateTransform(t,s,n,l,r),this.configureCanvas(t,s,n,l,r),e)t.updateText(s,n,l,r,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node);else{const e=(0,c.Ll)(this.value)||"strictHtml"===this.dialect,i=e?"html":"";let h=this.value;e||"html"!==i||(h=(0,d.bG)(h,!1)),"html"!==i||(0,c.Ll)(this.value)||(h=(0,d.K7)(h,"<div><br></div>")),h=!(0,c.Ll)(this.value)&&this.replaceLinefeeds&&"html"===i?h.replace(/\n/g,"<br/>"):h;let o=this.textDirection;"auto"!==o||e||(o=this.getAutoDirection()),"ltr"!==o&&"rtl"!==o&&(o=""),t.text(s,n,l,r,h,this.align,this.valign,this.wrap,i,this.overflow,this.clipped,this.getTextRotation(),o)}}redraw(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue===this.value&&((0,c.Ll)(this.value)||"strictHtml"===this.dialect))if("DIV"===this.node.nodeName)this.redrawHtmlShape(),this.updateBoundingBox();else{const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.paint(t,!0),this.destroyCanvas(t),this.updateBoundingBox())}else super.redraw(),(0,c.Ll)(this.value)||"strictHtml"===this.dialect?this.lastValue=this.value:this.lastValue=null}resetStyles(){super.resetStyles(),this.color="black",this.align="center",this.valign="middle",this.family=n.CT,this.size=n.FV,this.fontStyle=n.fm,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,this.background=n.x3,this.border=n.x3,this.textDirection=n.Sr,this.margin=null}apply(t){const e=this.spacing;super.apply(t),this.style&&(this.fontStyle=this.style.fontStyle??this.fontStyle,this.family=this.style.fontFamily??this.family,this.size=this.style.fontSize??this.size,this.color=this.style.fontColor??this.color,this.align=this.style.align??this.align,this.valign=this.style.verticalAlign??this.valign,this.spacing=this.style.spacing??this.spacing,this.spacingTop=(this.style.spacingTop??this.spacingTop-e)+this.spacing,this.spacingRight=(this.style.spacingRight??this.spacingRight-e)+this.spacing,this.spacingBottom=(this.style.spacingBottom??this.spacingBottom-e)+this.spacing,this.spacingLeft=(this.style.spacingLeft??this.spacingLeft-e)+this.spacing,this.horizontal=this.style.horizontal??this.horizontal,this.background=this.style.labelBackgroundColor??this.background,this.border=this.style.labelBorderColor??this.border,this.textDirection=this.style.textDirection??n.Sr,this.opacity=this.style.textOpacity??100,this.updateMargin()),this.flipV=!1,this.flipH=!1}getAutoDirection(){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(String(this.value));return t&&t.length>0&&t[0]>"z"?"rtl":"ltr"}getContentNode(){let t=this.node;return t&&(t=t.ownerSVGElement?t.firstChild.firstChild.firstChild.firstChild.firstChild:this.node.firstChild.firstChild),t}updateBoundingBox(){let{node:t}=this;this.boundingBox=this.bounds.clone();const e=this.getTextRotation(),i=this.style?.labelPosition??"center",s=this.style?.verticalLabelPosition??"middle";if(!this.ignoreStringSize&&t&&"fill"!==this.overflow&&(!this.clipped||!this.ignoreClippedStringSize||"center"!==i||"middle"!==s)){let e=null,i=null;if(t.firstChild&&t.firstChild.firstChild&&"foreignObject"===t.firstChild.firstChild.nodeName)t=t.firstChild.firstChild.firstChild.firstChild,i=t.offsetHeight*this.scale,e="width"===this.overflow?this.boundingBox.width:t.offsetWidth*this.scale;else try{const e=t.getBBox();return void("string"==typeof this.value&&0===(0,d.Bq)(this.value)?.length||0===e.width&&0===e.height?this.boundingBox=null:this.boundingBox=new a.A(e.x,e.y,e.width,e.height))}catch(t){}e&&i&&(this.boundingBox=new a.A(this.bounds.x,this.bounds.y,e,i))}if(this.boundingBox){const t=this.margin;if(0!==e){const i=(0,l.UX)(new a.A(t.x*this.boundingBox.width,t.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),e,new h.A(0,0));this.unrotatedBoundingBox=a.A.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=t.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=t.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=i.x,this.boundingBox.y+=i.y,this.boundingBox.width=i.width,this.boundingBox.height=i.height}else this.boundingBox.x+=t.x*this.boundingBox.width,this.boundingBox.y+=t.y*this.boundingBox.height,this.unrotatedBoundingBox=null}}getShapeRotation(){return 0}getTextRotation(){return this.state&&this.state.shape?this.state.shape.getTextRotation():0}isPaintBoundsInverted(){return!this.horizontal&&!!this.state&&this.state.cell.isVertex()}configureCanvas(t,e,i,s,n){super.configureCanvas(t,e,i,s,n),t.setFontColor(this.color),t.setFontBackgroundColor(this.background),t.setFontBorderColor(this.border),t.setFontFamily(this.family),t.setFontSize(this.size),t.setFontStyle(this.fontStyle)}getHtmlValue(){let t=this.value;return"strictHtml"!==this.dialect&&(t=(0,d.bG)(t,!1)),t=(0,d.K7)(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t,t}getTextCss(){const t=n.Fb?this.size*n.$g+"px":n.$g;let e=`display: inline-block; font-size: ${this.size}px; font-family: ${this.family}; color: ${this.color}; line-height: ${t}; pointer-events: ${this.pointerEvents?"all":"none"}; `;(0,u.bW)(this.fontStyle,n.hv.BOLD)&&(e+="font-weight: bold; "),(0,u.bW)(this.fontStyle,n.hv.ITALIC)&&(e+="font-style: italic; ");const i=[];return(0,u.bW)(this.fontStyle,n.hv.UNDERLINE)&&i.push("underline"),(0,u.bW)(this.fontStyle,n.hv.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e+=`text-decoration: ${i.join(" ")}; `),e}redrawHtmlShape(){const t=Math.max(0,Math.round(this.bounds.width/this.scale)),e=Math.max(0,Math.round(this.bounds.height/this.scale)),i=`position: absolute; left: ${Math.round(this.bounds.x)}px; top: ${Math.round(this.bounds.y)}px; pointer-events: none; `,l=this.getTextCss(),r=this.margin,h=this.node;g.A.createCss(t+2,e,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.background!==n.x3?(0,d.bG)(this.background,!0):null,this.border!==n.x3?(0,d.bG)(this.border,!0):null,i,l,this.scale,(t,e,i,n,l,o)=>{const a=this.getTextRotation();let d=(1!==this.scale?`scale(${this.scale}) `:"")+(0!==a?`rotate(${a}deg) `:"")+(0!==r.x||0!==r.y?`translate(${100*r.x}%,${100*r.y}%)`:"");""!==d&&(d=`transform-origin: 0 0; transform: ${d}; `),""===o?(i+=n,n=`display:inline-block; min-width: 100%; ${d}`):(n+=d,s.A.IS_SF&&(n+="-webkit-clip-path: content-box;")),this.opacity<100&&(l+=`opacity: ${this.opacity/100}; `),h.setAttribute("style",i);const g=(0,c.Ll)(this.value)?this.value.outerHTML:this.getHtmlValue();h.firstChild||(h.innerHTML=`<div><div>${g}</div></div>`),h.firstChild.firstChild.setAttribute("style",l),h.firstChild.setAttribute("style",n)})}updateInnerHtml(t){if((0,c.Ll)(this.value))t.innerHTML=this.value.outerHTML;else{let e=this.value;"strictHtml"!==this.dialect&&(e=(0,d.bG)(e,!1)),e=(0,d.K7)(e,"<div>&nbsp;</div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e,e=`<div style="display:inline-block;_display:inline;">${e}</div>`,t.innerHTML=e}}updateValue(){const t=this.node;if((0,c.Ll)(this.value))t.innerHTML="",t.appendChild(this.value);else{let e=this.value;"strictHtml"!==this.dialect&&(e=(0,d.bG)(e,!1)),e=(0,d.K7)(e,"<div><br></div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e;const i=this.background!==n.x3?this.background:null,s=this.border!==n.x3?this.border:null;if("fill"===this.overflow||"width"===this.overflow)i&&(t.style.backgroundColor=i),s&&(t.style.border=`1px solid ${s}`);else{let t="";i&&(t+=`background-color:${(0,d.bG)(i,!0)};`),s&&(t+=`border:1px solid ${(0,d.bG)(s,!0)};`),e=`<div style="zoom:1;${t}display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:${n.Fb?this.size*n.$g+"px":n.$g}">${e}</div>`}t.innerHTML=e;const l=t.getElementsByTagName("div");if(l.length>0){let t=this.textDirection;"auto"===t&&"strictHtml"!==this.dialect&&(t=this.getAutoDirection()),"ltr"===t||"rtl"===t?l[l.length-1].setAttribute("dir",t):l[l.length-1].removeAttribute("dir")}}}updateFont(t){const{style:e}=t;e.lineHeight=n.Fb?this.size*n.$g+"px":n.$g,e.fontSize=`${this.size}px`,e.fontFamily=this.family,e.verticalAlign="top",e.color=this.color,(0,u.bW)(this.fontStyle,n.hv.BOLD)?e.fontWeight="bold":e.fontWeight="",(0,u.bW)(this.fontStyle,n.hv.ITALIC)?e.fontStyle="italic":e.fontStyle="";const i=[];(0,u.bW)(this.fontStyle,n.hv.UNDERLINE)&&i.push("underline"),(0,u.bW)(this.fontStyle,n.hv.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e.textDecoration=i.join(" ")),"center"===this.align?e.textAlign="center":"right"===this.align?e.textAlign="right":e.textAlign="left"}updateSize(t,e=!1){const i=Math.max(0,Math.round(this.bounds.width/this.scale)),s=Math.max(0,Math.round(this.bounds.height/this.scale)),{style:l}=t;if(this.clipped?(l.overflow="hidden",l.maxHeight=`${s}px`,l.maxWidth=`${i}px`):"fill"===this.overflow?(l.width=`${i+1}px`,l.height=`${s+1}px`,l.overflow="hidden"):"width"===this.overflow&&(l.width=`${i+1}px`,l.maxHeight=`${s+1}px`,l.overflow="hidden"),this.wrap&&i>0){if(l.wordWrap=n.Cx,l.whiteSpace="normal",l.width=`${i}px`,e&&"fill"!==this.overflow&&"width"!==this.overflow){let e=t;null!=e.firstChild&&"DIV"===e.firstChild.nodeName&&(e=e.firstChild,"break-word"===t.style.wordWrap&&(e.style.width="100%"));let s=e.offsetWidth;if(0===s){const i=t.parentNode;t.style.visibility="hidden",document.body.appendChild(t),s=e.offsetWidth,t.style.visibility="",i.appendChild(t)}s+=3,this.clipped&&(s=Math.min(s,i)),l.width=`${s}px`}}else l.whiteSpace="nowrap"}updateMargin(){this.margin=(0,r.oM)(this.align,this.valign)}getSpacing(){let t=0,e=0;return t="center"===this.align?(this.spacingLeft-this.spacingRight)/2:"right"===this.align?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,e="middle"===this.valign?(this.spacingTop-this.spacingBottom)/2:"bottom"===this.valign?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop,new h.A(t,e)}}const f=p},3439:(t,e,i)=>{i.d(e,{o:()=>n});var s=i(60);const n=function t(e,i=null,n=!1){n=null!=n&&n;let l=null;if(null!=e&&"function"==typeof e.constructor){l=new e.constructor;for(const r in e)r!=s.A.FIELD_NAME&&(null==i||i.indexOf(r)<0)&&(n||"object"!=typeof e[r]?l[r]=e[r]:l[r]=t(e[r]))}return l}},3556:(t,e,i)=>{i.d(e,{T:()=>At});var s=i(2223),n=i(7373),l=i(4186),r=i(2380),h=i(7236),o=i(7738),a=i(7208),d=i(1613),c=i(6172),g=i(5491),u=i(715);class p extends g.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(){return!0}paintVertexShape(t,e,i,s,n){const l=s/2,r=n/2,h=this.getBaseArcSize();t.begin(),this.addPoints(t,[new u.A(e+l,i),new u.A(e+s,i+r),new u.A(e+l,i+n),new u.A(e,i+r)],this.isRounded,h,!0),t.fillAndStroke()}}const f=p;var y=i(6368);class m extends g.A{constructor(t,e,i,s=1){super(),this.maxHeight=40,this.svgStrokeTolerance=0,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n,!1),t.fillAndStroke(),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),t.begin(),this.redrawPath(t,e,i,s,n,!0),t.stroke())}getCylinderSize(t,e,i,s){return Math.min(this.maxHeight,Math.round(s/5))}redrawPath(t,e,i,s,n,l=!1){const r=this.getCylinderSize(e,i,s,n);(l&&this.fill!==y.x3||!l&&this.fill===y.x3)&&(t.moveTo(0,r),t.curveTo(0,2*r,s,2*r,s,r),l||(t.stroke(),t.begin())),l||(t.moveTo(0,r),t.curveTo(0,-r/3,s,-r/3,s,r),t.lineTo(s,n-r),t.curveTo(s,n+r/3,0,n+r/3,0,n-r),t.close())}}const v=m;var w=i(8520);class x extends g.A{constructor(t=null,e=y.x3,i=y.x3,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n),t.fillAndStroke()}redrawPath(t,e,i,s,n){const l=s/3;t.moveTo(0,n),t.curveTo(0,3*n/5,0,2*n/5,s/2,2*n/5),t.curveTo(s/2-l,2*n/5,s/2-l,0,s/2,0),t.curveTo(s/2+l,0,s/2+l,2*n/5,s/2,2*n/5),t.curveTo(s,2*n/5,s,3*n/5,s,n),t.close()}}const b=x,C=class extends b{constructor(){super()}isRoundable(){return!0}redrawPath(t,e,i,s,n){const l=this.getBaseArcSize();this.addPoints(t,[new u.A(0,0),new u.A(s,.5*n),new u.A(0,n)],this.isRounded,l,!0)}},S=class extends b{constructor(){super()}redrawPath(t,e,i,s,n){const l=this.getBaseArcSize();this.addPoints(t,[new u.A(.25*s,0),new u.A(.75*s,0),new u.A(s,.5*n),new u.A(.75*s,n),new u.A(.25*s,n),new u.A(0,.5*n)],this.isRounded,l,!0)}},A=class extends b{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}redrawPath(t,e,i,s,n){t.moveTo(.25*s,.25*n),t.curveTo(.05*s,.25*n,0,.5*n,.16*s,.55*n),t.curveTo(0,.66*n,.18*s,.9*n,.31*s,.8*n),t.curveTo(.4*s,n,.7*s,n,.8*s,.8*n),t.curveTo(s,.8*n,s,.6*n,.875*s,.5*n),t.curveTo(s,.3*n,.8*s,.1*n,.625*s,.2*n),t.curveTo(.5*s,.05*n,.3*s,.05*n,.25*s,.25*n),t.close()}};class E extends g.A{constructor(t,e,i=1,s=!1){super(),this.bounds=t,this.stroke=e,this.strokeWidth=i,this.vertical=s}paintVertexShape(t,e,i,s,n){if(t.begin(),this.vertical){const l=e+s/2;t.moveTo(l,i),t.lineTo(l,i+n)}else{const l=i+n/2;t.moveTo(e,l),t.lineTo(e+s,l)}t.stroke()}}const M=E;class T extends g.A{constructor(t,e,i,s=1,n=y.pC,l=y.qG,r=y.gK){super(),this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.spacing=l,this.endSize=r}augmentBoundingBox(t){super.augmentBoundingBox(t);const e=Math.max(this.arrowWidth,this.endSize);t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){const i=y.qG,s=y.pC,n=y.gK,l=e[0],r=e[e.length-1],h=r.x-l.x,o=r.y-l.y,a=Math.sqrt(h*h+o*o),d=a-2*i-n,c=h/a,g=o/a,u=d*c,p=d*g,f=s*g/3,m=-s*c/3,v=l.x-f/2+i*c,w=l.y-m/2+i*g,x=v+f,b=w+m,C=x+u,S=b+p,A=C+f,E=S+m,M=A-3*f,T=E-3*m;t.begin(),t.moveTo(v,w),t.lineTo(x,b),t.lineTo(C,S),t.lineTo(A,E),t.lineTo(r.x-i*c,r.y-i*g),t.lineTo(M,T),t.lineTo(M+f,T+m),t.close(),t.fillAndStroke()}}const P=T;var H=i(8302);class L extends g.A{constructor(t,e,i,s=1,n=y.pC,l=y.qG,r=y.gK/5){super(),this.useSvgBoundingBox=!0,this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.arrowSpacing=l,this.startSize=y.gK/5,this.endSize=r}isRoundable(){return!0}resetStyles(){super.resetStyles(),this.arrowSpacing=y.qG}apply(t){super.apply(t),this.style&&null!=this.style.startSize&&null!=this.style.endSize&&(this.startSize=3*this.style.startSize,this.endSize=3*this.style.endSize)}augmentBoundingBox(t){super.augmentBoundingBox(t);let e=this.getEdgeWidth();this.isMarkerStart()&&(e=Math.max(e,this.getStartArrowWidth())),this.isMarkerEnd()&&(e=Math.max(e,this.getEndArrowWidth())),t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){let i=this.strokeWidth;this.outline&&(i=Math.max(1,this.style?.strokeWidth??0));const s=this.getStartArrowWidth()+i,n=this.getEndArrowWidth()+i,l=this.outline?this.getEdgeWidth()+i:this.getEdgeWidth(),r=this.isOpenEnded(),h=this.isMarkerStart(),o=this.isMarkerEnd(),a=r?0:this.arrowSpacing+i/2,d=this.startSize+i,c=this.endSize+i,g=this.isArrowRounded(),u=e[e.length-1];let p=1;for(;p<e.length-1&&e[p].x===e[0].x&&e[p].y===e[0].y;)p++;const f=e[p].x-e[0].x,y=e[p].y-e[0].y,m=Math.sqrt(f*f+y*y);if(0===m)return;let v,w,x=f/m,b=x,C=y/m,S=C,A=l*C,E=-l*x;const M=[];g?t.setLineJoin("round"):e.length>2&&t.setMiterLimit(1.42),t.begin();const T=x,P=C;if(h&&!r)this.paintMarker(t,e[0].x,e[0].y,x,C,d,s,l,a,!0);else{const i=e[0].x+A/2+a*x,s=e[0].y+E/2+a*C,n=e[0].x-A/2+a*x,l=e[0].y-E/2+a*C;r?(t.moveTo(i,s),M.push(()=>{t.lineTo(n,l)})):(t.moveTo(n,l),t.lineTo(i,s))}let L=0,D=0,k=0;for(let i=0;i<e.length-2;i+=1){const s=(0,H._C)(e[i].x,e[i].y,e[i+1].x,e[i+1].y,e[i+2].x,e[i+2].y);if(L=e[i+2].x-e[i+1].x,D=e[i+2].y-e[i+1].y,k=Math.sqrt(L*L+D*D),0!==k){b=L/k,S=D/k;const n=x*b+C*S,r=Math.max(Math.sqrt((n+1)/2),.04);v=x+b,w=C+S;const h=Math.sqrt(v*v+w*w);if(0!==h){v/=h,w/=h;const n=Math.max(r,Math.min(this.strokeWidth/200+.04,.35)),o=0!==s&&g?Math.max(.1,n):Math.max(r,.06),a=e[i+1].x+w*l/2/o,d=e[i+1].y-v*l/2/o,c=e[i+1].x-w*l/2/o,u=e[i+1].y+v*l/2/o;if(0!==s&&g)if(-1===s){const e=c+C*l,i=u-x*l,s=c+S*l,n=u-b*l;t.lineTo(e,i),t.quadTo(a,d,s,n),((e,i)=>{M.push(()=>{t.lineTo(e,i)})})(c,u)}else t.lineTo(a,d),((e,i)=>{const s=a-C*l,n=d+x*l,r=a-S*l,h=d+b*l;M.push(()=>{t.quadTo(e,i,s,n)}),M.push(()=>{t.lineTo(r,h)})})(c,u);else t.lineTo(a,d),((e,i)=>{M.push(()=>{t.lineTo(e,i)})})(c,u);x=b,C=S}}}if(A=l*S,E=-l*b,o&&!r)this.paintMarker(t,u.x,u.y,-x,-C,c,n,l,a,!1);else{t.lineTo(u.x-a*b+A/2,u.y-a*S+E/2);const e=u.x-a*b-A/2,i=u.y-a*S-E/2;r?(t.moveTo(e,i),M.splice(0,0,()=>{t.moveTo(e,i)})):t.lineTo(e,i)}for(let t=M.length-1;t>=0;t--)M[t]();r?(t.end(),t.stroke()):(t.close(),t.fillAndStroke()),t.setShadow(!1),t.setMiterLimit(4),g&&t.setLineJoin("flat"),e.length>2&&(t.setMiterLimit(4),h&&!r&&(t.begin(),this.paintMarker(t,e[0].x,e[0].y,T,P,d,s,l,a,!0),t.stroke(),t.end()),o&&!r&&(t.begin(),this.paintMarker(t,u.x,u.y,-x,-C,c,n,l,a,!0),t.stroke(),t.end()))}paintMarker(t,e,i,s,n,l,r,h,o,a){const d=h/r,c=h*n/2,g=-h*s/2,u=(o+l)*s,p=(o+l)*n;a?t.moveTo(e-c+u,i-g+p):t.lineTo(e-c+u,i-g+p),t.lineTo(e-c/d+u,i-g/d+p),t.lineTo(e+o*s,i+o*n),t.lineTo(e+c/d+u,i+g/d+p),t.lineTo(e+c+u,i+g+p)}isArrowRounded(){return this.isRounded}getStartArrowWidth(){return y.pC}getEndArrowWidth(){return y.pC}getEdgeWidth(){return y.pC/3}isOpenEnded(){return!1}isMarkerStart(){return(this.style?.startArrow??y.x3)!==y.x3}isMarkerEnd(){return(this.style?.endArrow??y.x3)!==y.x3}}const D=L;var k=i(9760);class O extends g.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintBackground(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}paintForeground(t,e,i,s,n){if(!this.outline){const l=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(s/5,n/5));e+=l,i+=l,n-=2*l,(s-=2*l)>0&&n>0&&t.ellipse(e,i,s,n),t.stroke()}}getLabelBounds(t){const e=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(t.width/5/this.scale,t.height/5/this.scale))*this.scale;return new k.A(t.x+e,t.y+e,t.width-2*e,t.height-2*e)}}const V=O;class B extends g.A{constructor(t,e,i,s=1){super(),this.imageSize=16,this.imageSrc=null,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(t,e,i,s,n){return!0}getTitleSize(){return Math.max(0,this.style?.startSize??y.QX)}getLabelBounds(t){const e=this.getTitleSize(),i=new k.A(t.x,t.y,t.width,t.height),s=this.isHorizontal(),n=this.style?.flipH??!1,l=this.style?.flipV??!1,r="north"===this.direction||"south"===this.direction,h=s==!r,o=!h&&n!==("south"===this.direction||"west"===this.direction),a=h&&l!==("south"===this.direction||"west"===this.direction);if(r){const t=Math.min(i.width,e*this.scale);(o||a)&&(i.x+=i.width-t),i.width=t}else{const t=Math.min(i.height,e*this.scale);(o||a)&&(i.y+=i.height-t),i.height=t}return i}getGradientBounds(t,e,i,s,n){let l=this.getTitleSize();return this.isHorizontal()?(l=Math.min(l,n),new k.A(e,i,s,l)):(l=Math.min(l,s),new k.A(e,i,l,n))}getSwimlaneArcSize(t,e,i){return this.style?.absoluteArcSize?Math.min(this.getBaseArcSize(),Math.min(e,t)/2):i*((this.style?.arcSize??100*y.fQ)/100)*3}isHorizontal(){return this.style?.horizontal??!0}paintVertexShape(t,e,i,s,n){let l=this.getTitleSize();const r=this.style?.swimlaneFillColor??y.x3,h=this.style?.swimlaneLine??!0;let o=0;l=this.isHorizontal()?Math.min(l,n):Math.min(l,s),t.translate(e,i),this.isRounded?(o=this.getSwimlaneArcSize(s,n,l),o=Math.min((this.isHorizontal()?n:s)-l,Math.min(l,o)),this.paintRoundedSwimlane(t,e,i,s,n,l,o,r,h)):this.paintSwimlane(t,e,i,s,n,l,r,h);const a=this.style?.separatorColor??y.x3;if(this.paintSeparator(t,e,i,s,n,l,a),this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x-e,l.y-i,l.width,l.height,this.imageSrc,!1,!1,!1)}this.glass&&(t.setShadow(!1),this.paintGlassEffect(t,0,0,s,l,o))}paintSwimlane(t,e,i,s,n,l,r,h){t.begin();let o=!0;this.style&&null!=this.style.pointerEvents&&(o=this.style.pointerEvents),o||this.fill!==y.x3||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(0,0),t.lineTo(s,0),t.lineTo(s,l),t.fillAndStroke(),l<n&&(r!==y.x3&&o||(t.pointerEvents=!1),r!==y.x3&&t.setFillColor(r),t.begin(),t.moveTo(0,l),t.lineTo(0,n),t.lineTo(s,n),t.lineTo(s,l),r===y.x3?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(0,0),t.lineTo(0,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(r!==y.x3&&o||(t.pointerEvents=!1),r!==y.x3&&t.setFillColor(r),t.begin(),t.moveTo(l,0),t.lineTo(s,0),t.lineTo(s,n),t.lineTo(l,n),r===y.x3?t.stroke():t.fillAndStroke())),h&&this.paintDivider(t,e,i,s,n,l,r===y.x3)}paintRoundedSwimlane(t,e,i,s,n,l,r,h,o){t.begin();let a=!0;this.style&&null!=this.style.pointerEvents&&(a=this.style.pointerEvents),a||this.fill!==y.x3||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,r),t.quadTo(s,0,s-Math.min(s/2,r),0),t.lineTo(Math.min(s/2,r),0),t.quadTo(0,0,0,r),t.lineTo(0,l),t.fillAndStroke(),l<n&&(h!==y.x3&&a||(t.pointerEvents=!1),h!==y.x3&&t.setFillColor(h),t.begin(),t.moveTo(0,l),t.lineTo(0,n-r),t.quadTo(0,n,Math.min(s/2,r),n),t.lineTo(s-Math.min(s/2,r),n),t.quadTo(s,n,s,n-r),t.lineTo(s,l),h===y.x3?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(r,0),t.quadTo(0,0,0,Math.min(n/2,r)),t.lineTo(0,n-Math.min(n/2,r)),t.quadTo(0,n,r,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(h!==y.x3&&a||(t.pointerEvents=!1),h!==y.x3&&t.setFillColor(h),t.begin(),t.moveTo(l,n),t.lineTo(s-r,n),t.quadTo(s,n,s,n-Math.min(n/2,r)),t.lineTo(s,Math.min(n/2,r)),t.quadTo(s,0,s-r,0),t.lineTo(l,0),h===y.x3?t.stroke():t.fillAndStroke())),o&&this.paintDivider(t,e,i,s,n,l,h===y.x3)}paintDivider(t,e,i,s,n,l,r){r||t.setShadow(!1),t.begin(),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(s,l)):(t.moveTo(l,0),t.lineTo(l,n)),t.stroke()}paintSeparator(t,e,i,s,n,l,r){r!==y.x3&&(t.setStrokeColor(r),t.setDashed(!0),t.begin(),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,n)):(t.moveTo(l,0),t.lineTo(s,0)),t.stroke(),t.setDashed(!1))}getImageBounds(t,e,i,s){return this.isHorizontal()?new k.A(t+i-this.imageSize,e,this.imageSize,this.imageSize):new k.A(t,e,this.imageSize,this.imageSize)}}const I=B;var R=i(8053);class N extends d.A{constructor(t,e,i,s){super(t,e,i,s),this.imageSize=y.tK,this.imageSrc=null,this.spacing=2,this.indicatorSize=10,this.indicatorSpacing=2,this.indicatorImageSrc=null}init(t){super.init(t),this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))}redraw(){this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.redraw()),super.redraw()}isHtmlAllowed(){return super.isHtmlAllowed()&&this.indicatorColor===y.x3&&!!this.indicatorShape}paintForeground(t,e,i,s,n){this.paintImage(t,e,i,s,n),this.paintIndicator(t,e,i,s,n),super.paintForeground(t,e,i,s,n)}paintImage(t,e,i,s,n){if(this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.imageSrc,!1,!1,!1)}}getImageBounds(t,e,i,s){const n=this.style?.imageAlign??"left",l=this.style?.verticalAlign??"middle",r=this.style?.imageWidth??y.tK,h=this.style?.imageHeight??y.tK,o=this.style?.spacing??this.spacing+5;return t+="center"===n?(i-r)/2:"right"===n?i-r-o:o,e+="top"===l?o:"bottom"===l?s-h-o:(s-h)/2,new k.A(t,e,r,h)}paintIndicator(t,e,i,s,n){if(this.indicator)this.indicator.bounds=this.getIndicatorBounds(e,i,s,n),this.indicator.paint(t);else if(this.indicatorImageSrc){const l=this.getIndicatorBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.indicatorImageSrc,!1,!1,!1)}}getIndicatorBounds(t,e,i,s){const n=this.style?.imageAlign??"left",l=this.style?.verticalAlign??"middle",r=this.style?.indicatorWidth??this.indicatorSize,h=this.style?.indicatorHeight??this.indicatorSize,o=this.spacing+5;return t+="right"===n?i-r-o:"center"===n?(i-r)/2:o,e+="bottom"===l?s-h-o:"top"===l?o:(s-h)/2,new k.A(t,e,r,h)}redrawHtmlShape(){for(super.redrawHtmlShape();this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(this.imageSrc&&this.bounds){const t=document.createElement("img");t.style.position="relative",t.setAttribute("border","0");const e=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);e.x-=this.bounds.x,e.y-=this.bounds.y,t.style.left=`${Math.round(e.x)}px`,t.style.top=`${Math.round(e.y)}px`,t.style.width=`${Math.round(e.width)}px`,t.style.height=`${Math.round(e.height)}px`,t.src=this.imageSrc,this.node.appendChild(t)}}}const z=N;let F=!1;var G=i(8152);const _=(t,e,i,s,n)=>{const{view:l}=t;let r=null!=s&&s.length>0?s[0]:null;const h=t.absolutePoints,o=h[0],a=h[h.length-1];if(null!=r&&(r=l.transformControlPoint(t,r)),null!=o&&((e=new G.A).x=o.x,e.y=o.y),null!=a&&((i=new G.A).x=a.x,i.y=a.y),null!=e&&null!=i){const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width),h=null!=r?r.x:Math.round(s+(t-s)/2);let o=l.getRoutingCenterY(e),a=l.getRoutingCenterY(i);if(null!=r&&(r.y>=e.y&&r.y<=e.y+e.height&&(o=r.y),r.y>=i.y&&r.y<=i.y+i.height&&(a=r.y)),(0,H.gR)(i,h,o)||(0,H.gR)(e,h,o)||n.push(new u.A(h,o)),(0,H.gR)(i,h,a)||(0,H.gR)(e,h,a)||n.push(new u.A(h,a)),1===n.length)if(null!=r)(0,H.gR)(i,h,r.y)||(0,H.gR)(e,h,r.y)||n.push(new u.A(h,r.y));else{const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);n.push(new u.A(h,t+(s-t)/2))}}},U=(t,e,i,s,n)=>{const{view:l}=t;let r=null!=s&&s.length>0?s[0]:null;const h=t.absolutePoints,o=h[0],a=h[h.length-1];if(null!=r&&(r=l.transformControlPoint(t,r)),null!=o&&((e=new G.A).x=o.x,e.y=o.y),null!=a&&((i=new G.A).x=a.x,i.y=a.y),null!=e&&null!=i){const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);let h=l.getRoutingCenterX(e);null!=r&&r.x>=e.x&&r.x<=e.x+e.width&&(h=r.x);const o=null!=r?r.y:Math.round(s+(t-s)/2);if((0,H.gR)(i,h,o)||(0,H.gR)(e,h,o)||n.push(new u.A(h,o)),h=null!=r&&r.x>=i.x&&r.x<=i.x+i.width?r.x:l.getRoutingCenterX(i),(0,H.gR)(i,h,o)||(0,H.gR)(e,h,o)||n.push(new u.A(h,o)),1===n.length)if(null!=r&&1===n.length)(0,H.gR)(i,r.x,o)||(0,H.gR)(e,r.x,o)||n.push(new u.A(r.x,o));else{const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width);n.push(new u.A(t+(s-t)/2,o))}}},W=(t,e,i,s,n)=>{let l=null!=s&&s.length>0?s[0]:null,r=!1,h=!1;if(null!=e&&null!=i)if(null!=l){const s=Math.min(e.x,i.x),n=Math.max(e.x+e.width,i.x+i.width),o=Math.min(e.y,i.y),a=Math.max(e.y+e.height,i.y+i.height);l=t.view.transformControlPoint(t,l),r=l.y<o||l.y>a,h=l.x<s||l.x>n}else r=Math.max(e.x,i.x)===Math.min(e.x+e.width,i.x+i.width),r||(h=Math.max(e.y,i.y)===Math.min(e.y+e.height,i.y+i.height));h||!r&&"vertical"!==t.style.elbow?_(t,e,i,s,n):U(t,e,i,s,n)};var Y=i(1311),X=i(3618),$=i(868),q=i(849);function K(t,e){let i=[];if(null!=t)for(let s=0;s<t.length;s+=1)null!=t[s]?i[s]=new u.A(Math.round(t[s].x/e*10)/10,Math.round(t[s].y/e*10)/10):i[s]=null;else i=null;return i}function j(t,e){let i=null;return null!=t&&(i=t.clone(),i.setRect(Math.round(t.x/e*10)/10,Math.round(t.y/e*10)/10,Math.round(t.width/e*10)/10,Math.round(t.height/e*10)/10)),i}const J=(t,e,i,s,n)=>{const l=K(t.absolutePoints,t.view.scale),r=j(e,t.view.scale),h=j(i,t.view.scale);let o=n.length>0?n[0]:null,a=!0,d=null;function c(e){return e.x=Math.round(e.x*t.view.scale*10)/10,e.y=Math.round(e.y*t.view.scale*10)/10,(null==o||Math.abs(o.x-e.x)>=1||Math.abs(o.y-e.y)>=Math.max(1,t.view.scale))&&(n.push(e),o=e),o}let g=l[0];null==g&&null!=r?g=new u.A(t.view.getRoutingCenterX(r),t.view.getRoutingCenterY(r)):null!=g&&(g=g.clone());const p=l.length-1;let f=null;if(null!=s&&s.length>0){let e=[];for(let i=0;i<s.length;i+=1){const n=t.view.transformControlPoint(t,s[i],!0);null!=n&&e.push(n)}if(0===e.length)return;null!=g&&null!=e[0]&&(Math.abs(e[0].x-g.x)<1&&(e[0].x=g.x),Math.abs(e[0].y-g.y)<1&&(e[0].y=g.y)),f=l[p],null!=f&&null!=e[e.length-1]&&(Math.abs(e[e.length-1].x-f.x)<1&&(e[e.length-1].x=f.x),Math.abs(e[e.length-1].y-f.y)<1&&(e[e.length-1].y=f.y)),d=e[0];let i=r,n=l[0],o=!1,y=!1,m=d;null!=n&&(i=null);for(let t=0;t<2;t+=1){const s=null!=n&&n.x===m.x,r=null!=n&&n.y===m.y,d=null!=i&&m.y>=i.y&&m.y<=i.y+i.height,c=null!=i&&m.x>=i.x&&m.x<=i.x+i.width;if(o=r||null==n&&d,y=s||null==n&&c,0!=t||!(o&&y||s&&r)){if(null!=n&&!r&&!s&&(d||c)){a=!d;break}if(y||o){a=o,1===t&&(a=e.length%2==0?o:y);break}}i=h,n=l[p],null!=n&&(i=null),m=e[e.length-1],s&&r&&(e=e.slice(1))}a&&(null!=l[0]&&l[0].y!==d.y||null==l[0]&&null!=r&&(d.y<r.y||d.y>r.y+r.height))?c(new u.A(g.x,d.y)):!a&&(null!=l[0]&&l[0].x!==d.x||null==l[0]&&null!=r&&(d.x<r.x||d.x>r.x+r.width))&&c(new u.A(d.x,g.y)),a?g.y=d.y:g.x=d.x;for(let t=0;t<e.length;t+=1)a=!a,d=e[t],a?g.y=d.y:g.x=d.x,c(g.clone())}else d=g,a=!0;if(g=l[p],null==g&&null!=h&&(g=new u.A(t.view.getRoutingCenterX(h),t.view.getRoutingCenterY(h))),null!=g&&null!=d&&(a&&(null!=l[p]&&l[p].y!==d.y||null==l[p]&&null!=h&&(d.y<h.y||d.y>h.y+h.height))?c(new u.A(g.x,d.y)):!a&&(null!=l[p]&&l[p].x!==d.x||null==l[p]&&null!=h&&(d.x<h.x||d.x>h.x+h.width))&&c(new u.A(d.x,g.y))),null==l[0]&&null!=r)for(;n.length>1&&null!=n[1]&&(0,H.gR)(r,n[1].x,n[1].y);)n.splice(1,1);if(null==l[p]&&null!=h)for(;n.length>1&&null!=n[n.length-1]&&(0,H.gR)(h,n[n.length-1].x,n[n.length-1].y);)n.splice(n.length-1,1);null!=f&&null!=n[n.length-1]&&Math.abs(f.x-n[n.length-1].x)<=1&&Math.abs(f.y-n[n.length-1].y)<=1&&(n.splice(n.length-1,1),null!=n[n.length-1]&&(Math.abs(n[n.length-1].x-f.x)<1&&(n[n.length-1].x=f.x),Math.abs(n[n.length-1].y-f.y)<1&&(n[n.length-1].y=f.y)))},Q=[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],Z=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],tt=[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],et=[],it=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]];function st(t,e){const i=$.TG.buffer;let s=(e?t.style.sourceJettySize:t.style.targetJettySize)??t.style.jettySize??i;if("auto"===s)if(((e?t.style.startArrow:t.style.endArrow)??y.x3)!==y.x3){const n=(e?t.style.startSize:t.style.endSize)??y.wh;s=Math.max(2,Math.ceil((n+i)/i))*i}else s=2*i;return s}const nt=(t,e,i,s,n)=>{const l=K(t.absolutePoints,t.view.scale),r=j(e,t.view.scale),h=j(i,t.view.scale),o=null!=r&&r.cell.isEdge(),a=null!=h&&h.cell.isEdge(),d=l[0],c=l[l.length-1];let g=null!=r?r.x:d.x,p=null!=r?r.y:d.y,f=null!=r?r.width:0,m=null!=r?r.height:0,v=null!=h?h.x:c.x,w=null!=h?h.y:c.y,x=null!=h?h.width:0,b=null!=h?h.height:0,C=st(t,!0),S=st(t,!1);null!=r&&h===r&&(S=Math.max(C,S),C=S);const A=S+C;let E=!1;if(null!=d&&null!=c){const t=c.x-d.x,e=c.y-d.y;E=t*t+e*e<A*A}if(E||$.TG.pointsFallback&&null!=s&&s.length>0||o||a)return void J(t,e,i,s,n);const M=[y.TE.ALL,y.TE.ALL];let T=0;if(null!=r&&(M[0]=(0,H.ct)(r,t,!0,y.TE.ALL),T=r.style.rotation??0,0!==T)){const t=(0,H.UX)(new k.A(g,p,f,m),T);g=t.x,p=t.y,f=t.width,m=t.height}if(null!=h&&(M[1]=(0,H.ct)(h,t,!1,y.TE.ALL),T=h.style.rotation??0,0!==T)){const t=(0,H.UX)(new k.A(v,w,x,b),T);v=t.x,w=t.y,x=t.width,b=t.height}const P=[0,0],L=[[g,p,f,m],[v,w,x,b]],D=[C,S];for(let t=0;t<2;t+=1)it[t][1]=L[t][0]-D[t],it[t][2]=L[t][1]-D[t],it[t][4]=L[t][0]+L[t][2]+D[t],it[t][8]=L[t][1]+L[t][3]+D[t];const O=L[0][0]+L[0][2]/2,V=L[0][1]+L[0][3]/2,B=O-(L[1][0]+L[1][2]/2),I=V-(L[1][1]+L[1][3]/2);let R=0;B<0?R=I<0?2:1:I<=0&&(R=3,0===B&&(R=2));let N=null;null!=r&&(N=d);const z=[[.5,.5],[.5,.5]];for(let t=0;t<2;t+=1)null!=N&&(z[t][0]=(N.x-L[t][0])/L[t][2],Math.abs(N.x-L[t][0])<=1?P[t]=y.TE.WEST:Math.abs(N.x-L[t][0]-L[t][2])<=1&&(P[t]=y.TE.EAST),z[t][1]=(N.y-L[t][1])/L[t][3],Math.abs(N.y-L[t][1])<=1?P[t]=y.TE.NORTH:Math.abs(N.y-L[t][1]-L[t][3])<=1&&(P[t]=y.TE.SOUTH)),N=null,null!=h&&(N=c);const F=L[0][1]-(L[1][1]+L[1][3]),G=L[0][0]-(L[1][0]+L[1][2]),_=L[1][1]-(L[0][1]+L[0][3]),U=L[1][0]-(L[0][0]+L[0][2]);et[1]=Math.max(G-A,0),et[2]=Math.max(F-A,0),et[4]=Math.max(_-A,0),et[3]=Math.max(U-A,0);const W=[],Y=[],X=[];Y[0]=G>=U?y.TE.WEST:y.TE.EAST,X[0]=F>=_?y.TE.NORTH:y.TE.SOUTH,Y[1]=(0,H.Qg)(Y[0]),X[1]=(0,H.Qg)(X[0]);const q=G>=U?G:U,nt=F>=_?F:_,lt=[[0,0],[0,0]];let rt=!1;for(let t=0;t<2;t+=1)0===P[t]&&(0===(Y[t]&M[t])&&(Y[t]=(0,H.Qg)(Y[t])),0===(X[t]&M[t])&&(X[t]=(0,H.Qg)(X[t])),lt[t][0]=X[t],lt[t][1]=Y[t]);nt>0&&q>0&&((Y[0]&M[0])>0&&(X[1]&M[1])>0?(lt[0][0]=Y[0],lt[0][1]=X[0],lt[1][0]=X[1],lt[1][1]=Y[1],rt=!0):(X[0]&M[0])>0&&(Y[1]&M[1])>0&&(lt[0][0]=X[0],lt[0][1]=Y[0],lt[1][0]=Y[1],lt[1][1]=X[1],rt=!0)),nt>0&&!rt&&(lt[0][0]=X[0],lt[0][1]=Y[0],lt[1][0]=X[1],lt[1][1]=Y[1],rt=!0),q>0&&!rt&&(lt[0][0]=Y[0],lt[0][1]=X[0],lt[1][0]=Y[1],lt[1][1]=X[1],rt=!0);for(let t=0;t<2;t+=1)0===P[t]&&(0===(lt[t][0]&M[t])&&(lt[t][0]=lt[t][1]),W[t]=lt[t][0]&M[t],W[t]|=(lt[t][1]&M[t])<<8,W[t]|=(lt[1-t][t]&M[t])<<16,W[t]|=(lt[1-t][1-t]&M[t])<<24,15&W[t]||(W[t]=W[t]<<8),3840&W[t]||(W[t]=15&W[t]|W[t]>>8),983040&W[t]||(W[t]=65535&W[t]|(251658240&W[t])>>8),P[t]=15&W[t],M[t]!==y.TE.WEST&&M[t]!==y.TE.NORTH&&M[t]!==y.TE.EAST&&M[t]!==y.TE.SOUTH||(P[t]=M[t]));let ht=P[0]===y.TE.EAST?3:P[0],ot=P[1]===y.TE.EAST?3:P[1];ht-=R,ot-=R,ht<1&&(ht+=4),ot<1&&(ot+=4);const at=tt[ht-1][ot-1];switch(Z[0][0]=L[0][0],Z[0][1]=L[0][1],P[0]){case y.TE.WEST:Z[0][0]-=C,Z[0][1]+=z[0][1]*L[0][3];break;case y.TE.SOUTH:Z[0][0]+=z[0][0]*L[0][2],Z[0][1]+=L[0][3]+C;break;case y.TE.EAST:Z[0][0]+=L[0][2]+C,Z[0][1]+=z[0][1]*L[0][3];break;case y.TE.NORTH:Z[0][0]+=z[0][0]*L[0][2],Z[0][1]-=C}let dt=0,ct=(P[0]&(y.TE.EAST|y.TE.WEST))>0?0:1;const gt=ct;let ut=0;for(let t=0;t<at.length;t+=1){const e=15&at[t];let i=e===y.TE.EAST?3:e;i+=R,i>4&&(i-=4);const s=Q[i-1];ut=i%2>0?0:1,ut!==ct&&(dt++,Z[dt][0]=Z[dt-1][0],Z[dt][1]=Z[dt-1][1]);const n=(2048&at[t])>0,l=(1024&at[t])>0;let r=(480&at[t])>>5;r<<=R,r>15&&(r>>=4);const h=(512&at[t])>0;if((l||n)&&r<9){let t=0;const e=l?0:1;if(t=h&&0===ut?L[e][0]+z[e][0]*L[e][2]:h?L[e][1]+z[e][1]*L[e][3]:it[e][r],0===ut){const e=(t-Z[dt][0])*s[0];e>0&&(Z[dt][0]+=s[0]*e)}else{const e=(t-Z[dt][1])*s[1];e>0&&(Z[dt][1]+=s[1]*e)}}else h&&(Z[dt][0]+=s[0]*Math.abs(et[i]/2),Z[dt][1]+=s[1]*Math.abs(et[i]/2));dt>0&&Z[dt][ut]===Z[dt-1][ut]?dt--:ct=ut}for(let e=0;e<=dt&&(e!==dt||(((P[1]&(y.TE.EAST|y.TE.WEST))>0?0:1)===gt?0:1)==(dt+1)%2);e+=1)n.push(new u.A(Math.round(Z[e][0]*t.view.scale*10)/10,Math.round(Z[e][1]*t.view.scale*10)/10));let pt=1;for(;pt<n.length;)null==n[pt-1]||null==n[pt]||n[pt-1].x!==n[pt].x||n[pt-1].y!==n[pt].y?pt++:n.splice(pt,1)},lt=(t,e,i,s,n)=>{function l(t,e){return t.x+=e.x||0,t.y+=e.y||0,t.width+=e.width||0,t.height+=e.height||0,t}function r(t,e){return e*Math.round(t/e)}function h(t,e,i){return t.x=r(t.x,e),t.y=r(t.y,i||e),t}function o(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}function a(t){return new u.A(t.x+t.width/2,t.y+t.height/2)}function d(t,e){return new u.A(t.x-e.x,t.y-e.y)}function c(t,e,i){return t.x+=e||0,t.y+=i||0,t}function g(t,e){const i=e.clone(),s=-(i.y-t.y),n=i.x-t.x;return 180*("0"==s.toFixed(10)&&"0"==n.toFixed(10)?0:Math.atan2(s,n))/Math.PI}function p(t){return new u.A(0===t.x?0:Math.abs(t.x)/t.x,0===t.y?0:Math.abs(t.y)/t.y)}function f(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function y(t){const e=t.split(-1===t.indexOf("@")?" ":"@");return new u.A(parseInt(e[0],10),parseInt(e[1],10))}function m(t){return`${t.x}@${t.y}`}function v(t){const e=t.view.graph,i=e.getCellBounds(t.cell,!1,!1)?.clone();if(!i)return;const s=e.view,{scale:n,translate:l}=s,{x:r,y:h}=l,o=t=>Math.round(10*t)/10;return new k.A(o(i.x/n-r),o(i.y/n-h),o(i.width/n),o(i.height/n))}const w=$.kD.step,x={paddingBox:new q.A(-w,-w,2*w,2*w),directions:[{offsetX:w,offsetY:0,cost:w,angle:E(g(new u.A(0,0),new u.A(w,0)))},{offsetX:0,offsetY:w,cost:w,angle:E(g(new u.A(0,0),new u.A(0,w)))},{offsetX:-w,offsetY:0,cost:w,angle:E(g(new u.A(0,0),new u.A(-w,0)))},{offsetX:0,offsetY:-w,cost:w,angle:E(g(new u.A(0,0),new u.A(0,-w)))}],directionMap:{east:{x:1,y:0},south:{x:0,y:1},west:{x:-1,y:0},north:{x:0,y:-1}},penaltiesGenerator:t=>45==t||90==t||180==t?w/2:0,draggingRoute:null,previousDirAngle:0};class b{constructor(t){this.options=t,this.mapGridSize=100,this.map=new Map}build(t,e){const i=t?.view.graph||e?.view.graph;if(i)return Array.from(i.getView().getCellStates()).filter(t=>t.cell&&t.cell.isVertex()&&!t.cell.isEdge()).map(t=>v(t)).map(t=>t?l(t,this.options.paddingBox):null).forEach(t=>{if(!t)return;const e=h(new u.A(t.x,t.y),this.mapGridSize),i=h(new u.A(t.x+t.width,t.y+t.height),this.mapGridSize);for(let s=e.x;s<=i.x;s+=this.mapGridSize)for(let n=e.y;n<=i.y;n+=this.mapGridSize){const e=s+"@"+n,i=this.map.get(e)||[];this.map.has(e)||this.map.set(e,i),i.push(t)}})}isPointAccessible(t){const e=m(h(t.clone(),this.mapGridSize)),i=this.map.get(e);return!i||i.every(e=>!o(e,t))}}class C{constructor(){this.items=[],this.hash=new Map}add(t,e){const i=this.hash.get(t);i?(i.value=e,this.items.splice(this.items.indexOf(t),1)):this.hash.set(t,{value:e,open:!0}),this.items.push(t),this.items.sort((t,e)=>{const i=this.hash.get(t),s=this.hash.get(e);return i&&s?i.value-s.value:0})}remove(t){const e=this.hash.get(t);e&&(e.open=!1)}isOpen(t){const e=this.hash.get(t);return e&&1==e.open}isClose(t){const e=this.hash.get(t);return e&&0==e.open}isEmpty(){return 0==this.items.length}pop(){const t=this.items.shift();return t&&this.remove(t),t}}function S(t,e,i,s){const n=[];let l,r=p(d(s,e)),h=e;for(;t[m(h)];){if(l=t[m(h)],!l)continue;const e=p(d(h,l));e.equals(r)||(n.unshift(h),r=e),h=l}return p(d(h,i)).equals(r)||n.unshift(h),n}function A(t,e,i){const s=$.kD.step,n=a(t),l=[];for(const r of e){const e=i.directionMap[r],a=e.x*t.width/2,d=e.y*t.height/2,g=c(n.clone(),a,d);o(t,g)&&c(g,e.x*s,e.y*s),l.push(h(g,s))}return l}function E(t){return t%360+(t<0?360:0)}function M(t,e,i){const s=360/i;return Math.floor(E(g(t,e)+s/2)/s)*s}function T(t,e){const i=Math.abs(t-e);return i>180?360-i:i}function P(t,e){let i=1/0;for(let s=0,n=e.length;s<n;s++){const n=f(t,e[s]);n<i&&(i=n)}return i}function H(t,e,i,s){const n=v(i),l=s?e.style.exitY:e.style.entryY,r=s?$.kD.startDirections.every(t=>"north"!=t&&"south"!=t):$.kD.endDirections.every(t=>"north"!=t&&"south"!=t);if(null!=l&&r){const e=n?.height||0;t.y=null!=n?.y?n?.y+e*l:t.y-e/2+e*l}const h=s?e.style.exitX:e.style.entryX,o=s?$.kD.startDirections.every(t=>"west"!=t&&"east"!=t):$.kD.endDirections.every(t=>"west"!=t&&"east"!=t);if(null!=h&&o){const e=n?.width||0;t.x=null!=n?.x?n?.x+e*h:t.x-e/2+e*(h||0)}}!function(t,e,i,s,n,r){if(null!=s&&s.length>0||null==e||null==i)return void J(t,e,i,s,n);let o=v(e);o=o?l(o,r.paddingBox):void 0;let d=v(i);d=d?l(d,r.paddingBox):void 0;const g=new b(r);if(g.build(e,i),!o||!d)return nt(t,e,i,s,n);const p=function(t,e,i,s){const n=$.kD.step,l=A(t,$.kD.startDirections,s).filter(t=>i.isPointAccessible(t)),r=h(a(t),n),o=A(e,$.kD.endDirections,s).filter(t=>i.isPointAccessible(t)),d=h(a(e),n);if(l.length>0&&o.length>0){const t=new C,e={},n={};l.forEach(e=>{const i=m(e);t.add(i,P(e,o)),n[i]=0});let h=$.kD.maxLoops;const a=o.map(t=>m(t));let g,u;for(;!t.isEmpty()&&h>0;){const l=t.pop();if(null==l)continue;const p=y(l),f=n[l];if(u=g,g=e[l]?M(e[l],p,s.directions.length):0!=s.previousDirAngle?s.previousDirAngle:M(r,p,s.directions.length),a.indexOf(l)>=0){const t=T(g,M(p,d,s.directions.length));if(p.equals(d)||t<180)return s.previousDirAngle=g,S(e,p,r,d)}for(let l=0;l<s.directions.length;l++){const r=s.directions[l],h=T(g,r.angle);if(u&&h>$.kD.maxAllowedDirectionChange)continue;const a=c(p.clone(),r.offsetX,r.offsetY),d=m(a);if(t.isClose(d)||!i.isPointAccessible(a))continue;const y=f+r.cost+s.penaltiesGenerator(h);(!t.isOpen(d)||y<n[d])&&(e[d]=p,n[d]=y,t.add(d,y+P(a,o)))}h--}return null}return null}(o,d,g,r);if(null==p||0==p.length)return nt(t,e,i,s,n);t.style&&(t.visibleSourceState&&p.length>0&&H(p[0],t,t.visibleSourceState,!0),t.visibleTargetState&&p.length>1&&H(p[p.length-1],t,t.visibleTargetState,!1));const f=t.view.scale;p.forEach(e=>n.push(new u.A(Math.round((e.x+t.view.translate.x)*f*10)/10,Math.round((e.y+t.view.translate.y)*f*10)/10)))}(t,e,i,s,n,x)},rt=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,r=t.width/2,h=t.height/2,o=n+r,a=l+h,d=i.x,c=i.y,g=parseInt(String(d-o)),p=parseInt(String(c-a));if(0===g&&0!==p)return new u.A(o,a+h*p/Math.abs(p));if(0===g&&0===p)return new u.A(d,c);if(s){if(c>=l&&c<=l+t.height){const t=c-a;let e=Math.sqrt(r*r*(1-t*t/(h*h)))||0;return d<=n&&(e=-e),new u.A(o+e,c)}if(d>=n&&d<=n+t.width){const t=d-o;let e=Math.sqrt(h*h*(1-t*t/(r*r)))||0;return c<=l&&(e=-e),new u.A(d,a+e)}}const f=p/g,y=a-f*o,m=r*r*f*f+h*h,v=-2*o*m,w=r*r*f*f*o*o+h*h*o*o-r*r*h*h,x=Math.sqrt(v*v-4*m*w),b=(-v+x)/(2*m),C=(-v-x)/(2*m),S=f*b+y,A=f*C+y;let E=0,M=0;return Math.sqrt(Math.pow(b-d,2)+Math.pow(S-c,2))<Math.sqrt(Math.pow(C-d,2)+Math.pow(A-c,2))?(E=b,M=S):(E=C,M=A),new u.A(E,M)},ht=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,r=t.width,h=t.height,o=t.getCenterX(),a=t.getCenterY(),d=i.x,c=i.y,g=d-o,p=c-a,f=-Math.atan2(p,g),y=Math.PI,m=Math.PI/2;let v=new u.A(o,a);const w=e?.style?.direction??"east",x="north"===w||"south"===w;let b=new u.A,C=new u.A;if((d<n&&c<l||d<n&&c>l+h||d>n+r&&c<l||d>n+r&&c>l+h)&&(s=!1),s){if(x){if(d===o){if(c<=l)return new u.A(o,l);if(c>=l+h)return new u.A(o,l+h)}else if(d<n){if(c===l+h/4)return new u.A(n,l+h/4);if(c===l+3*h/4)return new u.A(n,l+3*h/4)}else if(d>n+r){if(c===l+h/4)return new u.A(n+r,l+h/4);if(c===l+3*h/4)return new u.A(n+r,l+3*h/4)}else if(d===n){if(c<a)return new u.A(n,l+h/4);if(c>a)return new u.A(n,l+3*h/4)}else if(d===n+r){if(c<a)return new u.A(n+r,l+h/4);if(c>a)return new u.A(n+r,l+3*h/4)}if(c===l)return new u.A(o,l);if(c===l+h)return new u.A(o,l+h);d<o?c>l+h/4&&c<l+3*h/4?(b=new u.A(n,l),C=new u.A(n,l+h)):c<l+h/4?(b=new u.A(n-Math.floor(.5*r),l+Math.floor(.5*h)),C=new u.A(n+r,l-Math.floor(.25*h))):c>l+3*h/4&&(b=new u.A(n-Math.floor(.5*r),l+Math.floor(.5*h)),C=new u.A(n+r,l+Math.floor(1.25*h))):d>o&&(c>l+h/4&&c<l+3*h/4?(b=new u.A(n+r,l),C=new u.A(n+r,l+h)):c<l+h/4?(b=new u.A(n,l-Math.floor(.25*h)),C=new u.A(n+Math.floor(1.5*r),l+Math.floor(.5*h))):c>l+3*h/4&&(b=new u.A(n+Math.floor(1.5*r),l+Math.floor(.5*h)),C=new u.A(n,l+Math.floor(1.25*h))))}else{if(c===a){if(d<=n)return new u.A(n,l+h/2);if(d>=n+r)return new u.A(n+r,l+h/2)}else if(c<l){if(d===n+r/4)return new u.A(n+r/4,l);if(d===n+3*r/4)return new u.A(n+3*r/4,l)}else if(c>l+h){if(d===n+r/4)return new u.A(n+r/4,l+h);if(d===n+3*r/4)return new u.A(n+3*r/4,l+h)}else if(c===l){if(d<o)return new u.A(n+r/4,l);if(d>o)return new u.A(n+3*r/4,l)}else if(c===l+h){if(d<o)return new u.A(n+r/4,l+h);if(c>a)return new u.A(n+3*r/4,l+h)}if(d===n)return new u.A(n,a);if(d===n+r)return new u.A(n+r,a);c<a?d>n+r/4&&d<n+3*r/4?(b=new u.A(n,l),C=new u.A(n+r,l)):d<n+r/4?(b=new u.A(n-Math.floor(.25*r),l+h),C=new u.A(n+Math.floor(.5*r),l-Math.floor(.5*h))):d>n+3*r/4&&(b=new u.A(n+Math.floor(.5*r),l-Math.floor(.5*h)),C=new u.A(n+Math.floor(1.25*r),l+h)):c>a&&(d>n+r/4&&d<n+3*r/4?(b=new u.A(n,l+h),C=new u.A(n+r,l+h)):d<n+r/4?(b=new u.A(n-Math.floor(.25*r),l),C=new u.A(n+Math.floor(.5*r),l+Math.floor(1.5*h))):d>n+3*r/4&&(b=new u.A(n+Math.floor(.5*r),l+Math.floor(1.5*h)),C=new u.A(n+Math.floor(1.25*r),l)))}let t=o,e=a;d>=n&&d<=n+r?(t=d,e=c<a?l+h:l):c>=l&&c<=l+h&&(e=c,t=d<o?n+r:n),v=(0,H.E$)(t,e,i.x,i.y,b.x,b.y,C.x,C.y)}else{if(x){const t=Math.atan2(h/4,r/2);if(f===t)return new u.A(n+r,l+Math.floor(.25*h));if(f===m)return new u.A(n+Math.floor(.5*r),l);if(f===y-t)return new u.A(n,l+Math.floor(.25*h));if(f===-t)return new u.A(n+r,l+Math.floor(.75*h));if(f===-m)return new u.A(n+Math.floor(.5*r),l+h);if(f===-y+t)return new u.A(n,l+Math.floor(.75*h));f<t&&f>-t?(b=new u.A(n+r,l),C=new u.A(n+r,l+h)):f>t&&f<m?(b=new u.A(n,l-Math.floor(.25*h)),C=new u.A(n+Math.floor(1.5*r),l+Math.floor(.5*h))):f>m&&f<y-t?(b=new u.A(n-Math.floor(.5*r),l+Math.floor(.5*h)),C=new u.A(n+r,l-Math.floor(.25*h))):f>y-t&&f<=y||f<-y+t&&f>=-y?(b=new u.A(n,l),C=new u.A(n,l+h)):f<-t&&f>-m?(b=new u.A(n+Math.floor(1.5*r),l+Math.floor(.5*h)),C=new u.A(n,l+Math.floor(1.25*h))):f<-m&&f>-y+t&&(b=new u.A(n-Math.floor(.5*r),l+Math.floor(.5*h)),C=new u.A(n+r,l+Math.floor(1.25*h)))}else{const t=Math.atan2(h/2,r/4);if(f===t)return new u.A(n+Math.floor(.75*r),l);if(f===y-t)return new u.A(n+Math.floor(.25*r),l);if(f===y||f===-y)return new u.A(n,l+Math.floor(.5*h));if(0===f)return new u.A(n+r,l+Math.floor(.5*h));if(f===-t)return new u.A(n+Math.floor(.75*r),l+h);if(f===-y+t)return new u.A(n+Math.floor(.25*r),l+h);f>0&&f<t?(b=new u.A(n+Math.floor(.5*r),l-Math.floor(.5*h)),C=new u.A(n+Math.floor(1.25*r),l+h)):f>t&&f<y-t?(b=new u.A(n,l),C=new u.A(n+r,l)):f>y-t&&f<y?(b=new u.A(n-Math.floor(.25*r),l+h),C=new u.A(n+Math.floor(.5*r),l-Math.floor(.5*h))):f<0&&f>-t?(b=new u.A(n+Math.floor(.5*r),l+Math.floor(1.5*h)),C=new u.A(n+Math.floor(1.25*r),l)):f<-t&&f>-y+t?(b=new u.A(n,l+h),C=new u.A(n+r,l+h)):f<-y+t&&f>-y&&(b=new u.A(n-Math.floor(.25*r),l),C=new u.A(n+Math.floor(.5*r),l+Math.floor(1.5*h)))}v=(0,H.E$)(o,a,i.x,i.y,b.x,b.y,C.x,C.y)}return null==v?new u.A(o,a):v},ot=(t,e,i,s=!1)=>{const n=t.getCenterX(),l=t.getCenterY(),r=i.x-n,h=i.y-l,o=Math.atan2(h,r),a=new u.A(0,0),d=Math.PI,c=Math.PI/2-o,g=Math.atan2(t.height,t.width);return o<-d+g||o>d-g?(a.x=t.x,a.y=l-t.width*Math.tan(o)/2):o<-g?(a.y=t.y,a.x=n-t.height*Math.tan(c)/2):o<g?(a.x=t.x+t.width,a.y=l+t.width*Math.tan(o)/2):(a.y=t.y+t.height,a.x=n+t.height*Math.tan(c)/2),s&&(i.x>=t.x&&i.x<=t.x+t.width?a.x=i.x:i.y>=t.y&&i.y<=t.y+t.height&&(a.y=i.y),i.x<t.x?a.x=t.x:i.x>t.x+t.width&&(a.x=t.x+t.width),i.y<t.y?a.y=t.y:i.y>t.y+t.height&&(a.y=t.y+t.height)),a},at=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,r=t.width,h=t.height,o=n+r/2,a=l+h/2,d=i.x,c=i.y;if(o===d)return a>c?new u.A(o,l):new u.A(o,l+h);if(a===c)return o>d?new u.A(n,a):new u.A(n+r,a);let g=o,p=a;return s&&(d>=n&&d<=n+r?g=d:c>=l&&c<=l+h&&(p=c)),d<o?c<a?(0,H.E$)(d,c,g,p,o,l,n,a):(0,H.E$)(d,c,g,p,o,l+h,n,a):c<a?(0,H.E$)(d,c,g,p,o,l,n+r,a):(0,H.E$)(d,c,g,p,o,l+h,n+r,a)},dt=(t,e,i,s=!1)=>{const n=null!=e?e.style.direction:null,l="north"===n||"south"===n,{x:r}=t,{y:h}=t,o=t.width,a=t.height;let d=r+o/2,c=h+a/2,g=new u.A(r,h),p=new u.A(r+o,c),f=new u.A(r,h+a);"north"===n?(g=f,p=new u.A(d,h),f=new u.A(r+o,h+a)):"south"===n?(p=new u.A(d,h+a),f=new u.A(r+o,h)):"west"===n&&(g=new u.A(r+o,h),p=new u.A(r,c),f=new u.A(r+o,h+a));let y=i.x-d,m=i.y-c;const v=l?Math.atan2(y,m):Math.atan2(m,y),w=l?Math.atan2(o,a):Math.atan2(a,o);let x=!1;x="north"===n||"west"===n?v>-w&&v<w:v<-Math.PI+w||v>Math.PI-w;let b=null;if(x)b=s&&(l&&i.x>=g.x&&i.x<=f.x||!l&&i.y>=g.y&&i.y<=f.y)?l?new u.A(i.x,g.y):new u.A(g.x,i.y):"north"===n?new u.A(r+o/2+a*Math.tan(v)/2,h+a):"south"===n?new u.A(r+o/2-a*Math.tan(v)/2,h):"west"===n?new u.A(r+o,h+a/2+o*Math.tan(v)/2):new u.A(r,h+a/2-o*Math.tan(v)/2);else{if(s){const t=new u.A(d,c);i.y>=h&&i.y<=h+a?(t.x=l?d:"west"===n?r+o:r,t.y=i.y):i.x>=r&&i.x<=r+o&&(t.x=i.x,t.y=l?"north"===n?h+a:h:c),y=i.x-t.x,m=i.y-t.y,d=t.x,c=t.y}b=l&&i.x<=r+o/2||!l&&i.y<=h+a/2?(0,H.E$)(i.x,i.y,d,c,g.x,g.y,p.x,p.y):(0,H.E$)(i.x,i.y,d,c,p.x,p.y,f.x,f.y)}return null==b&&(b=new u.A(d,c)),b},ct=t=>"classic"===t||"classicThin"===t,gt=t=>"diamond"===t,ut=t=>(e,i,s,n,l,r,h,o,a,d)=>{const c=l*a*1.118,g=r*a*1.118;l*=h+a,r*=h+a;const u=n.clone();u.x-=c,u.y-=g;const p=ct(s)?3/4:1;return n.x+=-l*p-c,n.y+=-r*p-g,()=>{e.begin(),e.moveTo(u.x,u.y),e.lineTo(u.x-l-r/t,u.y-r+l/t),ct(s)&&e.lineTo(u.x-3*l/4,u.y-3*r/4),e.lineTo(u.x+r/t-l,u.y-r-l/t),e.close(),d?e.fillAndStroke():e.stroke()}},pt=t=>(e,i,s,n,l,r,h,o,a,d)=>{const c=l*a*1.118,g=r*a*1.118;l*=h+a,r*=h+a;const u=n.clone();return u.x-=c,u.y-=g,n.x+=2*-c,n.y+=2*-g,()=>{e.begin(),e.moveTo(u.x-l-r/t,u.y-r+l/t),e.lineTo(u.x,u.y),e.lineTo(u.x+r/t-l,u.y-r-l/t),e.stroke()}},ft=(t,e,i,s,n,l,r,h,o,a)=>{const d=r/2,c=s.clone();return s.x-=n*d,s.y-=l*d,()=>{t.ellipse(c.x-d,c.y-d,r,r),a?t.fillAndStroke():t.stroke()}},yt=(t,e,i,s,n,l,r,h,o,a)=>{const d=gt(i)?.7071:.9862,c=n*o*d,g=l*o*d;n*=r+o,l*=r+o;const u=s.clone();u.x-=c,u.y-=g,s.x+=-n-c,s.y+=-l-g;const p=gt(i)?2:3.4;return()=>{t.begin(),t.moveTo(u.x,u.y),t.lineTo(u.x-n/2-l/p,u.y+n/p-l/2),t.lineTo(u.x-n,u.y-l),t.lineTo(u.x-n/2+l/p,u.y-l/2-n/p),t.close(),a?t.fillAndStroke():t.stroke()}};var mt=i(8595),vt=i(1997),wt=i(9542);let xt=!1,bt=!1,Ct=!1;var St=i(4885);class At extends s.d{createCellRenderer(){return new l.A}createGraphDataModel(){return new r.A}createGraphView(){return new n.A(this)}createSelectionModel(){return new o.A(this)}createStylesheet(){return new h.n}registerDefaults(){(()=>{if(!Ct){const t=[["classic",ut(2)],["classicThin",ut(3)],["block",ut(2)],["blockThin",ut(3)],["open",pt(2)],["openThin",pt(3)],["oval",ft],["diamond",yt],["diamondThin",yt]];for(const[e,i]of t)vt.r.add(e,i);Ct=!0}})(),(()=>{if(!xt){const t=[["elbowEdgeStyle",W,{handlerKind:"elbow"}],["entityRelationEdgeStyle",Y.S,{}],["loopEdgeStyle",X.F,{handlerKind:"elbow",isOrthogonal:!1}],["manhattanEdgeStyle",lt,{handlerKind:"segment"}],["orthogonalEdgeStyle",nt,{handlerKind:"segment"}],["segmentEdgeStyle",J,{handlerKind:"segment"}],["sideToSideEdgeStyle",_,{handlerKind:"elbow"}],["topToBottomEdgeStyle",U,{handlerKind:"elbow"}]];for(const[e,i,s]of t)mt.O.add(e,i,{...s,isOrthogonal:s.isOrthogonal??!0});xt=!0}})(),(()=>{if(!bt){const t=[["ellipsePerimeter",rt],["hexagonPerimeter",ht],["rectanglePerimeter",ot],["rhombusPerimeter",at],["trianglePerimeter",dt]];for(const[e,i]of t)wt.h.add(e,i);bt=!0}})(),function(){if(!F){const t=[["actor",b],["arrow",P],["arrowConnector",D],["cloud",A],["connector",w.A],["cylinder",v],["doubleEllipse",V],["ellipse",c.A],["hexagon",S],["image",R.A],["label",z],["line",M],["rectangle",d.A],["rhombus",f],["swimlane",I],["triangle",C]];for(const[e,i]of t)a.x.add(e,i);F=!0}}()}initializeCollaborators(t){this.cellRenderer=this.createCellRenderer(),this.model=t?.model??this.createGraphDataModel(),this.setSelectionModel(this.createSelectionModel()),this.setStylesheet(t?.stylesheet??this.createStylesheet()),this.view=this.createGraphView()}constructor(t,e,i=(0,St.qG)(),s){super({container:t,model:e,plugins:i,stylesheet:s??void 0})}}},3618:(t,e,i)=>{i.d(e,{F:()=>l});var s=i(715),n=i(8302);const l=(t,e,i,l,r)=>{const h=t.absolutePoints,o=h[0],a=h[h.length-1];if(null==o||null==a){if(null!=e){const{view:i}=t,{graph:h}=i;let o=null!=l&&l.length>0?l[0]:null;null!=o&&(o=i.transformControlPoint(t,o),(0,n.gR)(e,o.x,o.y)&&(o=null));let a=0,d=0,c=0,g=0;const u=(t.style.segment??h.gridSize)*i.scale,p=t.style?.direction??"west";"north"===p||"south"===p?(a=i.getRoutingCenterX(e),d=u):(c=i.getRoutingCenterY(e),g=u),null==o||o.x<e.x||o.x>e.x+e.width?null!=o?(a=o.x,g=Math.max(Math.abs(c-o.y),g)):"north"===p?c=e.y-2*d:"south"===p?c=e.y+e.height+2*d:a="east"===p?e.x-2*g:e.x+e.width+2*g:null!==o&&(a=i.getRoutingCenterX(e),d=Math.max(Math.abs(a-o.x),g),c=o.y,g=0),r.push(new s.A(a-d,c-g)),r.push(new s.A(a+d,c+g))}}else if(null!=l&&l.length>0)for(let e=0;e<l.length;e+=1){let i=l[e];i=t.view.transformControlPoint(t,i),r.push(new s.A(i.x,i.y))}}},3675:(t,e,i)=>{i.d(e,{A:()=>d});var s=i(9214),n=i(6368),l=i(5197),r=i(124),h=i(9504),o=i(8302);class a extends s.A{constructor(t,e=n.Vj,i=n.G7,s=n.ir){super(),this.enabled=!0,this.hotspot=n.ir,this.hotspotEnabled=!1,this.currentColor=n.x3,this.validState=null,this.markedState=null,this.graph=t,this.validColor=e,this.invalidColor=i,this.hotspot=s,this.highlight=new l.A(t)}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}setHotspot(t){this.hotspot=t}getHotspot(){return this.hotspot}setHotspotEnabled(t){this.hotspotEnabled=t}isHotspotEnabled(){return this.hotspotEnabled}hasValidState(){return!!this.validState}getValidState(){return this.validState}getMarkedState(){return this.markedState}reset(){this.validState=null,this.markedState&&(this.markedState=null,this.unmark())}process(t){let e=null;return this.isEnabled()&&(e=this.getState(t),this.setCurrentState(e,t)),e}setCurrentState(t,e,i){const s=!!t&&this.isValidState(t);i=i??this.getMarkerColor(e.getEvent(),t,s),this.validState=s?t:null,t===this.markedState&&i===this.currentColor||(this.currentColor=i,t&&this.currentColor!==n.x3?(this.markedState=t,this.mark()):this.markedState&&(this.markedState=null,this.unmark()))}markCell(t,e){const i=this.graph.getView().getState(t);i&&(this.currentColor=e??this.validColor,this.markedState=i,this.mark())}mark(){this.highlight.setHighlightColor(this.currentColor),this.highlight.highlight(this.markedState),this.fireEvent(new r.A(h.A.MARK,"state",this.markedState))}unmark(){this.mark()}isValidState(t){return!0}getMarkerColor(t,e,i){return i?this.validColor:this.invalidColor}getState(t){const e=this.graph.getView(),i=this.getCell(t);if(!i)return null;const s=this.getStateToMark(e.getState(i));return s&&this.intersects(s,t)?s:null}getCell(t){return t.getCell()}getStateToMark(t){return t}intersects(t,e){const i=e.getGraphX(),s=e.getGraphY();return!this.hotspotEnabled||(0,o.KP)(t,i,s,this.hotspot,n.vd,n.DK)}destroy(){this.highlight.destroy()}}const d=a},4186:(t,e,i)=>{i.d(e,{A:()=>A});var s=i(1613),n=i(8520),l=i(8053),r=i(3355),h=i(6368),o=i(8302),a=i(7895),d=i(9827),c=i(9760),g=i(7208);const u=new(i(5964).H);var p=i(9504),f=i(3161),y=i(2548),m=i(124),v=i(715),w=i(5491),x=i(4344),b=i(8872);const C=["inherit","swimlane","indicated"],S=["fillColor","strokeColor","gradientColor","fontColor"],A=class{constructor(){this.defaultEdgeShape=n.A,this.defaultVertexShape=s.A,this.defaultTextShape=r.A,this.legacyControlPosition=!0,this.legacySpacing=!0,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.forceControlClickHandler=!1}initializeShape(t){t.shape&&(t.shape.dialect=t.view.graph.dialect,this.configureShape(t),t.shape.init(t.view.getDrawPane()))}createShape(t){const e=u.get(t.style.shape);return e?new w.A(e):new(this.getShapeConstructor(t))}createIndicatorShape(t){t.shape&&(t.shape.indicatorShape=this.getShape(t.getIndicatorShape()))}getShape(t){return g.x.get(t)}getShapeConstructor(t){let e=this.getShape(t.style.shape);return e||(e=t.cell.isEdge()?this.defaultEdgeShape:this.defaultVertexShape),e}configureShape(t){const e=t.shape;e&&(e.apply(t),e.imageSrc=t.getImageSrc()||null,e.indicatorColor=t.getIndicatorColor()||h.x3,e.indicatorStrokeColor=t.style.indicatorStrokeColor||h.x3,e.indicatorGradientColor=t.getIndicatorGradientColor()||h.x3,t.style.indicatorDirection&&(e.indicatorDirection=t.style.indicatorDirection),e.indicatorImageSrc=t.getIndicatorImageSrc()||null,this.postConfigureShape(t))}postConfigureShape(t){t.shape&&(this.resolveColor(t,"indicatorGradientColor","gradientColor"),this.resolveColor(t,"indicatorColor","fillColor"),this.resolveColor(t,"gradient","gradientColor"),this.resolveColor(t,"stroke","strokeColor"),this.resolveColor(t,"fill","fillColor"))}checkPlaceholderStyles(t){for(const e of S)if(C.includes(t.style[e]))return!0;return!1}resolveColor(t,e,i){const s="fontColor"===i?t.text:t.shape;if(s){const n=t.view.graph,l=s[e];let r=null;if("inherit"===l?r=t.cell.getParent():"swimlane"===l?(s[e]="strokeColor"===i||"fontColor"===i?"#000000":"#ffffff",r=t.cell.getTerminal(!1)?t.cell.getTerminal(!1):t.cell,r=n.getSwimlane(r),i=n.swimlaneIndicatorColorAttribute):"indicated"===l&&t.shape?s[e]=t.shape.indicatorColor:"fillColor"!==i&&"fillColor"===l&&t.shape?s[e]=t.style.fillColor:"strokeColor"!==i&&"strokeColor"===l&&t.shape&&(s[e]=t.style.strokeColor),r){const t=n.getView().getState(r);if(s[e]=null,t){const n="fontColor"===i?t.text:t.shape;s[e]=n&&"indicatorColor"!==e?n[e]:t.style[i]}}}}getLabelValue(t){return t.view.graph.getLabel(t.cell)}createLabel(t,e){const i=t.view.graph;if((t.style.fontSize||0)>0||null==t.style.fontSize){const s=i.isHtmlLabel(t.cell)||(0,b.Ll)(e);t.text=new this.defaultTextShape(e,new c.A,t.style.align??"center",t.getVerticalAlign(),t.style.fontColor,t.style.fontFamily,t.style.fontSize,t.style.fontStyle,t.style.spacing,t.style.spacingTop,t.style.spacingRight,t.style.spacingBottom,t.style.spacingLeft,t.style.horizontal,t.style.labelBackgroundColor,t.style.labelBorderColor,i.isWrapping(t.cell)&&i.isHtmlLabel(t.cell),i.isLabelClipped(t.cell),t.style.overflow,t.style.labelPadding,t.style.textDirection??h.Sr),t.text.opacity=t.style.textOpacity??100,t.text.dialect=s?"strictHtml":i.dialect,t.text.style=t.style,t.text.state=t,this.initializeLabel(t,t.text);let n=!1;const l=e=>{let s=t;if(f.A.IS_TOUCH||n){const t=(0,x.El)(e),n=(0,x.xJ)(e),l=(0,a.ce)(i.container,t,n);s=i.view.getState(i.getCellAt(l.x,l.y))}return s};p.A.addGestureListeners(t.text.node,e=>{if(this.isLabelEvent(t,e)){i.fireMouseEvent(p.A.MOUSE_DOWN,new y.A(e,t));const s=(0,x.el)(e);n="svg"!==i.dialect&&"IMG"===s.nodeName}},e=>{this.isLabelEvent(t,e)&&i.fireMouseEvent(p.A.MOUSE_MOVE,new y.A(e,l(e)))},e=>{this.isLabelEvent(t,e)&&(i.fireMouseEvent(p.A.MOUSE_UP,new y.A(e,l(e))),n=!1)}),i.isNativeDblClickEnabled()&&p.A.addListener(t.text.node,"dblclick",e=>{this.isLabelEvent(t,e)&&(i.dblClick(e,t.cell),p.A.consume(e))})}}initializeLabel(t,e){if(f.A.IS_SVG&&f.A.NO_FO&&"svg"!==e.dialect){const i=t.view.graph;e.init(i.container)}else e.init(t.view.getDrawPane())}createCellOverlays(t){const e=t.view.graph,i=e.getCellOverlays(t.cell),s=new Map;for(const n of i){const i=t.overlays.get(n);if(t.overlays.delete(n),i){s.set(n,i);continue}const l=this.createOverlayShape(t,n);l.dialect=e.dialect,l.overlay=n,this.initializeOverlay(t,l),this.installCellOverlayListeners(t,n,l),this.configureOverlayShape(t,n,l),s.set(n,l)}t.overlays.forEach(t=>{t.destroy()}),t.overlays=s}createOverlayShape(t,e){const i=new l.A(new c.A,e.image.src);return i.preserveImageAspect=!1,i}initializeOverlay(t,e){e.init(t.view.getOverlayPane())}installCellOverlayListeners(t,e,i){const s=t.view.graph;p.A.addListener(i.node,"click",i=>{s.isEditing()&&s.stopEditing(!s.isInvokesStopCellEditing()),e.fireEvent(new m.A(p.A.CLICK,{event:i,cell:t.cell}))}),p.A.addGestureListeners(i.node,t=>{p.A.consume(t)},e=>{s.fireMouseEvent(p.A.MOUSE_MOVE,new y.A(e,t))}),f.A.IS_TOUCH&&p.A.addListener(i.node,"touchend",i=>{e.fireEvent(new m.A(p.A.CLICK,{event:i,cell:t.cell}))})}configureOverlayShape(t,e,i){e.cursor&&(i.node.style.cursor=e.cursor)}createControl(t){const e=t.view.graph,i=e.getFoldingImage(t);if(e.isFoldingEnabled()&&i){if(!t.control){const s=new c.A(0,0,i.width,i.height);t.control=new l.A(s,i.src),t.control.preserveImageAspect=!1,t.control.dialect=e.dialect,this.initControl(t,t.control,!0,this.createControlClickHandler(t))}}else t.control&&(t.control.destroy(),t.control=null)}createControlClickHandler(t){const e=t.view.graph;return i=>{if(this.forceControlClickHandler||e.isEnabled()){const s=!t.cell.isCollapsed();e.foldCells(s,!1,[t.cell],!1,i),p.A.consume(i)}}}initControl(t,e,i,s){const n=t.view.graph;n.isHtmlLabel(t.cell)&&f.A.NO_FO&&"svg"===n.dialect?(e.dialect="preferHtml",e.init(n.container),e.node.style.zIndex=String(1)):e.init(t.view.getOverlayPane());const l=e.node;if(s&&!f.A.IS_IOS&&(n.isEnabled()&&(l.style.cursor="pointer"),p.A.addListener(l,"click",s)),i){let e=null;p.A.addGestureListeners(l,i=>{e=new v.A((0,x.El)(i),(0,x.xJ)(i)),n.fireMouseEvent(p.A.MOUSE_DOWN,new y.A(i,t)),p.A.consume(i)},e=>{n.fireMouseEvent(p.A.MOUSE_MOVE,new y.A(e,t))},e=>{n.fireMouseEvent(p.A.MOUSE_UP,new y.A(e,t)),p.A.consume(e)}),s&&f.A.IS_IOS&&l.addEventListener("touchend",t=>{if(e){const i=n.getEventTolerance();Math.abs(e.x-(0,x.El)(t))<i&&Math.abs(e.y-(0,x.xJ)(t))<i&&(s.call(s,t),p.A.consume(t))}},!0)}return l}isShapeEvent(t,e){return!0}isLabelEvent(t,e){return!0}installListeners(t){const e=t.view.graph,i=i=>{let s=t;const n=(0,x.el)(i);if(n&&"svg"!==e.dialect&&"IMG"===n.nodeName||f.A.IS_TOUCH){const t=(0,x.El)(i),n=(0,x.xJ)(i),l=(0,a.ce)(e.container,t,n),r=e.getCellAt(l.x,l.y);s=r?e.view.getState(r):null}return s};t.shape&&(p.A.addGestureListeners(t.shape.node,i=>{this.isShapeEvent(t,i)&&e.fireMouseEvent(p.A.MOUSE_DOWN,new y.A(i,t))},s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(p.A.MOUSE_MOVE,new y.A(s,i(s)))},s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(p.A.MOUSE_UP,new y.A(s,i(s)))}),e.isNativeDblClickEnabled()&&p.A.addListener(t.shape.node,"dblclick",i=>{this.isShapeEvent(t,i)&&(e.dblClick(i,t.cell),p.A.consume(i))}))}redrawLabel(t,e){const i=t.view.graph,s=this.getLabelValue(t),n=i.isWrapping(t.cell),l=i.isLabelClipped(t.cell),r=i.isHtmlLabel(t.cell)||s&&(0,b.Ll)(s)?"strictHtml":i.dialect,h=t.style.overflow??"visible";if(!t.text||t.text.wrap===n&&t.text.clipped===l&&t.text.overflow===h&&t.text.dialect===r||(t.text.destroy(),t.text=null),null==t.text&&null!=s&&((0,b.Ll)(s)||s.length>0)?this.createLabel(t,s):null==t.text||null!=s&&0!=s.length||(t.text.destroy(),t.text=null),null!=t.text){e&&(null!=t.text.lastValue&&this.isTextShapeInvalid(t,t.text)&&(t.text.lastValue=null),t.text.resetStyles(),t.text.apply(t),t.text.valign=t.getVerticalAlign());const i=this.getLabelBounds(t),o=this.getTextScale(t);if(this.resolveColor(t,"color","fontColor"),e||t.text.value!==s||t.text.wrap!==n||t.text.overflow!==h||t.text.clipped!==l||t.text.scale!==o||t.text.dialect!==r||null==t.text.bounds||!t.text.bounds.equals(i)){t.text.dialect=r,t.text.value=s,t.text.bounds=i,t.text.scale=o,t.text.wrap=n,t.text.clipped=l,t.text.overflow=h;const e=t.text.node.style.visibility;this.redrawLabelShape(t.text),t.text.node.style.visibility=e}}}isTextShapeInvalid(t,e){function i(i,s,n){let l=!1;return l="spacingTop"===s||"spacingRight"===s||"spacingBottom"===s||"spacingLeft"===s?parseFloat(String(e[i]))-parseFloat(String(e.spacing))!==(t.style[s]||n):e[i]!==(t.style[s]||n),l}return i("fontStyle","fontStyle",h.fm)||i("family","fontFamily",h.CT)||i("size","fontSize",h.FV)||i("color","fontColor","black")||i("align","align","")||i("valign","verticalAlign","")||i("spacing","spacing",2)||i("spacingTop","spacingTop",0)||i("spacingRight","spacingRight",0)||i("spacingBottom","spacingBottom",0)||i("spacingLeft","spacingLeft",0)||i("horizontal","horizontal",!0)||i("background","labelBackgroundColor",null)||i("border","labelBorderColor",null)||i("opacity","textOpacity",100)||i("textDirection","textDirection",h.Sr)}redrawLabelShape(t){t.redraw()}getTextScale(t){return t.view.scale}getLabelBounds(t){const{scale:e}=t.view,i=t.cell.isEdge();let s=new c.A(t.absoluteOffset.x,t.absoluteOffset.y);if(i){const i=t.text.getSpacing();s.x+=i.x*e,s.y+=i.y*e;const n=t.cell.getGeometry();null!=n&&(s.width=Math.max(0,n.width*e),s.height=Math.max(0,n.height*e))}else{if(t.text.isPaintBoundsInverted()){const t=s.x;s.x=s.y,s.y=t}s.x+=t.x,s.y+=t.y,s.width=Math.max(1,t.width),s.height=Math.max(1,t.height)}if(t.text.isPaintBoundsInverted()){const e=(t.width-t.height)/2;s.x+=e,s.y-=e;const i=s.width;s.width=s.height,s.height=i}if(null!=t.shape){const e=t.style.labelPosition??"center",i=t.style.verticalLabelPosition??"middle";"center"===e&&"middle"===i&&(s=t.shape.getLabelBounds(s))}const n=t.style.labelWidth??null;return null!=n&&(s.width=n*e),i||this.rotateLabelBounds(t,s),s}rotateLabelBounds(t,e){const i=t.text;if(e.y-=i.margin.y*e.height,e.x-=i.margin.x*e.width,!this.legacySpacing||"fill"!==t.style.overflow&&"width"!==t.style.overflow){const s=t.view.scale,n=i.getSpacing();e.x+=n.x*s,e.y+=n.y*s;const l=t.style.labelPosition??"center",r=t.style.verticalLabelPosition??"middle",h=t.style.labelWidth??null;e.width=Math.max(0,e.width-("center"===l&&null==h?i.spacingLeft*s+i.spacingRight*s:0)),e.height=Math.max(0,e.height-("middle"===r?i.spacingTop*s+i.spacingBottom*s:0))}const s=i.getTextRotation();if(0!==s&&null!=t&&t.cell.isVertex()){const i=t.getCenterX(),n=t.getCenterY();if(e.x!==i||e.y!==n){const t=s*(Math.PI/180),l=(0,o.Iq)(new v.A(e.x,e.y),Math.cos(t),Math.sin(t),new v.A(i,n));e.x=l.x,e.y=l.y}}}redrawCellOverlays(t,e=!1){if(this.createCellOverlays(t),t.overlays){const i=(0,o.zi)(t.style.rotation??0,90),s=(0,o.eh)(i),n=Math.cos(s),l=Math.sin(s);t.overlays.forEach(s=>{const r=s.overlay?.getBounds(t)??null;if(r&&!t.cell.isEdge()&&t.shape&&0!==i){let e=r.getCenterX(),i=r.getCenterY();const s=(0,o.Iq)(new v.A(e,i),n,l,new v.A(t.getCenterX(),t.getCenterY()));e=s.x,i=s.y,r.x=Math.round(e-r.width/2),r.y=Math.round(i-r.height/2)}!e&&null!=s.bounds&&s.scale===t.view.scale&&s.bounds.equals(r)||(s.bounds=r,s.scale=t.view.scale,s.redraw())})}}redrawControl(t,e=!1){const i=t.view.graph.getFoldingImage(t);if(null!=t.control&&null!=i){const s=this.getControlBounds(t,i.width,i.height),n=this.legacyControlPosition?t.style.rotation??0:t.shape.getTextRotation(),l=t.view.scale;!e&&t.control.scale===l&&t.control.bounds.equals(s)&&t.control.rotation===n||(t.control.rotation=n,t.control.bounds=s,t.control.scale=l,t.control.redraw())}}getControlBounds(t,e,i){if(null!=t.control){const s=t.view.scale;let n=t.getCenterX(),l=t.getCenterY();if(!t.cell.isEdge()&&(n=t.x+e*s,l=t.y+i*s,null!=t.shape)){let e=t.shape.getShapeRotation();if(this.legacyControlPosition)e=t.style.rotation??0;else if(t.shape.isPaintBoundsInverted()){const e=(t.width-t.height)/2;n+=e,l-=e}if(0!==e){const i=(0,o.eh)(e),s=Math.cos(i),r=Math.sin(i),h=(0,o.Iq)(new v.A(n,l),s,r,new v.A(t.getCenterX(),t.getCenterY()));n=h.x,l=h.y}}return t.cell.isEdge(),new c.A(Math.round(n-e/2*s),Math.round(l-i/2*s),Math.round(e*s),Math.round(i*s))}return null}insertStateAfter(t,e,i){const s=t.view.graph,n=this.getShapesForState(t);for(let l=0;l<n.length;l+=1)if(null!=n[l]&&null!=n[l].node){const r=n[l].node.parentNode!==t.view.getDrawPane()&&n[l].node.parentNode!==t.view.getOverlayPane(),h=r?i:e;if(null!=h&&h.nextSibling!==n[l].node)null==h.nextSibling?h.parentNode.appendChild(n[l].node):h.parentNode.insertBefore(n[l].node,h.nextSibling);else if(null==h){const e=n[l].node;if(e.parentNode===s.container){let{canvas:i}=t.view;for(;null!=i&&i.parentNode!==s.container;)i=i.parentNode;null!=i&&null!=i.nextSibling?i.nextSibling!==e&&e.parentNode.insertBefore(e,i.nextSibling):e.parentNode.appendChild(e)}else null!=e.parentNode&&null!=e.parentNode.firstChild&&e.parentNode.firstChild!=e&&e.parentNode.insertBefore(e,e.parentNode.firstChild)}r?i=n[l].node:e=n[l].node}return[e,i]}getShapesForState(t){return[t.shape,t.text,t.control]}redraw(t,e=!1,i=!0){const s=this.redrawShape(t,e,i);null!=t.shape&&i&&(this.redrawLabel(t,s),this.redrawCellOverlays(t,s),this.redrawControl(t,s))}redrawShape(t,e=!1,i=!0){let s=!1;const n=t.view.graph;null!=t.shape&&null!=t.shape.style&&null!=t.style&&t.shape.style.shape!==t.style.shape&&(t.shape.destroy(),t.shape=null);const l=n.getPlugin("SelectionCellsHandler");return null==t.shape&&null!=n.container&&t.cell!==t.view.currentRoot&&(t.cell.isVertex()||t.cell.isEdge())?(t.shape=this.createShape(t),null!=t.shape&&(t.shape.minSvgStrokeWidth=this.minSvgStrokeWidth,t.shape.antiAlias=this.antiAlias,this.createIndicatorShape(t),this.initializeShape(t),this.createCellOverlays(t),this.installListeners(t),l?.updateHandler(t))):e||null==t.shape||(0,d.FG)(t.shape.style,t.style)&&!this.checkPlaceholderStyles(t)||(t.shape.resetStyles(),this.configureShape(t),l?.updateHandler(t),e=!0),null!=t.shape&&t.shape.indicatorShape!=this.getShape(t.getIndicatorShape())&&(null!=t.shape.indicator&&(t.shape.indicator.destroy(),t.shape.indicator=null),this.createIndicatorShape(t),null!=t.shape.indicatorShape&&(t.shape.indicator=new t.shape.indicatorShape,t.shape.indicator.dialect=t.shape.dialect,t.shape.indicator.init(t.node),e=!0)),t.shape&&(this.createControl(t),(e||this.isShapeInvalid(t,t.shape))&&(t.absolutePoints.length>0?(t.shape.points=t.absolutePoints.slice(),t.shape.bounds=null):(t.shape.points=[],t.shape.bounds=new c.A(t.x,t.y,t.width,t.height)),t.shape.scale=t.view.scale,null==i||i?this.doRedrawShape(t):t.shape.updateBoundingBox(),s=!0)),s}doRedrawShape(t){t.shape?.redraw()}isShapeInvalid(t,e){return null==e.bounds||e.scale!==t.view.scale||0===t.absolutePoints.length&&!e.bounds.equals(t)||t.absolutePoints.length>0&&!(0,d.s7)(e.points,t.absolutePoints)}destroy(t){t.shape&&(t.text&&(t.text.destroy(),t.text=null),t.overlays.forEach(t=>{t.destroy()}),t.overlays=new Map,t.control&&(t.control.destroy(),t.control=null),t.shape.destroy(),t.shape=null)}}},4329:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{GP:()=>doEval,bW:()=>matchBinaryMask,rU:()=>mixInto,uy:()=>isNullish,vq:()=>isElement});var _util_Constants_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6368),_util_config_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(914);const doEval=expression=>eval(expression),isElement=t=>t?.nodeType===_util_Constants_js__WEBPACK_IMPORTED_MODULE_0__.Qu.ELEMENT,isNullish=t=>null==t,mixInto=t=>e=>{const i=Reflect.ownKeys(e);try{for(const s of i)Object.defineProperty(t.prototype,s,{value:e[s],writable:!0})}catch(t){_util_config_js__WEBPACK_IMPORTED_MODULE_1__.eo.logger.error("Error while mixing",t)}},matchBinaryMask=(t,e)=>(t&e)===e},4344:(t,e,i)=>{i.d(e,{$Y:()=>p,CA:()=>y,DO:()=>c,El:()=>l,Er:()=>g,Lg:()=>u,M4:()=>n,RT:()=>f,UT:()=>v,el:()=>h,ew:()=>d,fm:()=>o,kH:()=>a,qt:()=>m,xJ:()=>r});var s=i(3161);const n=t=>{let e=t;return("touchstart"===e.type||"touchmove"===e.type)&&e.touches&&e.touches[0]?e=e.touches[0]:"touchend"===e.type&&e.changedTouches&&e.changedTouches[0]&&(e=e.changedTouches[0]),e},l=t=>n(t).clientX,r=t=>n(t).clientY,h=t=>t.target,o=t=>{const e=t;return void 0!==e.isConsumed&&e.isConsumed},a=t=>{const e=t;return e.pointerType?"touch"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH:void 0!==e.mozInputSource?5===e.mozInputSource:0===e.type.indexOf("touch")},d=t=>{const e=t;return e.pointerType?"pen"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_PEN:void 0!==e.mozInputSource?2===e.mozInputSource:0===e.type.indexOf("pen")},c=t=>{const e=t;return e.type&&0==e.type.indexOf("touch")&&void 0!==e.touches&&e.touches.length>1},g=t=>{const e=t;return e.pointerType?"mouse"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE:void 0!==e.mozInputSource?1===e.mozInputSource:0===e.type.indexOf("mouse")},u=t=>!("buttons"in t)||"mousedown"!==t.type&&"mousemove"!==t.type?void 0!==t.which?1===t.which:1===t.button:1===t.buttons,p=t=>(t=>2===t.button)(t)||s.A.IS_MAC&&m(t)&&!f(t)&&!v(t)&&!y(t),f=t=>t.shiftKey,y=t=>t.altKey,m=t=>t.ctrlKey,v=t=>t.metaKey},4402:(t,e,i)=>{i.d(e,{T:()=>l,m:()=>n});var s=i(914);function n(){return s.eo.i18n.isEnabled()}function l(t,e,i){return s.eo.i18n.get(t,e,i)}},4699:(t,e,i)=>{i.d(e,{Bq:()=>n,K7:()=>r,bG:()=>h,qQ:()=>l});const s=(t,e="\\s")=>null!=t?t.replace(new RegExp(`^[${e}]+`,"g"),""):null,n=(t,e)=>s(((t,e="\\s")=>null!=t?t.replace(new RegExp(`[${e}]+$`,"g"),""):null)(t,e),e),l=t=>{let e=null;if(null!=t)if(null!=t.name)e=t.name;else if(e=n(t.toString()),null!==e&&/^function\s/.test(e)&&(e=s(e.substring(9)),null!==e)){const t=e.indexOf("(");t>0&&(e=e.substring(0,t))}return e},r=(t,e)=>{let i="";for(;t.length>0&&"\n"==t.charAt(t.length-1);)t=t.substring(0,t.length-1),i+=e;return t+i},h=(t,e=!0)=>(t=(t=(t=(t=(t=(t=String(t||"")).replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#39;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e&&(t=t.replace(/\n/g,"&#xa;")),t)},4885:(t,e,i)=>{i.d(e,{qG:()=>q});var s=i(7895),n=i(9760),l=i(9504),r=i(3161),h=i(6368),o=i(3355),a=i(8872),d=i(4699),c=i(4344),g=i(4329);class u{constructor(t){this.clearOnChange=!1,this.bounds=null,this.resizeThread=null,this.textDirection=null,this.textarea=null,this.editingCell=null,this.trigger=null,this.modified=!1,this.autoSize=!0,this.selectText=!0,this.emptyLabelText=r.A.IS_FF?"<br>":"",this.escapeCancelsEditing=!0,this.textNode=null,this.zIndex=5,this.minResize=new n.A(0,20),this.wordWrapPadding=0,this.blurEnabled=!1,this.initialValue=null,this.align=null,this.graph=t,this.zoomHandler=()=>{this.graph.isEditing()&&this.resize()},this.changeHandler=t=>{this.editingCell&&!this.graph.getView().getState(this.editingCell,!1)&&this.stopEditing(!0)},this.graph.getView().addListener(l.A.SCALE,this.zoomHandler),this.graph.getView().addListener(l.A.SCALE_AND_TRANSLATE,this.zoomHandler),this.graph.getDataModel().addListener(l.A.CHANGE,this.changeHandler)}init(){this.textarea=document.createElement("div"),this.textarea.className="mxCellEditor mxPlainTextEditor",this.textarea.contentEditable=String(!0),r.A.IS_GC&&(this.textarea.style.minHeight="1em"),this.textarea.style.position="absolute",this.installListeners(this.textarea)}applyValue(t,e){this.graph.labelChanged(t.cell,e,this.trigger)}setAlign(t){this.textarea&&(this.textarea.style.textAlign=t),this.align=t,this.resize()}getInitialValue(t,e){let i=(0,d.bG)(this.graph.getEditingValue(t.cell,e),!1);return i=(0,d.K7)(i,"<div><br></div>"),i.replace(/\n/g,"<br>")}getCurrentValue(t){return this.textarea?(0,a.uq)(Array.from(this.textarea.childNodes)):null}isCancelEditingKeyEvent(t){return this.escapeCancelsEditing||(0,c.RT)(t)||(0,c.qt)(t)||(0,c.UT)(t)}installListeners(t){l.A.addListener(t,"dragstart",t=>{this.graph.stopEditing(!1),l.A.consume(t)}),l.A.addListener(t,"blur",t=>{this.blurEnabled&&this.focusLost()}),l.A.addListener(t,"keydown",t=>{(0,c.fm)(t)||(this.isStopEditingEvent(t)?(this.graph.stopEditing(!1),l.A.consume(t)):27===t.keyCode&&(this.graph.stopEditing(this.isCancelEditingKeyEvent(t)),l.A.consume(t)))});const e=e=>{null!=this.editingCell&&this.clearOnChange&&t.innerHTML===this.getEmptyLabelText()&&(!r.A.IS_FF||8!==e.keyCode&&46!==e.keyCode)&&(this.clearOnChange=!1,t.innerHTML="")};l.A.addListener(t,"keypress",e),l.A.addListener(t,"paste",e);const i=t=>{if(null!=this.editingCell){const t=this.textarea;0===t.innerHTML.length||"<br>"===t.innerHTML?(t.innerHTML=this.getEmptyLabelText(),this.clearOnChange=t.innerHTML.length>0):this.clearOnChange=!1}};l.A.addListener(t,"input",i),l.A.addListener(t,"cut",i),l.A.addListener(t,"paste",i);const s=t=>{null!=this.editingCell&&this.autoSize&&!(0,c.fm)(t)&&(null!=this.resizeThread&&window.clearTimeout(this.resizeThread),this.resizeThread=window.setTimeout(()=>{this.resizeThread=null,this.resize()},0))};l.A.addListener(t,"input",s),l.A.addListener(window,"resize",s),l.A.addListener(t,"cut",s),l.A.addListener(t,"paste",s)}isStopEditingEvent(t){return 113===t.keyCode||this.graph.isEnterStopsCellEditing()&&13===t.keyCode&&!(0,c.qt)(t)&&!(0,c.RT)(t)}isEventSource(t){return(0,c.el)(t)===this.textarea}resize(){const t=this.editingCell?this.graph.getView().getState(this.editingCell):null;if(t){if(null!=this.textarea){const e=t.cell.isEdge(),{scale:i}=this.graph.getView();let l=null;if(this.autoSize&&"fill"!==t.style.overflow){const r=t.style.labelWidth??null;if(l=null!=t.text&&null==this.align?t.text.margin:null,null==l&&(l=(0,s.oM)(this.align??t.style.align??"center",t.style.verticalAlign??"middle")),e){if(this.bounds=new n.A(t.absoluteOffset.x,t.absoluteOffset.y,0,0),null!=r){const t=(r+2)*i;this.bounds.width=t,this.bounds.x+=l.x*t}}else{let e=n.A.fromRectangle(t),s=t.style.labelPosition??"center",l=t.style.verticalLabelPosition??"middle";if(e=null!=t.shape&&"center"===s&&"middle"===l?t.shape.getLabelBounds(e):e,null!=r&&(e.width=r*i),!t.view.graph.cellRenderer.legacySpacing||"width"!==t.style.overflow){const h=new o.A,a=(t.style.spacing??2)*i,d=((t.style.spacingTop??0)+h.baseSpacingTop)*i+a,c=((t.style.spacingRight??0)+h.baseSpacingRight)*i+a,g=((t.style.spacingBottom??0)+h.baseSpacingBottom)*i+a,u=((t.style.spacingLeft??0)+h.baseSpacingLeft)*i+a;s=null!=t.style.labelPosition?t.style.labelPosition:"center",l=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle",e=new n.A(e.x+u,e.y+d,e.width-("center"===s&&null==r?u+c:0),e.height-("middle"===l?d+g:0))}this.bounds=new n.A(e.x+t.absoluteOffset.x,e.y+t.absoluteOffset.y,e.width,e.height)}if(this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()){this.textarea.style.wordWrap=h.Cx,this.textarea.style.whiteSpace="normal";const t=Math.round(this.bounds.width/i)+this.wordWrapPadding;"relative"!==this.textarea.style.position?(this.textarea.style.width=`${t}px`,this.textarea.scrollWidth>t&&(this.textarea.style.width=`${this.textarea.scrollWidth}px`)):this.textarea.style.maxWidth=`${t}px`}else this.textarea.style.whiteSpace="nowrap",this.textarea.style.width="";this.textarea.scrollWidth,this.textarea.scrollHeight,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x-l.x*(this.bounds.width-2))+1)}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y-l.y*(this.bounds.height-4)+(-1===l.y?3:0))+1)}px`}else this.bounds=this.getEditorBounds(t),this.textarea.style.width=`${Math.round(this.bounds.width/i)}px`,this.textarea.style.height=`${Math.round(this.bounds.height/i)}px`,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x+1))}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y+1))}px`,this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()?(this.textarea.style.wordWrap=h.Cx,this.textarea.style.whiteSpace="normal","fill"!==t.style.overflow&&(this.textarea.style.width=`${Math.round(this.bounds.width/i)+this.wordWrapPadding}px`)):(this.textarea.style.whiteSpace="nowrap","fill"!==t.style.overflow&&(this.textarea.style.width=""));(0,s.FR)(this.textarea.style,"transformOrigin","0px 0px"),(0,s.FR)(this.textarea.style,"transform",`scale(${i},${i})${null==l?"":` translate(${100*l.x}%,${100*l.y}%)`}`)}}else this.stopEditing(!0)}focusLost(){this.stopEditing(!this.graph.isInvokesStopCellEditing())}getBackgroundColor(t){return h.x3}startEditing(t,e=null){this.stopEditing(!0),this.align=null,null==this.textarea&&this.init();const i=this.graph.getPlugin("TooltipHandler");i?.hideTooltip();const s=this.graph.getView().getState(t);if(s){const i=s.style,n=i.fontSize??h.FV,l=i.fontFamily??h.CT,r=i.fontColor??"black",o=i.align??"left",d=i.fontStyle??0,c=(0,g.bW)(d,h.hv.BOLD),u=(0,g.bW)(d,h.hv.ITALIC),p=[];(0,g.bW)(d,h.hv.UNDERLINE)&&p.push("underline"),(0,g.bW)(d,h.hv.STRIKETHROUGH)&&p.push("line-through");const f=this.textarea,y=f.style;y.lineHeight=h.Fb?`${Math.round(n*h.$g)}px`:String(h.$g),y.backgroundColor=this.getBackgroundColor(s)||"transparent",y.textDecoration=p.join(" "),y.fontWeight=c?"bold":"normal",y.fontStyle=u?"italic":"",y.fontSize=`${Math.round(n)}px`,y.zIndex=String(this.zIndex),y.fontFamily=l,y.textAlign=o,y.outline="none",y.color=r;let m=this.textDirection=i.textDirection??h.Sr;const v=s.text;"auto"===m&&(null===v||"strictHtml"===v.dialect||(0,a.Ll)(v.value)||(m=v.getAutoDirection())),"ltr"===m||"rtl"===m?f.setAttribute("dir",m):f.removeAttribute("dir"),f.innerHTML=this.getInitialValue(s,e)||"",this.initialValue=f.innerHTML,0===f.innerHTML.length||"<br>"===f.innerHTML?(f.innerHTML=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=f.innerHTML===this.getEmptyLabelText(),this.graph.container.appendChild(f),this.editingCell=t,this.trigger=e,this.textNode=null,null!==v&&this.isHideLabel(s)&&(this.textNode=v.node,this.textNode.style.visibility="hidden"),this.autoSize&&(s.cell.isEdge()||"fill"!==i.overflow)&&window.setTimeout(()=>{this.resize()},0),this.resize();try{f.focus(),this.isSelectText()&&f.innerHTML.length>0&&(f.innerHTML!==this.getEmptyLabelText()||!this.clearOnChange)&&document.execCommand("selectAll",!1)}catch(t){}}}isSelectText(){return this.selectText}stopEditing(t=!1){if(this.editingCell){this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null);const e=t?null:this.graph.view.getState(this.editingCell),i=this.textarea,s=this.initialValue;if(this.initialValue=null,this.editingCell=null,this.bounds=null,i.blur(),(0,a.wr)(),i.parentNode&&i.parentNode.removeChild(i),this.clearOnChange&&i.innerHTML===this.getEmptyLabelText()&&(i.innerHTML="",this.clearOnChange=!1),e&&(i.innerHTML!==s||null!==this.align)){this.prepareTextarea();const t=this.getCurrentValue(e);this.graph.batchUpdate(()=>{null!==t&&this.applyValue(e,t),null!==this.align&&this.graph.setCellStyles("align",this.align,[e.cell])})}this.trigger=null,this.textarea&&l.A.release(this.textarea),this.textarea=null,this.align=null}}prepareTextarea(){const t=this.textarea;t.lastChild&&"BR"===t.lastChild.nodeName&&t.removeChild(t.lastChild)}isHideLabel(t=null){return!0}getMinimumSize(t){const{scale:e}=this.graph.getView(),i=this.textarea;return new n.A(0,0,null===t.text?30:t.text.size*e+20,"left"===i.style.textAlign?120:40)}getEditorBounds(t){const e=t.cell.isEdge(),{scale:i}=this.graph.getView(),s=this.getMinimumSize(t),l=s.width,r=s.height;let h=null;if(!e&&t.view.graph.cellRenderer.legacySpacing&&"fill"===t.style.overflow)h=t.shape.getLabelBounds(n.A.fromRectangle(t));else{const s=new o.A,a=(t.style.spacing??0)*i,d=((t.style.spacingTop??0)+s.baseSpacingTop)*i+a,c=((t.style.spacingRight??0)+s.baseSpacingRight)*i+a,g=((t.style.spacingBottom??0)+s.baseSpacingBottom)*i+a,u=((t.style.spacingLeft??0)+s.baseSpacingLeft)*i+a;h=new n.A(t.x,t.y,Math.max(l,t.width-u-c),Math.max(r,t.height-d-g));const p=null!=t.style.labelPosition?t.style.labelPosition:"center",f=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";if(h=null!=t.shape&&"center"===p&&"middle"===f?t.shape.getLabelBounds(h):h,e?(h.x=t.absoluteOffset.x,h.y=t.absoluteOffset.y,null!=t.text&&null!=t.text.boundingBox&&(t.text.boundingBox.x>0&&(h.x=t.text.boundingBox.x),t.text.boundingBox.y>0&&(h.y=t.text.boundingBox.y))):null!=t.text&&null!=t.text.boundingBox&&(h.x=Math.min(h.x,t.text.boundingBox.x),h.y=Math.min(h.y,t.text.boundingBox.y)),h.x+=u,h.y+=d,null!=t.text&&null!=t.text.boundingBox&&(e?(h.width=Math.max(l,t.text.boundingBox.width),h.height=Math.max(r,t.text.boundingBox.height)):(h.width=Math.max(h.width,t.text.boundingBox.width),h.height=Math.max(h.height,t.text.boundingBox.height))),t.cell.isVertex()){const e=t.style.labelPosition??"center";"left"===e?h.x-=t.width:"right"===e&&(h.x+=t.width);const i=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";"top"===i?h.y-=t.height:"bottom"===i&&(h.y+=t.height)}}return new n.A(Math.round(h.x),Math.round(h.y),Math.round(h.width),Math.round(h.height))}getEmptyLabelText(t=null){return this.emptyLabelText??""}getEditingCell(){return this.editingCell}onDestroy(){this.textarea&&(l.A.release(this.textarea),this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null),this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.zoomHandler)}}u.pluginId="CellEditorHandler";const p=u;class f{init(){document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),l.A.addGestureListeners(this.div,t=>{const e=(0,c.el)(t);e&&"A"!==e.nodeName&&this.hideTooltip()}),l.A.addListener(this.graph.getContainer(),"mouseleave",t=>{this.div!==t.relatedTarget&&this.hide()}))}constructor(t){this.zIndex=10005,this.delay=500,this.ignoreTouchEvents=!0,this.hideOnHover=!1,this.destroyed=!1,this.lastX=0,this.lastY=0,this.state=null,this.stateSource=!1,this.thread=null,this.enabled=!1,this.graph=t,this.graph.addMouseListener(this)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isHideOnHover(){return this.hideOnHover}setHideOnHover(t){this.hideOnHover=t}getStateForEvent(t){return t.getState()}mouseDown(t,e){this.reset(e,!1),this.hideTooltip()}mouseMove(t,e){if(e.getX()!==this.lastX||e.getY()!==this.lastY){this.reset(e,!0);const t=this.getStateForEvent(e);(this.isHideOnHover()||t!==this.state||e.getSource()!==this.node&&(!this.stateSource||null!=t&&this.stateSource===(e.isSource(t.shape)||!e.isSource(t.text))))&&this.hideTooltip()}this.lastX=e.getX(),this.lastY=e.getY()}mouseUp(t,e){this.reset(e,!0),this.hideTooltip()}resetTimer(){this.thread&&(window.clearTimeout(this.thread),this.thread=null)}reset(t,e,i=null){if((!this.ignoreTouchEvents||(0,c.Er)(t.getEvent()))&&(this.resetTimer(),i=i??this.getStateForEvent(t),e&&this.isEnabled()&&i&&(!this.div||"hidden"==this.div.style.visibility))){const e=t.getSource(),s=t.getX(),n=t.getY(),l=t.isSource(i.shape)||t.isSource(i.text),r=this.graph.getPlugin("PopupMenuHandler");this.thread=window.setTimeout(()=>{if(i&&e&&!this.graph.isEditing()&&r&&!r.isMenuShowing()&&!this.graph.isMouseDown){const t=this.graph.getTooltip(i,e,s,n);this.show(t,s,n),this.state=i,this.node=e,this.stateSource=l}},this.delay)}}hide(){this.resetTimer(),this.hideTooltip()}hideTooltip(){this.div&&(this.div.style.visibility="hidden",this.div.innerHTML="")}show(t,e,i){if(!this.destroyed&&t&&""!==t){const n=(0,s.ID)();this.div||this.init(),this.div.style.zIndex=String(this.zIndex),this.div.style.left=`${e+n.x}px`,this.div.style.top=`${i+h.jo+n.y}px`,(0,a.Ll)(t)?(this.div.innerHTML="",this.div.appendChild(t)):this.div.innerHTML=t.replace(/\n/g,"<br>"),this.div.style.visibility="",(0,s.Uj)(this.div)}}onDestroy(){this.destroyed||(this.resetTimer(),this.graph.removeMouseListener(this),this.div&&l.A.release(this.div),this.div?.parentNode&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)}}f.pluginId="TooltipHandler";const y=f;var m=i(9214),v=i(124);class w extends m.A{constructor(t){super(),this.enabled=!0,this.maxHandlers=100,this.graph=t,this.handlers=new Map,this.graph.addMouseListener(this),this.refreshHandler=()=>{this.isEnabled()&&this.refresh()},this.graph.getSelectionModel().addListener(l.A.CHANGE,this.refreshHandler),this.graph.getDataModel().addListener(l.A.CHANGE,this.refreshHandler),this.graph.getView().addListener(l.A.SCALE,this.refreshHandler),this.graph.getView().addListener(l.A.TRANSLATE,this.refreshHandler),this.graph.getView().addListener(l.A.SCALE_AND_TRANSLATE,this.refreshHandler),this.graph.getView().addListener(l.A.DOWN,this.refreshHandler),this.graph.getView().addListener(l.A.UP,this.refreshHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getHandler(t){return this.handlers.get(t)}isHandled(t){return!!this.getHandler(t)}reset(){this.handlers.forEach(t=>{t.reset.apply(t)})}getHandledSelectionCells(){return this.graph.getSelectionCells()}refresh(){const t=this.handlers;this.handlers=new Map;const e=(0,s.gU)(this.getHandledSelectionCells(),!1);for(let i=0;i<e.length;i+=1){const s=this.graph.view.getState(e[i]);if(s){let n=t.get(e[i])??null;t.delete(e[i]),n&&(n.state!==s?(n.onDestroy(),n=null):this.isHandlerActive(n)||(n.refresh&&n.refresh(),n.redraw())),n&&this.handlers.set(e[i],n)}}t.forEach(t=>{this.fireEvent(new v.A(l.A.REMOVE,{state:t.state})),t.onDestroy()});for(let t=0;t<e.length;t+=1){const i=this.graph.view.getState(e[t]);if(i){let s=this.handlers.get(e[t]);s?s.updateParentHighlight():(s=this.graph.createHandler(i),this.fireEvent(new v.A(l.A.ADD,{state:i})),this.handlers.set(e[t],s))}}}isHandlerActive(t){return null!==t.index}updateHandler(t){let e=this.handlers.get(t.cell);if(this.handlers.delete(t.cell),e){const{index:i}=e,s=e.startX,n=e.startY;e.onDestroy(),e=this.graph.createHandler(t),e&&(this.handlers.set(t.cell,e),null!==i&&e.start(s,n,i))}}mouseDown(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.forEach(i=>{i.mouseDown(t,e)})}mouseMove(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.forEach(i=>{i.mouseMove(t,e)})}mouseUp(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.forEach(i=>{i.mouseUp(t,e)})}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.refreshHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler)}}w.pluginId="SelectionCellsHandler";const x=w;class b extends m.A{constructor(t){super(),this.activeRow=null,this.eventReceiver=null,this.submenuImage=`${r.A.imageBasePath}/submenu.gif`,this.zIndex=10006,this.useLeftButtonForPopup=!1,this.enabled=!0,this.itemCount=0,this.autoExpand=!1,this.smartSeparators=!1,this.labels=!0,this.willAddSeparator=!1,this.containsItems=!1,t&&(this.factoryMethod=t),this.table=document.createElement("table"),this.table.className="mxPopupMenu",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.div=document.createElement("div"),this.div.className="mxPopupMenu",this.div.style.display="inline",this.div.style.zIndex=String(this.zIndex),this.div.appendChild(this.table),l.A.disableContextMenu(this.div)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isPopupTrigger(t){return t.isPopupTrigger()||this.useLeftButtonForPopup&&(0,c.Lg)(t.getEvent())}addItem(t,e,i,s=null,n=null,r=!0,h=!0,o=!1){s=s??this,this.itemCount++,s.willAddSeparator&&(s.containsItems&&this.addSeparator(s,!0),s.willAddSeparator=!1),s.containsItems=!0;const d=document.createElement("tr");d.className="mxPopupMenuItem";const c=document.createElement("td");if(c.className="mxPopupMenuIcon",e){const t=document.createElement("img");t.src=e,c.appendChild(t)}else if(n){const t=document.createElement("div");t.className=n,c.appendChild(t)}if(d.appendChild(c),this.labels){const e=document.createElement("td");e.className="mxPopupMenuItem"+(r?"":" mxDisabled"),(0,a.M9)(e,t),e.align="left",d.appendChild(e);const i=document.createElement("td");i.className="mxPopupMenuItem"+(r?"":" mxDisabled"),i.style.paddingRight="6px",i.style.textAlign="right",d.appendChild(i),null==s.div&&this.createSubmenu(s)}return s.tbody?.appendChild(d),h&&r&&(l.A.addGestureListeners(d,t=>{this.eventReceiver=d,s&&s.activeRow!=d&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),d.div&&(this.showSubmenu(s,d),s.activeRow=d)),l.A.consume(t)},t=>{s&&s.activeRow!=d&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),this.autoExpand&&d.div&&(this.showSubmenu(s,d),s.activeRow=d)),o||(d.className="mxPopupMenuItemHover")},t=>{this.eventReceiver==d&&(s&&s.activeRow!=d&&this.hideMenu(),i?.(t)),this.eventReceiver=null,l.A.consume(t)}),o||l.A.addListener(d,"mouseout",t=>{d.className="mxPopupMenuItem"})),d}addCheckmark(t,e){if(t.firstChild){const i=t.firstChild.nextSibling;i.style.backgroundImage=`url('${e}')`,i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="2px 50%"}}createSubmenu(t){t.table=document.createElement("table"),t.table.className="mxPopupMenu",t.tbody=document.createElement("tbody"),t.table.appendChild(t.tbody),t.div=document.createElement("div"),t.div.className="mxPopupMenu",t.div.style.position="absolute",t.div.style.display="inline",t.div.style.zIndex=String(this.zIndex),t.div.appendChild(t.table);const e=document.createElement("img");e.setAttribute("src",this.submenuImage),t.firstChild?.nextSibling?.nextSibling&&t.firstChild.nextSibling.nextSibling.appendChild(e)}showSubmenu(t,e){if(e.div){e.div.style.left=t.div.offsetLeft+e.offsetLeft+e.offsetWidth-1+"px",e.div.style.top=`${t.div.offsetTop+e.offsetTop}px`,document.body.appendChild(e.div);const i=e.div.offsetLeft,n=e.div.offsetWidth,l=(0,s.jb)(document),r=document.body,h=document.documentElement;i+n>l.x+(r.clientWidth||h.clientWidth)&&(e.div.style.left=`${Math.max(0,t.div.offsetLeft-n-6)}px`),(0,s.Uj)(e.div)}}addSeparator(t=null,e=!1){if(t=t||this,this.smartSeparators&&!e)t.willAddSeparator=!0;else if(t.tbody){t.willAddSeparator=!1;const e=document.createElement("tr"),i=document.createElement("td");i.className="mxPopupMenuIcon",i.style.padding="0 0 0 0px",e.appendChild(i);const s=document.createElement("td");s.style.padding="0 0 0 0px",s.setAttribute("colSpan","2");const n=document.createElement("hr");n.setAttribute("size","1"),s.appendChild(n),e.appendChild(s),t.tbody.appendChild(e)}}popup(t,e,i,s){if(this.div&&this.tbody&&this.factoryMethod){for(this.div.style.left=`${t}px`,this.div.style.top=`${e}px`;this.tbody.firstChild;)l.A.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0,this.factoryMethod(this,i,s),this.itemCount>0&&(this.showMenu(),this.fireEvent(new v.A(l.A.SHOW)))}}isMenuShowing(){return this.div&&this.div.parentNode==document.body}showMenu(){document.body.appendChild(this.div),(0,s.Uj)(this.div)}hideMenu(){this.div&&(this.div.parentNode?.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new v.A(l.A.HIDE)))}hideSubmenu(t){t.activeRow&&(this.hideSubmenu(t.activeRow),t.activeRow.div.parentNode?.removeChild(t.activeRow.div),t.activeRow=null)}destroy(){this.div&&(l.A.release(this.div),this.div.parentNode?.removeChild(this.div))}}const C=b;class S extends C{constructor(t){super(),this.inTolerance=!1,this.popupTrigger=!1,this.selectOnPopup=!0,this.clearSelectionOnBackground=!0,this.triggerX=null,this.triggerY=null,this.screenX=null,this.screenY=null,this.graph=t,this.graph.addMouseListener(this),this.gestureHandler=(t,e)=>{this.inTolerance=!1},this.graph.addListener(l.A.GESTURE,this.gestureHandler),this.init()}init(){l.A.addGestureListeners(this.div,t=>{const e=this.graph.getPlugin("TooltipHandler");e?.hide()})}isSelectOnPopup(t){return this.selectOnPopup}mouseDown(t,e){this.isEnabled()&&!(0,c.DO)(e.getEvent())&&(this.hideMenu(),this.triggerX=e.getGraphX(),this.triggerY=e.getGraphY(),this.screenX=(0,c.M4)(e.getEvent()).screenX,this.screenY=(0,c.M4)(e.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(e),this.inTolerance=!0)}mouseMove(t,e){this.inTolerance&&null!=this.screenX&&null!=this.screenY&&(Math.abs((0,c.M4)(e.getEvent()).screenX-this.screenX)>this.graph.getEventTolerance()||Math.abs((0,c.M4)(e.getEvent()).screenY-this.screenY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}mouseUp(t,e){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){const t=this.getCellForPopupEvent(e);this.graph.isEnabled()&&this.isSelectOnPopup(e)&&null!=t&&!this.graph.isCellSelected(t)?this.graph.setSelectionCell(t):this.clearSelectionOnBackground&&null==t&&this.graph.clearSelection();const i=this.graph.getPlugin("TooltipHandler");i?.hide();const n=(0,s.ID)();this.popup(e.getX()+n.x+1,e.getY()+n.y+1,t,e.getEvent()),e.consume()}this.popupTrigger=!1,this.inTolerance=!1}getCellForPopupEvent(t){return t.getCell()}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.gestureHandler),super.destroy()}}S.pluginId="PopupMenuHandler";const A=S;var E=i(849),M=i(3081),T=i(715),P=i(8302),H=i(2548),L=i(8053),D=i(3675),k=i(2630),O=i(2395),V=i(914);class B extends m.A{constructor(t,e=null){super(),this.previous=null,this.iconState=null,this.icons=[],this.cell=null,this.currentPoint=null,this.sourceConstraint=null,this.shape=null,this.icon=null,this.originalPoint=null,this.currentState=null,this.selectedIcon=null,this.waypoints=[],this.factoryMethod=null,this.moveIconFront=!1,this.moveIconBack=!1,this.connectImage=null,this.targetConnectImage=!1,this.enabled=!1,this.select=!0,this.createTarget=!1,this.error=null,this.waypointsEnabled=!1,this.ignoreMouseDown=!1,this.first=null,this.connectIconOffset=new T.A(0,h.jo),this.edgeState=null,this.mouseDownCounter=0,this.movePreviewAway=!1,this.outlineConnect=!1,this.livePreview=!1,this.cursor=null,this.cursorConnect="pointer",this.insertBeforeSource=!1,this.graph=t,this.factoryMethod=e,this.graph.addMouseListener(this),this.marker=this.createMarker(),this.constraintHandler=this.createConstraintHandler(),this.changeHandler=t=>{this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell)),this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.previous&&!this.graph.view.getState(this.previous.cell)&&this.reset()},this.graph.getDataModel().addListener(l.A.CHANGE,this.changeHandler),this.graph.getView().addListener(l.A.SCALE,this.changeHandler),this.graph.getView().addListener(l.A.TRANSLATE,this.changeHandler),this.graph.getView().addListener(l.A.SCALE_AND_TRANSLATE,this.changeHandler),this.drillHandler=t=>{this.reset()},this.graph.addListener(l.A.START_EDITING,this.drillHandler),this.graph.getView().addListener(l.A.DOWN,this.drillHandler),this.graph.getView().addListener(l.A.UP,this.drillHandler),this.escapeHandler=()=>{this.reset()},this.graph.addListener(l.A.ESCAPE,this.escapeHandler)}createConstraintHandler(){return new k.A(this.graph)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isInsertBefore(t,e,i,s,n){return this.insertBeforeSource&&e!==i}isCreateTarget(t){return this.createTarget}setCreateTarget(t){this.createTarget=t}createShape(){const t=this.livePreview&&this.edgeState?this.graph.cellRenderer.createShape(this.edgeState):new O.A([],h.SU);return t&&t.node&&(t.dialect="svg",t.scale=this.graph.view.scale,t.pointerEvents=!1,t.isDashed=!0,t.init(this.graph.getView().getOverlayPane()),l.A.redirectMouseEvents(t.node,this.graph,null)),t}isConnectableCell(t){return!0}createMarker(){return new I(this.graph,this)}start(t,e,i,s){this.previous=t,this.first=new T.A(e,i),this.edgeState=s??this.createEdgeState(),this.marker.currentColor=this.marker.validColor,this.marker.markedState=t,this.marker.mark(),this.fireEvent(new v.A(l.A.START,{state:this.previous}))}isConnecting(){return!!this.first&&!!this.shape}isValidSource(t,e){return this.graph.isValidSource(t)}isValidTarget(t){return!0}validateConnection(t,e){return this.isValidTarget(e)?this.graph.getEdgeValidationError(null,t,e):""}getConnectImage(t){return this.connectImage}isMoveIconToFrontForState(t){return!(!t.text||t.text.node.parentNode!==this.graph.container)||this.moveIconFront}createIcons(t){const e=this.getConnectImage(t);if(e){this.iconState=t;const i=[],s=new n.A(0,0,e.width,e.height),r=new L.A(s,e.src,void 0,void 0,0);r.preserveImageAspect=!1,this.isMoveIconToFrontForState(t)?(r.dialect="strictHtml",r.init(this.graph.container)):(r.dialect="svg",r.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&r.node.parentNode&&r.node.previousSibling&&r.node.parentNode.insertBefore(r.node,r.node.parentNode.firstChild)),r.node.style.cursor=this.cursorConnect;const h=()=>this.currentState??t,o=t=>{(0,c.fm)(t)||(this.icon=r,this.graph.fireMouseEvent(l.A.MOUSE_DOWN,new H.A(t,h())))};return l.A.redirectMouseEvents(r.node,this.graph,h,o),i.push(r),this.redrawIcons(i,this.iconState),i}return[]}redrawIcons(t,e){if(t[0]&&t[0].bounds){const i=this.getIconPosition(t[0],e);t[0].bounds.x=i.x,t[0].bounds.y=i.y,t[0].redraw()}}getIconPosition(t,e){const{scale:i}=this.graph.getView();let s=e.getCenterX(),n=e.getCenterY();if(this.graph.isSwimlane(e.cell)){const t=this.graph.getStartSize(e.cell);s=0!==t.width?e.x+t.width*i/2:s,n=0!==t.height?e.y+t.height*i/2:n;const l=(0,P.eh)(e.style.rotation??0);if(0!==l){const t=Math.cos(l),i=Math.sin(l),r=new T.A(e.getCenterX(),e.getCenterY()),h=(0,P.Iq)(new T.A(s,n),t,i,r);s=h.x,n=h.y}}return new T.A(s-t.bounds.width/2,n-t.bounds.height/2)}destroyIcons(){for(let t=0;t<this.icons.length;t+=1)this.icons[t].destroy();this.icons=[],this.icon=null,this.selectedIcon=null,this.iconState=null}isStartEvent(t){return null!==this.constraintHandler.currentFocus&&null!==this.constraintHandler.currentConstraint||null!==this.previous&&null===this.error&&(0===this.icons.length||null!==this.icon)}mouseDown(t,e){if(this.mouseDownCounter+=1,this.isEnabled()&&this.graph.isEnabled()&&!e.isConsumed()&&!this.isConnecting()&&this.isStartEvent(e)){if(this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new T.A(e.getGraphX(),e.getGraphY()),this.edgeState=this.createEdgeState(e),this.mouseDownCounter=1,this.waypointsEnabled&&!this.shape&&(this.waypoints=[],this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState)),!this.previous&&this.edgeState&&this.edgeState.cell.geometry){const t=this.graph.getPointForEvent(e.getEvent());this.edgeState.cell.geometry.setTerminalPoint(t,!0)}this.fireEvent(new v.A(l.A.START,{state:this.previous})),e.consume()}this.selectedIcon=this.icon,this.icon=null}isImmediateConnectSource(t){return!this.graph.isCellMovable(t.cell)}createEdgeState(t){return null}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,s.A3)(this.graph.container),i=t.getEvent(),n=(0,c.El)(i),l=(0,c.xJ)(i),r=document.documentElement,h=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),o=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),a=this.currentPoint.x-this.graph.container.scrollLeft+e.x-h,d=this.currentPoint.y-this.graph.container.scrollTop+e.y-o;return this.outlineConnect&&!(0,c.RT)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,c.CA)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(n,l)||(a!==n||d!==l)&&null==t.getState()&&this.marker.highlight.isHighlightAt(a,d))}updateCurrentState(t,e){if(this.constraintHandler.update(t,!this.first,!1,!this.first||t.isSource(this.marker.highlight.shape)?null:e),null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)this.marker.highlight&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell&&this.marker.highlight.shape?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent"),this.previous&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),this.error||(this.currentState=this.constraintHandler.currentFocus),(this.error||this.currentState&&!this.isCellEnabled(this.currentState.cell))&&this.constraintHandler.reset());else{this.graph.isIgnoreTerminalEvent(t.getEvent())?(this.marker.reset(),this.currentState=null):(this.marker.process(t),this.currentState=this.marker.getValidState()),null==this.currentState||this.isCellEnabled(this.currentState.cell)||(this.constraintHandler.reset(),this.marker.reset(),this.currentState=null);const i=this.isOutlineConnectEvent(t);if(null!=this.currentState&&i){t.isSource(this.marker.highlight.shape)&&(e=new T.A(t.getGraphX(),t.getGraphY()));const i=this.graph.getOutlineConstraint(e,this.currentState,t);this.constraintHandler.setFocus(t,this.currentState,!1),this.constraintHandler.currentConstraint=i,this.constraintHandler.currentPoint=e}if(this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const e=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=h.eX,this.marker.highlight.shape.strokeWidth=h.XZ/e/e,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const i=t.getCell();i&&i.isConnectable()&&this.marker.getValidState()!==t.getState()?(this.marker.highlight.shape.stroke="transparent",this.currentState=null):this.marker.highlight.shape.stroke=h.Vj,this.marker.highlight.shape.strokeWidth=h.es/e/e,this.marker.highlight.repaint()}}}}isCellEnabled(t){return!0}convertWaypoint(t){const e=this.graph.getView().getScale(),i=this.graph.getView().getTranslate();t.x=t.x/e-i.x,t.y=t.y/e-i.y}snapToPreview(t,e){if(!(0,c.CA)(t.getEvent())&&this.previous){const i=this.graph.getGridSize()*this.graph.view.scale/2,s=this.sourceConstraint&&this.first?this.first:new T.A(this.previous.getCenterX(),this.previous.getCenterY());Math.abs(s.x-t.getGraphX())<i&&(e.x=s.x),Math.abs(s.y-t.getGraphY())<i&&(e.y=s.y)}}mouseMove(t,e){if(e.isConsumed()||!this.ignoreMouseDown&&!this.first&&this.graph.isMouseDown)this.constraintHandler.reset();else{!this.isEnabled()&&this.currentState&&(this.destroyIcons(),this.currentState=null);const t=this.graph.getView(),{scale:i}=t,s=t.translate;let r=new T.A(e.getGraphX(),e.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(e.getEvent())&&(r=new T.A((this.graph.snap(r.x/i-s.x)+s.x)*i,(this.graph.snap(r.y/i-s.y)+s.y)*i)),this.snapToPreview(e,r),this.currentPoint=r,(this.first||this.isEnabled()&&this.graph.isEnabled())&&(this.shape||!this.first||Math.abs(e.getGraphX()-this.first.x)>this.graph.getEventTolerance()||Math.abs(e.getGraphY()-this.first.y)>this.graph.getEventTolerance())&&this.updateCurrentState(e,r),this.first){let t=null,i=r;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(t=this.constraintHandler.currentConstraint,i=this.constraintHandler.currentPoint.clone()):this.previous&&!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,c.RT)(e.getEvent())&&(Math.abs(this.previous.getCenterX()-r.x)<Math.abs(this.previous.getCenterY()-r.y)?r.x=this.previous.getCenterX():r.y=this.previous.getCenterY());let s=this.first;if(this.selectedIcon&&this.selectedIcon.bounds){const t=this.selectedIcon.bounds.width,i=this.selectedIcon.bounds.height;if(this.currentState&&this.targetConnectImage){const t=this.getIconPosition(this.selectedIcon,this.currentState);this.selectedIcon.bounds.x=t.x,this.selectedIcon.bounds.y=t.y}else{const s=new n.A(e.getGraphX()+this.connectIconOffset.x,e.getGraphY()+this.connectIconOffset.y,t,i);this.selectedIcon.bounds=s}this.selectedIcon.redraw()}if(this.edgeState)this.updateEdgeState(i,t),i=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1],s=this.edgeState.absolutePoints[0];else{if(this.currentState&&!this.constraintHandler.currentConstraint){const t=this.getTargetPerimeterPoint(this.currentState,e);null!=t&&(i=t)}if(!this.sourceConstraint&&this.previous){const t=this.waypoints.length>0?this.waypoints[0]:i,n=this.getSourcePerimeterPoint(this.previous,t,e);n&&(s=n)}}if(!this.currentState&&this.movePreviewAway&&i){let t=s;if(this.edgeState&&this.edgeState.absolutePoints.length>=2){const e=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2];e&&(t=e)}if(t){const e=i.x-t.x,s=i.y-t.y,n=Math.sqrt(e*e+s*s);if(0===n)return;this.originalPoint=i.clone(),i.x-=4*e/n,i.y-=4*s/n}}else this.originalPoint=null;if(!this.shape){const t=Math.abs(e.getGraphX()-this.first.x),i=Math.abs(e.getGraphY()-this.first.y);(t>this.graph.getEventTolerance()||i>this.graph.getEventTolerance())&&(this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState),this.updateCurrentState(e,r))}if(this.shape){if(this.edgeState)this.shape.points=this.edgeState.absolutePoints;else{let t=[s];this.waypoints.length>0&&(t=t.concat(this.waypoints)),t.push(i),this.shape.points=t}this.drawPreview()}this.cursor&&(this.graph.container.style.cursor=this.cursor),l.A.consume(e.getEvent()),e.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous===this.currentState||this.edgeState?this.previous!==this.currentState||null==this.currentState||0!==this.icons.length||this.graph.isMouseDown||e.consume():(this.destroyIcons(),!this.currentState||this.error||this.constraintHandler.currentConstraint||(this.icons=this.createIcons(this.currentState),0===this.icons.length&&(this.currentState.setCursor(this.cursorConnect),e.consume())),this.previous=this.currentState):this.constraintHandler.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){let t=!1;const i=e.getSource();for(let e=0;e<this.icons.length&&!t;e+=1)t=i===this.icons[e].node||!!i&&i.parentNode===this.icons[e].node;t||this.updateIcons(this.currentState,this.icons,e)}}}updateEdgeState(t,e){if(!this.edgeState)return;this.sourceConstraint&&this.sourceConstraint.point&&(this.edgeState.style.exitX=this.sourceConstraint.point.x,this.edgeState.style.exitY=this.sourceConstraint.point.y),e&&e.point?(this.edgeState.style.entryX=e.point.x,this.edgeState.style.entryY=e.point.y):(this.edgeState.style.entryX=0,this.edgeState.style.entryY=0),this.edgeState.absolutePoints=[null,null!=this.currentState?null:t],this.sourceConstraint&&this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),null!=this.currentState&&(null==e&&(e=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,e));const i=[];for(let t=0;t<this.waypoints.length;t+=1){const e=this.waypoints[t].clone();this.convertWaypoint(e),i[t]=e}this.graph.view.updatePoints(this.edgeState,i,this.previous,this.currentState),this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState)}getTargetPerimeterPoint(t,e){let i=null;const{view:s}=t,n=s.getPerimeterFunction(t);if(n&&this.previous&&this.edgeState){const e=this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new T.A(this.previous.getCenterX(),this.previous.getCenterY()),l=n(s.getPerimeterBounds(t),this.edgeState,e,!1);l&&(i=l)}else i=new T.A(t.getCenterX(),t.getCenterY());return i}getSourcePerimeterPoint(t,e,i){let s=null;const{view:n}=t,l=n.getPerimeterFunction(t),r=new T.A(t.getCenterX(),t.getCenterY());if(l){const i=t.style.rotation??0,h=-i*(Math.PI/180);0!==i&&(e=(0,P.Iq)(new T.A(e.x,e.y),Math.cos(h),Math.sin(h),r));let o=l(n.getPerimeterBounds(t),t,e,!1);o&&(0!==i&&(o=(0,P.Iq)(new T.A(o.x,o.y),Math.cos(-h),Math.sin(-h),r)),s=o)}else s=r;return s}updateIcons(t,e,i){}isStopEvent(t){return!!t.getState()}addWaypointForEvent(t){if(!this.first)return;let e=(0,s.ce)(this.graph.container,t.getX(),t.getY());const i=Math.abs(e.x-this.first.x),n=Math.abs(e.y-this.first.y);if(this.waypoints.length>0||this.mouseDownCounter>1&&(i>this.graph.getEventTolerance()||n>this.graph.getEventTolerance())){const{scale:i}=this.graph.view;e=new T.A(this.graph.snap(t.getGraphX()/i)*i,this.graph.snap(t.getGraphY()/i)*i),this.waypoints.push(e)}}checkConstraints(t,e){return!(t&&e&&t.point&&e.point&&t.point.equals(e.point)&&t.dx===e.dx&&t.dy===e.dy&&t.perimeter===e.perimeter)}mouseUp(t,e){if(!e.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(e))return this.addWaypointForEvent(e),void e.consume();const t=this.sourceConstraint,i=this.constraintHandler.currentConstraint,s=this.previous?this.previous.cell:null;let n=null;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&(n=this.constraintHandler.currentFocus.cell),!n&&this.currentState&&(n=this.currentState.cell),this.error||s&&n&&s===n&&!this.checkConstraints(t,i)?(null!=this.previous&&null!=this.marker.validState&&this.previous.cell===this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.validState.cell,e.getEvent()),null!=this.error&&this.error.length>0&&this.graph.validationAlert(this.error)):this.connect(s,n,e.getEvent(),e.getCell()),this.destroyIcons(),e.consume()}null!=this.first&&this.reset()}reset(){null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.cursor&&null!=this.graph.container&&(this.graph.container.style.cursor=""),this.destroyIcons(),this.marker.reset(),this.constraintHandler.reset(),this.originalPoint=null,this.currentPoint=null,this.edgeState=null,this.previous=null,this.error=null,this.sourceConstraint=null,this.mouseDownCounter=0,this.first=null,this.fireEvent(new v.A(l.A.RESET))}drawPreview(){this.updatePreview(null===this.error),this.shape&&this.shape.redraw()}updatePreview(t){this.shape&&(this.shape.strokeWidth=this.getEdgeWidth(t),this.shape.stroke=this.getEdgeColor(t))}getEdgeColor(t){return t?h.Vm:h.SU}getEdgeWidth(t){return t?3:1}connect(t,e,i,s=null){if(e||this.isCreateTarget(i)||this.graph.isAllowDanglingEdges()){const n=this.graph.getDataModel();let r=!1,h=null;n.beginUpdate();try{if(t&&!e&&!this.graph.isIgnoreTerminalEvent(i)&&this.isCreateTarget(i)&&(e=this.createTargetVertex(i,t))){if(s=this.graph.getDropTarget([e],i,s),r=!0,null!=s&&s.isEdge())s=this.graph.getDefaultParent();else{const t=s?this.graph.getView().getState(s):null;if(t){const i=e.getGeometry();i&&(i.x-=t.origin.x,i.y-=t.origin.y)}}this.graph.addCell(e,s)}let o=this.graph.getDefaultParent();t&&e&&t.getParent()===e.getParent()&&t.getParent()?.getParent()!==n.getRoot()&&(o=t.getParent(),t.geometry&&t.geometry.relative&&e.geometry&&e.geometry.relative&&(o=o.getParent()));let a=null,d={};if(this.edgeState?.cell&&(a=this.edgeState.cell.value,d=this.edgeState.cell.style??{}),h=this.insertEdge(o,"",a,t,e,d),h&&t){if(this.graph.setConnectionConstraint(h,t,!0,this.sourceConstraint),this.graph.setConnectionConstraint(h,e,!1,this.constraintHandler.currentConstraint),this.edgeState?.cell?.geometry&&n.setGeometry(h,this.edgeState.cell.geometry),o=t.getParent(),this.isInsertBefore(h,t,e,i,s)){let e=t;for(;e&&null!=e.parent&&null!=e.geometry&&e.geometry.relative&&e.parent!==h.parent;)e=e.getParent();null!=e&&null!=e.parent&&e.parent===h.parent&&n.add(o,h,e.parent.getIndex(e))}let a=h.getGeometry();if(null==a&&(a=new E.A,a.relative=!0,n.setGeometry(h,a)),this.waypoints.length>0){const t=this.graph.view.scale,e=this.graph.view.translate;a.points=[];for(let i=0;i<this.waypoints.length;i+=1){const s=this.waypoints[i];a.points.push(new T.A(s.x/t-e.x,s.y/t-e.y))}}if(!e&&this.currentPoint){const t=this.graph.view.translate,e=this.graph.view.scale,i=null!=this.originalPoint?new T.A(this.originalPoint.x/e-t.x,this.originalPoint.y/e-t.y):new T.A(this.currentPoint.x/e-t.x,this.currentPoint.y/e-t.y);i.x-=this.graph.getPanDx()/this.graph.view.scale,i.y-=this.graph.getPanDy()/this.graph.view.scale,a.setTerminalPoint(i,!1)}this.fireEvent(new v.A(l.A.CONNECT,"cell",h,"terminal",e,"event",i,"target",s,"terminalInserted",r))}}catch(t){V.eo.logger.show();const e="Error in ConnectionHandler: "+(t instanceof Error?t.message+"\n"+t.stack:"unknown cause");V.eo.logger.debug(e)}finally{n.endUpdate()}this.select&&this.selectCells(h,r?e:null)}}selectCells(t,e){this.graph.setSelectionCell(t)}insertEdge(t,e,i,s,n,l){if(!this.factoryMethod)return this.graph.insertEdge({parent:t,id:e,value:i,source:s,target:n,style:l});let r=this.createEdge(i,s,n,l);return r=this.graph.addEdge(r,t,s,n),r}createTargetVertex(t,e){let i=e.getGeometry();for(;i&&i.relative;)i=(e=e.getParent()).getGeometry();const s=this.graph.cloneCell(e);if(i=s.getGeometry(),i&&this.currentPoint){const t=this.graph.view.translate,s=this.graph.view.scale,n=new T.A(this.currentPoint.x/s-t.x,this.currentPoint.y/s-t.y);i.x=Math.round(n.x-i.width/2-this.graph.getPanDx()/s),i.y=Math.round(n.y-i.height/2-this.graph.getPanDy()/s);const l=this.getAlignmentTolerance();if(l>0){const n=this.graph.view.getState(e);if(null!=n){const e=n.x/s-t.x,r=n.y/s-t.y;Math.abs(e-i.x)<=l&&(i.x=Math.round(e)),Math.abs(r-i.y)<=l&&(i.y=Math.round(r))}}}return s}getAlignmentTolerance(t){return this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.graph.getSnapTolerance()}createEdge(t,e,i,s={}){let n=null;if(null!=this.factoryMethod&&(n=this.factoryMethod(e,i,s)),null==n){n=new M.A(t||""),n.setEdge(!0),n.setStyle(s);const e=new E.A;e.relative=!0,n.setGeometry(e)}return n}onDestroy(){this.graph.removeMouseListener(this),this.shape&&(this.shape.destroy(),this.shape=null),this.marker&&(this.marker.destroy(),this.marker=null),this.constraintHandler&&this.constraintHandler.onDestroy(),this.changeHandler&&(this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler)),this.drillHandler&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler)),this.escapeHandler&&this.graph.removeListener(this.escapeHandler)}}B.pluginId="ConnectionHandler";class I extends D.A{constructor(t,e,i=h.Vj,s=h.G7,n=h.ir){super(t,i,s,n),this.hotspotEnabled=!0,this.connectionHandler=e}getCell(t){let e=super.getCell(t);if(this.connectionHandler.error=null,!e&&this.connectionHandler.currentPoint&&(e=this.connectionHandler.graph.getCellAt(this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)),e&&!e.isConnectable()&&this.connectionHandler.cell){const t=this.connectionHandler.cell.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.connectionHandler.graph.isSwimlane(e)&&null!=this.connectionHandler.currentPoint&&this.connectionHandler.graph.hitsSwimlaneContent(e,this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)||!this.connectionHandler.isConnectableCell(e))&&(e=null),e?this.connectionHandler.isConnecting()?this.connectionHandler.previous&&(this.connectionHandler.error=this.connectionHandler.validateConnection(this.connectionHandler.previous.cell,e),null!==this.connectionHandler.error&&0===this.connectionHandler.error.length&&(e=null,this.connectionHandler.isCreateTarget(t.getEvent())&&(this.connectionHandler.error=null))):this.connectionHandler.isValidSource(e,t)||(e=null):!this.connectionHandler.isConnecting()||this.connectionHandler.isCreateTarget(t.getEvent())||this.connectionHandler.graph.isAllowDanglingEdges()||(this.connectionHandler.error=""),e}isValidState(t){return this.connectionHandler.isConnecting()?!this.connectionHandler.error:super.isValidState(t)}getMarkerColor(t,e,i){return!this.connectionHandler.connectImage||this.connectionHandler.isConnecting()?super.getMarkerColor(t,e,i):h.x3}intersects(t,e){return!(!this.connectionHandler.connectImage&&!this.connectionHandler.isConnecting())||super.intersects(t,e)}}const R=B;var N=i(1613);const z=class{constructor(t,e){this.states=[],this.horizontal=!0,this.vertical=!0,this.guideX=null,this.guideY=null,this.rounded=!1,this.tolerance=2,this.graph=t,this.setStates(e)}setStates(t){this.states=t}isEnabledForEvent(t){return!0}getGuideTolerance(t=!1){return t&&this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.tolerance}createGuideShape(t=!1){const e=new O.A([],h.JP,h.Mn);return e.isDashed=!0,e}isStateIgnored(t){return!1}move(t=null,e,i=!1,s=!1){if((this.horizontal||this.vertical)&&t){const{scale:s}=this.graph.getView(),n=this.getGuideTolerance(i)*s,l=t.clone();l.x+=e.x,l.y+=e.y;let r=!1,h=null,o=null,a=!1,d=null,c=null,g=n,u=n;const p=l.x,f=l.x+l.width,y=l.getCenterX(),m=l.y,v=l.y+l.height,w=l.getCenterY(),x=(i,s,n)=>{let l=!1;n&&Math.abs(i-y)<g?(e.x=i-t.getCenterX(),g=Math.abs(i-y),l=!0):n||(Math.abs(i-p)<g?(e.x=i-t.x,g=Math.abs(i-p),l=!0):Math.abs(i-f)<g&&(e.x=i-t.x-t.width,g=Math.abs(i-f),l=!0)),l&&(h=s,o=i,this.guideX||(this.guideX=this.createGuideShape(!0),this.guideX.dialect="svg",this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()))),r=r||l},b=(i,s,n)=>{let l=!1;n&&Math.abs(i-w)<u?(e.y=i-t.getCenterY(),u=Math.abs(i-w),l=!0):n||(Math.abs(i-m)<u?(e.y=i-t.y,u=Math.abs(i-m),l=!0):Math.abs(i-v)<u&&(e.y=i-t.y-t.height,u=Math.abs(i-v),l=!0)),l&&(d=s,c=i,this.guideY||(this.guideY=this.createGuideShape(!1),this.guideY.dialect="svg",this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()))),a=a||l};for(let t=0;t<this.states.length;t+=1){const e=this.states[t];e&&!this.isStateIgnored(e)&&(this.horizontal&&(x(e.getCenterX(),e,!0),x(e.x,e,!1),x(e.x+e.width,e,!1),e.cell||x(e.getCenterX(),e,!1)),this.vertical&&(b(e.getCenterY(),e,!0),b(e.y,e,!1),b(e.y+e.height,e,!1),e.cell||b(e.getCenterY(),e,!1)))}this.graph.snapDelta(e,t,!i,r,a),e=this.getDelta(t,h,e.x,d,e.y);const C=this.graph.container;if(!r&&this.guideX)this.guideX.node.style.visibility="hidden";else if(this.guideX){let i=null,s=null;h&&(i=Math.min(t.y+e.y-this.graph.getPanDy(),h.y),s=Math.max(t.y+t.height+e.y-this.graph.getPanDy(),h.y+h.height)),this.guideX.points=null!==i&&null!==s?[new T.A(o,i),new T.A(o,s)]:[new T.A(o,-this.graph.getPanDy()),new T.A(o,C.scrollHeight-3-this.graph.getPanDy())],this.guideX.stroke=this.getGuideColor(h,!0),this.guideX.node.style.visibility="visible",this.guideX.redraw()}if(a||null==this.guideY){if(null!=this.guideY){let i=null,s=null;null!=d&&null!=t&&(i=Math.min(t.x+e.x-this.graph.getPanDx(),d.x),s=Math.max(t.x+t.width+e.x-this.graph.getPanDx(),d.x+d.width)),null!=i&&null!=s&&null!==c?this.guideY.points=[new T.A(i,c),new T.A(s,c)]:null!==c&&(this.guideY.points=[new T.A(-this.graph.getPanDx(),c),new T.A(C.scrollWidth-3-this.graph.getPanDx(),c)]),this.guideY.stroke=this.getGuideColor(d,!1),this.guideY.node.style.visibility="visible",this.guideY.redraw()}}else this.guideY.node.style.visibility="hidden"}return e}getDelta(t,e=null,i,s=null,n){const l=this.graph.view.scale;return(this.rounded||null!=e&&null==e.cell)&&(i=Math.round((t.x+i)/l)*l-t.x),(this.rounded||null!=s&&null==s.cell)&&(n=Math.round((t.y+n)/l)*l-t.y),new T.A(i,n)}getGuideColor(t,e){return h.JP}hide(){this.setVisible(!1)}setVisible(t){this.guideX&&(this.guideX.node.style.visibility=t?"visible":"hidden"),this.guideY&&(this.guideY.node.style.visibility=t?"visible":"hidden")}destroy(){this.guideX&&(this.guideX.destroy(),this.guideX=null),this.guideY&&(this.guideY.destroy(),this.guideY=null)}};var F=i(5197),G=i(789);class _{constructor(t){this.refreshThread=null,this.maxCells=50,this.enabled=!0,this.highlightEnabled=!0,this.cloneEnabled=!0,this.moveEnabled=!0,this.guidesEnabled=!1,this.handlesVisible=!0,this.guide=null,this.currentDx=0,this.currentDy=0,this.updateCursor=!0,this.selectEnabled=!0,this.removeCellsFromParent=!0,this.removeEmptyParents=!1,this.connectOnDrop=!1,this.scrollOnMove=!0,this.minimumSize=6,this.previewColor="black",this.htmlPreview=!1,this.shape=null,this.scaleGrid=!1,this.rotationEnabled=!0,this.maxLivePreview=0,this.allowLivePreview=r.A.IS_SVG,this.cell=null,this.delayedSelection=!1,this.first=null,this.cells=null,this.bounds=null,this.pBounds=null,this.allCells=new Map,this.cellWasClicked=!1,this.cloning=!1,this.cellCount=0,this.target=null,this.suspended=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.highlight=null,this.graph=t,this.graph.addMouseListener(this),this.panHandler=()=>{this.suspended||(this.updatePreview(),this.updateHint())},this.graph.addListener(l.A.PAN,this.panHandler),this.escapeHandler=(t,e)=>{this.reset()},this.graph.addListener(l.A.ESCAPE,this.escapeHandler),this.refreshHandler=(t,e)=>{this.refreshThread&&window.clearTimeout(this.refreshThread),this.refreshThread=window.setTimeout(()=>{if(this.refreshThread=null,this.first&&!this.suspended&&this.cells){const t=this.currentDx,e=this.currentDy;this.currentDx=0,this.currentDy=0,this.updatePreview(),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),null!=this.pBounds||this.livePreviewUsed?(this.currentDx=t,this.currentDy=e,this.updatePreview(),this.updateHint(),this.livePreviewUsed&&(this.setHandlesVisibleForCells(this.getSelectionCellsHandler()?.getHandledSelectionCells()??[],!1,!0),this.updatePreview())):this.reset()}},0)},this.graph.getDataModel().addListener(l.A.CHANGE,this.refreshHandler),this.graph.addListener(l.A.REFRESH,this.refreshHandler),this.keyHandler=t=>{if(null!=this.graph.container&&"hidden"!==this.graph.container.style.visibility&&null!=this.first&&!this.suspended){const e=this.graph.isCloneEvent(t)&&this.graph.isCellsCloneable()&&this.isCloneEnabled();e!==this.cloning&&(this.cloning=e,this.checkPreview(),this.updatePreview())}},"undefined"!=typeof document&&(l.A.addListener(document,"keydown",this.keyHandler),l.A.addListener(document,"keyup",this.keyHandler))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isCloneEnabled(){return this.cloneEnabled}setCloneEnabled(t){this.cloneEnabled=t}isMoveEnabled(){return this.moveEnabled}setMoveEnabled(t){this.moveEnabled=t}isSelectEnabled(){return this.selectEnabled}setSelectEnabled(t){this.selectEnabled=t}isRemoveCellsFromParent(){return this.removeCellsFromParent}setRemoveCellsFromParent(t){this.removeCellsFromParent=t}isPropagateSelectionCell(t,e,i){const s=t.getParent();if(e){const e=t.isEdge()?null:t.getGeometry();return!this.graph.isSiblingSelected(t)&&e&&e.relative||!this.graph.isSwimlane(s)}return(!this.graph.isToggleEvent(i.getEvent())||!this.graph.isSiblingSelected(t)&&!this.graph.isCellSelected(t)&&!this.graph.isSwimlane(s)||this.graph.isCellSelected(s))&&(this.graph.isToggleEvent(i.getEvent())||!this.graph.isCellSelected(s))}getInitialCellForEvent(t){let e=t.getState();if((!this.graph.isToggleEvent(t.getEvent())||!(0,c.CA)(t.getEvent()))&&e&&!this.graph.isCellSelected(e.cell)){let i=e.cell.getParent(),s=i?this.graph.view.getState(i):null;for(;s&&!this.graph.isCellSelected(s.cell)&&(s.cell.isVertex()||s.cell.isEdge())&&this.isPropagateSelectionCell(e.cell,!0,t);)e=s,i=e.cell.getParent(),s=i?this.graph.view.getState(i):null}return e?e.cell:null}isDelayedSelection(t,e){let i=t;const s=this.getSelectionCellsHandler();if(!this.graph.isToggleEvent(e.getEvent())||!(0,c.CA)(e.getEvent()))for(;i;){if(s?.isHandled(i)){const t=this.graph.getPlugin("CellEditorHandler");return t?.getEditingCell()!==i}i=i.getParent()}return this.graph.isToggleEvent(e.getEvent())&&!(0,c.CA)(e.getEvent())}selectDelayed(t){const e=this.graph.getPlugin("PopupMenuHandler");if(!e||!e.isPopupTrigger(t)){let e=t.getCell();null===e&&(e=this.cell),e&&this.selectCellForEvent(e,t)}}selectCellForEvent(t,e){const i=this.graph.view.getState(t);if(i)if(e.isSource(i.control))this.graph.selectCellForEvent(t,e.getEvent());else{if(!this.graph.isToggleEvent(e.getEvent())||!(0,c.CA)(e.getEvent())){let i=t.getParent();for(;i&&this.graph.view.getState(i)&&(i.isVertex()||i.isEdge())&&this.isPropagateSelectionCell(t,!1,e);)i=(t=i).getParent()}this.graph.selectCellForEvent(t,e.getEvent())}return t}consumeMouseEvent(t,e){e.consume()}mouseDown(t,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&e.getState()&&!(0,c.DO)(e.getEvent())){const t=this.getInitialCellForEvent(e);if(t&&(this.delayedSelection=this.isDelayedSelection(t,e),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(t,e.getEvent()),this.isMoveEnabled())){const i=t.getGeometry();i&&this.graph.isCellMovable(t)&&(!t.isEdge()||this.graph.getSelectionCount()>1||i.points&&i.points.length>0||!t.getTerminal(!0)||!t.getTerminal(!1)||this.graph.isAllowDanglingEdges()||this.graph.isCloneEvent(e.getEvent())&&this.graph.isCellsCloneable())?this.start(t,e.getX(),e.getY()):this.delayedSelection&&(this.cell=t),this.cellWasClicked=!0,this.consumeMouseEvent(l.A.MOUSE_DOWN,e)}}}getGuideStates(){const t=this.graph.getDefaultParent();return this.graph.view.getCellStates(t.filterDescendants(t=>{const e=t.getGeometry();return!!this.graph.view.getState(t)&&t.isVertex()&&!!e&&!e.relative}))}getCells(t){return!this.delayedSelection&&this.graph.isCellMovable(t)?[t]:this.graph.getMovableCells(this.graph.getSelectionCells())}getPreviewBounds(t){const e=this.getBoundingBox(t);if(e){if(e.width=Math.max(0,e.width-1),e.height=Math.max(0,e.height-1),e.width<this.minimumSize){const t=this.minimumSize-e.width;e.x-=t/2,e.width=this.minimumSize}else e.x=Math.round(e.x),e.width=Math.ceil(e.width);if(e.height<this.minimumSize){const t=this.minimumSize-e.height;e.y-=t/2,e.height=this.minimumSize}else e.y=Math.round(e.y),e.height=Math.ceil(e.height)}return e}getBoundingBox(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.graph.view.getState(t[i]);if(s){let l=null;t[i].isVertex()&&s.shape&&s.shape.boundingBox&&(l=s.shape.boundingBox),l&&(e?e.add(l):e=n.A.fromRectangle(l))}}return e}createPreviewShape(t){const e=new N.A(t,h.x3,this.previewColor);return e.isDashed=!0,this.htmlPreview?(e.dialect="strictHtml",e.init(this.graph.container)):(e.dialect="svg",e.init(this.graph.getView().getOverlayPane()),e.pointerEvents=!1,r.A.IS_IOS&&(e.getSvgScreenOffset=()=>0)),e}createGuide(){return new z(this.graph,this.getGuideStates())}start(t,e,i,n){this.cell=t,this.first=(0,s.ce)(this.graph.container,e,i),this.cells=n||this.getCells(this.cell),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.cloning=!1,this.cellCount=0;for(let t=0;t<this.cells.length;t+=1)this.cellCount+=this.addStates(this.cells[t],this.allCells);if(this.guidesEnabled){this.guide=this.createGuide();const e=t.getParent(),i=e.getChildCount()<2,s=new Map,n=this.graph.getOpposites(this.graph.getEdges(this.cell),this.cell);for(let t=0;t<n.length;t+=1){const e=this.graph.view.getState(n[t]);e&&!s.get(e)&&s.set(e,!0)}this.guide.isStateIgnored=t=>{const n=t.cell.getParent();return!!t.cell&&(!this.cloning&&!!this.isCellMoving(t.cell)||t.cell!==(this.target||e)&&!i&&!s.get(t)&&(!this.target||this.target.getChildCount()>=2)&&n!==(this.target||e))}}}addStates(t,e){const i=this.graph.view.getState(t);let s=0;if(i&&!e.get(t)){e.set(t,i),s++;const n=t.getChildCount();for(let i=0;i<n;i+=1)s+=this.addStates(t.getChildAt(i),e)}return s}isCellMoving(t){return this.allCells.has(t)}useGuidesForEvent(t){return!this.guide||this.guide.isEnabledForEvent(t.getEvent())&&!this.graph.isConstrainedEvent(t.getEvent())}snap(t){const e=this.scaleGrid?this.graph.view.scale:1;return t.x=this.graph.snap(t.x/e)*e,t.y=this.graph.snap(t.y/e)*e,t}getDelta(t){const e=(0,s.ce)(this.graph.container,t.getX(),t.getY());return this.first?new T.A(e.x-this.first.x-this.graph.getPanDx(),e.y-this.first.y-this.graph.getPanDy()):new T.A}updateHint(t){}removeHint(){}roundLength(t){return Math.round(100*t)/100}isValidDropTarget(t,e){return!!this.cell&&this.cell.getParent()!==t}checkPreview(){this.livePreviewActive&&this.cloning?(this.resetLivePreview(),this.livePreviewActive=!1):this.maxLivePreview>=this.cellCount&&!this.livePreviewActive&&this.allowLivePreview?this.cloning&&this.livePreviewActive||(this.livePreviewActive=!0,this.livePreviewUsed=!0):this.livePreviewUsed||this.shape||!this.bounds||(this.shape=this.createPreviewShape(this.bounds))}mouseMove(t,e){const{graph:i}=this;if(!e.isConsumed()&&i.isMouseDown&&this.cell&&this.first&&this.bounds&&!this.suspended){if((0,c.DO)(e.getEvent()))return void this.reset();let t=this.getDelta(e);const s=i.getEventTolerance();if(this.shape||this.livePreviewActive||Math.abs(t.x)>s||Math.abs(t.y)>s){this.highlight||(this.highlight=new F.A(this.graph,h.ag,3));const s=i.isCloneEvent(e.getEvent())&&i.isCellsCloneable()&&this.isCloneEnabled(),n=i.isGridEnabledEvent(e.getEvent()),l=e.getCell();let r=!0,o=null;this.cloning=s,i.isDropEnabled()&&this.highlightEnabled&&this.cells&&(o=i.getDropTarget(this.cells,e.getEvent(),l,s));let a=o?i.getView().getState(o):null,d=!1;if(a&&(s||o&&this.isValidDropTarget(o,e)))this.target!==o&&(this.target=o,this.setHighlightColor(h.ag)),d=!0;else if(this.target=null,this.connectOnDrop&&l&&this.cells&&1===this.cells.length&&l.isVertex()&&l.isConnectable()&&(a=i.getView().getState(l),a)){const t=null===i.getEdgeValidationError(null,this.cell,l)?h.Vm:h.$o;this.setHighlightColor(t),d=!0}a&&d?this.highlight.highlight(a):this.highlight.hide(),this.guide&&this.useGuidesForEvent(e)?(t=this.guide.move(this.bounds,t,n,s),r=!1):t=this.graph.snapDelta(t,this.bounds,!n,!1,!1),this.guide&&r&&this.guide.hide(),i.isConstrainedEvent(e.getEvent())&&(Math.abs(t.x)>Math.abs(t.y)?t.y=0:t.x=0),this.checkPreview(),this.currentDx===t.x&&this.currentDy===t.y||(this.currentDx=t.x,this.currentDy=t.y,this.updatePreview())}this.updateHint(e),this.consumeMouseEvent(l.A.MOUSE_MOVE,e),l.A.consume(e.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!e.isConsumed()&&(e.getState()||e.sourceState)&&!i.isMouseDown){let t=i.getCursorForMouseEvent(e);const s=e.getCell();!t&&s&&i.isEnabled()&&i.isCellMovable(s)&&(t=s.isEdge()?G.cK.cursorMovable:G.NJ.cursorMovable),t&&e.sourceState&&e.sourceState.setCursor(t)}}updatePreview(t=!1){this.livePreviewUsed&&!t?this.cells&&(this.setHandlesVisibleForCells(this.getSelectionCellsHandler()?.getHandledSelectionCells()??[],!1),this.updateLivePreview(this.currentDx,this.currentDy)):this.updatePreviewShape()}updatePreviewShape(){this.shape&&this.pBounds&&(this.shape.bounds=new n.A(Math.round(this.pBounds.x+this.currentDx),Math.round(this.pBounds.y+this.currentDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())}updateLivePreview(t,e){if(!this.suspended){const i=[];if(this.allCells&&this.allCells.forEach(s=>{const n=s?this.graph.view.getState(s.cell):null;if(n!==s&&s&&(s.destroy(),n?this.allCells.set(s.cell,n):this.allCells.delete(s.cell),s=n),s){const n=s.clone();i.push([s,n]),s.shape&&(null===s.shape.originalPointerEvents&&(s.shape.originalPointerEvents=s.shape.pointerEvents),s.shape.pointerEvents=!1,s.text&&(null===s.text.originalPointerEvents&&(s.text.originalPointerEvents=s.text.pointerEvents),s.text.pointerEvents=!1)),s.cell.isVertex()&&(s.x+=t,s.y+=e,this.cloning?s.text&&(s.text.updateBoundingBox(),s.text.boundingBox&&(s.text.boundingBox.x+=t,s.text.boundingBox.y+=e),s.text.unrotatedBoundingBox&&(s.text.unrotatedBoundingBox.x+=t,s.text.unrotatedBoundingBox.y+=e)):(s.view.graph.cellRenderer.redraw(s,!0),s.view.invalidate(s.cell),s.invalid=!1,s.control&&s.control.node&&(s.control.node.style.visibility="hidden")))}}),0===i.length)this.reset();else{const s=this.graph.view.scale;for(let n=0;n<i.length;n+=1){const l=i[n][0];if(l.cell.isEdge()){const r=l.cell.getGeometry(),h=[];if(r&&r.points)for(let i=0;i<r.points.length;i++)r.points[i]&&h.push(new T.A(r.points[i].x+t/s,r.points[i].y+e/s));let o=l.visibleSourceState,a=l.visibleTargetState;const d=i[n][1].absolutePoints;if(null!=o&&this.isCellMoving(o.cell))l.view.updateFixedTerminalPoint(l,o,!0,this.graph.getConnectionConstraint(l,o,!0));else{const i=d[0];i&&(l.setAbsoluteTerminalPoint(new T.A(i.x+t,i.y+e),!0),o=null)}if(null!=a&&this.isCellMoving(a.cell))l.view.updateFixedTerminalPoint(l,a,!1,this.graph.getConnectionConstraint(l,a,!1));else{const i=d[d.length-1];i&&(l.setAbsoluteTerminalPoint(new T.A(i.x+t,i.y+e),!1),a=null)}l.view.updatePoints(l,h,o,a),l.view.updateFloatingTerminalPoints(l,o,a),l.view.updateEdgeLabelOffset(l),l.invalid=!1,this.cloning||l.view.graph.cellRenderer.redraw(l,!0)}}this.graph.view.validate(),this.redrawHandles(i),this.resetPreviewStates(i)}}}redrawHandles(t){const e=this.getSelectionCellsHandler();for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i][0].cell);s?.redraw(!0)}}resetPreviewStates(t){for(let e=0;e<t.length;e+=1)t[e][0].setState(t[e][1])}suspend(){this.suspended||(this.livePreviewUsed&&this.updateLivePreview(0,0),this.shape&&(this.shape.node.style.visibility="hidden"),this.guide&&this.guide.setVisible(!1),this.suspended=!0)}resume(){this.suspended&&(this.suspended=!1,this.livePreviewUsed&&(this.livePreviewActive=!0),this.shape&&(this.shape.node.style.visibility="visible"),this.guide&&this.guide.setVisible(!0))}resetLivePreview(){this.allCells.forEach(t=>{t.shape&&null!==t.shape.originalPointerEvents&&(t.shape.pointerEvents=t.shape.originalPointerEvents,t.shape.originalPointerEvents=null,t.shape.bounds=null,t.text&&null!==t.text.originalPointerEvents&&(t.text.pointerEvents=t.text.originalPointerEvents,t.text.originalPointerEvents=null)),t.control&&t.control.node&&"hidden"===t.control.node.style.visibility&&(t.control.node.style.visibility=""),this.cloning||t.text&&t.text.updateBoundingBox(),t.view.invalidate(t.cell)}),this.graph.view.validate()}setHandlesVisibleForCells(t,e,i=!1){if(i||this.handlesVisible!==e){this.handlesVisible=e;const i=this.getSelectionCellsHandler();for(let s=0;s<t.length;s+=1){const n=i?.getHandler(t[s]);n&&(n.setHandlesVisible(e),e&&n.redraw())}}}setHighlightColor(t){this.highlight&&this.highlight.setHighlightColor(t)}mouseUp(t,e){if(!e.isConsumed())if(this.livePreviewUsed&&this.resetLivePreview(),this.cell&&this.first&&(this.shape||this.livePreviewUsed)&&(0,P.kf)(this.currentDx)&&(0,P.kf)(this.currentDy)){const{graph:t}=this,i=e.getCell();if(this.connectOnDrop&&!this.target&&i&&i.isVertex()&&i.isConnectable()&&t.isEdgeValid(null,this.cell,i)){const s=t.getPlugin("ConnectionHandler");s?.connect(this.cell,i,e.getEvent())}else{const i=t.isCloneEvent(e.getEvent())&&t.isCellsCloneable()&&this.isCloneEnabled(),{scale:s}=t.getView(),n=this.roundLength(this.currentDx/s),l=this.roundLength(this.currentDy/s),r=this.target;r&&t.isSplitEnabled()&&this.cells&&t.isSplitTarget(r,this.cells,e.getEvent())?t.splitEdge(r,this.cells,null,n,l,e.getGraphX(),e.getGraphY()):this.cells&&this.moveCells(this.cells,n,l,i,this.target,e.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(e);this.cellWasClicked&&this.consumeMouseEvent(l.A.MOUSE_UP,e),this.reset()}reset(){this.livePreviewUsed&&(this.resetLivePreview(),this.setHandlesVisibleForCells(this.getSelectionCellsHandler()?.getHandledSelectionCells()??[],!0)),this.destroyShapes(),this.removeHint(),this.delayedSelection=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.cellWasClicked=!1,this.suspended=!1,this.currentDx=0,this.currentDy=0,this.cellCount=0,this.cloning=!1,this.allCells.clear(),this.pBounds=null,this.target=null,this.first=null,this.cells=null,this.cell=null}shouldRemoveCellsFromParent(t,e,i){if(t.isVertex()){const e=this.graph.getView().getState(t);if(e){let t=(0,s.ce)(this.graph.container,(0,c.El)(i),(0,c.xJ)(i));const n=(0,P.eh)(e.style.rotation??0);if(0!==n){const i=Math.cos(-n),s=Math.sin(-n),l=new T.A(e.getCenterX(),e.getCenterY());t=(0,P.Iq)(t,i,s,l)}return!(0,P.gR)(e,t.x,t.y)}}return!1}moveCells(t,e,i,s,n,l){if(!this.cell)return;s&&(t=this.graph.getCloneableCells(t));const r=this.cell.getParent();!n&&r&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(r,t,l)&&(n=this.graph.getDefaultParent()),s=!!s&&!this.graph.isCellLocked(n||this.graph.getDefaultParent()),this.graph.batchUpdate(()=>{const r=[];if(!s&&n&&this.removeEmptyParents){const e=new Map;for(let i=0;i<t.length;i+=1)e.set(t[i],!0);for(let i=0;i<t.length;i+=1){const s=t[i].getParent();s&&!e.get(s)&&(e.set(s,!0),r.push(s))}}t=this.graph.moveCells(t,e,i,s,n,l);const h=[];for(let t=0;t<r.length;t+=1)this.shouldRemoveParent(r[t])&&h.push(r[t]);this.graph.removeCells(h,!1)}),s&&this.graph.setSelectionCells(t),this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(t[0])}shouldRemoveParent(t){const e=this.graph.view.getState(t);return null!=e&&(e.cell.isEdge()||e.cell.isVertex())&&this.graph.isCellDeletable(e.cell)&&0===e.cell.getChildCount()&&e.isTransparentState()}destroyShapes(){this.shape&&(this.shape.destroy(),this.shape=null),this.guide&&(this.guide.destroy(),this.guide=null),this.highlight&&(this.highlight.destroy(),this.highlight=null)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),this.graph.removeListener(this.escapeHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.removeListener(this.refreshHandler),l.A.removeListener(document,"keydown",this.keyHandler),l.A.removeListener(document,"keyup",this.keyHandler),this.destroyShapes(),this.removeHint()}getSelectionCellsHandler(){return this.graph.getPlugin("SelectionCellsHandler")}}_.pluginId="SelectionHandler";const U=_,W=class{constructor(t){this.damper=1/6,this.delay=10,this.handleMouseOut=!0,this.border=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.mouseListener={mouseDown:()=>{},mouseMove:()=>{},mouseUp:()=>{this.active&&this.stop()}},t.addMouseListener(this.mouseListener),this.mouseUpListener=()=>{this.active&&this.stop()},l.A.addListener(document,"mouseup",this.mouseUpListener);const e=()=>(this.scrollbars=(0,s.uM)(t.container),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop,window.setInterval(()=>{if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){const e=-t.container.scrollLeft-Math.ceil(this.dx),i=-t.container.scrollTop-Math.ceil(this.dy);t.panGraph(e,i),t.setPanDx(this.scrollLeft-t.container.scrollLeft),t.setPanDy(this.scrollTop-t.container.scrollTop),t.fireEvent(new v.A(l.A.PAN))}else t.panGraph(this.getDx(),this.getDy())},this.delay));this.isActive=()=>this.active,this.getDx=()=>Math.round(this.tdx),this.getDy=()=>Math.round(this.tdy),this.start=()=>{this.t0x=t.view.translate.x,this.t0y=t.view.translate.y,this.active=!0},this.panTo=(i,s,n=0,l=0)=>{this.active||this.start(),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop;const r=t.container;this.dx=i+n-r.scrollLeft-r.clientWidth,this.dx<0&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.handleMouseOut?this.dx=Math.max(this.dx,0):this.dx=0,0==this.dx&&(this.dx=i-r.scrollLeft,this.dx>0&&this.dx<this.border?this.dx-=this.border:this.handleMouseOut?this.dx=Math.min(0,this.dx):this.dx=0),this.dy=s+l-r.scrollTop-r.clientHeight,this.dy<0&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.handleMouseOut?this.dy=Math.max(this.dy,0):this.dy=0,0==this.dy&&(this.dy=s-r.scrollTop,this.dy>0&&this.dy<this.border?this.dy-=this.border:this.handleMouseOut?this.dy=Math.min(0,this.dy):this.dy=0),0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=e())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)},this.stop=()=>{if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)t.setPanDx(0),t.setPanDy(0),t.fireEvent(new v.A(l.A.PAN));else{const e=t.getPanDx(),i=t.getPanDy();0==e&&0==i||(t.panGraph(0,0),t.view.setTranslate(this.t0x+e/t.view.scale,this.t0y+i/t.view.scale))}},this.destroy=()=>{t.removeMouseListener(this.mouseListener),l.A.removeListener(document,"mouseup",this.mouseUpListener)}}};class Y extends m.A{constructor(t){super(),this.getPanningManager=()=>this.panningManager,this.useLeftButtonForPanning=!1,this.usePopupTrigger=!0,this.ignoreCell=!1,this.previewEnabled=!0,this.useGrid=!1,this.panningEnabled=!1,this.pinchEnabled=!0,this.initialScale=0,this.maxScale=8,this.minScale=.01,this.dx=0,this.dy=0,this.startX=0,this.startY=0,this.dx0=0,this.dy0=0,this.panningTrigger=!1,this.active=!1,this.mouseDownEvent=null,this.graph=t,this.graph.addMouseListener(this),this.forcePanningHandler=(t,e)=>{const i=e.getProperty("eventName"),s=e.getProperty("event");i===l.A.MOUSE_DOWN&&this.isForcePanningEvent(s)&&(this.start(s),this.active=!0,this.fireEvent(new v.A(l.A.PAN_START,{event:s})),s.consume())},this.graph.addListener(l.A.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=(t,e)=>{if(this.isPinchEnabled()){const t=e.getProperty("event");(0,c.fm)(t)||"gesturestart"!==t.type?"gestureend"===t.type&&0!==this.initialScale&&(this.initialScale=0):(this.initialScale=this.graph.view.scale,!this.active&&this.mouseDownEvent&&(this.start(this.mouseDownEvent),this.mouseDownEvent=null)),0!==this.initialScale&&this.zoomGraph(t)}},this.graph.addListener(l.A.GESTURE,this.gestureHandler),this.mouseUpListener=()=>{this.active&&this.reset()},l.A.addListener(document,"mouseup",this.mouseUpListener),this.panningManager=new W(t)}isActive(){return this.active||null!==this.initialScale}isPanningEnabled(){return this.panningEnabled}setPanningEnabled(t){this.panningEnabled=t}isPinchEnabled(){return this.pinchEnabled}setPinchEnabled(t){this.pinchEnabled=t}isPanningTrigger(t){const e=t.getEvent();return this.useLeftButtonForPanning&&!t.getState()&&(0,c.Lg)(e)||(0,c.qt)(e)&&(0,c.RT)(e)||this.usePopupTrigger&&(0,c.$Y)(e)}isForcePanningEvent(t){return this.ignoreCell||(0,c.DO)(t.getEvent())}mouseDown(t,e){this.mouseDownEvent=e,!e.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(e)&&(this.start(e),this.consumePanningTrigger(e))}start(t){this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.startX=t.getX(),this.startY=t.getY(),this.dx=0,this.dy=0,this.panningTrigger=!0}consumePanningTrigger(t){t.consume()}mouseMove(t,e){if(this.dx=e.getX()-this.startX,this.dy=e.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new v.A(l.A.PAN,{event:e}));else if(this.panningTrigger){const t=this.active;this.active=Math.abs(this.dx)>this.graph.getSnapTolerance()||Math.abs(this.dy)>this.graph.getSnapTolerance(),!t&&this.active&&this.fireEvent(new v.A(l.A.PAN_START,{event:e}))}(this.active||this.panningTrigger)&&e.consume()}mouseUp(t,e){if(this.active){if(0!==this.dx&&0!==this.dy){if(!this.graph.isUseScrollbarsForPanning()||!(0,s.uM)(this.graph.container)){const{scale:t}=this.graph.getView(),e=this.graph.getView().translate;this.graph.panGraph(0,0),this.panGraph(e.x+this.dx/t,e.y+this.dy/t)}e.consume()}this.fireEvent(new v.A(l.A.PAN_END,{event:e}))}this.reset()}zoomGraph(t){let e=Math.round(this.initialScale*t.scale*100)/100;e=Math.max(this.minScale,e),e=Math.min(this.maxScale,e),this.graph.view.scale!==e&&(this.graph.zoomTo(e),l.A.consume(t))}reset(){this.panningTrigger=!1,this.mouseDownEvent=null,this.active=!1,this.dx=0,this.dy=0}panGraph(t,e){this.graph.getView().setTranslate(t,e)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.forcePanningHandler),this.graph.removeListener(this.gestureHandler),l.A.removeListener(document,"mouseup",this.mouseUpListener)}}Y.pluginId="PanningHandler";const X=Y;class ${constructor(t){this.graph=t,this.minFitScale=.1,this.maxFitScale=8}fit(t={}){const{border:e=this.graph.getBorder(),keepOrigin:i=!1,margin:n=0,enabled:l=!0,ignoreWidth:r=!1,ignoreHeight:h=!1,maxHeight:o=null}=t,{backgroundImage:a,container:d,view:c}=this.graph;if(d){const t=this.graph.getBorderSizes();let g=d.offsetWidth-t.x-t.width-1,u=o??d.offsetHeight-t.y-t.height-1,p=c.getGraphBounds();if(p.width>0&&p.height>0){i&&null!=p.x&&null!=p.y&&(p=p.clone(),p.width+=p.x,p.height+=p.y,p.x=0,p.y=0);const t=c.scale;let o=p.width/t,f=p.height/t;a&&(o=Math.max(o,a.width-p.x/t),f=Math.max(f,a.height-p.y/t));const y=(i?e:2*e)+n+1;g-=y,u-=y;let m=r?u/f:h?g/o:Math.min(g/o,u/f);const v=this.minFitScale??0,w=this.maxFitScale??1/0;if(m=Math.max(Math.min(m,w),v),!l)return m;if(i)c.scale!=m&&c.setScale(m);else if((0,s.uM)(d)){c.setScale(m);const t=this.graph.getGraphBounds();null!=t.x&&(d.scrollLeft=t.x),null!=t.y&&(d.scrollTop=t.y)}else{const i=null!=p.x?Math.floor(c.translate.x-p.x/t+e/m+n/2):e,s=null!=p.y?Math.floor(c.translate.y-p.y/t+e/m+n/2):e;c.scaleAndTranslate(m,i,s)}}}return c.scale}fitCenter(t){const e=t?.margin??2,{container:i,view:s}=this.graph,n=i.clientWidth-2*e,l=i.clientHeight-2*e,r=this.graph.getGraphBounds(),h=s.scale,o=r.width/h,a=r.height/h;let d=Math.min(this.maxFitScale??1/0,n/o,l/a);Number.isFinite(d)||(d=h);const c=Math.floor(s.translate.x+(i.clientWidth-o*d)/(2*d)-r.x/h),g=Math.floor(s.translate.y+(i.clientHeight-a*d)/(2*d)-r.y/h);return d=Number(d.toFixed(2)),s.scaleAndTranslate(d,c,g),d}onDestroy(){}}$.pluginId="fit";const q=()=>[p,y,x,A,R,U,X,$]},5197:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(6368),n=i(9504),l=i(9760);const r=class{constructor(t,e,i,l){this.strokeWidth=0,this.dashed=!1,this.opacity=100,this.shape=null,this.keepOnTop=!1,this.state=null,this.spacing=2,this.graph=t,this.highlightColor=e??s.Vj,this.strokeWidth=i??s.es,this.dashed=l??!1,this.opacity=s.V8,this.repaintHandler=()=>{if(this.state){const t=this.graph.view.getState(this.state.cell);t?(this.state=t,this.repaint()):this.hide()}},this.graph.getView().addListener(n.A.SCALE,this.repaintHandler),this.graph.getView().addListener(n.A.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(n.A.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getDataModel().addListener(n.A.CHANGE,this.repaintHandler),this.resetHandler=()=>{this.hide()},this.graph.getView().addListener(n.A.DOWN,this.resetHandler),this.graph.getView().addListener(n.A.UP,this.resetHandler)}setHighlightColor(t){this.highlightColor=t,this.shape&&(this.shape.stroke=t)}drawHighlight(){if(this.shape=this.createShape(),this.repaint(),this.shape){const t=this.shape.node;!this.keepOnTop&&t?.parentNode?.firstChild!==t&&t.parentNode&&t.parentNode.insertBefore(t,t.parentNode.firstChild)}}createShape(){if(!this.state)return null;const t=this.graph.cellRenderer.createShape(this.state);return t.svgStrokeTolerance=this.graph.getEventTolerance(),t.points=this.state.absolutePoints,t.apply(this.state),t.stroke=this.highlightColor,t.opacity=this.opacity,t.isDashed=this.dashed,t.isShadow=!1,t.dialect="svg",t.init(this.graph.getView().getOverlayPane()),n.A.redirectMouseEvents(t.node,this.graph,this.state),"svg"!==this.graph.dialect?t.pointerEvents=!1:t.svgPointerEvents="stroke",t}getStrokeWidth(t=null){return this.strokeWidth}repaint(){this.state&&this.shape&&(this.shape.scale=this.state.view.scale,this.state.cell.isEdge()?(this.shape.strokeWidth=this.getStrokeWidth(),this.shape.points=this.state.absolutePoints,this.shape.outline=!1):(this.shape.bounds=new l.A(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=this.state.style.rotation??0,this.shape.strokeWidth=this.getStrokeWidth()/this.state.view.scale,this.shape.outline=!0),this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())}hide(){this.highlight(null)}highlight(t=null){this.state!==t&&(this.shape&&(this.shape.destroy(),this.shape=null),this.state=t,this.state&&this.drawHighlight())}isHighlightAt(t,e){let i=!1;if(this.shape&&document.elementFromPoint){let s=document.elementFromPoint(t,e);for(;s;){if(s===this.shape.node){i=!0;break}s=s.parentNode}}return i}destroy(){const t=this.graph;t.getView().removeListener(this.resetHandler),t.getView().removeListener(this.repaintHandler),t.getDataModel().removeListener(this.repaintHandler),this.shape&&(this.shape.destroy(),this.shape=null)}}},5491:(t,e,i)=>{i.d(e,{A:()=>g});var s=i(9760),n=i(4329),l=i(8302),r=i(6368),h=i(715),o=i(1635),a=i(9504),d=i(3161),c=i(914);const g=class{constructor(t=null){this.preserveImageAspect=!1,this.overlay=null,this.indicator=null,this.indicatorShape=null,this.opacity=100,this.isDashed=!1,this.fill=r.x3,this.gradient=r.x3,this.gradientDirection="east",this.fillOpacity=100,this.strokeOpacity=100,this.stroke=r.x3,this.strokeWidth=1,this.spacing=0,this.startSize=1,this.endSize=1,this.startArrow=r.x3,this.endArrow=r.x3,this.direction="east",this.flipH=!1,this.flipV=!1,this.isShadow=!1,this.isRounded=!1,this.rotation=0,this.cursor="",this.verticalTextRotation=0,this.oldGradients={},this.glass=!1,this.dialect=null,this.scale=1,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.bounds=null,this.points=[],this.state=null,this.style=null,this.boundingBox=null,this.stencil=null,this.svgStrokeTolerance=8,this.pointerEvents=!0,this.originalPointerEvents=null,this.svgPointerEvents="all",this.shapePointerEvents=!1,this.stencilPointerEvents=!1,this.outline=!1,this.visible=!0,this.useSvgBoundingBox=!0,this.image=null,this.imageSrc=null,this.indicatorColor=r.x3,this.indicatorStrokeColor=r.x3,this.indicatorGradientColor=r.x3,this.indicatorDirection="east",this.indicatorImageSrc=null,t&&(this.stencil=t),this.node=this.create()}init(t){this.node.parentNode||t.appendChild(this.node)}initStyles(){this.strokeWidth=1,this.rotation=0,this.opacity=100,this.fillOpacity=100,this.strokeOpacity=100,this.flipH=!1,this.flipV=!1}isHtmlAllowed(){return!1}getSvgScreenOffset(){const t=this.stencil&&"inherit"!==this.stencil.strokeWidthValue?Number(this.stencil.strokeWidthValue):this.strokeWidth??0;return 1===(0,l.zi)(Math.max(1,Math.round(t*this.scale)),2)?.5:0}create(){return document.createElementNS(r.pr,"g")}redraw(){this.updateBoundsFromPoints(),this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)}clear(){for(;this.node.lastChild;)this.node.removeChild(this.node.lastChild)}updateBoundsFromPoints(){const t=this.points;if(t.length>0&&t[0]){this.bounds=new s.A(Math.round(t[0].x),Math.round(t[0].y),1,1);for(const e of t)e&&this.bounds.add(new s.A(Math.round(e.x),Math.round(e.y),1,1))}}getLabelBounds(t){const e=this.style?.direction??"east";let i=t.clone();"south"!==e&&"north"!==e&&this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()&&(i=i.clone(),[i.width,i.height]=[i.height,i.width]);let s=this.getLabelMargins(i);if(s){s=s.clone();let e=this.style?.flipH??!1,i=this.style?.flipV??!1;if(this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()){const t=s.x;s.x=s.height,s.height=s.width,s.width=s.y,s.y=t,[e,i]=[i,e]}return(0,l.Aw)(t,s,this.style,e,i)}return t}getLabelMargins(t){return null}checkBounds(){return!Number.isNaN(this.scale)&&Number.isFinite(this.scale)&&this.scale>0&&this.bounds&&!Number.isNaN(this.bounds.x)&&!Number.isNaN(this.bounds.y)&&!Number.isNaN(this.bounds.width)&&!Number.isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0}redrawShape(){const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.beforePaint(t),this.paint(t),this.afterPaint(t),this.node!==t.root&&t.root&&this.node.insertAdjacentHTML("beforeend",t.root.outerHTML),this.destroyCanvas(t))}createCanvas(){const t=this.createSvgCanvas();return t&&this.outline&&(t.setStrokeWidth(this.strokeWidth),t.setStrokeColor(this.stroke),this.isDashed&&t.setDashed(this.isDashed),t.setStrokeWidth=()=>{},t.setStrokeColor=()=>{},t.setFillColor=()=>{},t.setGradient=()=>{},t.setDashed=()=>{},t.text=()=>{}),t}createSvgCanvas(){if(!this.node)return null;const t=new o.A(this.node,!1);t.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,t.pointerEventsValue=this.svgPointerEvents;const e=this.getSvgScreenOffset();return 0!==e?this.node.setAttribute("transform",`translate(${e},${e})`):this.node.removeAttribute("transform"),t.minStrokeWidth=this.minSvgStrokeWidth,this.antiAlias||(t.format=t=>Math.round(t)),t}destroyCanvas(t){if(t instanceof o.A){for(const e in t.gradients){const i=t.gradients[e];i&&(i.mxRefCount=(i.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients),this.oldGradients=t.gradients}}beforePaint(t){}afterPaint(t){}paint(t){let e=!1;if(t&&this.outline){const{stroke:i}=t;t.stroke=(...s)=>{e=!0,i.apply(t,s)};const{fillAndStroke:s}=t;t.fillAndStroke=(...i)=>{e=!0,s.apply(t,i)}}const i=this.scale,s=this.bounds;if(s){let l=s.x/i,r=s.y/i,o=s.width/i,a=s.height/i;if(this.isPaintBoundsInverted()){const t=(o-a)/2;l+=t,r-=t;const e=o;o=a,a=e}this.updateTransform(t,l,r,o,a),this.configureCanvas(t,l,r,o,a);let d=null;if(!this.stencil&&0===this.points.length&&this.shapePointerEvents||this.stencil&&this.stencilPointerEvents){const t=this.createBoundingBox();t&&this.node&&(d=this.createTransparentSvgRectangle(t.x,t.y,t.width,t.height),this.node.appendChild(d))}if(this.stencil)this.stencil.drawShape(t,this,l,r,o,a);else if(t.setStrokeWidth(this.strokeWidth),this.points.length>0){const e=[];for(let t=0;t<this.points.length;t+=1){const s=this.points[t];s&&e.push(new h.A(s.x/i,s.y/i))}this.paintEdgeShape(t,e)}else this.paintVertexShape(t,l,r,o,a);d&&t.state&&!(0,n.uy)(t.state.transform)&&d.setAttribute("transform",t.state.transform),t&&this.outline&&!e&&(t.rect(l,r,o,a),t.stroke())}}configureCanvas(t,e,i,s,n){let l=null;if(this.style&&null!=this.style.dashPattern&&(l=this.style.dashPattern),t.setAlpha(this.opacity/100),t.setFillAlpha(this.fillOpacity/100),t.setStrokeAlpha(this.strokeOpacity/100),this.isShadow&&t.setShadow(this.isShadow),this.isDashed&&t.setDashed(this.isDashed,this.style?.fixDash??!1),l&&t.setDashPattern(l),this.fill!==r.x3&&this.gradient!==r.x3){const l=this.getGradientBounds(t,e,i,s,n);t.setGradient(this.fill,this.gradient,l.x,l.y,l.width,l.height,this.gradientDirection)}else t.setFillColor(this.fill);t.setStrokeColor(this.stroke)}getGradientBounds(t,e,i,n,l){return new s.A(e,i,n,l)}updateTransform(t,e,i,s,n){t.scale(this.scale),t.rotate(this.getShapeRotation(),this.flipH,this.flipV,e+s/2,i+n/2)}paintVertexShape(t,e,i,s,n){this.paintBackground(t,e,i,s,n),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),this.paintForeground(t,e,i,s,n))}paintBackground(t,e,i,s,n){}paintForeground(t,e,i,s,n){}paintEdgeShape(t,e){}getBaseArcSize(){return(this.style?.arcSize??r.xU)/2}getArcSize(t,e){if(this.style?.absoluteArcSize)return Math.min(this.getBaseArcSize(),Math.min(e,t)/2);const i=(this.style?.arcSize??100*r.fQ)/100;return Math.min(t,e)*i}paintGlassEffect(t,e,i,s,n,l){const r=Math.ceil((this.strokeWidth??0)/2),h=.4;t.setGradient("#ffffff","#ffffff",e,i,s,.6*n,"south",.9,.1),t.begin(),l+=2*r,this.isRounded?(t.moveTo(e-r+l,i-r),t.quadTo(e-r,i-r,e-r,i-r+l),t.lineTo(e-r,i+n*h),t.quadTo(e+.5*s,i+.7*n,e+s+r,i+n*h),t.lineTo(e+s+r,i-r+l),t.quadTo(e+s+r,i-r,e+s+r-l,i-r)):(t.moveTo(e-r,i-r),t.lineTo(e-r,i+n*h),t.quadTo(e+.5*s,i+.7*n,e+s+r,i+n*h),t.lineTo(e+s+r,i-r)),t.close(),t.fill()}addPoints(t,e,i=!1,s,n=!1,r=[],o=!0){if(e.length>0){const a=e[e.length-1];if(n&&i){const t=(e=e.slice())[0],i=new h.A(a.x+(t.x-a.x)/2,a.y+(t.y-a.y)/2);e.splice(0,0,i)}let d=e[0],c=1;for(o?t.moveTo(d.x,d.y):t.lineTo(d.x,d.y);c<(n?e.length:e.length-1);){let n=e[(0,l.zi)(c,e.length)],o=d.x-n.x,a=d.y-n.y;if(i&&(0!==o||0!==a)&&r.indexOf(c-1)<0){let i=Math.sqrt(o*o+a*a);const r=o*Math.min(s,i/2)/i,d=a*Math.min(s,i/2)/i,g=n.x+r,u=n.y+d;t.lineTo(g,u);let p=e[(0,l.zi)(c+1,e.length)];for(;c<e.length-2&&0===Math.round(p.x-n.x)&&0===Math.round(p.y-n.y);)p=e[(0,l.zi)(c+2,e.length)],c++;o=p.x-n.x,a=p.y-n.y,i=Math.max(1,Math.sqrt(o*o+a*a));const f=o*Math.min(s,i/2)/i,y=a*Math.min(s,i/2)/i,m=n.x+f,v=n.y+y;t.quadTo(n.x,n.y,m,v),n=new h.A(m,v)}else t.lineTo(n.x,n.y);d=n,c+=1}n?t.close():t.lineTo(a.x,a.y)}}resetStyles(){this.initStyles(),this.spacing=0,this.fill=r.x3,this.gradient=r.x3,this.gradientDirection="east",this.stroke=r.x3,this.startSize=1,this.endSize=1,this.startArrow=r.x3,this.endArrow=r.x3,this.direction="east",this.isShadow=!1,this.isDashed=!1,this.isRounded=!1,this.glass=!1}apply(t){if(this.state=t,this.style=t.style,this.style){if(this.fill=this.style.fillColor??this.fill,this.gradient=this.style.gradientColor??this.gradient,this.gradientDirection=this.style.gradientDirection??this.gradientDirection,this.opacity=this.style.opacity??this.opacity,this.fillOpacity=this.style.fillOpacity??this.fillOpacity,this.strokeOpacity=this.style.strokeOpacity??this.strokeOpacity,this.stroke=this.style.strokeColor??this.stroke,this.strokeWidth=this.style.strokeWidth??this.strokeWidth,this.spacing=this.style.spacing??this.spacing,this.startSize=this.style.startSize??this.startSize,this.endSize=this.style.endSize??this.endSize,this.startArrow=this.style.startArrow??this.startArrow,this.endArrow=this.style.endArrow??this.endArrow,this.rotation=this.style.rotation??this.rotation,this.direction=this.style.direction??this.direction,this.flipH=!!this.style.flipH,this.flipV=!!this.style.flipV,"north"===this.direction||"south"===this.direction){const t=this.flipH;this.flipH=this.flipV,this.flipV=t}this.isShadow=this.style.shadow??this.isShadow,this.isDashed=this.style.dashed??this.isDashed,this.isRounded=this.style.rounded??this.isRounded,this.glass=this.style.glass??this.glass}}setCursor(t){this.cursor=t,this.node.style.cursor=t}getCursor(){return this.cursor}isRoundable(t,e,i,s,n){return!1}updateBoundingBox(){if(this.useSvgBoundingBox&&this.node.ownerSVGElement)try{const t=this.node.getBBox();if(t.width>0&&t.height>0)return this.boundingBox=new s.A(t.x,t.y,t.width,t.height),void this.boundingBox.grow((this.strokeWidth??0)*this.scale/2)}catch(t){}if(this.bounds){let t=this.createBoundingBox();if(t){this.augmentBoundingBox(t);const e=this.getShapeRotation();0!==e&&(t=(0,l.UX)(t,e))}this.boundingBox=t}}createBoundingBox(){if(!this.bounds)return null;const t=this.bounds.clone();return(this.stencil&&("north"===this.direction||"south"===this.direction)||this.isPaintBoundsInverted())&&t.rotate90(),t}augmentBoundingBox(t){this.isShadow&&(t.width+=Math.ceil(c.m5.shadowOffsetX*this.scale),t.height+=Math.ceil(c.m5.shadowOffsetX*this.scale)),t.grow((this.strokeWidth??0)*this.scale/2)}isPaintBoundsInverted(){return!this.stencil&&("north"===this.direction||"south"===this.direction)}getRotation(){return this.rotation??0}getTextRotation(){let t=this.getRotation();return(this.style?.horizontal??1)||(t+=this.verticalTextRotation||-90),t}getShapeRotation(){let t=this.getRotation();return"north"===this.direction?t+=270:"west"===this.direction?t+=180:"south"===this.direction&&(t+=90),t}createTransparentSvgRectangle(t,e,i,s){const n=document.createElementNS(r.pr,"rect");return n.setAttribute("x",String(t)),n.setAttribute("y",String(e)),n.setAttribute("width",String(i)),n.setAttribute("height",String(s)),n.setAttribute("fill",r.x3),n.setAttribute("stroke",r.x3),n.setAttribute("pointer-events","all"),n}redrawHtmlShape(){}setTransparentBackgroundImage(t){t.style.backgroundImage=`url('${d.A.imageBasePath}/transparent.gif')`}releaseSvgGradients(t){for(const e in t){const i=t[e];i&&(i.mxRefCount=(i.mxRefCount||0)-1,0===i.mxRefCount&&i.parentNode&&i.parentNode.removeChild(i))}}destroy(){a.A.release(this.node),this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node.innerHTML="",this.releaseSvgGradients(this.oldGradients),this.oldGradients={}}}},5964:(t,e,i)=>{i.d(e,{H:()=>s});class s{constructor(){this.values=new Map}add(t,e){this.values.set(t,e)}get(t){return this.values.get(t)??null}getName(t){for(const[e,i]of this.values.entries())if(i===t)return e;return null}clear(){this.values.clear()}}},6172:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(5491);class n extends s.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}}const l=n},6368:(t,e,i)=>{i.d(e,{$g:()=>$,$o:()=>b,CT:()=>W,Cx:()=>q,DK:()=>l,FK:()=>c,FV:()=>Y,Fb:()=>K,G7:()=>f,J8:()=>G,JP:()=>D,Jk:()=>T,MO:()=>P,MQ:()=>H,Mm:()=>d,Mn:()=>k,Q5:()=>tt,QG:()=>r,QX:()=>J,Qu:()=>dt,RH:()=>g,SR:()=>M,SU:()=>A,Sr:()=>X,TE:()=>at,V8:()=>x,VI:()=>O,Vj:()=>p,Vm:()=>S,XA:()=>N,XW:()=>F,XZ:()=>m,Xy:()=>L,aQ:()=>I,ag:()=>C,bF:()=>w,dZ:()=>z,eX:()=>y,en:()=>V,es:()=>v,fQ:()=>et,fm:()=>j,gK:()=>lt,hv:()=>ot,ir:()=>s,jo:()=>u,nh:()=>E,o7:()=>U,pC:()=>nt,pK:()=>o,pr:()=>h,qG:()=>st,r5:()=>B,s4:()=>rt,tK:()=>Z,vd:()=>n,wh:()=>Q,x3:()=>ht,xU:()=>it,y2:()=>a,yS:()=>R,zI:()=>_});const s=.3,n=8,l=0,r="mxObjectId",h="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xlink",a="gray",d=2,c=3,g=1,u=16,p="#00FF00",f="#FF0000",y="#00FF00",m=5,v=3,w=2,x=100,b="#FF0000",C="#0000FF",S="#00FF00",A="#FF0000",E="#00FF00",M="#00FF00",T=1,P=1,H=!0,L=!0,D="#FF0000",k=1,O="#0099FF",V=3,B=6,I=4,R="#00FF00",N="black",z="yellow",F="#0000FF",G="#FF0000",_="#00FFFF",U="#0033FF",W="Arial,Helvetica",Y=11,X="",$=1.2,q="normal",K=!1,j=0,J=40,Q=6,Z=24,tt=30,et=.15,it=20,st=0,nt=30,lt=30,rt=[0,0,827,1169],ht="none",ot={BOLD:1,ITALIC:2,UNDERLINE:4,STRIKETHROUGH:8},at={NONE:0,WEST:1,NORTH:2,SOUTH:4,EAST:8,ALL:15},dt={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12}},6905:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e,i){this.model=t,this.cell=e,this.geometry=i,this.previous=i}execute(){this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous)}}},7208:(t,e,i)=>{i.d(e,{x:()=>s});const s=new(i(5964).H)},7236:(t,e,i)=>{i.d(e,{n:()=>n});var s=i(6368);class n{constructor(){this.styles=new Map,this.putDefaultVertexStyle(this.createDefaultVertexStyle()),this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}createDefaultVertexStyle(){return{shape:"rectangle",perimeter:"rectanglePerimeter",verticalAlign:"middle",align:"center",fillColor:"#C3D9FF",strokeColor:"#6482B9",fontColor:"#774400"}}createDefaultEdgeStyle(){return{shape:"connector",endArrow:"classic",verticalAlign:"middle",align:"center",strokeColor:"#6482B9",fontColor:"#446299"}}putDefaultVertexStyle(t){this.putCellStyle("defaultVertex",t)}putDefaultEdgeStyle(t){this.putCellStyle("defaultEdge",t)}getDefaultVertexStyle(){return this.styles.get("defaultVertex")}getDefaultEdgeStyle(){return this.styles.get("defaultEdge")}putCellStyle(t,e){this.styles.set(t,e)}getCellStyle(t,e){let i=t.ignoreDefaultStyle?{}:{...e};t.baseStyleNames&&(i=t.baseStyleNames.reduce((t,e)=>({...t,...this.styles.get(e)}),i));for(const e of Object.keys(t))void 0!==t[e]&&(t[e]==s.x3?delete i[e]:i[e]=t[e]);return"baseStyleNames"in i&&delete i.baseStyleNames,"ignoreDefaultStyle"in i&&delete i.ignoreDefaultStyle,i}}},7373:(t,e,i)=>{i.d(e,{A:()=>M});var s=i(715),n=i(9760),l=i(9214),r=i(124),h=i(1613),o=i(6368),a=i(3161),d=i(9504),c=i(7895),g=i(8302),u=i(914),p=i(8152),f=i(2039),y=i(8053),m=i(2548);const v=class{constructor(t,e){if(this.view=t,this.root=e,this.previous=e,this.isUp=null===e,!this.isUp){let t=this.view.currentRoot;for(;t;){if(t===e){this.isUp=!0;break}t=t.getParent()}}}execute(){const t=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=t;const e=this.view.graph.getTranslateForRoot(this.view.currentRoot);e&&(this.view.translate=new s.A(-e.x,-e.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0,!0),this.view.validate(null)):this.view.refresh();const i=this.isUp?d.A.UP:d.A.DOWN;this.view.fireEvent(new r.A(i,{root:this.view.currentRoot,previous:this.previous})),this.isUp=!this.isUp}};var w=i(4344),x=i(3439),b=i(8595),C=i(9542),S=i(4329),A=i(4402);class E extends l.A{constructor(t){super(),this.backgroundImage=null,this.backgroundPageShape=null,this.EMPTY_POINT=new s.A,this.doneResource=(0,A.m)()?"done":"",this.updatingDocumentResource=(0,A.m)()?"updatingDocument":"",this.allowEval=!1,this.captureDocumentGesture=!0,this.rendering=!0,this.currentRoot=null,this.graphBounds=new n.A,this.scale=1,this.translate=new s.A,this.states=new Map,this.updateStyle=!1,this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null,this.endHandler=null,this.moveHandler=null,this.graph=t}getGraphBounds(){return this.graphBounds}setGraphBounds(t){this.graphBounds=t}getScale(){return this.scale}setScale(t){const e=this.scale;e!==t&&(this.scale=t,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new r.A(d.A.SCALE,{scale:t,previousScale:e}))}getTranslate(){return this.translate}isRendering(){return this.rendering}setRendering(t){this.rendering=t}setTranslate(t,e){const i=new s.A(this.translate.x,this.translate.y);this.translate.x===t&&this.translate.y===e||(this.translate.x=t,this.translate.y=e,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new r.A(d.A.TRANSLATE,{translate:this.translate,previousTranslate:i}))}isAllowEval(){return this.allowEval}setAllowEval(t){this.allowEval=t}getStates(){return this.states}setStates(t){this.states=t}getCanvas(){return this.canvas}getBackgroundPane(){return this.backgroundPane}getDrawPane(){return this.drawPane}getOverlayPane(){return this.overlayPane}getDecoratorPane(){return this.decoratorPane}getBounds(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.getState(t[i]);s&&(e?e.add(s):e=n.A.fromRectangle(s))}return e}setCurrentRoot(t){if(this.currentRoot!==t){const e=new v(this,t);e.execute();const i=new f.A(this,!0);i.add(e),this.fireEvent(new r.A(d.A.UNDO,{edit:i})),this.graph.sizeDidChange(),this.currentRoot=t}return t}scaleAndTranslate(t,e,i){const n=this.scale,l=new s.A(this.translate.x,this.translate.y);this.scale===t&&this.translate.x===e&&this.translate.y===i||(this.scale=t,this.translate.x=e,this.translate.y=i,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new r.A(d.A.SCALE_AND_TRANSLATE,{scale:t,previousScale:n,translate:this.translate,previousTranslate:l}))}viewStateChanged(){this.revalidate(),this.graph.sizeDidChange()}refresh(){this.currentRoot&&this.clear(),this.revalidate()}revalidate(){this.invalidate(),this.validate()}clear(t,e=!1,i=!0){if(t||(t=this.graph.getDataModel().getRoot()),t)if(this.removeState(t),i&&(e||t!==this.currentRoot)){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.clear(t.getChildAt(s),e)}else this.invalidate(t)}invalidate(t=null,e=!0,i=!0){const s=this.graph.getDataModel();if(t=t??s.getRoot()){const s=this.getState(t);if(s&&(s.invalid=!0),!t.invalidating){if(t.invalidating=!0,e){const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);this.invalidate(s,e,i)}}if(i){const s=t.getEdgeCount();for(let n=0;n<s;n+=1)this.invalidate(t.getEdgeAt(n),e,i)}t.invalidating=!1}}}validate(t=null){const e=u.eo.logger.enter("GraphView.validate");this.resetValidationState();const i=t||(this.currentRoot??this.graph.getDataModel().getRoot());if(i){const t=this.getBoundingBox(this.validateCellState(i?this.validateCell(i):null));this.setGraphBounds(t??this.getEmptyBounds()),this.validateBackground(),this.resetValidationState()}u.eo.logger.leave("GraphView.validate",e)}getEmptyBounds(){return new n.A(this.translate.x*this.scale,this.translate.y*this.scale)}getBoundingBox(t=null,e=!0){let i=null;if(t&&(t.shape&&t.shape.boundingBox&&(i=t.shape.boundingBox.clone()),t.text&&t.text.boundingBox&&(i?i.add(t.text.boundingBox):i=t.text.boundingBox.clone()),e)){const e=t.cell.getChildCount();for(let s=0;s<e;s+=1){const e=this.getBoundingBox(this.getState(t.cell.getChildAt(s)));e&&(i?i.add(e):i=e)}}return i}createBackgroundPageShape(t){return new h.A(t,"white","black")}validateBackground(){this.validateBackgroundImage(),this.validateBackgroundPage()}validateBackgroundImage(){const t=this.graph.getBackgroundImage();if(t){if(!this.backgroundImage||this.backgroundImage.imageSrc!==t.src){this.backgroundImage&&this.backgroundImage.destroy();const e=new n.A(0,0,1,1);this.backgroundImage=new y.A(e,t.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw()}this.redrawBackgroundImage(this.backgroundImage,t)}else this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)}validateBackgroundPage(){const t=this.graph;if(t.pageVisible){const e=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(e),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.backgroundPageShape.node&&(t.isNativeDblClickEnabled()&&d.A.addListener(this.backgroundPageShape.node,"dblclick",e=>{t.dblClick(e)}),d.A.addGestureListeners(this.backgroundPageShape.node,e=>{t.fireMouseEvent(d.A.MOUSE_DOWN,new m.A(e))},e=>{const i=t.getPlugin("TooltipHandler");i&&i.isHideOnHover()&&i.hide(),t.isMouseDown&&!(0,w.fm)(e)&&t.fireMouseEvent(d.A.MOUSE_MOVE,new m.A(e))},e=>{t.fireMouseEvent(d.A.MOUSE_UP,new m.A(e))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=e,this.backgroundPageShape.redraw())}else this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)}getBackgroundPageBounds(){const t=this.graph.pageFormat,e=this.scale*this.graph.pageScale;return new n.A(this.scale*this.translate.x,this.scale*this.translate.y,t.width*e,t.height*e)}redrawBackgroundImage(t,e){if(t.scale=this.scale,t.bounds){const i=t.bounds;i.x=this.scale*this.translate.x,i.y=this.scale*this.translate.y,i.width=this.scale*e.width,i.height=this.scale*e.height}t.redraw()}validateCell(t,e=!0){if(e=e&&t.isVisible(),this.getState(t,e)&&!e)this.removeState(t);else{const i=t.getChildCount();for(let s=0;s<i;s+=1)this.validateCell(t.getChildAt(s),e&&(!t.isCollapsed()||t===this.currentRoot))}return t}validateCellState(t,e=!0){let i=null;if(t&&(i=this.getState(t),i&&(i.invalid&&(i.invalid=!1,i.style&&!i.invalidStyle||(i.style=this.graph.getCellStyle(i.cell),i.invalidStyle=!1),t!==this.currentRoot&&this.validateCellState(t.getParent(),!1),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!0),!1),!0),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!1),!1),!1),this.updateCellState(i),t===this.currentRoot||i.invalid||(this.graph.cellRenderer.redraw(i,!1,this.isRendering()),i.updateCachedBounds())),e&&!i.invalid))){i.shape&&this.stateValidated(i);const e=t.getChildCount();for(let i=0;i<e;i+=1)this.validateCellState(t.getChildAt(i))}return i}updateCellState(t){const e=t.absoluteOffset,i=t.origin;if(e.x=0,e.y=0,i.x=0,i.y=0,t.length=0,t.cell!==this.currentRoot){const s=t.cell.getParent(),n=s?this.getState(s):null;n&&n.cell!==this.currentRoot&&(i.x+=n.origin.x,i.y+=n.origin.y);let l=this.graph.getChildOffsetForCell(t.cell);l&&(i.x+=l.x,i.y+=l.y);const r=t.cell.getGeometry();if(r){if(!t.cell.isEdge())if(l=r.offset?r.offset:this.EMPTY_POINT,r.relative&&n)if(n.cell.isEdge()){const t=this.getPoint(n,r);t&&(i.x+=t.x/this.scale-n.origin.x-this.translate.x,i.y+=t.y/this.scale-n.origin.y-this.translate.y)}else i.x+=r.x*n.unscaledWidth+l.x,i.y+=r.y*n.unscaledHeight+l.y;else e.x=this.scale*l.x,e.y=this.scale*l.y,i.x+=r.x,i.y+=r.y;t.x=this.scale*(this.translate.x+i.x),t.y=this.scale*(this.translate.y+i.y),t.width=this.scale*r.width,t.unscaledWidth=r.width,t.height=this.scale*r.height,t.unscaledHeight=r.height,t.cell.isVertex()&&this.updateVertexState(t,r),t.cell.isEdge()&&this.updateEdgeState(t,r)}}t.updateCachedBounds()}updateVertexState(t,e){const i=t.cell.getParent(),n=i?this.getState(i):null;if(e.relative&&n&&!n.cell.isEdge()){const e=(0,g.eh)(n.style.rotation??0);if(0!==e){const i=Math.cos(e),l=Math.sin(e),r=new s.A(t.getCenterX(),t.getCenterY()),h=new s.A(n.getCenterX(),n.getCenterY()),o=(0,g.Iq)(r,i,l,h);t.x=o.x-t.width/2,t.y=o.y-t.height/2}}this.updateVertexLabelOffset(t)}updateEdgeState(t,e){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1);if(t.cell.getTerminal(!0)&&!i||!i&&!e.getTerminalPoint(!0)||t.cell.getTerminal(!1)&&!s||!s&&!e.getTerminalPoint(!1))this.clear(t.cell,!0);else{this.updateFixedTerminalPoints(t,i,s),this.updatePoints(t,e.points,i,s),this.updateFloatingTerminalPoints(t,i,s);const n=t.absolutePoints;t.cell!==this.currentRoot&&(null==n||n.length<2||null==n[0]||null==n[n.length-1])?this.clear(t.cell,!0):(this.updateEdgeBounds(t),this.updateEdgeLabelOffset(t))}}updateVertexLabelOffset(t){const e=t.style.labelPosition??"center";if("left"===e){let e=t.style.labelWidth??null;null!=e?e*=this.scale:e=t.width,t.absoluteOffset.x-=e}else if("right"===e)t.absoluteOffset.x+=t.width;else if("center"===e){const e=t.style.labelWidth??null;if(null!=e){const i=t.style.align??"center";let s=0;"center"===i?s=.5:"right"===i&&(s=1),0!==s&&(t.absoluteOffset.x-=(e*this.scale-t.width)*s)}}const i=t.style.verticalLabelPosition??"middle";"top"===i?t.absoluteOffset.y-=t.height:"bottom"===i&&(t.absoluteOffset.y+=t.height)}resetValidationState(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null}stateValidated(t){const e=this.graph,i=t.cell.isEdge()&&e.keepEdgesInForeground||t.cell.isVertex()&&e.keepEdgesInBackground,s=i&&this.lastForegroundHtmlNode||this.lastHtmlNode,n=i&&this.lastForegroundNode||this.lastNode,l=e.cellRenderer.insertStateAfter(t,n,s);i?(this.lastForegroundHtmlNode=l[1],this.lastForegroundNode=l[0]):(this.lastHtmlNode=l[1],this.lastNode=l[0])}updateFixedTerminalPoints(t,e,i){this.updateFixedTerminalPoint(t,e,!0,this.graph.getConnectionConstraint(t,e,!0)),this.updateFixedTerminalPoint(t,i,!1,this.graph.getConnectionConstraint(t,i,!1))}updateFixedTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(t,e,i,s),i)}getFixedTerminalPoint(t,e,i,n){let l=null;if(n&&e&&(l=this.graph.getConnectionPoint(e,n,!1)),!l&&!e){const e=this.scale,n=this.translate,r=t.origin;l=t.cell.getGeometry().getTerminalPoint(i),l&&(l=new s.A(e*(n.x+l.x+r.x),e*(n.y+l.y+r.y)))}return l}updateBoundsFromStencil(t){let e=null;if(t&&t.shape&&t.shape.stencil&&"fixed"===t.shape.stencil.aspect){e=n.A.fromRectangle(t);const i=t.shape.stencil.computeAspect(null,t.x,t.y,t.width,t.height);t.setRect(i.x,i.y,t.shape.stencil.w0*i.width,t.shape.stencil.h0*i.height)}return e}updatePoints(t,e,i,s){const n=[];n.push(t.absolutePoints[0]);const l=this.getEdgeStyle(t,e,i,s);if(l&&i){const r=this.getTerminalPort(t,i,!0),h=s?this.getTerminalPort(t,s,!1):null,o=this.updateBoundsFromStencil(r),a=this.updateBoundsFromStencil(h);l(t,r,h,e,n),r&&o&&r.setRect(o.x,o.y,o.width,o.height),h&&a&&h.setRect(a.x,a.y,a.width,a.height)}else if(e)for(let i=0;i<e.length;i+=1)if(e[i]){const s=(0,x.o)(e[i]);n.push(this.transformControlPoint(t,s))}const r=t.absolutePoints;n.push(r[r.length-1]),t.absolutePoints=n}transformControlPoint(t,e,i=!1){if(t&&e){const n=t.origin,l=i?1:this.scale;return new s.A(l*(e.x+this.translate.x+n.x),l*(e.y+this.translate.y+n.y))}return null}isLoopStyleEnabled(t,e=[],i=null,s=null){const n=this.graph.getConnectionConstraint(t,i,!0),l=this.graph.getConnectionConstraint(t,s,!1);return(null==e||e.length<2)&&!t.style.orthogonalLoop&&(null!=n&&null!=n.point||null!=l&&null!=l.point)&&null!=i&&i===s}getEdgeStyle(t,e=[],i=null,s=null){let n=this.isLoopStyleEnabled(t,e,i,s)?t.style.loopStyle??this.graph.defaultLoopStyle:t.style.noEdgeStyle?null:t.style.edgeStyle;if("string"==typeof n){let t=b.O.get(n);!t&&this.isAllowEval()&&(t=(0,S.GP)(n)),n=t}return"function"==typeof n?n:null}updateFloatingTerminalPoints(t,e,i){const s=t.absolutePoints,n=s[0];!s[s.length-1]&&i&&this.updateFloatingTerminalPoint(t,i,e,!1),!n&&e&&this.updateFloatingTerminalPoint(t,e,i,!0)}updateFloatingTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(t,e,i,s),s)}getFloatingTerminalPoint(t,e,i,n){e=this.getTerminalPort(t,e,n);let l=this.getNextPoint(t,i,n);const r=this.graph.isOrthogonal(t),h=(0,g.eh)(e.style.rotation??0),o=new s.A(e.getCenterX(),e.getCenterY());if(0!==h){const t=Math.cos(-h),e=Math.sin(-h);l=(0,g.Iq)(l,t,e,o)}let a=t.style.perimeterSpacing??0;a+=t.style[n?"sourcePerimeterSpacing":"targetPerimeterSpacing"]??0;let d=this.getPerimeterPoint(e,l,0===h&&r,a);if(d&&0!==h){const t=Math.cos(h),e=Math.sin(h);d=(0,g.Iq)(d,t,e,o)}return d}getTerminalPort(t,e,i=!1){const s=i?"sourcePort":"targetPort",n=t.style[s];if(n){const t=this.graph.getDataModel().getCell(n);if(t){const i=this.getState(t,!1);i&&(e=i)}}return e}getPerimeterPoint(t,e,i,n=0){let l=null;if(null!=t){const r=this.getPerimeterFunction(t);if(null!=r&&null!=e){const h=this.getPerimeterBounds(t,n);if(h.width>0||h.height>0){l=new s.A(e.x,e.y);let n=!1,o=!1;t.cell.isVertex()&&(n=!!t.style.flipH,o=!!t.style.flipV,n&&(l.x=2*h.getCenterX()-l.x),o&&(l.y=2*h.getCenterY()-l.y)),l=r(h,t,l,i),null!=l&&(n&&(l.x=2*h.getCenterX()-l.x),o&&(l.y=2*h.getCenterY()-l.y))}}null==l&&(l=this.getPoint(t))}return l}getRoutingCenterX(t){const e=t.style?t.style.routingCenterX??0:0;return t.getCenterX()+e*t.width}getRoutingCenterY(t){const e=t.style?t.style.routingCenterY??0:0;return t.getCenterY()+e*t.height}getPerimeterBounds(t,e=0){return e+=t.style.perimeterSpacing??0,t.getPerimeterBounds(e*this.scale)}getPerimeterFunction(t){let e=t.style.perimeter;if("string"==typeof e){let t=C.h.get(e);null==t&&this.isAllowEval()&&(t=(0,S.GP)(e)),e=t}return"function"==typeof e?e:null}getNextPoint(t,e,i=!1){const n=t.absolutePoints;let l=null;if(n.length>=2){const t=n.length;l=n[i?Math.min(1,t-1):Math.max(0,t-2)]}return!l&&e&&(l=new s.A(e.getCenterX(),e.getCenterY())),l}getVisibleTerminal(t,e){const i=this.graph.getDataModel();let s=t.getTerminal(e),n=s;for(;s&&s!==this.currentRoot;)(n&&!n.isVisible()||s.isCollapsed())&&(n=s),s=s.getParent();return!n||i.contains(n)&&n.getParent()!==i.getRoot()&&n!==this.currentRoot||(n=null),n}updateEdgeBounds(t){const e=t.absolutePoints,i=e[0],s=e[e.length-1];if(i&&s&&(i.x!==s.x||i.y!==s.y)){const e=s.x-i.x,n=s.y-i.y;t.terminalDistance=Math.sqrt(e*e+n*n)}else t.terminalDistance=0;let n=0;const l=[];let r=i;if(r){let i=r.x,s=r.y,h=i,o=s;for(let t=1;t<e.length;t+=1){const a=e[t];if(a){const t=r.x-a.x,e=r.y-a.y,d=Math.sqrt(t*t+e*e);l.push(d),n+=d,r=a,i=Math.min(r.x,i),s=Math.min(r.y,s),h=Math.max(r.x,h),o=Math.max(r.y,o)}}t.length=n,t.segments=l;const a=1;t.x=i,t.y=s,t.width=Math.max(a,h-i),t.height=Math.max(a,o-s)}}getPoint(t,e=null){let i=t.getCenterX(),n=t.getCenterY();if(null==t.segments||null!=e&&!e.relative){if(null!=e){const{offset:t}=e;null!=t&&(i+=t.x,n+=t.y)}}else{const s=null!=e?e.x/2:0,l=t.absolutePoints.length,r=Math.round((s+.5)*t.length);let h=t.segments[0],o=0,a=1;for(;r>=Math.round(o+h)&&a<l-1;)o+=h,h=t.segments[a++];const d=0===h?0:(r-o)/h,c=t.absolutePoints[a-1],g=t.absolutePoints[a];if(null!=c&&null!=g){let t=0,s=0,l=0;if(null!=e){t=e.y;const{offset:i}=e;null!=i&&(s=i.x,l=i.y)}const r=g.x-c.x,o=g.y-c.y,a=0===h?0:o/h,u=0===h?0:r/h;i=c.x+r*d+(a*t+s)*this.scale,n=c.y+o*d-(u*t-l)*this.scale}}return new s.A(i,n)}getRelativePoint(t,e,i){const n=t.cell.getGeometry();if(n){const l=t.absolutePoints,r=l.length;if(n.relative&&r>1){const n=t.length,{segments:h}=t;let o=l[0],a=l[1],d=(0,g.E8)(o.x,o.y,a.x,a.y,e,i),c=0,u=0,p=0;for(let t=2;t<r;t+=1){o=a,a=l[t];const s=(0,g.E8)(o.x,o.y,a.x,a.y,e,i);p+=h[t-2],s<=d&&(d=s,u=t-1,c=p)}const f=h[u];o=l[u],a=l[u+1];const y=o.x,m=o.y,v=a.x,w=a.y;let x=e,b=i;const C=y-v,S=m-w;x-=v,b-=w;let A=0;x=C-x,b=S-b;const E=x*C+b*S;A=E<=0?0:E*E/(C*C+S*S);let M=Math.sqrt(A);M>f&&(M=f);let T=Math.sqrt((0,g.E8)(o.x,o.y,a.x,a.y,e,i));return-1===(0,g._C)(o.x,o.y,a.x,a.y,e,i)&&(T=-T),new s.A((n/2-c-M)/n*-2,T/this.scale)}}return new s.A}updateEdgeLabelOffset(t){const e=t.absolutePoints,i=t.absoluteOffset;if(i.x=t.getCenterX(),i.y=t.getCenterY(),e.length>0&&t.segments){const s=t.cell.getGeometry();if(s)if(s.relative){const e=this.getPoint(t,s);t.absoluteOffset=e}else{const t=e[0],n=e[e.length-1];if(t&&n){const e=n.x-t.x,l=n.y-t.y;let r=0,h=0;const o=s.offset;o&&(r=o.x,h=o.y);const a=t.x+e/2+r*this.scale,d=t.y+l/2+h*this.scale;i.x=a,i.y=d}}}}getState(t,e=!1){let i=this.states.get(t)??null;return e&&(!i||this.updateStyle)&&t.isVisible()&&(i?i.style=this.graph.getCellStyle(t):(i=this.createState(t),this.states.set(t,i))),i}getCellStates(t=null){if(!t)return Array.from(this.states.values());const e=[];for(const i of t){const t=this.getState(i);t&&e.push(t)}return e}removeState(t){const e=this.states.get(t)??null;return this.states.delete(t),e&&(this.graph.cellRenderer.destroy(e),e.invalid=!0,e.destroy()),e}createState(t){return new p.A(this,t,this.graph.getCellStyle(t))}isContainerEvent(t){const e=(0,w.el)(t);return e&&(e===this.graph.container||e.parentNode===this.backgroundPane||e.parentNode&&e.parentNode.parentNode===this.backgroundPane||e===this.canvas.parentNode||e===this.canvas||e===this.backgroundPane||e===this.drawPane||e===this.overlayPane||e===this.decoratorPane)}isScrollEvent(t){const e=this.graph,i=(0,c.A3)(e.container),n=t instanceof MouseEvent?[t.clientX,t.clientY]:[t.touches[0].clientX,t.touches[0].clientY],l=new s.A(n[0]-i.x,n[1]-i.y),r=e.container,h=r.offsetWidth,o=r.clientWidth;if(h>o&&l.x>o+2&&l.x<=h)return!0;const a=r.offsetHeight,d=r.clientHeight;return a>d&&l.y>d+2&&l.y<=a}init(){this.installListeners(),this.createSvg()}installListeners(){const t=this.graph,{container:e}=t;a.A.IS_TOUCH&&(d.A.addListener(e,"gesturestart",e=>{t.fireGestureEvent(e),d.A.consume(e)}),d.A.addListener(e,"gesturechange",e=>{t.fireGestureEvent(e),d.A.consume(e)}),d.A.addListener(e,"gestureend",e=>{t.fireGestureEvent(e),d.A.consume(e)}));let i=null;d.A.addGestureListeners(e,e=>{!this.isContainerEvent(e)||(a.A.IS_GC||a.A.IS_SF)&&this.isScrollEvent(e)||(t.fireMouseEvent(d.A.MOUSE_DOWN,new m.A(e)),i=e.pointerId)},e=>{!this.isContainerEvent(e)||null!==i&&e.pointerId!==i||t.fireMouseEvent(d.A.MOUSE_MOVE,new m.A(e))},e=>{this.isContainerEvent(e)&&t.fireMouseEvent(d.A.MOUSE_UP,new m.A(e)),i=null}),d.A.addListener(e,"dblclick",e=>{this.isContainerEvent(e)&&t.dblClick(e)}),t.addMouseListener({mouseDown:()=>{const e=t.getPlugin("PopupMenuHandler");e?.hideMenu()},mouseMove:()=>{},mouseUp:()=>{}}),this.moveHandler=i=>{const s=t.getPlugin("TooltipHandler");s&&s.isHideOnHover()&&s.hide(),this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(i)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&!(0,w.fm)(i)&&t.fireMouseEvent(d.A.MOUSE_MOVE,new m.A(i,(i=>{let s=null;if(a.A.IS_TOUCH){const n=(0,w.El)(i),l=(0,w.xJ)(i),r=(0,c.ce)(e,n,l),h=t.getCellAt(r.x,r.y);h&&(s=t.view.getState(h))}return s})(i)))},this.endHandler=e=>{this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(e)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&t.fireMouseEvent(d.A.MOUSE_UP,new m.A(e))},d.A.addGestureListeners(document,null,this.moveHandler,this.endHandler)}createSvg(){const{container:t}=this.graph,e=this.canvas=document.createElementNS(o.pr,"g");this.backgroundPane=document.createElementNS(o.pr,"g"),e.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(o.pr,"g"),e.appendChild(this.drawPane),this.overlayPane=document.createElementNS(o.pr,"g"),e.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(o.pr,"g"),e.appendChild(this.decoratorPane);const i=document.createElementNS(o.pr,"svg");i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",i.style.display="block",i.appendChild(this.canvas),null!=t&&(t.appendChild(i),this.updateContainerStyle(t))}createHtml(){const t=this.graph.container;null!=t&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas),this.updateContainerStyle(t))}updateHtmlCanvasSize(t,e){if(null!=this.graph.container){const i=this.graph.container.offsetWidth,s=this.graph.container.offsetHeight;this.canvas.style.width=i<t?t+"px":"100%",this.canvas.style.height=s<e?e+"px":"100%"}}createHtmlPane(t,e){const i=document.createElement("DIV");return null!=t&&null!=e?(i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width=t,i.style.height=e):i.style.position="relative",i}updateContainerStyle(t){const e=(0,c.lY)(t);null!=e&&"static"==e.position&&(t.style.position="relative"),a.A.IS_POINTER&&(t.style.touchAction="none")}destroy(){let t=null;this.canvas&&this.canvas instanceof SVGElement&&(t=this.canvas.ownerSVGElement),t||(t=this.canvas),t&&t.parentNode&&(this.clear(this.currentRoot,!0),d.A.removeGestureListeners(document,null,this.moveHandler,this.endHandler),d.A.release(this.graph.container),t.parentNode.removeChild(t),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)}}const M=E},7625:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e){this.model=t,this.root=e,this.previous=e}execute(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)}}},7738:(t,e,i)=>{i.d(e,{A:()=>d});var s=i(9214),n=i(124),l=i(9504);const r=class{constructor(t,e=[],i=[]){this.graph=t,this.added=e.slice(),this.removed=i.slice()}execute(){const t=this.graph.getSelectionModel();for(const e of this.removed)t.cellRemoved(e);for(const e of this.added)t.cellAdded(e);[this.added,this.removed]=[this.removed,this.added],t.fireEvent(new n.A(l.A.CHANGE,{added:this.added,removed:this.removed}))}};var h=i(2039),o=i(4402);class a extends s.A{constructor(t){super(),this.doneResource=(0,o.m)()?"done":"",this.updatingSelectionResource=(0,o.m)()?"updatingSelection":"",this.singleSelection=!1,this.graph=t,this.cells=[]}isSingleSelection(){return this.singleSelection}setSingleSelection(t){this.singleSelection=t}isSelected(t){return this.cells.indexOf(t)>=0}isEmpty(){return 0===this.cells.length}clear(){this.changeSelection(null,this.cells)}setCell(t){this.setCells(t?[t]:[])}setCells(t){this.singleSelection&&(t=[this.getFirstSelectableCell(t)]);const e=[];for(let i=0;i<t.length;i+=1)this.graph.isCellSelectable(t[i])&&e.push(t[i]);this.changeSelection(e,this.cells)}getFirstSelectableCell(t){for(let e=0;e<t.length;e+=1)if(this.graph.isCellSelectable(t[e]))return t[e];return null}addCell(t){this.addCells([t])}addCells(t){let e=null;if(this.singleSelection){e=this.cells;const i=this.getFirstSelectableCell(t);t=i?[i]:[]}const i=[];for(let e=0;e<t.length;e+=1)!this.isSelected(t[e])&&this.graph.isCellSelectable(t[e])&&i.push(t[e]);this.changeSelection(i,e)}removeCell(t){this.removeCells([t])}removeCells(t){const e=[];for(let i=0;i<t.length;i+=1)this.isSelected(t[i])&&e.push(t[i]);this.changeSelection(null,e)}changeSelection(t=null,e=null){if(t&&t.length>0&&t[0]||e&&e.length>0&&e[0]){const i=new r(this.graph,t||[],e||[]);i.execute();const s=new h.A(this.graph,!1);s.add(i),this.fireEvent(new n.A(l.A.UNDO,{edit:s}))}}cellAdded(t){this.isSelected(t)||this.cells.push(t)}cellRemoved(t){const e=this.cells.indexOf(t);e>=0&&this.cells.splice(e,1)}}const d=a},7821:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e,i,s){this.model=t,this.cell=e,this.terminal=i,this.previous=i,this.source=s}execute(){this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)}}},7895:(t,e,i)=>{i.d(e,{A3:()=>p,FR:()=>c,ID:()=>y,Ko:()=>b,Uj:()=>u,ce:()=>m,fE:()=>w,gU:()=>S,i4:()=>C,jb:()=>f,lY:()=>a,nf:()=>v,oM:()=>A,sc:()=>d,uM:()=>g});var s=i(3161),n=i(6368),l=i(715),r=i(8206),h=i(9760),o=i(4329);const a=t=>t&&"[object ShadowRoot]"!==t.toString()?window.getComputedStyle(t,""):null,d=t=>{"thin"===t?t="2":"medium"===t?t="4":"thick"===t&&(t="6");let e=parseFloat(t);return Number.isNaN(e)&&(e=0),e},c=(t,e,i)=>{let n=null;s.A.IS_SF||s.A.IS_GC?n="Webkit":s.A.IS_MT&&(n="Moz"),t.setProperty(e,i),null!==n&&e.length>0&&(e=n+e.substring(0,1).toUpperCase()+e.substring(1),t.setProperty(e,i))},g=t=>{const e=a(t);return!!e&&("scroll"===e.overflow||"auto"===e.overflow)},u=t=>{const e=(()=>{const t=document.body,e=document.documentElement;try{return new h.A(0,0,t.clientWidth??e.clientWidth,Math.max(t.clientHeight??0,e.clientHeight))}catch(t){return new h.A}})(),i=t.offsetLeft,s=t.offsetWidth,n=f(t.ownerDocument),l=n.x,r=n.y,o=l+e.width;i+s>o&&(t.style.left=`${Math.max(l,o-s)}px`);const a=t.offsetTop,d=t.offsetHeight,c=r+e.height;a+d>c&&(t.style.top=`${Math.max(r,c-d)}px`)},p=(t,e=!1)=>{let i=0,s=0,n=!1,r=t;const h=document.body,o=document.documentElement;for(;null!=r&&r!=h&&r!=o&&!n;){const t=a(r);null!=t&&(n=n||"fixed"==t.position),r=r.parentNode}if(!e&&!n){const e=f(t.ownerDocument);i+=e.x,s+=e.y}const d=t.getBoundingClientRect();return null!=d&&(i+=d.left,s+=d.top),new l.A(i,s)},f=t=>{const e=t.defaultView||t.parentWindow,i=null!=e&&void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,s=null!=e&&void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return new l.A(i,s)},y=(t=null,e=!1,i=!0)=>{const s=null!=t?t.ownerDocument:document,n=s.body,r=s.documentElement,h=new l.A;let o=!1;for(;null!=t&&t!=n&&t!=r;){Number.isNaN(t.scrollLeft)||Number.isNaN(t.scrollTop)||(h.x+=t.scrollLeft,h.y+=t.scrollTop);const i=a(t);null!=i&&(o=o||"fixed"==i.position),t=e?t.parentNode:null}if(!o&&i){const t=f(s);h.x+=t.x,h.y+=t.y}return h},m=(t,e,i)=>{const s=y(t,!1),n=p(t);return n.x-=s.x,n.y-=s.y,new l.A(e-n.x,i-n.y)},v=(t,e,i,s)=>{e.length>0&&t.batchUpdate(()=>{for(let n=0;n<e.length;n+=1){const l=e[n];if(l){const e=l.getClonedStyle();e[i]=s,t.setStyle(l,e)}}})},w=(t,e,i,s,n)=>{e.length>0&&t.batchUpdate(()=>{for(let l=0;l<e.length;l+=1){const r=e[l];if(r){const e=x(r.getClonedStyle(),i,s,n);t.setStyle(r,e)}}})},x=(t,e,i,s)=>{const n=t[e];return t[e]=void 0===n?void 0===s||s?i:0:void 0===s?n^i:s?n|i:n&~i,t},b=(t,e)=>{t.style.opacity=String(e/100)},C=(t,e=n.FV,i=n.CT,s=null,l=null)=>{const r=document.createElement("div");if(r.style.fontFamily=i,r.style.fontSize=`${Math.round(e)}px`,r.style.lineHeight=`${Math.round(e*n.$g)}px`,null!==l){(0,o.bW)(l,n.hv.BOLD)&&(r.style.fontWeight="bold"),(0,o.bW)(l,n.hv.ITALIC)&&(r.style.fontStyle="italic");const t=[];(0,o.bW)(l,n.hv.UNDERLINE)&&t.push("underline"),(0,o.bW)(l,n.hv.STRIKETHROUGH)&&t.push("line-through"),t.length>0&&(r.style.textDecoration=t.join(" "))}r.style.position="absolute",r.style.visibility="hidden",r.style.display="inline-block",null!==s?(r.style.width=`${s}px`,r.style.whiteSpace="normal"):r.style.whiteSpace="nowrap",r.innerHTML=t,document.body.appendChild(r);const a=new h.A(0,0,r.offsetWidth,r.offsetHeight);return document.body.removeChild(r),a},S=(t,e=!0)=>{const i=new Map;return t.sort((t,s)=>{let n=i.get(t);null==n&&(n=r.A.create(t).split(r.A.PATH_SEPARATOR),i.set(t,n));let l=i.get(s);null==l&&(l=r.A.create(s).split(r.A.PATH_SEPARATOR),i.set(s,l));const h=r.A.compare(n,l);return 0==h?0:h>0==e?1:-1}),t},A=(t,e)=>{let i=-.5,s=-.5;return"left"===t?i=0:"right"===t&&(i=-1),"top"===e?s=0:"bottom"===e&&(s=-1),new l.A(i,s)}},8053:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(1613),n=i(6368);class l extends s.A{constructor(t,e,i="#FFFFFF",s="#000000",n=1){super(t,i,s,n),this.imageSrc=e,this.shadow=!1,this.preserveImageAspect=!0}getSvgScreenOffset(){return 0}apply(t){super.apply(t),this.fill=n.x3,this.stroke=n.x3,this.gradient=n.x3,this.style&&null!=this.style.imageAspect&&(this.preserveImageAspect=this.style.imageAspect)}isHtmlAllowed(){return!this.preserveImageAspect}isRoundable(t,e,i,s,n){return!1}paintVertexShape(t,e,i,s,l){if(this.imageSrc){const r=this.style?.imageBackground??n.x3,h=this.style?.imageBorder??n.x3;r!==n.x3&&(t.setFillColor(r),t.setStrokeColor(h),t.rect(e,i,s,l),t.fillAndStroke()),t.image(e,i,s,l,this.imageSrc,this.preserveImageAspect,!1,!1),h!==n.x3&&(t.setShadow(!1),t.setStrokeColor(h),t.rect(e,i,s,l),t.stroke())}else this.paintBackground(t,e,i,s,l)}}const r=l},8152:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(715),n=i(9760),l=i(6368);class r extends n.A{constructor(t=null,e=null,i=null){super(),this.node=null,this.cellBounds=null,this.paintBounds=null,this.boundingBox=null,this.control=null,this.overlays=new Map,this.invalidStyle=!1,this.invalid=!0,this.absolutePoints=[],this.visibleSourceState=null,this.visibleTargetState=null,this.terminalDistance=0,this.length=0,this.segments=[],this.shape=null,this.text=null,this.unscaledWidth=0,this.unscaledHeight=0,this.parentHighlight=null,this.point=null,t&&(this.view=t),e&&(this.cell=e),this.style=i??{},this.origin=new s.A,this.absoluteOffset=new s.A}getPerimeterBounds(t=0,e=new n.A(this.x,this.y,this.width,this.height)){if("fixed"===this.shape?.stencil?.aspect){const t=this.shape.stencil.computeAspect(this.shape,e.x,e.y,e.width,e.height);e.x=t.x,e.y=t.y,e.width=this.shape.stencil.w0*t.width,e.height=this.shape.stencil.h0*t.height}return 0!==t&&e.grow(t),e}setAbsoluteTerminalPoint(t,e=!1){e?0===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[0]=t:0===this.absolutePoints.length?(this.absolutePoints.push(null),this.absolutePoints.push(t)):1===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[this.absolutePoints.length-1]=t}setCursor(t){this.shape&&this.shape.setCursor(t),this.text&&this.text.setCursor(t)}getVisibleTerminal(t=!1){return this.getVisibleTerminalState(t)?.cell??null}getVisibleTerminalState(t=!1){return t?this.visibleSourceState:this.visibleTargetState}setVisibleTerminalState(t,e=!1){e?this.visibleSourceState=t:this.visibleTargetState=t}getCellBounds(){return this.cellBounds}getPaintBounds(){return this.paintBounds}updateCachedBounds(){const t=this.view,e=t.translate,i=t.scale;this.cellBounds=new n.A(this.x/i-e.x,this.y/i-e.y,this.width/i,this.height/i),this.paintBounds=n.A.fromRectangle(this.cellBounds),this.shape&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()}setState(t){this.view=t.view,this.cell=t.cell,this.style=t.style,this.absolutePoints=t.absolutePoints,this.origin=t.origin,this.absoluteOffset=t.absoluteOffset,this.boundingBox=t.boundingBox,this.terminalDistance=t.terminalDistance,this.segments=t.segments,this.length=t.length,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.unscaledWidth=t.unscaledWidth,this.unscaledHeight=t.unscaledHeight}clone(){const t=new r(this.view,this.cell,this.style);for(let e=0;e<this.absolutePoints.length;e+=1){const i=this.absolutePoints[e];t.absolutePoints[e]=i?i.clone():null}return this.origin&&(t.origin=this.origin.clone()),this.absoluteOffset&&(t.absoluteOffset=this.absoluteOffset.clone()),this.boundingBox&&(t.boundingBox=this.boundingBox.clone()),t.terminalDistance=this.terminalDistance,t.segments=this.segments,t.length=this.length,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.unscaledWidth=this.unscaledWidth,t.unscaledHeight=this.unscaledHeight,t}destroy(){this.view.graph.cellRenderer.destroy(this)}isLoop(t){const e=this.getVisibleTerminalState(!0);return e&&e===this.getVisibleTerminalState(!1)}getVerticalAlign(){return this.style.verticalAlign??"middle"}isTransparentState(){return(this.style.strokeColor??l.x3)===l.x3&&(this.style.fillColor??l.x3)===l.x3&&!this.getImageSrc()}getImageSrc(){return this.style.image||null}getIndicatorColor(){return this.style.indicatorColor||null}getIndicatorGradientColor(){return this.style.gradientColor||null}getIndicatorShape(){return this.style.indicatorShape||null}getIndicatorImageSrc(){return this.style.indicatorImage||null}}const h=r},8206:(t,e,i)=>{i.d(e,{A:()=>n});class s{constructor(){throw new Error("Static class can't be instantiated!")}static create(t){let e="",i=t.getParent();for(;i;)e=i.getIndex(t)+s.PATH_SEPARATOR+e,i=(t=i).getParent();const n=e.length;return n>1&&(e=e.substring(0,n-1)),e}static getParentPath(t){const e=t.lastIndexOf(s.PATH_SEPARATOR);return e>=0?t.substring(0,e):t.length>0?"":null}static resolve(t,e){let i=t;const n=e.split(s.PATH_SEPARATOR);for(let t=0;t<n.length;t+=1)i=i.getChildAt(parseInt(n[t]));return i}static compare(t,e){const i=Math.min(t.length,e.length);let s=0;for(let n=0;n<i;n+=1)if(t[n]!==e[n]){if(0===t[n].length||0===e[n].length)s=t[n]===e[n]?0:t[n]>e[n]?1:-1;else{const i=parseInt(t[n]),l=parseInt(e[n]);s=i===l?0:i>l?1:-1}break}if(0===s){const i=t.length,n=e.length;i!==n&&(s=i>n?1:-1)}return s}}s.PATH_SEPARATOR=".";const n=s},8302:(t,e,i)=>{i.d(e,{Aw:()=>p,E$:()=>x,E8:()=>b,HY:()=>y,Iq:()=>d,JQ:()=>u,KP:()=>m,Qg:()=>g,UA:()=>o,UX:()=>a,_C:()=>C,ct:()=>c,eh:()=>h,gR:()=>f,kf:()=>v,zi:()=>w});var s=i(6368),n=i(715),l=i(9760),r=i(4329);const h=t=>Math.PI*t/180,o=(t,e,i,s,n,l,r,h,o)=>{if(h-=t,o-=e,0===i||0===s)return[];const a=r,d=n;i=Math.abs(i),s=Math.abs(s);const c=-h/2,g=-o/2,u=Math.cos(d*Math.PI/180),p=Math.sin(d*Math.PI/180),f=u*c+p*g,y=-1*p*c+u*g,m=f*f,v=y*y,w=i*i,x=s*s,b=m/w+v/x;let C;if(b>1)i=Math.sqrt(b)*i,s=Math.sqrt(b)*s,C=0;else{let t=1;l===a&&(t=-1),C=t*Math.sqrt((w*x-w*v-x*m)/(w*v+x*m))}const S=C*i*y/s,A=-1*C*s*f/i,E=u*S-p*A+h/2,M=p*S+u*A+o/2;let T=Math.atan2((y-A)/s,(f-S)/i)-Math.atan2(0,1),P=T>=0?T:2*Math.PI+T;T=Math.atan2((-y-A)/s,(-f-S)/i)-Math.atan2((y-A)/s,(f-S)/i);let H=T>=0?T:2*Math.PI+T;!a&&H>0?H-=2*Math.PI:a&&H<0&&(H+=2*Math.PI);const L=2*H/Math.PI,D=Math.ceil(L<0?-1*L:L),k=H/D,O=8/3*Math.sin(k/4)*Math.sin(k/4)/Math.sin(k/2),V=u*i,B=u*s,I=p*i,R=p*s;let N=Math.cos(P),z=Math.sin(P),F=-O*(V*z+R*N),G=-O*(I*z-B*N),_=0,U=0;const W=[];for(let i=0;i<D;++i){P+=k,N=Math.cos(P),z=Math.sin(P),_=V*N-R*z+E,U=I*N+B*z+M;const s=-O*(V*z+R*N),n=-O*(I*z-B*N),l=6*i;W[l]=Number(F+t),W[l+1]=Number(G+e),W[l+2]=Number(_-s+t),W[l+3]=Number(U-n+e),W[l+4]=Number(_+t),W[l+5]=Number(U+e),F=_+s,G=U+n}return W},a=(t,e,i=null)=>{let s=null;if(t&&0!==e){const r=h(e),o=Math.cos(r),a=Math.sin(r);i=null!=i?i:new n.A(t.x+t.width/2,t.y+t.height/2);let c=new n.A(t.x,t.y),g=new n.A(t.x+t.width,t.y),u=new n.A(g.x,t.y+t.height),p=new n.A(t.x,u.y);c=d(c,o,a,i),g=d(g,o,a,i),u=d(u,o,a,i),p=d(p,o,a,i),s=new l.A(c.x,c.y,0,0),s.add(new l.A(g.x,g.y,0,0)),s.add(new l.A(u.x,u.y,0,0)),s.add(new l.A(p.x,p.y,0,0))}return s},d=(t,e,i,s=new n.A)=>{const l=t.x-s.x,r=t.y-s.y,h=l*e-r*i,o=r*e+l*i;return new n.A(h+s.x,o+s.y)},c=(t,e,i,n)=>{const l=t.style.portConstraint??(i?e.style.sourcePortConstraint:e.style.targetPortConstraint);if((0,r.uy)(l))return n;const h=l.toString();let o=s.TE.NONE;const a=t.style.portConstraintRotation?t.style.rotation??0:0;let d=0;if(a>45?(d=1,a>=135&&(d=2)):a<-45&&(d=3,a<=-135&&(d=2)),h.indexOf("north")>=0)switch(d){case 0:o|=s.TE.NORTH;break;case 1:o|=s.TE.EAST;break;case 2:o|=s.TE.SOUTH;break;case 3:o|=s.TE.WEST}if(h.indexOf("west")>=0)switch(d){case 0:o|=s.TE.WEST;break;case 1:o|=s.TE.NORTH;break;case 2:o|=s.TE.EAST;break;case 3:o|=s.TE.SOUTH}if(h.indexOf("south")>=0)switch(d){case 0:o|=s.TE.SOUTH;break;case 1:o|=s.TE.WEST;break;case 2:o|=s.TE.NORTH;break;case 3:o|=s.TE.EAST}if(h.indexOf("east")>=0)switch(d){case 0:o|=s.TE.EAST;break;case 1:o|=s.TE.SOUTH;break;case 2:o|=s.TE.WEST;break;case 3:o|=s.TE.NORTH}return o},g=t=>{let e=0;return e=(t&s.TE.WEST)<<3,e|=(t&s.TE.NORTH)<<1,e|=(t&s.TE.SOUTH)>>1,e|=(t&s.TE.EAST)>>3,e},u=(t,e,i)=>{let s=-1;if(t.absolutePoints.length>0){let n=t.absolutePoints[0],l=null;for(let r=1;r<t.absolutePoints.length;r+=1){const h=t.absolutePoints[r];if(!n||!h)continue;const o=b(n.x,n.y,h.x,h.y,e,i);(null==l||o<l)&&(l=o,s=r-1),n=h}}return s},p=(t,e,i,s,n)=>{const r=i?.direction??"east";if(s??(s=i?.flipH??!1),n??(n=i?.flipV??!1),e.x=Math.round(Math.max(0,Math.min(t.width,e.x))),e.y=Math.round(Math.max(0,Math.min(t.height,e.y))),e.width=Math.round(Math.max(0,Math.min(t.width,e.width))),e.height=Math.round(Math.max(0,Math.min(t.height,e.height))),n&&("south"===r||"north"===r)||s&&("east"===r||"west"===r)){const t=e.x;e.x=e.width,e.width=t}if(s&&("south"===r||"north"===r)||n&&("east"===r||"west"===r)){const t=e.y;e.y=e.height,e.height=t}const h=l.A.fromRectangle(e);return"south"===r?(h.y=e.x,h.x=e.height,h.width=e.y,h.height=e.width):"west"===r?(h.y=e.height,h.x=e.width,h.width=e.x,h.height=e.y):"north"===r&&(h.y=e.width,h.x=e.y,h.width=e.height,h.height=e.x),new l.A(t.x+h.x,t.y+h.y,t.width-h.width-h.x,t.height-h.height-h.y)},f=(t,e,i)=>t.x<=e&&t.x+t.width>=e&&t.y<=i&&t.y+t.height>=i,y=(t,e)=>{let i=t.width,s=t.height,n=e.width,l=e.height;if(n<=0||l<=0||i<=0||s<=0)return!1;const r=t.x,h=t.y,o=e.x,a=e.y;return n+=o,l+=a,i+=r,s+=h,(n<o||n>r)&&(l<a||l>h)&&(i<r||i>o)&&(s<h||s>a)},m=(t,e,i,s,r,o)=>{if(r=null!=r?r:0,o=null!=o?o:0,(s=null!=s?s:1)>0){let a=t.getCenterX(),c=t.getCenterY(),g=t.width,u=t.height;const p=t.style,y=(p?.startSize??0)*t.view.scale;y>0&&(p?.horizontal??1?(c=t.y+y/2,u=y):(a=t.x+y/2,g=y)),g=Math.max(r,g*s),u=Math.max(r,u*s),o>0&&(g=Math.min(g,o),u=Math.min(u,o));const m=new l.A(a-g/2,c-u/2,g,u),v=h(p?.rotation??0);if(0!=v){const s=Math.cos(-v),l=Math.sin(-v),r=new n.A(t.getCenterX(),t.getCenterY()),h=d(new n.A(e,i),s,l,r);e=h.x,i=h.y}return f(m,e,i)}return!0},v=t=>!Number.isNaN(parseFloat(t))&&isFinite(+t)&&("string"!=typeof t||t.toLowerCase().indexOf("0x")<0),w=(t,e)=>(t%e+e)%e,x=(t,e,i,s,l,r,h,o)=>{const a=(o-r)*(i-t)-(h-l)*(s-e),d=((h-l)*(e-r)-(o-r)*(t-l))/a,c=((i-t)*(e-r)-(s-e)*(t-l))/a;if(d>=0&&d<=1&&c>=0&&c<=1){const l=t+d*(i-t),r=e+d*(s-e);return new n.A(l,r)}return null},b=(t,e,i,s,n,l)=>{let r,h=(n-=t)*(i-=t)+(l-=e)*(s-=e);h<=0?r=0:(h=(n=i-n)*i+(l=s-l)*s,r=h<=0?0:h*h/(i*i+s*s));let o=n*n+l*l-r;return o<0&&(o=0),o},C=(t,e,i,s,n,l)=>{let r=(n-=t)*(s-=e)-(l-=e)*(i-=t);return 0==r&&(r=n*i+l*s,r>0&&(r=(n-=i)*i+(l-=s)*s,r<0&&(r=0))),r<0?-1:r>0?1:0}},8520:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(6368),n=i(2395),l=i(1997);class r extends n.A{constructor(t,e,i){super(t,e,i)}updateBoundingBox(){this.useSvgBoundingBox=this.style?.curved??!1,super.updateBoundingBox()}paintEdgeShape(t,e){const i=this.createMarker(t,e,!0),s=this.createMarker(t,e,!1);if(super.paintEdgeShape(t,e),t.setShadow(!1),t.setDashed(!1),i){const e=this.style?.startStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.startFillColor??e),i()}if(s){const e=this.style?.endStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.endFillColor??e),s()}}createMarker(t,e,i){if(!this.style)return null;let n=null;const r=e.length,h=(i?this.style.startArrow:this.style.endArrow)||s.x3;let o=i?e[1]:e[r-2];const a=i?e[0]:e[r-1];if(h!==s.x3&&null!==o&&null!==a){let d=1;for(;d<r-1&&0===Math.round(o.x-a.x)&&0===Math.round(o.y-a.y);)o=i?e[1+d]:e[r-2-d],d++;const c=a.x-o.x,g=a.y-o.y,u=Math.max(1,Math.sqrt(c*c+g*g)),p=c/u,f=g/u,y=(i?this.style.startSize:this.style.endSize)??s.wh,m=(i?this.style.startFill:this.style.endFill)??!0;n=l.r.createMarker(t,this,h,a,p,f,y,i,this.strokeWidth,m)}return n}augmentBoundingBox(t){if(super.augmentBoundingBox(t),!this.style)return;let e=0;this.style.startArrow!==s.x3&&(e=(this.style.startSize??s.wh)+1),this.style.endArrow!==s.x3&&(e=Math.max(e,this.style.endSize??s.wh)+1),t.grow(e*this.scale)}}const h=r},8595:(t,e,i)=>{i.d(e,{O:()=>r});var s=i(4329),n=i(5964);class l extends n.H{constructor(){super(...arguments),this.handlerMapping=new Map,this.orthogonalStates=new Map}add(t,e,i){super.add(t,e),i?.handlerKind&&this.handlerMapping.set(e,i.handlerKind),!(0,s.uy)(i?.isOrthogonal)&&this.orthogonalStates.set(e,i.isOrthogonal)}isOrthogonal(t){return this.orthogonalStates.get(t)??!1}getHandlerKind(t){return this.handlerMapping.get(t)??"default"}clear(){super.clear(),this.handlerMapping.clear(),this.orthogonalStates.clear()}}const r=new l},8872:(t,e,i)=>{i.d(e,{Ll:()=>l,M9:()=>n,oH:()=>r,uq:()=>s,wr:()=>h});const s=t=>{const e=["BLOCKQUOTE","DIV","H1","H2","H3","H4","H5","H6","OL","P","PRE","TABLE","UL"],i=[];return function t(s){if(1!=s.length||"BR"!=s[0].nodeName&&"\n"!=s[0].innerHTML)for(let n=0;n<s.length;n+=1){const l=s[n];"BR"==l.nodeName||"\n"==l.innerHTML||(1==s.length||0==n)&&"DIV"==l.nodeName&&"<br>"==l.innerHTML.toLowerCase()?i.push("\n"):(3===l.nodeType||4===l.nodeType?l.nodeValue&&l.nodeValue.length>0&&i.push(l.nodeValue):8!==l.nodeType&&l.childNodes.length>0&&t(Array.from(l.childNodes)),n<s.length-1&&e.indexOf(s[n+1].nodeName)>=0&&i.push("\n"))}}(t),i.join("")},n=(t,e)=>{const i=t.ownerDocument.createTextNode(e);return null!=t&&t.appendChild(i),i},l=(t,e=null,i,s)=>!(null==t||isNaN(t.nodeType)||null!=e&&t.nodeName.toLowerCase()!=e.toLowerCase()||null!=i&&t.getAttribute(i)!=s),r=(t,e)=>{let i=e;for(;null!=i;){if(i===t)return!0;i=i.parentNode}return!1},h=()=>{const t=window.getSelection?window.getSelection():document.selection;t&&(t.removeAllRanges?t.removeAllRanges():t.empty&&t.empty())}},9214:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(124);const n=class{constructor(t=null){this.eventListeners=[],this.eventsEnabled=!0,this.eventSource=null,this.eventSource=t}isEventsEnabled(){return this.eventsEnabled}setEventsEnabled(t){this.eventsEnabled=t}getEventSource(){return this.eventSource}setEventSource(t){this.eventSource=t}addListener(t,e){this.eventListeners.push({name:t,funct:e})}removeListener(t){let e=0;for(;e<this.eventListeners.length;)this.eventListeners[e].funct===t?this.eventListeners.splice(e,1):e+=1}fireEvent(t,e=null){if(this.isEventsEnabled()){t||(t=new s.A("")),e||(e=this.getEventSource()),e||(e=this);for(const i of this.eventListeners)null!==i.name&&i.name!==t.getName()||i.funct.apply(this,[e,t])}}}},9504:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(2548),n=i(3161),l=i(4344);let r=!1;try{document.addEventListener("test",()=>{},Object.defineProperty&&Object.defineProperty({},"passive",{get:()=>{r=!0}}))}catch(t){}class h{static addListener(t,e,i){t.addEventListener(e,i,!!r&&{passive:!1}),t.mxListenerList||(t.mxListenerList=[]);const s={name:e,f:i};t.mxListenerList.push(s)}static removeListener(t,e,i){if(t.removeEventListener(e,i,!1),t.mxListenerList){const e=t.mxListenerList.length;for(let s=0;s<e;s+=1)if(t.mxListenerList[s].f===i){t.mxListenerList.splice(s,1);break}}}static removeAllListeners(t){const e=t.mxListenerList;if(e)for(;e.length>0;){const i=e[0];h.removeListener(t,i.name,i.f)}}static addGestureListeners(t,e=null,i=null,s=null){e&&h.addListener(t,n.A.IS_POINTER?"pointerdown":"mousedown",e),i&&h.addListener(t,n.A.IS_POINTER?"pointermove":"mousemove",i),s&&h.addListener(t,n.A.IS_POINTER?"pointerup":"mouseup",s),!n.A.IS_POINTER&&n.A.IS_TOUCH&&(e&&h.addListener(t,"touchstart",e),i&&h.addListener(t,"touchmove",i),s&&h.addListener(t,"touchend",s))}static removeGestureListeners(t,e,i,s){e&&h.removeListener(t,n.A.IS_POINTER?"pointerdown":"mousedown",e),i&&h.removeListener(t,n.A.IS_POINTER?"pointermove":"mousemove",i),s&&h.removeListener(t,n.A.IS_POINTER?"pointerup":"mouseup",s),!n.A.IS_POINTER&&n.A.IS_TOUCH&&(e&&h.removeListener(t,"touchstart",e),i&&h.removeListener(t,"touchmove",i),s&&h.removeListener(t,"touchend",s))}static redirectMouseEvents(t,e,i=null,n=null,r=null,o=null,a=null){const d=t=>"function"==typeof i?i(t):i;h.addGestureListeners(t,t=>{n?n(t):(0,l.fm)(t)||e.fireMouseEvent(h.MOUSE_DOWN,new s.A(t,d(t)))},t=>{r?r(t):(0,l.fm)(t)||e.fireMouseEvent(h.MOUSE_MOVE,new s.A(t,d(t)))},t=>{o?o(t):(0,l.fm)(t)||e.fireMouseEvent(h.MOUSE_UP,new s.A(t,d(t)))}),h.addListener(t,"dblclick",t=>{if(a)a(t);else if(!(0,l.fm)(t)){const i=d(t);e.dblClick(t,i?.cell)}})}static release(t){try{h.removeAllListeners(t);const e=t.childNodes;if(void 0!==e){const t=e.length;for(let i=0;i<t;i+=1)h.release(e[i])}}catch(t){}}static addMouseWheelListener(t,e){if(null!=t){const i=e=>{e.ctrlKey&&e.preventDefault(),(Math.abs(e.deltaX)>.5||Math.abs(e.deltaY)>.5)&&t(e,0==e.deltaY?-e.deltaX>0:-e.deltaY>0)};if(e=null!=e?e:window,n.A.IS_SF&&!n.A.IS_TOUCH){let i=1;h.addListener(e,"gesturestart",t=>{h.consume(t),i=1}),h.addListener(e,"gesturechange",e=>{if(h.consume(e),"number"==typeof e.scale){const s=i-e.scale;Math.abs(s)>.2&&(t(e,s<0,!0),i=e.scale)}}),h.addListener(e,"gestureend",t=>{h.consume(t)})}else{let i=[],s=0,n=0;h.addGestureListeners(e,t=>{(0,l.Er)(t)||null==t.pointerId||i.push(t)},e=>{if(!(0,l.Er)(e)&&2==i.length){for(let t=0;t<i.length;t+=1)if(e.pointerId==i[t].pointerId){i[t]=e;break}const l=Math.abs(i[0].clientX-i[1].clientX),r=Math.abs(i[0].clientY-i[1].clientY),o=Math.abs(l-s),a=Math.abs(r-n);if(o>h.PINCH_THRESHOLD||a>h.PINCH_THRESHOLD){const e=i[0].clientX+(i[1].clientX-i[0].clientX)/2,h=i[0].clientY+(i[1].clientY-i[0].clientY)/2;t(i[0],o>a?l>s:r>n,!0,e,h),s=l,n=r}}},t=>{i=[],s=0,n=0})}h.addListener(e,"wheel",i)}}static disableContextMenu(t){h.addListener(t,"contextmenu",t=>(t.preventDefault&&t.preventDefault(),!1))}static consume(t,e=!0,i=!0){e&&(t.preventDefault?(i&&t.stopPropagation(),t.preventDefault()):i&&(t.cancelBubble=!0)),t.isConsumed=!0,t.preventDefault||(t.returnValue=!1)}}h.LABEL_HANDLE=-1,h.ROTATION_HANDLE=-2,h.CUSTOM_HANDLE=-100,h.VIRTUAL_HANDLE=-1e5,h.MOUSE_DOWN="mouseDown",h.MOUSE_MOVE="mouseMove",h.MOUSE_UP="mouseUp",h.ACTIVATE="activate",h.RESIZE_START="resizeStart",h.RESIZE="resize",h.RESIZE_END="resizeEnd",h.MOVE_START="moveStart",h.MOVE="move",h.MOVE_END="moveEnd",h.PAN_START="panStart",h.PAN="pan",h.PAN_END="panEnd",h.MINIMIZE="minimize",h.NORMALIZE="normalize",h.MAXIMIZE="maximize",h.HIDE="hide",h.SHOW="show",h.CLOSE="close",h.DESTROY="destroy",h.REFRESH="refresh",h.SIZE="size",h.SELECT="select",h.FIRED="fired",h.FIRE_MOUSE_EVENT="fireMouseEvent",h.GESTURE="gesture",h.TAP_AND_HOLD="tapAndHold",h.GET="get",h.RECEIVE="receive",h.CONNECT="connect",h.DISCONNECT="disconnect",h.SUSPEND="suspend",h.RESUME="resume",h.MARK="mark",h.ROOT="root",h.POST="post",h.OPEN="open",h.SAVE="save",h.BEFORE_ADD_VERTEX="beforeAddVertex",h.ADD_VERTEX="addVertex",h.AFTER_ADD_VERTEX="afterAddVertex",h.DONE="done",h.EXECUTE="execute",h.EXECUTED="executed",h.BEGIN_UPDATE="beginUpdate",h.START_EDIT="startEdit",h.END_UPDATE="endUpdate",h.END_EDIT="endEdit",h.BEFORE_UNDO="beforeUndo",h.UNDO="undo",h.REDO="redo",h.CHANGE="change",h.NOTIFY="notify",h.LAYOUT_CELLS="layoutCells",h.CLICK="click",h.SCALE="scale",h.TRANSLATE="translate",h.SCALE_AND_TRANSLATE="scaleAndTranslate",h.UP="up",h.DOWN="down",h.ADD="add",h.REMOVE="remove",h.CLEAR="clear",h.ADD_CELLS="addCells",h.CELLS_ADDED="cellsAdded",h.MOVE_CELLS="moveCells",h.CELLS_MOVED="cellsMoved",h.RESIZE_CELLS="resizeCells",h.CELLS_RESIZED="cellsResized",h.TOGGLE_CELLS="toggleCells",h.CELLS_TOGGLED="cellsToggled",h.ORDER_CELLS="orderCells",h.CELLS_ORDERED="cellsOrdered",h.REMOVE_CELLS="removeCells",h.CELLS_REMOVED="cellsRemoved",h.GROUP_CELLS="groupCells",h.UNGROUP_CELLS="ungroupCells",h.REMOVE_CELLS_FROM_PARENT="removeCellsFromParent",h.FOLD_CELLS="foldCells",h.CELLS_FOLDED="cellsFolded",h.ALIGN_CELLS="alignCells",h.LABEL_CHANGED="labelChanged",h.CONNECT_CELL="connectCell",h.CELL_CONNECTED="cellConnected",h.SPLIT_EDGE="splitEdge",h.FLIP_EDGE="flipEdge",h.START_EDITING="startEditing",h.EDITING_STARTED="editingStarted",h.EDITING_STOPPED="editingStopped",h.ADD_OVERLAY="addOverlay",h.REMOVE_OVERLAY="removeOverlay",h.UPDATE_CELL_SIZE="updateCellSize",h.ESCAPE="escape",h.DOUBLE_CLICK="doubleClick",h.START="start",h.RESET="reset",h.PINCH_THRESHOLD=10;const o=h},9542:(t,e,i)=>{i.d(e,{h:()=>s});const s=new(i(5964).H)},9715:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e,i,s=0){this.model=t,this.parent=e,this.previous=e,this.child=i,this.index=s,this.previousIndex=s}execute(){let t=this.child.getParent();const e=t?t.getIndex(this.child):0;this.previous||this.connect(this.child,!1),t=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),this.previous&&this.connect(this.child,!0),this.parent=this.previous,this.previous=t,this.index=this.previousIndex,this.previousIndex=e}connect(t,e=!0){const i=t.getTerminal(!0),s=t.getTerminal(!1);i&&(e?this.model.terminalForCellChanged(t,i,!0):this.model.terminalForCellChanged(t,null,!0)),s&&(e?this.model.terminalForCellChanged(t,s,!1):this.model.terminalForCellChanged(t,null,!1)),t.setTerminal(i,!0),t.setTerminal(s,!1);const n=t.getChildCount();for(let i=0;i<n;i+=1)this.connect(t.getChildAt(i),e)}}},9760:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(715);class n extends s.A{constructor(t=0,e=0,i=0,s=0){super(t,e),this._width=0,this._height=0,this.width=i,this.height=s}get width(){return this._width}set width(t){if(Number.isNaN(t))throw new Error("Invalid width supplied.");this._width=t}get height(){return this._height}set height(t){if(Number.isNaN(t))throw new Error("Invalid height supplied.");this._height=t}setRect(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}add(t){const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x+this.width,t.x+t.width),n=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.y=i,this.width=s-e,this.height=n-i}intersect(t){const e=this.x+this.width,i=t.x+t.width,s=this.y+this.height,n=t.y+t.height;this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.width=Math.min(e,i)-this.x,this.height=Math.min(s,n)-this.y}grow(t){this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t}getPoint(){return new s.A(this.x,this.y)}rotate90(){const t=(this.width-this.height)/2;this.x+=t,this.y-=t;const e=this.width;this.width=this.height,this.height=e}equals(t){return!!t&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}clone(){return new n(this.x,this.y,this.width,this.height)}}n.fromRectangle=t=>new n(t.x,t.y,t.width,t.height);const l=n},9827:(t,e,i)=>{i.d(e,{FG:()=>n,R3:()=>l,s7:()=>s});const s=(t,e)=>{if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e)for(let i=0;i<t.length;i+=1){const s=t[i];if(!s||s&&!s.equals(e[i]))return!1}return!0},n=(t,e)=>{let i=0;if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e){for(const t in e)i++;for(const s in t)if(i--,!(Number.isNaN(t[s])&&Number.isNaN(e[s])||t[s]===e[s]))return!1}return 0===i},l=t=>{const e=new Map,i=[];for(let s=0;s<t.length;s+=1)e.get(t[s])||(i.push(t[s]),e.set(t[s],!0));return i}},9866:(t,e,i)=>{i.d(e,{A:()=>x});var s=i(2548),n=i(6368),l=i(715),r=i(9760),h=i(1613),o=i(2223),a=i(2380),d=i(4186),c=i(7236),g=i(7738),u=i(7373);class p extends o.d{initializeCollaborators(t){this.cellRenderer=t?.cellRenderer??new d.A,this.model=t?.model??new a.A,this.setSelectionModel(t?.selectionModel?.(this)??new g.A(this)),this.setStylesheet(t?.stylesheet??new c.n),this.view=t?.view?.(this)??new u.A(this)}}var f=i(8053),y=i(9504),m=i(4344),v=i(7895),w=i(4885);const x=class{constructor(t,e){this.sizer=null,this.selectionBorder=null,this.updateHandler=null,this.refreshHandler=null,this.panHandler=null,this.active=null,this.bounds=null,this.zoom=!1,this.startX=null,this.startY=null,this.dx0=null,this.dy0=null,this.index=null,this.outline=null,this.graphRenderHint="exact",this.enabled=!0,this.showViewport=!0,this.border=10,this.sizerSize=8,this.labelsVisible=!1,this.updateOnPan=!1,this.sizerImage=null,this.minScale=1e-4,this.suspended=!1,this.source=t,e&&this.init(e)}init(t){this.outline=this.createGraph(t);const e=this.outline.graphModelChanged;this.outline.graphModelChanged=t=>{this.suspended||null==this.outline||e.apply(this.outline,[t])},this.outline.labelsVisible=this.labelsVisible,this.outline.setEnabled(!1),this.updateHandler=(t,e)=>{this.suspended||this.active||this.update()},this.source.getDataModel().addListener(y.A.CHANGE,this.updateHandler),this.outline.addMouseListener(this);const i=this.source.getView();i.addListener(y.A.SCALE,this.updateHandler),i.addListener(y.A.TRANSLATE,this.updateHandler),i.addListener(y.A.SCALE_AND_TRANSLATE,this.updateHandler),i.addListener(y.A.DOWN,this.updateHandler),i.addListener(y.A.UP,this.updateHandler),y.A.addListener(this.source.container,"scroll",this.updateHandler),this.panHandler=(t,e)=>{this.updateOnPan&&this.updateHandler(t,e)},this.source.addListener(y.A.PAN,this.panHandler),this.refreshHandler=t=>{const e=this.outline;e?.setStylesheet(this.source.getStylesheet()),e?.refresh()},this.source.addListener(y.A.REFRESH,this.refreshHandler),this.bounds=new r.A(0,0,0,0),this.selectionBorder=new h.A(this.bounds,n.x3,n.VI,n.en),this.selectionBorder.dialect=this.outline.dialect,this.selectionBorder.init(this.outline.getView().getOverlayPane());const l=this.selectionBorder.node,o=t=>{const e=(0,m.el)(t),i=t=>{const e=this.outline;e?.fireMouseEvent(y.A.MOUSE_MOVE,new s.A(t))},n=t=>{const l=this.outline;y.A.removeGestureListeners(e,null,i,n),l?.fireMouseEvent(y.A.MOUSE_UP,new s.A(t))},l=this.outline;y.A.addGestureListeners(e,null,i,n),l?.fireMouseEvent(y.A.MOUSE_DOWN,new s.A(t))};y.A.addGestureListeners(this.selectionBorder.node,o);const a=this.sizer=this.createSizer(),d=a.node;a.init(this.outline.getView().getOverlayPane()),this.enabled&&(d.style.cursor="nwse-resize"),y.A.addGestureListeners(this.sizer.node,o),l.style.display=this.showViewport?"":"none",d.style.display=l.style.display,l.style.cursor="move",this.update(!1)}createGraph(t){const e=new p({container:t,model:this.source.getDataModel(),plugins:(0,w.qG)(),stylesheet:this.source.getStylesheet()});return e.options.foldingEnabled=!1,e.autoScroll=!1,e}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setZoomEnabled(t){this.sizer.node.style.visibility=t?"visible":"hidden"}refresh(){this.update(!0)}createSizer(){const t=this.outline;if(null!=this.sizerImage){const e=new f.A(new r.A(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src);return t&&(e.dialect=t.dialect),e}const e=new h.A(new r.A(0,0,this.sizerSize,this.sizerSize),n.zI,n.o7);return t&&(e.dialect=t.dialect),e}getSourceContainerSize(){return new r.A(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)}getOutlineOffset(t){return null}getSourceGraphBounds(){return this.source.getGraphBounds()}update(t=!1){if(null!=this.source&&null!=this.source.container&&null!=this.outline&&null!=this.outline.container){const e=this.source.view.scale,i=this.getSourceGraphBounds(),s=new r.A(i.x/e+this.source.panDx,i.y/e+this.source.panDy,i.width/e,i.height/e),n=new r.A(0,0,this.source.container.clientWidth/e,this.source.container.clientHeight/e),l=s.clone();l.add(n);const h=this.getSourceContainerSize(),o=Math.max(h.width/e,l.width),a=Math.max(h.height/e,l.height),d=Math.max(0,this.outline.container.clientWidth-this.border),c=Math.max(0,this.outline.container.clientHeight-this.border),g=Math.min(d/o,c/a);let u=Number.isNaN(g)?this.minScale:Math.max(this.minScale,g);if(u>0){this.outline.getView().scale!==u&&(this.outline.getView().scale=u,t=!0);const e=this.outline.getView();e.currentRoot!==this.source.getView().currentRoot&&e.setCurrentRoot(this.source.getView().currentRoot);const i=this.source.view.translate;let n=i.x+this.source.panDx,l=i.y+this.source.panDy;const h=this.getOutlineOffset(u);null!=h&&(n+=h.x,l+=h.y),s.x<0&&(n-=s.x),s.y<0&&(l-=s.y),e.translate.x===n&&e.translate.y===l||(e.translate.x=n,e.translate.y=l,t=!0);const o=e.translate;u=this.source.getView().scale;const a=u/e.scale,d=1/e.scale,{container:c}=this.source;this.bounds=new r.A((o.x-i.x-this.source.panDx)/d,(o.y-i.y-this.source.panDy)/d,c.clientWidth/a,c.clientHeight/a),this.bounds.x+=this.source.container.scrollLeft*e.scale/u,this.bounds.y+=this.source.container.scrollTop*e.scale/u;const g=this.selectionBorder;let p=g.bounds;p.x===this.bounds.x&&p.y===this.bounds.y&&p.width===this.bounds.width&&p.height===this.bounds.height||(g.bounds=this.bounds,g.redraw());const f=this.sizer;p=f.bounds;const y=new r.A(this.bounds.x+this.bounds.width-p.width/2,this.bounds.y+this.bounds.height-p.height/2,p.width,p.height);p.x===y.x&&p.y===y.y&&p.width===y.width&&p.height===y.height||(f.bounds=y,"hidden"!==f.node.style.visibility&&f.redraw()),t&&this.outline.view.revalidate()}}}mouseDown(t,e){if(this.enabled&&this.showViewport){const t=(0,m.Er)(e.getEvent())?0:this.source.tolerance,i=t>0?new r.A(e.getGraphX()-t,e.getGraphY()-t,2*t,2*t):null;this.zoom=e.isSource(this.sizer)||null!=i&&intersects(this.sizer.bounds,i),this.startX=e.getX(),this.startY=e.getY(),this.active=!0;const s=this.source.container;this.source.useScrollbarsForPanning&&(0,v.uM)(this.source.container)?(this.dx0=s.scrollLeft,this.dy0=s.scrollTop):(this.dx0=0,this.dy0=0)}e.consume()}mouseMove(t,e){if(this.active){const t=this.bounds,i=this.sizer,s=i.node,n=this.selectionBorder,l=n.node,h=this.source,o=this.outline;l.style.display=this.showViewport?"":"none",s.style.display=l.style.display;const a=this.getTranslateForEvent(e);let d=a.x,c=a.y,g=null;if(o&&!this.zoom){const{scale:e}=o.getView();g=new r.A(t.x+d,t.y+c,t.width,t.height),n.bounds=g,n.redraw(),d/=e,d*=h.getView().scale,c/=e,c*=h.getView().scale,h.panGraph(-d-this.dx0,-c-this.dy0)}else{const{container:e}=this.source;c=d/(e.clientWidth/e.clientHeight),g=new r.A(t.x,t.y,Math.max(1,t.width+d),Math.max(1,t.height+c)),n.bounds=g,n.redraw()}const u=i.bounds;i.bounds=new r.A(g.x+g.width-u.width/2,g.y+g.height-u.height/2,u.width,u.height),"hidden"!==s.style.visibility&&i.redraw(),e.consume()}}getTranslateForEvent(t){return new l.A(t.getX()-this.startX,t.getY()-this.startY)}mouseUp(t,e){if(this.active){const t=this.getTranslateForEvent(e);let i=t.x,s=t.y;const n=this.source,l=this.outline,r=this.selectionBorder;if(Math.abs(i)>0||Math.abs(s)>0){if(this.zoom){const t=r.bounds.width,{scale:e}=n.getView();n.zoomTo(Math.max(this.minScale,e-i*e/t),!1)}else if(l&&(!n.useScrollbarsForPanning||!(0,v.uM)(n.container))){n.panGraph(0,0),i/=l.getView().scale,s/=l.getView().scale;const t=n.getView().translate;n.getView().setTranslate(t.x-i,t.y-s)}this.update(),e.consume()}this.index=null,this.active=!1}}destroy(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getDataModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),y.A.removeListener(this.source.container,"scroll",this.updateHandler),this.source=null),null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null),null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null),null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)}}}}]);